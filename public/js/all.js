!function(e){function t(n){if(o[n])return o[n].exports;var a=o[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,t,o){Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var o=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=51)}([function(e,t){"use strict";var o=angular.module("besafe",["besafe.constants","ngCookies","ngMaterial","ngAnimate","ngAria"]);o.config(function(){}).run(["$http","$rootScope","$cookies","Users","Modals","$location","$anchorScroll",function(e,t,o,n,a,r,i){function s(){var t=o.get("cart-uuid");if(t&&t.length>0)console.log("Cart cookie found");else{var n=c();console.log("setting cart cookie"),o.put("cart-uuid",n,{path:"/"})}e.defaults.headers.common["X-device-id"]=t}function c(){var e=(new Date).getTime(),t=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){var n=16*Math.random();return e>0?(n=(e+n)%16|0,e=Math.floor(e/16)):(n=(t+n)%16|0,t=Math.floor(t/16)),("x"===o?n:3&n|8).toString(16)})}function l(){console.log("Get cart"),t.$broadcast("updateHeadCart")}console.log("Searching for user"),angular.element(document).ready(function(){var e=window.innerWidth;console.log("Screen width: ",e);window.location.href;e<450&&setTimeout(function(){var e=r.hash();r.hash("mobile-anchor"),i(),r.hash(e)},1500)}),s(),n.getUser().then(function(e){console.log("user loaded",e),t.user=e.user,t.hasSavedCard=e.savedCard,e.merchants>0?t.hasMerchants=!0:t.hasMerchants=!1,console.log("Has saved card",t.hasSavedCard),t.$broadcast("user_loaded")},function(e){}),l();var d=o.get("shippingAddress");d&&d.length>0&&(t.shippingAddress=JSON.parse(d));var u=a.getAllUrlParams(null);console.log("Checking params",u),u&&(u.merchant_id&&u.merchant_id.length>0&&(t.merchant_id=u.merchant_id),u.lat&&u.lat.length>0&&(console.log("saving lat"),t.lat=u.lat)),e.defaults.headers.common.Accept="application/json",t.changeShippingHeader=function(){console.log("changeShippingHeader"),t.$broadcast("updateShippingAddress")}}])},function(e,t){angular.module("besafe.constants",[]).constant("API",{address:"http://lonchis.com.co/api",website:"http://lonchis.com.co",avatar:"http://lonchis.com.co/avatars/avatar.jpg"})},function(e,t){angular.module("besafe").controller("PersonalTokensCtrl",["$scope","Passport","$rootScope",function(e,t,o){e.data={},e.data.scopes=[],e.personalAccessTokens,e.showForm=!1,e.showToken=!1,angular.element(document).ready(function(){e.getPersonalAccessTokens()}),e.save=function(n){e.submitted=!0,n&&(e.data.scopes=[""],t.createPersonalAccessToken($.param(e.data)).then(function(t){e.token=t.accessToken,e.personalAccessTokens.push(t.token),o.$broadcast("getTokens"),e.data={},e.data.scopes=[],e.submitted=!1,e.showToken=!0,e.showForm=!1},function(e){}))},e.getPersonalAccessTokens=function(){t.getPersonalAccessTokens().then(function(t){e.personalAccessTokens=t},function(e){}),t.getScopes().then(function(t){e.scopes=t},function(e){})},e.deletePersonalToken=function(o){t.deletePersonalAccessTokens(o).then(function(){for(item in e.personalAccessTokens)e.personalAccessTokens[item].id==o&&e.personalAccessTokens.splice(item,1)},function(e){})},e.clean=function(){e.data={}},e.newPersonalAccessToken=function(){e.showForm=!0,e.showToken=!1}}]).controller("OauthClientsCtrl",["$scope","Passport","Users",function(e,t,o){e.data={},e.oauthClients,e.showForm=!1,angular.element(document).ready(function(){e.getOauthClients()}),e.save=function(o){e.submitted=!0,o&&(e.data.id?t.updateOauthClient($.param(e.data),e.data.id).then(function(t){e.updateOauthClient(t),e.showForm=!1,e.data={},e.submitted=!1},function(e){}):t.createOauthClient($.param(e.data)).then(function(t){e.oauthClients.push(t),e.showForm=!1,e.data={},e.submitted=!1},function(e){}))},e.updateOauthClient=function(t){for(item in e.oauthClients)e.oauthClients[item].id==t.id&&(e.oauthClients.splice(item,1),e.oauthClients.push(t))},e.getOauthClients=function(){t.getOauthClients().then(function(t){e.oauthClients=t},function(e){})},e.newOauthClient=function(){e.showForm=!0},e.editOauthClient=function(t){e.showForm=!0,e.data.id=angular.element(document.querySelector("tr#oauthClient-"+t+" span.id")).html(),e.data.name=angular.element(document.querySelector("tr#oauthClient-"+t+" span.name")).html(),e.data.redirect=angular.element(document.querySelector("tr#oauthClient-"+t+" span.redirect")).html()},e.deleteOauthClient=function(o){t.deleteOauthClient(o).then(function(t){for(item in e.oauthClients)e.oauthClients[item].id==o&&(console.log("deleting oauthClient",e.oauthClients[item]),e.oauthClients.splice(item,1))},function(e){})},e.clean=function(){e.data={}}}]).controller("TokensCtrl",["$scope","Passport","$rootScope",function(e,t,o){e.tokens,angular.element(document).ready(function(){e.getTokens()}),o.$on("getTokens",function(t,o){e.getTokens()}),e.getTokens=function(){t.getTokens().then(function(t){e.tokens=t},function(e){})},e.deleteToken=function(o){t.deleteTokens(o).then(function(){for(item in e.tokens)e.tokens[item].id==o&&e.tokens.splice(item,1)},function(e){})}}])},function(e,t){angular.module("besafe").controller("AddressesCtrl",["$scope","$rootScope","LocationService","Addresses","$mdDialog","Modals","$cookies",function(e,t,o,n,a,r,i){e.data={},e.addresses,e.regionVisible=!1,e.editAddress=!1,angular.element(document).ready(function(){e.getAddresses();var n="",a=i.get("creating_address");a&&(i.remove("creating_address",{path:"/"}),console.log("creat",i.get("creating_address")),console.log("Loading address from cookie",t.shippingAddress),e.editAddress=!0,e.data=t.shippingAddress,e.data.address_id=t.shippingAddress.id,e.data.name&&e.data.name.length>0||(e.data.name=t.user.name),e.data.phone&&e.data.phone.length>0||(e.data.phone=t.user.cellphone),e.selectPlace(e.data.country_id,e.data.region_id)),o.getCountries(n).then(function(t){e.countries=t.data},function(e){})}),e.save=function(t){if(e.submitted=!0,t){var o=!1;i.remove("creating_address",{path:"/"}),i.remove("creating_address",{path:"/"}),i.remove("creating_address",{path:"/"}),e.data.address_id&&(o=!0),n.saveAddress(e.data).then(function(t){"success"==t.status?(r.showToast("Actualizacion exitosa",$("#myaccountContent")),o?e.updateAddress(t.address):e.addresses.push(t.address),e.data={},e.editAddress=!1):r.showToast("Hubo un error porfavor comunicate con soporte",$("#myaccountContent")),e.submitted=!1},function(e){})}},e.getAddresses=function(){n.getAddresses().then(function(t){e.addresses=t.addresses},function(e){})},e.newAddress=function(){a.show(r.getLocationPrompt()).then(function(e){"map"==e?(i.put("locationRefferrer",window.location.href,{path:"/"}),i.put("creating_address",!0,{path:"/"}),window.location.href="/location"):"address"==e&&showAdvanced()},function(){})},e.deleteAddress=function(t){i.remove("shippingAddress",{path:"/"}),n.deleteAddress(t.id).then(function(o){for(item in e.addresses)console.log("a",e.addresses[item].id),console.log("b",t.id),console.log("c",e.addresses[item].id==t.id),e.addresses[item].id==t.id&&(console.log("deleting address",e.addresses[item]),e.addresses.splice(item,1))},function(e){})},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.updateAddress=function(t){for(item in e.addresses)e.addresses[item].id==t.id&&(e.addresses.splice(item,1),e.addresses.push(t))},e.selectCountry=function(){for(item in e.countries)e.countries[item].id==e.data.country_id&&(e.data.country=e.countries[item].country_iso);o.getRegionsCountry(e.data.country_id).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1},function(e){})},e.selectRegion=function(){for(item in e.regions)e.countries[item].id==e.data.region_id&&(e.data.region=e.countries[item].name);o.getCitiesRegion(e.data.region_id).then(function(t){e.cities=t.data,e.cityVisible=!0,console.log("Setting cities",e.cities)},function(e){})},e.selectPlace=function(t,n,a){e.data.country_id=t,o.getRegionsCountry(t).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1,console.log("Setting region",e.data.region_id),e.data.region_id=n,o.getCitiesRegion(n).then(function(t){e.cities=t.data,e.cityVisible=!0,console.log("Setting city_id",e.data.city_id),console.log("Setting cities",e.cities),e.data.city_id=a},function(e){})},function(e){})},e.editAddressObj=function(t){if(e.editAddress=!0,t.lat)i.put("shippingAddress",JSON.stringify(t),{path:"/"}),i.put("locationRefferrer",window.location.href,{path:"/"}),i.put("creating_address",!0,{path:"/"}),window.location.href="/location";else for(item in e.addresses)e.addresses[item].id==t.id&&(e.data=e.addresses[item],e.data.address_id=t.id,e.selectPlace(e.data.country_id,e.data.region_id))}}])},function(e,t){angular.module("besafe").controller("AdminCategoriesCtrl",["$scope","ProductImport",function(e,t){e.data={},e.items=[],e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems()}),e.buildItemData=function(e){return e},e.getItems=function(){e.page++;var o="order_by=id,desc&page="+e.page;t.getCategories(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1),console.log("Items",t.data);var o=t.data;for(item in o)o[item]=e.buildItemData(o[item]);e.items=e.items.concat(o)},function(e){})},e.updateItem=function(e){t.updateCategoryItem(e).then(function(e){},function(e){})},e.deleteItem=function(e){t.deleteCategoryItem(e).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("AdminMerchantsCtrl",["$scope","ProductImport",function(e,t){e.data={},e.items=[],e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems()}),e.buildItemData=function(e){return e},e.getItems=function(){e.page++;var o="order_by=id,desc&page="+e.page;t.getMerchants(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1),console.log("Items",t.data);var o=t.data;for(item in o)o[item]=e.buildItemData(o[item]);e.items=e.items.concat(o)},function(e){})},e.updateItem=function(e){t.updateMerchantItem(e).then(function(e){},function(e){})},e.deleteItem=function(e){t.deleteMerchantItem(e).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("AdminProductsCtrl",["$scope","ProductImport",function(e,t){e.data={},e.items=[],e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems()}),e.buildItemData=function(e){return e},e.getItems=function(){e.page++;var o="order_by=id,desc&includes=productVariants,categories&page="+e.page;t.getProducts(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1),console.log("Items",t.data);var o=t.data;for(item in o)o[item]=e.buildItemData(o[item]);e.items=e.items.concat(o)},function(e){})},e.updateItem=function(e){t.updateProductItem(e).then(function(e){},function(e){})},e.deleteItem=function(e){t.deleteProductItem(e).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("AdminVariantsCtrl",["$scope","ProductImport",function(e,t){e.data={},e.items=[],e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems()}),e.buildItemData=function(e){return e},e.getItems=function(){e.page++;var o="order_by=id,desc&includes=product.merchants&page="+e.page;t.getVariants(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1),console.log("Items",t.data);var o=t.data;for(item in o)o[item]=e.buildItemData(o[item]);e.items=e.items.concat(o)},function(e){})},e.updateItem=function(e){t.updateVariantItem(e).then(function(e){},function(e){})},e.deleteItem=function(e){t.deleteVariantItem(e).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("BookingCtrl",["$scope","$rootScope","getParams","Booking","Modals","Cart","$mdDialog",function(e,t,o,n,a,r,i){e.availableDays=[],e.availableDates=[],e.selectedSpots=[],e.questions=[],e.meetingType,e.availabilities=[],e.appointmentOptions=[],e.months=[],e.newVisit=!0,e.dateSelected=!1,e.virtualMeeting="physical",e.timeSelected=!1,e.availabilitiesDate=[],e.weekday=[],e.weekday2=[],e.typeObj,e.bookingObj=null,e.requiresAuth,e.dayName,e.atributesCont,e.product_variant_id=null,e.item_id=null,e.quantity=null,e.location=null,e.objectId,e.objectName,e.objectDescription,e.objectIcon,e.startDate,e.endDate,e.startDateS,e.expectedPrice,e.activeBooking,e.amount="1",e.submitted=!1,e.constructor=function(){e.atributesCont={},e.weekday=new Array(7),e.weekday[0]="sunday",e.weekday[1]="monday",e.weekday[2]="tuesday",e.weekday[3]="wednesday",e.weekday[4]="thursday",e.weekday[5]="friday",e.weekday[6]="saturday",e.weekday2=new Array(7),e.weekday2[0]="Domingo",e.weekday2[1]="Lunes",e.weekday2[2]="Martes",e.weekday2[3]="Miercoles",e.weekday2[4]="Jueves",e.weekday2[5]="Viernes",e.weekday2[6]="Sabado",e.questions=[{name:"es rico",value:"",type:"text"},{name:"es deli",value:0,type:"num"},{name:"es sabroso",value:"",type:"textarea"}],console.log("Get availableDates",e.availableDates)},e.ngOnInit=function(){e.loadData()},e.cancel=function(){i.cancel()},e.keytab=function(e,t){var o=e.srcElement.nextElementSibling;console.log("nextInput",o);var n=e.target||e.srcElement;console.log("target",n),console.log("targetvalue",n.value),console.log("targettype",n.nodeType),n.value.length<t||null!=o&&o.focus()},e.onError=function(){console.log("IMG ERROR"),e.objectIcon="/assets/avatar/Bentley.png"},e.loadData=function(){var t=o;if(console.log("Params arrived: ",t),t){if(e.typeObj=t.type,e.objectId=t.objectId,e.objectName=t.objectName,e.objectDescription=t.objectDescription,e.objectIcon=t.objectIcon,t.expectedPrice&&(e.expectedPrice=t.expectedPrice),t.questions&&(e.questions=t.questions),t.location&&(e.location=t.location,"zoom"==e.location&&(e.virtualMeeting="virtual")),t.product_variant_id&&(e.product_variant_id=t.product_variant_id),t.item_id&&(e.item_id=t.item_id),t.quantity&&(e.quantity=t.quantity),t.booking){e.bookingObj=t.booking,e.dateSelected=!0,e.timeSelected=!0;var n={date:e.bookingObj.starts_at,status:"active"};e.selectDate(n),e.expectedPrice=e.bookingObj.price,e.atributesCont=e.bookingObj.options,e.atributesCont&&e.atributesCont.questions&&(e.questions=e.atributesCont.questions),console.log("Date",e.bookingObj.starts_at.toISOString()),e.startDateS=e.bookingObj.starts_at.toISOString(),e.selectStart()}t.availabilities?(e.dateSelected=!1,e.availabilities=t.availabilities,console.log("Availabilities",e.availabilities),e.getAvailableDates(e.availabilities),e.getDates(),console.log("Get availableDays",e.availableDays)):e.getItems(),console.log("expectedPrice",e.expectedPrice)}else e.getItems();console.log("Get availableDays",e.dateSelected)},e.setOrder=function(e){var t=new Date("1970-01-01 00:00:00"),o=new Date("1970-01-01 "+e.from),n=(o.getTime()-t.getTime())/1e6;return console.log("Date: ",n),"sunday"==e.range&&(e.order=0),"monday"==e.range&&(e.order=100),"tuesday"==e.range&&(e.order=200),"wednesday"==e.range&&(e.order=300),"thursday"==e.range&&(e.order=400),"friday"==e.range&&(e.order=500),"saturday"==e.range&&(e.order=600),e.order+=n,e},e.getItems=function(){var t=[],o={type:"Merchant",object_id:e.objectId};n.getAvailabilitiesObject(o).then(function(o){console.log("after getItems",o);var n=o.data;for(var a in n)n[a]=e.setOrder(n[a]),t.push(n[a]);if(t.sort(function(e,t){return e.order>t.order?1:-1}),e.availabilities=t,console.log("Availabilities",e.availabilities),e.getAvailableDates(e.availabilities),e.getDates(),console.log("in get items",e.bookingObj),e.bookingObj){var r={date:e.bookingObj.starts_at,status:"active"};e.selectDate(r)}console.log("Get availableDays",e.availableDays),console.log(JSON.stringify(o))},function(e){a.showToast("BOOKING.ERROR_GET_AVAILABILITIES")})},e.goBack=function(){console.log("goBack",e.dateSelected),e.dateSelected?e.dateSelected=!1:e.navCtrl.back()},e.addBookingToCart=function(o){if(t.items){var n=t.items;for(var r in n){var i=n[r].attributes;if("Booking"==i.type&&i.id==o.id)return void a.showToast("Carrito actualizado")}}e.addBookingToCartServer(o)},e.addBookingToCartServer=function(o){var n={type:"Booking",id:o.id,name:"Reserva con: "+o.bookable.name,from:o.starts_at},a={name:"Reserva con: "+o.bookable.name,price:o.price,quantity:o.quantity,tax:0,merchant_id:e.objectId,cost:0,extras:n};if(console.log("addBookingToCartServer",a),e.product_variant_id){var i={product_variant_id:e.product_variant_id,quantity:e.quantity,item_id:null,merchant_id:e.objectId,extras:n};r.postToServer(i).then(function(e){"success"==e.status?(t.$broadcast("loadHeadCart",e.cart),t.cartMessage="Carrito actualizado"):t.cartMessage=e.message},function(e){console.log("Error addCustomCartItem")})}else if(e.item_id){var s={quantity:e.quantity,item_id:e.item_id,merchant_id:e.objectId,extras:n};r.updateCartItem(s).then(function(e){"success"==e.status?(t.$broadcast("loadHeadCart",e.cart),t.cartMessage="Carrito actualizado"):t.cartMessage=e.message},function(e){console.log("Error addCustomCartItem")})}else r.addCustomCartItem(a).then(function(e){"success"==e.status?(t.$broadcast("loadHeadCart",e.cart),t.cartMessage="Carrito actualizado"):t.cartMessage=e.message},function(e){console.log("Error addCustomCartItem")})},e.selectRadio=function(t){e.virtualMeeting=t.detail.value,console.log("Virtual meeting radio ",t),console.log("Virtual meeting radio ",e.virtualMeeting)},e.createBooking=function(){if(e.submitted)return!0;e.submitted=!0;var t=new Date(e.startDate.getTime()-6e4*e.startDate.getTimezoneOffset()),o=t.toISOString(),r=new Date(e.endDate.getTime()-6e4*e.endDate.getTimezoneOffset()),i=r.toISOString(),s=!1;console.log("Virtual meeting",e.virtualMeeting),"virtual"==e.virtualMeeting&&(s=!0,e.atributesCont.virtual_provider="zoom",e.atributesCont.virtual_meeting=!0);var c={type:e.typeObj,object_id:e.objectId,from:o,to:i,attributes:e.atributesCont,virtual_meeting:s};console.log("Start",e.startDate),console.log("data",c),n.addBookingObject(c).then(function(t){a.hideLoader(),console.log("addBookingObject",t),e.submitted=!1,"success"==t.status?t.requires_auth?e.presentAlertConfirm(e.requiresAuth):e.addBookingToCart(t.booking):e.showAlertTranslation("BOOKING."+t.message)},function(t){e.submitted=!1,console.log("Error addBookingObject"),a.hideLoader()})},e.saveOrCreateBooking=function(){e.atributesCont.questions=e.questions,e.bookingObj?e.editBooking():e.createBooking()},e.editBooking=function(){a.showLoader(),console.log("offset",6e4*e.startDate.getTimezoneOffset());var t=new Date(e.startDate.getTime()-6e4*e.startDate.getTimezoneOffset()),o=t.toISOString(),r=new Date(e.endDate.getTime()-6e4*e.endDate.getTimezoneOffset()),i=r.toISOString(),s=!1;console.log("Virtual meeting",e.virtualMeeting),"virtual"==e.virtualMeeting&&(s=!0,e.atributesCont.virtual_provider="zoom",e.atributesCont.virtual_meeting=!0);var c={booking_id:e.bookingObj.id,type:e.typeObj,object_id:e.objectId,from:o,to:i,attributes:e.atributesCont};console.log("Start",e.startDate),console.log("data",c),n.editBookingObject(c).then(function(t){if(a.hideLoader(),console.log("editBookingObject",t),e.submitted=!1,"success"==t.status){var o=e.params.getParams();o.booking=new n(t.booking),e.params.setParams(o),e.navCtrl.back()}else e.showAlertTranslation("BOOKING."+t.message)},function(e){console.log("Error editBookingObject"),a.hideLoader()})},e.showAlertTranslation=function(e){a.showToast(e)},e.presentAlertConfirm=function(e){console.log("Present alert",e)},e.getAvailableDates=function(t){for(var o in t){var n=t[o];e.checkAvailableDays(n.range)||e.availableDays.push(n.range)}},e.checkAvailableDays=function(t){for(var o in e.availableDays)if(e.availableDays[o]==t)return!0;return!1},e.getDates=function(){console.log("Get dates");for(var t=new Date,o=t.getMonth(),a={month:o,days:[],title:n.getMonthName(o)},r=0;r<61;r++){var i=t.getDay(),s={date:new Date(t.getTime()),status:"closed"};if(e.checkAvailableDays(e.weekday[i])&&(s.status="active"),t.getMonth()!=a.month){e.months.push(a);var c=t.getMonth();a={month:c,days:[],title:n.getMonthName(c)}}a.days.push(s),e.availableDates.push(s),t.setDate(t.getDate()+1)}console.log("Get dates months",e.months)},e.returnDates=function(){e.dateSelected=!1},e.selectStart=function(){e.startDate=new Date(e.startDateS),e.endDate=new Date(e.startDate.getTime()+50*parseInt(e.amount)*6e4),e.timeSelected=!0},e.filterAvailabilities=function(t){e.availabilitiesDate=[];for(var o in e.availabilities)e.availabilities[o].range==e.weekday[t]&&e.availabilitiesDate.push(e.availabilities[o])},e.selectSlot=function(t){e.startDate=t.start,e.endDate=e.addMinutes(t.end,-5),e.timeSelected=!0},e.getBookingsDay=function(t){var o=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(),a={from:o,query:"day",type:e.typeObj,object_id:e.objectId};n.getBookingsObject(a).then(function(t){console.log("getBookingsObject",t);var o=t.data;for(var a in o){var r=new n(o[a]);e.selectedSpots.push(r)}e.buildSlots()},function(e){console.log("Error getBookingsObject")})},e.selectDate=function(t){if("active"==t.status){var o=t.date,n=o.getDay();e.dateSelected=!0,e.timeSelected=!1,console.log("select date",o),e.dayName=e.weekday2[n],e.startDate=o,e.startDateS=o.toISOString(),a.showToast("Buscando horarios disponibles"),e.filterAvailabilities(n),e.getBookingsDay(o),console.log("Availabilities",e.availabilitiesDate)}else a.showToast("BOOKING.NOT_AVAILABLE")},e.addMinutes=function(e,t){return new Date(e.getTime()+6e4*t)},e.buildSlots=function(){e.appointmentOptions=[];var t=new Date;t=e.addMinutes(t,30);for(var o in e.availabilitiesDate){var n=e.availabilitiesDate[o],a=!0;console.log("Building date "+e.startDate.getFullYear()+"/"+(e.startDate.getMonth()+1)+"/"+e.startDate.getDate()+" "+n.from.replace(" ",":00 "));for(var r=new Date(e.startDate.getFullYear()+"/"+(e.startDate.getMonth()+1)+"/"+e.startDate.getDate()+" "+n.from.replace(" ",":00 ")),i=new Date(e.startDate.getFullYear()+"/"+(e.startDate.getMonth()+1)+"/"+e.startDate.getDate()+" "+n.to.replace(" ",":00 "));a;){var s=e.addMinutes(r,30);if(s<=i){var c={start:r,end:s};r>t&&(e.checkFilledDate(c)||e.appointmentOptions.push(c)),r=e.addMinutes(r,30)}else a=!1}}if(e.bookingObj){console.log("Loaded booking obj",e.bookingObj);var l={start:e.bookingObj.starts_at,end:e.bookingObj.ends_at};e.selectSlot(l)}},e.checkFilledDate=function(t){for(var o in e.selectedSpots){var n=e.selectedSpots[o];if(console.log("Test"),console.log("comparing: ",t.start.getTime()," ",t.end.getTime()),console.log("comparing: ",n.starts_at.getTime()," ",n.ends_at.getTime()),console.log("difference: ",t.start.getTime()-n.starts_at.getTime()," ",t.end.getTime()-n.ends_at.getTime()),t.start.getTime()==n.starts_at.getTime()||t.start.getTime()>n.starts_at.getTime()&&t.start.getTime()<n.ends_at.getTime()||t.start.getTime()<n.starts_at.getTime()&&t.end.getTime()>n.starts_at.getTime())return console.log("True"),!0}return!1},e.changeDate=function(){e.dateSelected=!1,e.timeSelected=!1},e.changeTime=function(){e.timeSelected=!1},e.constructor(),e.ngOnInit()}])},function(e,t){angular.module("besafe").controller("CartCtrl",["$scope","Cart","$rootScope",function(e,t,o){e.subtotal=0,e.total=0,angular.element(document).ready(function(){setTimeout(function(){var t=window.location.href;t.includes("checkout")||e.getCart()},300)}),e.clean=function(){angular.forEach(angular.element(".item-attributes"),function(e,t){var o=angular.element(e),n=JSON.parse(o.html()),a="";for(x in n)a+=x+": "+n[x]+" <br/>";o.html(a),o.css("display","block")})},o.$on("updateHeadCart",function(){console.log("Get cart"),e.getCart()}),o.$on("loadHeadCart",function(t,o){console.log("Loading cart",o),e.loadCart(o)}),e.getCart=function(){t.getCart().then(function(t){console.log("Get Cart",t),"error"==t.status?alert(t.message):(e.loadCart(t),o.$broadcast("loadCartVariants",t))},function(e){})},e.loadCart=function(t){o.items=t.items,e.totalItems=t.totalItems,e.subtotal=t.subtotal,e.total=t.total},e.updateCartItem=function(o){var n=angular.element(document.querySelector("input[name=quantity-"+o+"]")).val();console.log("da qty: "+n);var a={quantity:n,product_variant_id:e.product_variant_id,extras:[]};t.updateCartItem(a).then(function(t){"error"==t.status&&alert(t.message),e.getCart()},function(e){})},e.clearCart=function(){t.clearCart().then(function(t){e.getCart(),o.$broadcast("clearCart")},function(e){})},e.deleteCartItem=function(n){var a={quantity:0,item_id:n,extras:[]};t.updateCartItem(a).then(function(t){console.log("delete",t),"error"==t.status?alert(t.message):(e.loadCart(t.cart),o.$broadcast("deleteItem",n))},function(e){})}}])},function(e,t){angular.module("besafe").controller("CheckoutCartCtrl",["$scope","$rootScope","Cart","Orders","Modals","$q",function(e,t,o,n,a,r){e.data={},e.coupon="",e.accept=!1,e.acceptError=!1,t.isDigital=!1,t.bookingSet=!0,angular.element(document).ready(function(){setTimeout(function(){e.getCart(!0)},300)}),e.cleanJson=function(){angular.forEach(angular.element(".item-attributes"),function(e,t){var o=angular.element(e),n=JSON.parse(o.html()),a="";for(x in n)a+=x+": "+n[x]+" <br/>";o.html(a),o.css("display","block")})},e.getCart=function(t){o.getCheckoutCart().then(function(o){"error"==o.status?alert(o.message):e.loadCart(o,t)},function(e){})},e.AcceptTerms=function(){e.accept&&(e.acceptError=!1)},e.getOrder=function(e){var o=r.defer();return n.getOrder().then(function(e){t.isDigital=!0,t.activeOrder=e.data,o.resolve("Done")},function(e){}),o.promise},e.updateCartItem=function(t){var n=angular.element(document.querySelector("input[name=check-quantity-"+t+"]")).val(),a={quantity:n,item_id:t,extras:[]};o.updateCartItem(a).then(function(t){"error"==t.status&&alert(t.message),e.getCart(!1)},function(e){})},e.clearCart=function(){o.clearCart().then(function(t){e.getCart()},function(e){})},e.loadCart=function(o,n){if(o.items.length>0){var a=o.items,r=!1;for(var i in a){var s=a[i];console.log("Item: ",s.attributes),s.attributes.is_shippable&&(r=!0)}t.items=o.items,e.totalItems=o.totalItems,e.subtotal=o.subtotal,e.shipping=o.shipping,e.tax=o.tax,e.sale=o.sale,e.coupon=o.coupon,e.discount=o.sale+o.coupon,e.total=o.total,console.log("Broadcasting shippable: ",r),n&&(r?t.$broadcast("Shippable"):e.getOrder().then(function(e){t.$broadcast("NotShippable")},function(e){}))}else window.location.href="/"},e.prepareOrder=function(){console.log("Accept",e.accept),e.accept?t.$broadcast("prepareOrder"):e.acceptError=!0},e.deleteCartItem=function(t){var n={quantity:0,item_id:t,extras:[]};o.updateCartItem(n).then(function(t){"error"==t.status&&alert(t.message),e.getCart()},function(e){})},e.setCoupon=function(){e.coupon&&e.coupon.length>0?(a.showLoader(),n.setCoupon(e.coupon).then(function(t){a.hideLoader(),t&&("success"==t.status?(e.getCart(!1),e.coupon="",a.showToast("Cupon agregado exitosamente",$("#final-submit"))):a.showToast("No puedes usar ese cupon",$("#final-submit")))},function(e){})):a.showToast("Ingresa un cupon",$("#final-submit"))},t.$on("updateCheckoutCart",function(t,o){e.getCart(!1)}),t.$on("updateLoadedCart",function(t,o){console.log("updateLoadedCart",o),e.loadCart(o)})}]).controller("CheckoutShippingCtrl",["$scope","$rootScope","LocationService","Users","$q","Cart","$cookies","Orders","Modals","Billing","$location","$anchorScroll",function(e,t,o,n,a,r,i,s,c,l,d,u){e.data={},e.addressSet={},e.shipping=[],e.regionVisible=!1,e.addressesFetched=!1,e.cityVisible=!1,e.addAddress=!1,e.visible=!1,t.shippingAddressSet=!0,t.shippingCondition=!0,t.shippingConditionSet=!1,t.billingAddressSet=!1,t.paymentMethodSet=!1,t.$on("Shippable",function(o,n){t.shippingAddressSet=!1,t.shippingCondition=!1,t.billingAddressSet=!1,t.paymentMethodSet=!1,e.visible=!0;var a=i.get("shippingAddress"),r=null;a&&a.length>0&&(r=JSON.parse(a)),console.log("Shipping address: ",r),console.log("$rootScope.user: ",t.user),r?(r.name||(e.addAddress=!0,e.data=r,t.user&&(e.data.name=t.user.name,e.data.phone=t.user.cellphone),e.selectPlace(e.data.country_id,e.data.region_id,e.data.city_id)),r.id&&e.selectAddress(r)):e.getAddresses().then(function(o){0==t.addresses.length&&e.newAddress()},function(e){})}),e.countries=[{name:"Colombia",id:1},{name:"Colombia2",id:2}],angular.element(document).ready(function(){}),e.newAddress=function(){var e=window.location.href;i.put("shippingAddress","",{path:"/"}),i.put("locationRefferrer",e,{path:"/"}),window.location.href="/location"},t.$on("prepareOrder",function(t,o){e.prepareOrder()}),t.$on("buildOrder",function(o,n){e.buildOrder(t.activeOrder)}),t.$on("NotShippable",function(t,o){e.visible=!1}),t.$on("getAddresses",function(t,o){e.getAddresses()}),e.cleanJson=function(){angular.forEach(angular.element(".item-attributes"),function(e,t){var o=angular.element(e),n=JSON.parse(o.html()),a="";for(x in n)a+=x+": "+n[x]+" <br/>";o.html(a),o.css("display","block")})},e.save=function(t){e.submitted=!0,t&&(c.showLoader(),n.saveAddress(e.data).then(function(t){c.hideLoader(),"success"==t.status&&(e.selectAddress(t.address),e.data={},e.submitted=!1,e.hideAddressForm())},function(e){}))},e.getAddresses=function(){var e=a.defer();return n.getAddresses().then(function(o){t.addresses=o.addresses,e.resolve("done")},function(t){e.resolve("error")}),e.promise},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.selectCountry=function(t){o.getRegionsCountry(t).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1},function(e){})},e.selectRegion=function(t){o.getCitiesRegion(t).then(function(t){e.cities=t.data,e.cityVisible=!0},function(e){})},e.selectPlace=function(t,n,a){e.data.country_id=t,o.getRegionsCountry(t).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1,console.log("Setting region",e.data.region_id),e.data.region_id=n,o.getCitiesRegion(n).then(function(t){e.cities=t.data,e.cityVisible=!0,console.log("Setting city_id",e.data.city_id),console.log("Setting cities",e.cities),e.data.city_id=a},function(e){})},function(e){})},e.selectAddress=function(o){e.addressSet=o;var n={address_id:o.id};c.showLoader(),s.setShippingAddress(n).then(function(n){if(console.log("Set shipping address",n),"success"==n.status){t.shippingAddressSet=!0,t.shippingAddress=o,i.put("shippingAddress",JSON.stringify(t.shippingAddress),{path:"/"});var a=n.order,r=JSON.parse(a.attributes);a.attributes=r,t.activeOrder=a;var s=r.providers;for(var l in s)console.log("Providers: ",s[l]);console.log("Setting discounts",t.shippingAddressSet),e.buildOrder(a)}else c.hideLoader(),c.showToast("Fuera de cobertura para esta orden",$("#checkout-shipping"))},function(e){})},e.scrollTo=function(e){setTimeout(function(){var t=d.hash();d.hash(e),u(),d.hash(t)},500)},e.buildOrder=function(o){s.setDiscounts(o.id,"Booking").then(function(n){console.log("Discounts set",n);var a={payers:[t.user.id],platform:"Booking"};s.checkOrder(o.id,a).then(function(o){console.log("Check Order Result",o),c.hideLoader();var n=o.order;"success"==o.status?t.isDigital||(c.showToast("Direccion guardada",$("#checkout-shipping")),t.$broadcast("updateCheckoutCart"),e.scrollTo("checkout-shipping-methods"),console.log("Finished scrolling2222")):e.handleCheckError(o,n)},function(e){})},function(e){})},e.addCartItem=function(e,o){r.addCartItem(e,o).then(function(e){"error"==e.status?alert(e.message):t.$broadcast("updateCheckoutCart")},function(e){})},e.setShippingCondition=function(o){c.showLoader(),console.log("Set Shipping",o);var n={provider:o["class"],provider_id:o.id};s.setPlatformShippingCondition(t.activeOrder.id,n).then(function(n){if(c.hideLoader(),console.log("setPlatformShippingPrice Result",n),"success"==n.status){t.$broadcast("updateLoadedCart",n.cart),t.activeOrder=n.order;for(var a=0;a<e.shipping.length;a++)e.shipping[a].selected=!1;t.shippingConditionSet=!0,o.price=n.cart.shipping,o.selected=!0,c.showToast("Envio agregado exitosamente",$("#checkout-shipping"))}else c.showToast("Hubo un error con ese metodo de envio",$("#checkout-shipping"))},function(e){
c.showToast("Hubo un error con ese metodo de envio",$("#checkout-shipping"))})},e.handleCheckError=function(t,o){if("credits"==t.type){var n=parseInt(t.required_credits);console.log("Required credits",n),console.log("creditItem",t.creditItem),c.showToast("Hemos agregado un item obligatorio",$("#checkout-shipping")),console.log("creditItemMerchant",t.creditItemMerchant);var a={order_id:o.id,product_variant_id:t.creditItem.id,quantity:n,item_id:null,merchant_id:t.creditItemMerchant};e.addCartItem(a,[])}else if("buyers"==t.type);else if("shipping"==t.type){if(e.scrollTo("checkout-shipping-methods"),c.showToast("Debes seleccionar proveedor de envio",$("#checkout-shipping-methods")),0==e.shipping.length){e.expectedProviders=0;var r=JSON.parse(o.attributes);if(r.providers)for(var i in r.providers)e.expectedProviders++,e.getPlatformShippingPrice(t.order.id,r.providers[i])}}else"delivery"==t.type},e.getPlatformShippingPrice=function(o,n){var a=n.desc;delete n.desc,s.getPlatformShippingPrice(o,n).then(function(o){if(console.log("getPlatformShippingPrice Result",o),e.expectedProviders--,"success"==o.status){var r=n.provider;"MerchantShipping"==n.provider&&(r="Domicilio del Establecimiento");for(var i={platform:r,"class":n.provider,price:o.price,desc:a,id:n.provider_id,selected:!1},s=!0,c=0;c<e.shipping.length;c++){var l=e.shipping[c];l.platform==i.platform&&(l.price<=i.price?(console.log("Not adding",i),s=!1):(console.log("Removing",l),e.shipping.splice(c,1)))}s&&e.shipping.push(i),0!=e.expectedProviders||t.shippingConditionSet||(e.setShippingCondition(e.shipping[0]),console.log("Auto select",e.shipping))}},function(t){e.expectedProviders--})},e.showAddressForm=function(){i.put("locationRefferrer",window.location.href,{path:"/"}),window.location.href="/location"},e.hideAddressForm=function(){e.addAddress=!1},e.changeAddress=function(){console.log("Change address"),t.shippingAddressSet=!1,t.shippingConditionSet=!1,e.addAddress=!1,t.addresses&&t.addresses.length>0||e.getAddresses().then(function(o){0==t.addresses.length&&e.newAddress()},function(e){})},e.changeShipping=function(){t.shippingConditionSet=!1},e.prepareOrder=function(){c.showLoader(),e.showPayment=!1,e.shippingError=!1;var o=[t.user.id],n="limit",a=3,r={order_id:t.activeOrder.id,payers:o,delivery_date:null,split_order:!1,platform:"Booking",recurring:!1,recurring_type:n,recurring_value:a,merchant_id:t.activeOrder.merchant_id};s.prepareOrder(r,"Booking").then(function(o){if(c.hideLoader(),o)if("success"==o.status)if(c.showToast("Selecciona método de envío",$("#checkout-cart")),console.log("orderProvider",o),t.activePayment=o.payment,t.activeOrder=o.order,t.activePayment.total==t.activePayment.transaction_cost){var n={payment_id:t.activePayment.id};c.showLoader(),l.completePaidOrder(n).then(function(o){c.hideLoader(),"success"==o.status?(o.transaction={},o.transaction.reference_sale="Pago Interno",o.transaction.payment_method="Pago Interno",o.transaction.description="Pago Interno",o.transaction.transaction_id=o.payment.id,o.transaction.transaction_state="APPROVED",t.$broadcast("transactionResponse",o)):e.showPayment=!0},function(t){e.showPayment=!0,console.log("completePaidOrderError",t)})}else t.$broadcast("activatePayment");else e.handleCheckError(o)},function(e){c.hideLoader(),console.log("getCartError",e),c.showToast("Hubo un error porfavor comunicate mas tarde",$("#checkout-cart"))})}}]).controller("CheckoutBillingCtrl",["$scope","$rootScope","LocationService","Users","Billing","$location","$anchorScroll","Modals","$mdDialog","Cart",function(e,t,o,n,a,r,s,c,l,d){e.data={},e.data2={},e.data3={},e.data4={},e.transaction={},e.banks=[],t.paymentActive=!1,e.creditCardVisible=!1,e.creditPayerVisible=!1,e.creditBuyerVisible=!1,e.credito=!1,e.showResult=!1,e.resultHeader="",e.resultBody="",e.cash=!1,e.debito=!1,angular.element(document).ready(function(){var t=new Date;e.years=[],e.months=[];var o=t.getFullYear();for(i=0;i<12;i++)i<9?e.months.push("0"+(i+1)):e.months.push(i+1);for(i=0;i<13;i++)e.years.push(o+i)}),e.scrollTo=function(e){setTimeout(function(){var t=r.hash();r.hash(e),s(),r.hash(t)},500)},t.$on("activatePayment",function(o,n){t.paymentActive=!0,e.scrollTo("checkout-payment")}),t.$on("transactionResponse",function(t,o){console.log("updateLoadedCart",o),e.transactionResponse(o)}),e.keytab=function(e,t){console.log("Event",e);var o=e.target||e.srcElement,n=o.nextElementSibling;console.log("nextInput",n),console.log("target",o),console.log("targetvalue",o.value),console.log("targettype",o.nodeType),o.value.length<t||null!=n&&n.focus()},e.creditTab=function(t){var o=t.target||t.srcElement,n=o.value,a=/^(?:5[1-5][0-9]{2}|222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/.test(n)?"MASTERCARD":/^(4[0-9]{12}(?:[0-9]{3})?$)|(^606374[0-9]{10}$)/.test(n)?"VISA":/^3[47][0-9]{13}$/.test(n)?"AMEX":/^[35](?:0[0-5]|[68][0-9])[0-9]{11}$|^30[0-5]{11}$|^3095[0-9]{10}$|^36[0-9]{12}$|^3[89][0-9]{12}$/.test(n)?"DINERS":/^6(?:011|5[0-9]{2}|4[4-9][0-9])[0-9]{12}$/.test(n)?"DISCOVER":/^589562[0-9]{10}$/.test(n)?"NARANJA":/^603488[0-9]{10}$|^2799[0-9]{9}$/.test(n)?"SHOPPING":/^604(([23][0-9]{2})|(400))[0-9]{10}$|^589657[0-9]{10}$/.test(n)?"CABAL":/^603493[0-9]{10}$/.test(n)?"ARGENCARD":/^590712[0-9]{10}$/.test(n)?"CODENSA":/^627180[0-9]{10}$/.test(n)?"CMR":"";console.log("Credit branch",a),e.data2.cc_branch=a},e.transactionResponse=function(t){c.hideLoader(),console.log("Response payu",t),d.clearCart(),e.scrollTo("checkout-payment"),"error"!=t.message?(e.showResult=!0,e.transaction=t.transaction,"APPROVED"==t.transaction.transaction_state?(e.resultHeader="Pago aprobado",e.resultBody="Tu pago ha sido completado, revisa tu correo para recibir tu compra"):"PENDING"==t.transaction.transaction_state?(e.resultHeader="Pago pendiente",e.resultBody="Tu transaccion esta siendo verificada, cuando complete la verificacion recibiras un correo con el resultado"):(e.resultHeader="Pago negado",e.resultBody="Tu transaccion ha sido negada. Porfavor intenta otro metodo u otra tarjeta. En Mi cuenta > Mis Pagos puedes reintentar el pago")):c.showToast("Hubo un error. Porfavor verifica tus datos",$("#checkout-payment"))},e.payCreditCard=function(o){e.data2.buyer_address=e.data2.payer_address,e.data2.buyer_postal=e.data2.payer_postal,e.data2.buyer_city=e.data2.payer_city,e.data2.buyer_state=e.data2.payer_state,e.data2.buyer_country=e.data2.payer_country,e.data2.buyer_phone=e.data2.payer_phone,e.submitted2=!0,o&&(e.data2.platform="Booking",e.data2.email=!0,e.data2.payment_id=t.activePayment.id,c.showLoader(),a.payCreditCard(e.data2,"PayU").then(function(t){e.transactionResponse(t)},function(e){}))},e.quickPay=function(){var o={quick:!0,payment_id:t.activePayment.id,platform:"Booking"};c.showLoader(),a.payCreditCard(o,"PayU").then(function(t){e.transactionResponse(t)},function(e){})},e.selectOption=function(t){e.data4.payment_method=t,e.scrollTo("cash-form")},e.populatePayer=function(){e.data2.payer_name?0==e.data2.payer_name.length&&(e.data2.payer_name=e.data2.cc_name):e.data2.payer_name=e.data2.cc_name},e.payDebitCard=function(o){e.submitted3=!0,o&&(e.data3.platform="Booking",e.data3.email=!0,e.data3.payment_id=t.activePayment.id,c.showLoader(),a.payDebit(e.data3,"PayU").then(function(e){"SUCCESS"==e.code&&"PENDING"==e.transactionResponse.state?d.clearCart().then(function(t){window.location.href=e.transactionResponse.extraParameters.BANK_URL},function(e){c.hideLoader()}):(c.hideLoader(),c.showToast("Hubo un problema. Porfavor intenta otro medio. ",$("#checkout-payment")))},function(e){c.hideLoader()}))},e.payCash=function(o){e.submitted4=!0,o&&(c.showLoader(),e.data4.platform="Booking",e.data4.email=!0,e.data4.payment_id=t.activePayment.id,a.payCash(e.data4,"PayU").then(function(e){c.hideLoader(),console.log("after payCash"),console.log(JSON.stringify(e)),"SUCCESS"==e.code?d.clearCart().then(function(t){e.transactionResponse.extraParameters.URL_PAYMENT_RECEIPT_HTML?window.location.href=e.transactionResponse.extraParameters.URL_PAYMENT_RECEIPT_HTML:c.showToast("Hubo un problema. Porfavor intenta otro medio. ",$("#checkout-payment"))},function(e){}):c.showToast("Hubo un problema. Porfavor intenta otro medio. ",$("#checkout-payment"))},function(e){}))},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.clean2=function(){e.data2={}},e.fill=function(){e.data2.cc_branch="VISA",e.data2.cc_name="APPROVED",e.data2.cc_number="4111111111111111",e.data2.cc_security_code="123",e.data2.cc_expiration_month="09",e.data2.cc_expiration_year="2017",e.data2.payer_email="harredon01@gmail.com",e.data2.payer_id="321321321"},e.fill2=function(){e.data3.user_type="N",e.data3.pse_reference2="CC",e.data3.pse_reference3="1020716535",e.data3.payer_email="harredon01@gmail.com"},e.fill3=function(){e.data4.payer_email="harredon01@gmail.com"},e.selectCountry=function(t){o.getRegionsCountry(t).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1},function(e){})},e.selectRegion=function(t){o.getCitiesRegion(t).then(function(t){e.cities=t.data,e.cityVisible=!0},function(e){})},e.selectPlace=function(t,n,a){e.data.country_id=t,o.getRegionsCountry(t).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1,e.data.region_id=n,o.getCitiesRegion(n).then(function(t){e.cities=t.data,e.cityVisible=!0,e.data.city_id=a},function(e){})},function(e){})},e.showAddressForm=function(){e.addAddress=!0,e.data.type="billing"},e.hideAddressForm=function(){e.addAddress=!1},e.useUserDebit=function(){e.data3.user_type="N",e.data3.doc_type="N",e.data3.payer_name=t.user.name,e.data3.payer_id=t.user.docNum,e.data3.payer_phone=t.user.cellphone,e.data3.payer_email=t.user.email},e.useUserCredit=function(){e.data2.cc_name=t.user.name,e.data2.payer_name=t.user.name,e.data2.payer_id=t.user.docNum,e.data2.payer_phone=t.user.cellphone,e.data2.payer_email=t.user.email,e.addAddress=!1},e.useUserCash=function(){e.data4.payer_email=t.user.email,e.data4.payer_id=t.user.docNum},e.fetchAddressForUse=function(o,n){"shipping"==o?e.setAddressInfields(n,t.shippingAddress):"other"==o&&l.show(c.getAddressesPopup()).then(function(t){console.log("Got address",t),e.setAddressInfields(n,t)},function(){console.log("Got nothing")})},e.setAddressInfields=function(o,n){n.phone||(n.phone=t.user.cellphone),"payer"==o?(e.data2.payer_address=n.address,e.data2.payer_postal=n.postal,e.data2.payer_city=n.cityName,e.data2.payer_state=n.regionName,e.data2.payer_country=n.countryCode,e.data2.payer_phone=n.phone):"buyer"==o&&(e.data2.buyer_address=n.address,e.data2.buyer_postal=n.postal,e.data2.buyer_city=n.cityName,e.data2.buyer_state=n.regionName,e.data2.buyer_country=n.countryCode,e.data2.buyer_phone=n.phone)},e.showMethod=function(o){e.credito=!1,e.cash=!1,e.debito=!1,"PSE"==o&&(e.debito=!0,a.getBanks().then(function(t){e.banks=t.banks},function(e){})),"CC"==o&&(e.data2.buyer_country="CO",e.data2.payer_country="CO",t.addresses&&t.addresses.length>0||t.$broadcast("getAddresses"),e.credito=!0),"BALOTO"==o&&(e.cash=!0)}}]).controller("CheckoutBookCtrl",["$scope","$rootScope","Cart",function(e,t,o){e.appointments=[],e.visibleBooking=!1,e.loadPendingItems=function(){console.log("loadPendingItems",t.items);var o=!1;for(var n in t.items){var a=t.items[n];console.log("item",a),"Booking"==a.attributes.type&&(a.attributes.id?a.pending=!1:(a.pending=!0,o=!0),e.appointments.push(a),e.visibleBooking=!0)}o?t.bookingSet=!1:t.bookingSet=!0},e.programItem=function(n){var a={availabilities:null,type:"Merchant",objectId:n.attributes.merchant_id,objectName:n.name,objectDescription:n["null"],objectIcon:null,expectedPrice:n.price,questions:n.attributes.questions,item_id:n.id,quantity:n.quantity,purpose:"external_book",alert:"#checkout-booking"};console.log("Sending paramsparamsparams",a),o.showBooking(a).then(function(o){console.log("Got result",o),n.pending=!1;for(var a=!1,r=0;r<e.appointments.length;r++)e.appointments[r].pending&&(a=!0);a||(t.bookingSet=!0,t.$broadcast("buildOrder"))})},t.$on("Shippable",function(t,o){console.log("Booking shippable"),e.loadPendingItems()}),t.$on("NotShippable",function(o,n){e.loadPendingItems(),0==e.appointments.length&&t.$broadcast("buildOrder")})}]).controller("CheckoutGatewaysCtrl",function(){})},function(e,t){angular.module("besafe").controller("DeliveriesCtrl",["$scope","$rootScope","Food","MapService",function(e,t,o,n){e.data={},e.listArticles={},e.deliveries=[],e.page=0,e.loadMore=!0,e.status="enqueue",e.activeDate="",e.regionVisible=!1,e.editAddress=!1,e.mapActive=!1,angular.element(document).ready(function(){var t=new Date,o=t.getDay();o<6?t.setDate(t.getDate()+1):6==o&&t.setDate(t.getDate()+2),e.activeDate=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(),e.getArticles(),e.buildDatePicker()}),e.buildDatePicker=function(){var t="yy-mm-dd";$("#from").datepicker({defaultDate:"+1d",changeMonth:!0,numberOfMonths:2,dateFormat:t}).on("change",function(){console.log("date1",e.activeDate);var t=e.getDate(this);e.activeDate=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(),console.log("date",e.activeDate)})},e.getDate=function(e){console.log("Get date",e.value);var t;try{t=$.datepicker.parseDate("yy-mm-dd",e.value)}catch(o){t=null}return t},e.updateDels=function(){e.page=0,e.deliveries=[],e.getArticles()},e.activateMap=function(){e.mapActive=!0,console.log("Creating map data"),n.createMap(4.685419,-74.064161),e.createMapData()},e.changeScenario=function(){e.getDeliveries()},e.createMapData=function(){console.log("Creating map data");var t=e.deliveries[0],o=0,a=0;for(var r in e.deliveries)a++,e.deliveries[r].address_id==t.address_id?o++:(t.icon="http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+o+"|FE6256|000000",n.createStop(t),t=e.deliveries[r],o=1),a==e.deliveries.length&&(t.icon="http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+o+"|FE6256|000000",n.createStop(t))},e.getDeliveries=function(){console.log("Status",e.status),e.page++;var t="includes=user,address&limit=50&order_by=address_id,asc&page="+e.page+"&status="+e.status+"&delivery="+e.activeDate+" 12:00:00";o.getDeliveries(t).then(function(t){var o=t.data;if(t.page==t.last_page&&(e.loadMore=!1),o.length>0)for(item in o){var n=o[item];n.details=JSON.parse(n.details),n.name=n.address.address,n.lat=n.address.lat,n.delivery=new Date(n.delivery),n["long"]=n.address["long"],e.deliveries.push(n)}console.log("Deliveries",e.deliveries),e.replaceFood()},function(e){})},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.sendReminder=function(){o.sendReminder().then(function(e){},function(e){})},e.sendNewsletter=function(){o.sendNewsletter()},e.showAll=function(){console.log("Creating map data");for(item in e.deliveries)e.deliveries[item].marker.setMap(t.map)},e.hideAll=function(){for(item in e.deliveries)e.deliveries[item].marker.setMap(null)},e.showDelivery=function(o){e.hideAll(),o.marker.setMap(t.map)},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.updateDeliveryAddress=function(e,t){o.updateDeliveryAddress(e,t).then(function(e){window.location.reload()},function(e){})},e.getPurchaseOrder=function(){o.getPurchaseOrder().then(function(e){},function(e){})},e.getArticle=function(t){console.log("getArticle",t);for(var o in e.listArticles)if(e.listArticles[o].id==t)return console.log("getArticleres",e.listArticles[o]),e.listArticles[o]},e.replaceFood=function(){console.log("articles",e.listArticles);for(var t in e.deliveries){console.log("delivery",e.deliveries[t].id);var o=e.deliveries[t].details;if(o.dish){e.deliveries[t].build=!1,e.deliveries[t].type_id=o.dish.type_id;var n=e.getArticle(o.dish.type_id);if(n){o.tipoAlmuerzo=n.name;for(item2 in n.attributes.entradas)n.attributes.entradas[item2].codigo==o.dish.starter_id&&(o.entrada=n.attributes.entradas[item2].valor,e.deliveries[t].starter_id=o.dish.starter_id);for(item3 in n.attributes.plato)n.attributes.plato[item3].codigo==o.dish.main_id&&(o.plato=n.attributes.plato[item3].valor,e.deliveries[t].main_id=o.dish.main_id);delete o.dish,delete o.products,delete o.merchant_id,e.deliveries[t].details=o}console.log("deliveryDone",e.deliveries[t].id)}else e.deliveries[t].type_id=null,e.deliveries[t].starter_id=null,e.deliveries[t].main_id=null,e.deliveries[t].build=!0}},e.selectMissingType=function(t){var o=e.getArticle(t.type_id);t.starters=o.attributes.entradas,t.mains=o.attributes.plato},e.selectDish=function(t){var n=t.details,a=e.getArticle(t.type_id);n.tipoAlmuerzo=a.name;for(item2 in a.attributes.entradas)a.attributes.entradas[item2].codigo==t.starter_id&&(n.entrada=a.attributes.entradas[item2].valor);for(item3 in a.attributes.plato)a.attributes.plato[item3].codigo==t.main_id&&(n.plato=a.attributes.plato[item3].valor);t.details=n;var r={delivery_id:t.id,type_id:t.type_id,main_id:t.main_id};t.starter_id&&(r.starter_id=t.starter_id),t.build=!1,console.log("Updating dish: ",r),o.updateMissingDish(r)},e.getArticles=function(){o.getArticlesByDate(e.activeDate).then(function(t){e.listArticles=t.data;for(var o in e.listArticles)e.listArticles[o].attributes=JSON.parse(e.listArticles[o].attributes);e.getDeliveries()},function(e){})},e.regenerateDeliveries=function(){o.regenerateDeliveries().then(function(e){},function(e){})},e.getInputs=function(){var t;return t="enqueue"==e.status?{status:"enqueue"}:{status:e.status,provider:e.provider,type:e.scenario}}}])},function(e,t){angular.module("besafe").controller("ExportsCtrl",["$scope","Merchants","$mdDialog","Modals",function(e,t,o,n){e.data={},e.orders,e.from,e.to,e.user,e.activeMerchant=null,e.activeMerchantObject,e.changeMerchant=!0,e.showSearch=!1,e.showError=!1,e.datPickerBuilt=!1,e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getMerchantsPrivate()}),e.getMerchants=function(){e.page++,t.searchMerchants(e.searchTerms).then(function(t){console.log("Items",t.data),e.merchants=t.data},function(e){})},e.getMerchantsPrivate=function(){t.getMerchantsUser().then(function(t){"success"==t.status&&(e.merchants=t.data)},function(e){})},e.changeActiveMerchant=function(){e.changeMerchant=!0},e.cancelChangeMerchant=function(){e.changeMerchant=!1},e.selectMerchant=function(t){e.page=0,e.items=[],e.activeMerchantObject=t,e.activeMerchant=t.id+"",e.changeMerchant=!1,e.datPickerBuilt||setTimeout(function(){e.buildDatePicker()},800)},e.buildDatePicker=function(){e.datPickerBuilt=!0;var t="yy-mm-dd",o=$("#from").datepicker({defaultDate:"-1m",changeMonth:!0,numberOfMonths:2,dateFormat:t}).on("change",function(){n.datepicker("option","minDate",e.getDate(this)),e.from=e.getDate(this)}),n=$("#to").datepicker({defaultDate:"+1w",changeMonth:!0,numberOfMonths:2,dateFormat:t}).on("change",function(){o.datepicker("option","maxDate",e.getDate(this)),e.to=e.getDate(this)})},e.getDate=function(e){console.log("Get date",e.value);var t;try{t=$.datepicker.parseDate("yy-mm-dd",e.value)}catch(o){t=null}return t},e.startExport=function(t){return e.showError=!1,e.activeMerchant?void("orders"==t?e.getStoreExport():e.getContentExport(t)):void(e.showError=!0)},e.getStoreExport=function(){console.log("Date",e.from,e.to);var a={from:e.from,to:e.to,merchant_id:e.activeMerchant,type:"products"};t.getStoreExport(a).then(function(e){"success"==e.status?o.show(n.getExportPopup()):n.showToast("Hubo un error, porfavor comunicate con soporte")},function(e){n.showToast("Hubo un error, porfavor comunicate con soporte")})},e.getContentExport=function(a){var r={merchant_id:e.activeMerchant,type:a};t.getStoreContent(r).then(function(e){"success"==e.status?o.show(n.getExportPopup()):n.showToast("Hubo un error, porfavor comunicate con soporte")},function(e){n.showToast("Hubo un error, porfavor comunicate con soporte")})}}])},function(e,t){angular.module("besafe").controller("FoodAddressesCtrl",["$scope","Food",function(e,t){e.data={},e.addresses,e.regionVisible=!1,e.editAddress=!1,e.mapActive=!1,angular.element(document).ready(function(){e.getAddresses()}),e.delegateAddress=function(e,o){var n="";n="Rapigo"==e.provider?"Basilikum":"Rapigo";var a=(new Date(e.delivery),{address:e.address,provider:n,complete:o,merchant_id:e.merchant_id});t.delegateDeliveriesAddress(a).then(function(e){},function(e){})},e.buildAddressData=function(e){return e},e.getAddresses=function(){t.getLargestAddresses().then(function(t){var o=t.data;for(item in o)o[item]=e.buildAddressData(o[item]);e.addresses=o},function(e){})}}])},function(e,t){angular.module("besafe").controller("FoodMessagesCtrl",["$scope","Food",function(e,t){e.data={},e.items=[],e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems()}),e.buildItemData=function(e){return e},e.getItems=function(){e.page++;var o="order_by=id,desc&page="+e.page;t.getMessages(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1);var o=t.data;for(item in o)o[item]=e.buildItemData(o[item]);e.items=e.items.concat(o),console.log("Load more",e.loadMore)},function(e){})},e.updateItem=function(e){t.updateMessageItem(e).then(function(e){},function(e){})},e.deleteItem=function(e){t.deleteMessageItem(e).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("GroupsSelectionCtrl",["$scope","Groups","$rootScope","Users",function(e,t,o,n){e.data={},e.invites=[],e.groups=[],e.contacts=[],e.chosen=[],e.searchText="",e.objectSelected=!1,e.editGroup=!1,e.isActive=!1,e.save=function(t){e.submitted=!0,console.log("Saving: "+t),t&&e.saveGroup()},e.groupToggle=function(){e.editGroup?e.editGroup=!1:(e.editGroup=!0,0==e.contacts.length&&e.getContacts())},e.activation=function(){e.isActive?e.isActive=!1:e.isActive=!0},e.saveGroup=function(){console.log("Data sent"),console.log(JSON.stringify(e.data)),console.log(JSON.stringify($.param(e.data)));var o={name:e.data.name,is_public:!0,contacts:e.invites,completeData:e.chosen};t.saveGroup($.param(o)).then(function(t){console.log("Return group"),console.log(JSON.stringify(t)),"success"==t.status&&(e.selectGroup(t.group),e.groups.push(t.group)),e.data={},e.submitted=!1},function(e){})},e.getGroups=function(){t.getGroups().then(function(t){var o=t.data;for(item in o){var n=o[item];n.is_selected=!1,e.groups.push(n)}0==o.length&&(e.editGroup=!0)},function(e){})},e.getContacts=function(){n.getContacts(e.searchText).then(function(t){e.contacts=[],e.contacts=t.data},function(e){})},e.selectContact=function(t){e.invites.push(t.contact_id),e.chosen.push(t);for(item in e.contacts)e.contacts[item].contact_id==t.contact_id&&e.contacts.splice(item,1)},e.deleteContact=function(t){for(item in e.chosen)e.chosen[item].contact_id==t.contact_id&&e.chosen.splice(item,1);for(item in e.invites)e.invites[item]==t.contact_id&&e.chosen.splice(item,1)},e.selectGroup=function(t){t.is_selected=!0,e.isActive=!1,o.$broadcast("ObjectSelected",{object_id:t.id})},o.$on("PlanSelected",function(t,o){e.isActive=!0,0==e.groups.length&&e.getGroups()}),e.clean=function(){e.data={},e.invites=[]}}])},function(e,t){angular.module("besafe").controller("LeadCtrl",["$scope","Leads","Modals",function(e,t,o){e.data={},e.key="",e.submitted=!1,e.category,angular.element(document).ready(function(){var t=viewData;console.log("res",t);var o=JSON.parse(t);e.key=o.key}),e.send=function(n){e.submitted=!0,n&&grecaptcha.ready(function(){grecaptcha.execute(e.key,{action:"submit"}).then(function(n){e.data.captcha=n,o.showLoader(),t.sendLead(e.data).then(function(t){o.hideLoader(),e.data={},o.showToast("Mensaje enviado",$("#contact-form"))},function(e){})})})},e.lead=function(n,a){e.submitted=!0,n&&grecaptcha.ready(function(){grecaptcha.execute(e.key,{action:"submit"}).then(function(n){e.data.captcha=n,e.data.type=a,o.showLoader(),t.sendLead(e.data).then(function(t){o.hideLoader(),e.data={},e.submitted=!1,o.showToast("Mensaje enviado",$("#contact-form"))},function(e){})})})}}])},function(e,t){angular.module("besafe").controller("MapLocationCtrl",["$scope","$rootScope","MapService","$cookies",function(e,t,o,n){e.map={center:{latitude:4.65345,longitude:-74.049605},zoom:8},t.markers=[],t.mapLoaded=!1,e.error="nada";var a=window.location.href,r=a.split("/map/");console.log("url"),console.log(JSON.stringify(r)),o.createMap(4.65345,-74.049605),o.postMapLocation(),e.activeMarker=o.createLocationMarker(4.65345,-74.049605,!0),console.log(navigator.geolocation),t.shippingAddress&&t.shippingAddress.lat?(console.log("Loading address from cookie",t.shippingAddress),e.activeMarker.setPosition(new google.maps.LatLng(t.shippingAddress.lat,t.shippingAddress["long"])),google.maps.event.trigger(e.activeMarker,"dragend")):navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){e.$apply(function(){console.log("Position",t),e.position=t,e.activeMarker.setPosition(new google.maps.LatLng(t.coords.latitude,t.coords.longitude)),google.maps.event.trigger(e.activeMarker,"dragend")})}),e["default"]=function(){o.createLocationMarker(4.65345,-74.049605,!1)},e.cancel=function(){window.history.back()},e.saveLocation=function(){console.log("Loading address to cookie",t.shippingAddress),n.put("shippingAddress",JSON.stringify(t.shippingAddress),{path:"/"}),console.log("shippingAddress",JSON.stringify(t.shippingAddress));var o=n.get("locationRefferrer");n.remove("locationRefferrer");var a="";o&&o.length>0?(a="",console.log("location",o),a=o.includes("?")?o+"&lat="+t.shippingAddress.lat+"&long="+t.shippingAddress["long"]:o+"?lat="+t.shippingAddress.lat+"&long="+t.shippingAddress["long"],console.log("url",a)):a="/?lat="+t.shippingAddress.lat+"&long="+t.shippingAddress["long"],e.error="la url es: "+a,console.log("url",a),window.location.href=a}}])},function(e,t){angular.module("besafe").controller("MenuCtrl",["$scope","Food",function(e,t){e.data={},e.items=[],e.loadMore=!0,e.page=0,e.contentType="",e.config={},angular.element(document).ready(function(){e.getItems(),e.contentType=e.config.content}),e.buildItemData=function(e){return e.attributes=JSON.parse(e.attributes),e},e.getItems=function(){e.page++;var o="type=lunch&order_by=id,desc&page="+e.page;t.getMenu(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1);var o=t.data;for(item in o)o[item]=e.buildItemData(o[item]);e.items=e.items.concat(o)},function(e){})},e.updateItem=function(e){t.updateMenuItem(e).then(function(e){},function(e){})},e.deleteItem=function(e){t.deleteMenuItem(e).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("MerchantsCtrl",["$scope","Merchants","Modals",function(e,t,o){e.data={},e.user={},e.current=1,e.last=1,e.total=1,e.per_page=1,e.merchants=[],e.categories=[],e.regionVisible=!1,e.editMerchant=!1,e.showAddress=!0,e.showStore=!0,e.submitted=!1,e.category,angular.element(document).ready(function(){var t=viewData.replace(/App\\Models\\/g,"");console.log("res",t);var o=JSON.parse(t),n=window.location.href;n.includes("urgencias")&&(e.showStore=!1),e.category=o.category,e.merchants=o.data;for(var a in e.merchants)for(var r in e.merchants[a].attributes.categories)if(e.merchants[a].attributes.categories[r].id==e.category.id){e.merchants[a].activeCategory=e.merchants[a].attributes.categories[r];break}1==e.merchants.length&&e.openItem(e.merchants[0]),console.log("Data",e.merchants),e.current=o.page,e.per_page=o.per_page,e.last=o.last_page,e.total=o.total,document.getElementById("dissapear").remove()}),e.goTo=function(n){e.current=n,e.merchants=[],o.showLoader();var a="category_id="+e.category.id+"&page="+e.current+"&limit=2";e.category.type.includes("nearby")?t.getMerchantsNearby(a).then(function(t){e.loadResults(t)},function(e){}):e.category.type.includes("coverage")?t.getMerchantsCoverage(a).then(function(t){e.loadResults(t)},function(e){}):t.getMerchants(a).then(function(t){e.loadResults(t)},function(e){})},e.loadResults=function(t){e.merchants=t.data,e.current=parseInt(t.page),e.per_page=parseInt(t.per_page),e.last=parseInt(t.last_page),e.total=parseInt(t.total),o.hideLoader()},e.openItem=function(t){var o="",n=t.id;t.categorizable_id&&(n=t.categorizable_id),o=e.category?"/a/products/"+e.category.url+"?merchant_id="+n:"/a/merchant/"+t.slug+"/products",window.location.href=o}}]).controller("MerchantDetailCtrl",["$scope","$rootScope","Merchants","Modals","$mdDialog","Cart",function(e,t,o,n,a,r){e.data={},e.user={},e.merchant={},angular.element(document).ready(function(){var t=viewData.replace(/App\\Models\\/g,"");console.log("res",t);var o=JSON.parse(t);console.log("Data",o),e.merchant=o,e.merchant.availabilities=e.merchant.availabilities2,console.log("$scope.merchant",e.merchant)}),e.booking=function(){if(t.user){var o={availabilities:e.merchant.availabilities,type:"Merchant",objectId:e.merchant.id,objectName:e.merchant.name,objectDescription:e.merchant.description,objectIcon:e.merchant.icon,expectedPrice:e.merchant.unit_cost,alert:"#book-button"};r.showBooking(o)}else n.showToast("Registrate o ingresa para reservar",$("#book-button"));console.log("Booking")}}])},function(e,t){angular.module("besafe").controller("OrdersCtrl",["$scope","Orders",function(e,t){e.data={},e.orders,e.from,e.to,e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.buildDatePicker(),e.getOrders()}),e.buildDatePicker=function(){var t="yy-mm-dd",o=$("#from").datepicker({defaultDate:"-1m",changeMonth:!0,numberOfMonths:2,dateFormat:t}).on("change",function(){n.datepicker("option","minDate",e.getDate(this)),e.from=e.getDate(this)}),n=$("#to").datepicker({defaultDate:"+1w",changeMonth:!0,numberOfMonths:2,dateFormat:t}).on("change",function(){o.datepicker("option","maxDate",e.getDate(this)),e.to=e.getDate(this)})},e.getDate=function(e){console.log("Get date",e.value);var t;try{t=$.datepicker.parseDate("yy-mm-dd",e.value)}catch(o){t=null}return t},e.buildOrderData=function(e){var t=e.items;for(item in t)t[item].attributes=JSON.parse(t[item].attributes);return e.items=t,e},e.getOrders=function(){e.page++;var o="includes=orderConditions,items,payments,user&order_by=id,desc&page="+e.page;t.getOrders(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1);var o=t.data;for(item in o)o[item]=e.buildOrderData(o[item]);e.orders=o},function(e){})},e.updateOrderStatus=function(e,o){t.updateOrderStatus(e,o).then(function(e){},function(e){})},e.getStoreExport=function(){console.log("Date",e.from,e.to),t.getStoreExport(e.from,e.to).then(function(e){},function(e){})},e.approveOrder=function(e){t.approveOrder(e.id).then(function(t){e.status="scheduled"},function(e){})}}])},function(e,t){angular.module("besafe").controller("PaymentsCtrl",["$scope","Payments","Merchants",function(e,t,o){e.data={},e.payments,e.loadMore=!0,e.page=0,e.regionVisible=!1,e.editPayment=!1,angular.element(document).ready(function(){e.getPayments()}),e.getPayments=function(){e.page++;var o="includes=order,user&order_by=id,desc&page="+e.page;t.getPayments(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1),e.payments=t.data},function(e){})},e.approvePayment=function(e){t.approvePayment(e.id).then(function(t){e.status="approved"},function(e){})}}]).controller("PaymentsUserCtrl",["$scope","Payments",function(e,t){e.data={},e.payments,e.loadMore=!0,e.page=0,e.regionVisible=!1,e.editPayment=!1,angular.element(document).ready(function(){e.getPayments()}),e.getPayments=function(){e.page++;var o="includes=order,user&order_by=id,desc&page="+e.page;t.getPaymentsUser(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1),e.payments=t.data},function(e){})}}]).controller("PaymentsMerchantCtrl",["$scope","Orders","Merchants",function(e,t,o){e.data={},e.orders=[],e.merchants=[],e.merchant_id,e.loadMore=!0,e.page=0,e.regionVisible=!1,e.editPayment=!1,e.status="pending",angular.element(document).ready(function(){e.getMerchants()}),e.getOrders=function(o){e.page++;var n="includes=items,orderAddresses,orderConditions,user&order_by=id,asc&page="+e.page+"&merchant_id="+o+"&execution_status="+e.status;t.getOrders(n).then(function(t){t.page==t.last_page&&(e.loadMore=!1),e.orders=e.orders.concat(t.data)},function(e){})},e.loadMoreOrders=function(){e.getOrders(e.merchant_id)},e.selectMerchant=function(){e.orders=[],e.page=0,e.getOrders(e.merchant_id)},e.getMerchants=function(){
o.getMerchantsUser().then(function(t){"success"==t.status&&(e.merchants=t.data,0==e.orders.length&&e.merchants.length>0&&e.getOrders(e.merchants[0].id))},function(e){})},e.fullfillOrder=function(e){var o=[];for(var n in e.items)o.push(e.items[n].id);var a={order_id:e.id,items:o,status:"fullfill"};t.fullfillOrder(a).then(function(t){if("success"==t.status){e.execution_status="completed";for(var o in e.items)e.items[o].fulfillment="fulfilled"}},function(e){})}}]).controller("PaymentsUserCtrl",["$scope","Payments",function(e,t){e.data={},e.payments,e.loadMore=!0,e.page=0,e.regionVisible=!1,e.editPayment=!1,angular.element(document).ready(function(){e.getPayments()}),e.getPayments=function(){e.page++;var o="includes=order,user&order_by=id,desc&page="+e.page;t.getPaymentsUser(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1),e.payments=t.data},function(e){})}}]).controller("PaymentDetailCtrl",["$scope","Payments","$rootScope",function(e,t,o){e.data={},e.payment={},angular.element(document).ready(function(){e.getPayments()}),e.getPayments=function(){e.page++;var o=window.location.href,n=o.split("/");console.log("Payment id",n[n.length-1]);var a="id="+n[n.length-1]+"&includes=order.items,order.orderConditions,order.orderAddresses";t.getPaymentsUser(a).then(function(t){if(t.total>0){var o=t.data;e.payment=o[0]}},function(e){})},e.addTransactionCosts=function(){t.addTransactionCosts(e.payment.id).then(function(t){"success"==t.status?(console.log("after addTransactionCosts"),e.payment=t.payment):this.api.toast("PAYMENTS.ERROR_CHANGE")},function(e){})},e.retryPayment=function(){t.retryPayment(e.payment.id).then(function(e){console.log("after addTransactionCosts",e),"success"==e.status?(o.activePayment=e.payment,o.paymentActive=!0):this.api.toast("PAYMENTS.ERROR_CHANGE")},function(e){})}}])},function(e,t){angular.module("besafe").controller("ProductsCtrl",["$scope","Cart","$rootScope","$sce","Products","Modals",function(e,t,o,n,a,r){e.categories=[],e.prodIds=[],e.hasLocation=!1,e.hasMerchant=!1,e.isSearch=!1,e.merchantObj={},e.current=1,e.last=1,e.range,e.params={},e.per_page=1,e.category_id=null,e.total=1,e.local_total=0,angular.element(document).ready(function(){e.clean();var t=viewData.replace(/App\\Models\\/g,"");console.log("viewData",t);var o=JSON.parse(t);e.$apply(function(){e.buildProductsFromWhole(o)}),console.log(e.categories),document.getElementById("dissapear").remove();var n=r.getAllUrlParams();console.log("Params",n),n||(n={}),e.params=n,e.params.includes="files,merchant",e.category_id&&(e.params.category_id=e.category_id);var a=window.location.href;a.includes("search")&&(e.isSearch=!0)}),o.$on("loadCartVariants",function(t,n){e.updateProductsCart(n,!1),o.user&&e.checkFavorites()}),o.$on("clearCart",function(t,o){console.log("Cart cleared resetting items"),e.cartCleared()}),o.$on("deleteItem",function(t,o){console.log("item removed resetting items: ",o),e.cartDeletedItem(o)}),e.clean=function(){angular.forEach(angular.element(".product-attributes"),function(e,t){var o=angular.element(e),n=JSON.parse(o.html()),a="";for(x in n)a+=x+": "+n[x]+" <br/>";o.html(a),o.css("display","block")})},e.changeStore=function(){t.changeMerchant()},e.addCatFilter=function(t){e.params.category_id=t,e.goTo(1)},e.buildProductsFromWhole=function(t){e.categories=t.categories,e.current=t.page,e.last=t.last_page,e.current=t.page,e.per_page=t.per_page,e.total=t.total,t.category&&(e.category_id=t.category.id),console.log(e.categories);for(var a in e.categories)for(var r in e.categories[a].products)e.prodIds.push(e.categories[a].products[r].id),!o.merchant_id&&e.categories[0].products[0].merchant_id&&(o.merchant_id=e.categories[0].products[0].merchant_id),!e.categories[a].products[r].merchant_id&&e.categories[a].products[r].merchants.length>0&&(e.categories[a].products[r].merchant_id=e.categories[a].products[r].merchants[0].id),e.local_total++,e.categories[a].products[r].files&&e.categories[a].products[r].files.length>0&&(e.categories[a].products[r].imgs=e.categories[a].products[r].files),e.categories[a].products[r].imgs&&e.categories[a].products[r].imgs.length>0&&(e.categories[a].products[r].src=e.categories[a].products[r].imgs[0].file),e.categories[a].products[r].description=n.trustAsHtml(e.categories[a].products[r].description),e.categories[a].products[r].activeVariant=e.categories[a].products[r].variants[0],e.categories[a].products[r].variant_id=e.categories[a].products[r].variants[0].id,e.categories[a].products[r].quantity=e.categories[a].products[r].variants[0].min_quantity,e.categories[a].products[r].item_id=null,e.categories[a].products[r].isFavorite=!1},e.buildProducts=function(t){e.categories=a.buildProductInformation(t),console.log("Result build product",e.categories);var o=e.categories[0].products[0].merchant_attributes;"string"==typeof o&&(o=JSON.parse(o)),o.store_active&&1==o.store_active&&(e.storeActive=!0),e.merchantObj.merchant_name=e.categories[0].products[0].merchant_name,e.merchantObj.merchant_description=e.categories[0].products[0].merchant_description,e.merchantObj.src=e.categories[0].products[0].src,e.merchantObj.merchant_type=e.categories[0].products[0].merchant_type,e.categories.length>0&&(e.categories[0].more=!0,e.categories[0].products.length>0&&(e.categories[0].products[0].more=!0),e.categories[0].products.length>1&&(e.categories[0].products[1].more=!0)),e.current=parseInt(t.page),e.prodIds=[],e.last=parseInt(t.last_page),e.current=parseInt(t.page),e.per_page=parseInt(t.per_page),e.total=parseInt(t.total),e.local_total=0;for(var r in e.categories)for(var i in e.categories[r].products)e.local_total++,e.prodIds.push(e.categories[r].products[i].id),e.categories[r].products[i].description=n.trustAsHtml(e.categories[r].products[i].description),e.categories[r].products[i].activeVariant=e.categories[r].products[i].variants[0],e.categories[r].products[i].variant_id=e.categories[r].products[i].variants[0].id,e.categories[r].products[i].quantity=e.categories[r].products[i].variants[0].min_quantity,e.categories[r].products[i].item_id=null},e.filterPrice=function(){console.log("Filtering",$("#amount").val());var t=$("#amount").val();t=t.replace("$",""),t=t.replace("$",""),console.log("Filtering",t);var o=t.split("-");console.log("Filtering",o),e.params.high=parseInt(o[1].trim()),e.params.low=parseInt(o[0].trim()),e.goTo(1)},e.goTo=function(t){e.params.page=t,o.merchant_id&&(e.params.merchant_id=o.merchant_id),r.showLoader(),e.categories=[],e.isSearch?a.searchProducts(e.params).then(function(t){console.log("params",e.params),console.log("response",t),t.total>0&&e.buildProductsFromWhole(t),r.hideLoader()},function(e){}):a.getProductsMerchant(e.params).then(function(t){console.log("params",e.params),console.log("response",t),t.products_total>0&&e.buildProducts(t),r.hideLoader()},function(e){})},e.selectVariant=function(e){for(var t in e.variants)e.variant_id==e.variants[t].id&&(e.activeVariant=e.variants[t])},e.addCartItem=function(e){var n={id:e.activeVariant.id,quantity:e.quantity,item_id:e.item_id,product:e,type:e.type};return e.activeVariant.is_on_sale&&e.activeVariant.sale<1||!e.activeVariant.is_on_sale&&e.activeVariant.price<1?(r.showToast("Ese producto no esta a la venta",$("#prod-cont-"+e.id)),!0):void t.addCartItem(n,[]).then(function(t){console.log("Add cart",t),"success"==t.status?(r.showToast("Carrito actualizado",$("#prod-cont-"+e.id)),e.item_id=t.item.id,e.quantity=t.item.quantity,o.$broadcast("loadHeadCart",t.cart)):r.showToast(t.message,$("#prod-cont-"+e.id))},function(e){})},e.checkFavorites=function(){var t={product_ids:e.prodIds};a.checkFavorite(t).then(function(t){if(console.log("checkFavorites res",t),"success"==t.status){var o=t.data;for(var n in o)for(var a in e.categories)for(var r in e.categories[a].products)e.categories[a].products[r].id==o[n].favoritable_id&&(e.categories[a].products[r].isFavorite=!0)}},function(e){})},e.addFavorite=function(e){if(o.user){var t={object_id:e.id,type:"Product"};a.addFavorite(t).then(function(t){console.log("Add addFavorite",t),"success"==t.status?(e.isFavorite=!0,r.showToast("Agregado",$("#prod-cont-"+e.id))):r.showToast(t.message,$("#prod-cont-"+e.id))},function(e){})}else r.showToast("Debes estar logueado para guardar productos",$("#prod-cont-"+e.id))},e.deleteFavorite=function(e){var t={object_id:e.id,type:"Product"};a.deleteFavorite(t).then(function(t){console.log("Add addFavorite",t),"success"==t.status?r.showToast("Agregado",$("#prod-cont-"+e.id)):r.showToast(t.message,$("#prod-cont-"+e.id))},function(e){})},e.cartCleared=function(){for(var t in e.categories)for(var o in e.categories[t].products)e.categories[t].products[o].item_id=null},e.cartDeletedItem=function(t){for(var o in e.categories)for(var n in e.categories[o].products)e.categories[o].products[n].item_id==t&&(e.categories[o].products[n].item_id=null)},e.updateProductsCart=function(t,o){e:for(var n in t.items)for(var a in e.categories)for(var r in e.categories[a].products){e.categories[a].products[r].item_id=null;for(var i in e.categories[a].products[r].variants){var s=t.items[n],c=e.categories[a].products[r].variants[i];if(s.attributes.product_variant_id==c.id&&(e.categories[a].products[r].item_id=s.id,e.categories[a].products[r].quantity=s.quantity,o))continue e}}},e.changeCartQuantity=function(e,n){"+"==n?e.quantity++:e.quantity--;var a={quantity:e.quantity,item_id:e.item_id,extras:[]};t.updateCartItem(a).then(function(t){"error"==t.status?(r.showToast("Error Actualizando",$("#prod-cont-"+e.id)),alert(t.message)):(r.showToast("Carrito actualizado",$("#prod-cont-"+e.id)),o.$broadcast("loadHeadCart",t.cart))},function(e){})}}]).controller("ProductDetailCtrl",["$scope","Cart","$rootScope","$sce","Products","$mdDialog","Modals",function(e,t,o,n,a,r,i){e.hasLocation=!1,e.hasMerchant=!1,e.product={},e.related_products=[],e.category_id=null,e.rating={},angular.element(document).ready(function(){e.clean();var t=viewData.replace(/App\\Models\\/g,"");console.log("viewData",t);var o=JSON.parse(t);console.log("Data",o),e.product=o.product,e.related_products=o.related_products[0].products;for(var a in e.related_products){var r=e.related_products[a].variants[0];for(var i in e.related_products[a].variants)e.related_products[a].variants[i].is_on_sale&&r.is_on_sale?e.related_products[a].variants[i].sale<r.sale&&(r=e.related_products[a].variants[i]):!e.related_products[a].variants[i].is_on_sale&&r.is_on_sale?e.related_products[a].variants[i].price<r.sale&&(r=e.related_products[a].variants[i]):e.related_products[a].variants[i].is_on_sale||r.is_on_sale?e.related_products[a].variants[i].is_on_sale&&!r.is_on_sale&&e.related_products[a].variants[i].sale<r.price&&(r=e.related_products[a].variants[i]):e.related_products[a].variants[i].price<r.price&&(r=e.related_products[a].variants[i]);e.related_products[a].activeVariant=r,e.related_products[a].variant_id=r.id}e.rating.type="Product",e.rating.object_id=e.product.id,e.rating.rating="5",e.product.variants=e.product.product_variants,e.product.activeVariant=e.product.variants[0],e.product.quantity=e.product.activeVariant.min_quantity,e.product.variant_id=e.product.variants[0].id,e.product.description=n.trustAsHtml(e.product.description),document.getElementById("dissapear").remove()}),o.$on("loadCartVariants",function(t,o){e.updateProductsCart(o,!1)}),e.clean=function(){angular.forEach(angular.element(".product-attributes"),function(e,t){var o=angular.element(e),n=JSON.parse(o.html()),a="";for(x in n)a+=x+": "+n[x]+" <br/>";o.html(a),o.css("display","block")})},e.selectVariant=function(e){for(var t in e.variants)e.variant_id==e.variants[t].id&&(e.activeVariant=e.variants[t])},e.addCartItem=function(e){var n={id:e.activeVariant.id,quantity:e.quantity,item_id:e.item_id,product:e};return e.activeVariant.is_on_sale&&e.activeVariant.sale<1||!e.activeVariant.is_on_sale&&e.activeVariant.price<1?(i.showToast("Ese producto no esta a la venta",$("#prod-cont-"+e.id)),!0):void t.addCartItem(n,[]).then(function(t){console.log("Add cart",t),"success"==t.status?(e.item_id=t.item.id,e.quantity=t.item.quantity,o.$broadcast("loadHeadCart",t.cart),i.showToast("Carrito actualizado",$("#add-cart-form"))):i.showToast(t.message,$("#add-cart-form"))},function(e){})},e.addRating=function(){return console.log("Rating",e.rating),o.user?e.rating.rating.length>0?void i.showToast("Agrega una calificacion",$("#toast-container")):e.rating.comment.length>0?void i.showToast("Agrega una observacion a tu calificacion",$("#toast-container")):void a.addRating(e.rating).then(function(e){console.log("Add cart",e),"success"==e.status?i.showToast("Mensaje enviado. Si vuelves a enviar se anula el anterior",$("#toast-container")):i.showToast(e.message,$("#toast-container"))},function(e){}):(console.log("Debes estar loguedo para comentar"),void i.showToast("Debes estar loguedo para comentar",$("#toast-container")))},e.updateProductsCart=function(t,o){var n=e.related_products;for(var a in t.items)for(var r in n)for(var i in n[r].variants){var s=t.items[a],c=n[r].variants[i];if(s.attributes.product_variant_id==c.id&&(n[r].item_id=s.id,n[r].quantity=s.quantity,o))break}},e.changeCartQuantity=function(e,n){"+"==n?e.quantity++:e.quantity--;var a={quantity:e.quantity,item_id:e.item_id,extras:[]};t.updateCartItem(a).then(function(t){"error"==t.status?alert(t.message):(o.$broadcast("loadHeadCart",t.cart),i.showToast("Carrito actualizado",$("#prod-cont-"+e.id)))},function(e){})}}])},function(e,t){angular.module("besafe").controller("ReportsCtrl",["$scope","Merchants","Modals",function(e,t,o){e.data={},e.user={},e.current=1,e.last=1,e.total=1,e.per_page=1,e.reports=[],e.categories=[],e.regionVisible=!1,e.editMerchant=!1,e.submitted=!1,e.category,angular.element(document).ready(function(){var t=viewData.replace(/App\\Models\\/g,"");console.log("res",t);var o=JSON.parse(t);console.log("Data",o),e.category=o.category,e.reports=o.data,e.current=o.page,e.per_page=o.per_page,e.last=o.last_page,e.total=o.total,document.getElementById("dissapear").remove()}),e.goTo=function(n){e.current=n,e.reports=[],o.showLoader();var a="category_id="+e.category.id+"&page="+e.current+"&limit=2";e.category.type.includes("nearby")?t.getReportsNearby(a).then(function(t){e.loadResults(t)},function(e){}):t.getReports(a).then(function(t){e.loadResults(t)},function(e){})},e.loadResults=function(t){e.reports=t.data,e.current=parseInt(t.page),e.per_page=parseInt(t.per_page),e.last=parseInt(t.last_page),e.total=parseInt(t.total),o.hideLoader()}}]).controller("ReportDetailCtrl",["$scope","Merchants","Modals",function(e,t,o){e.report={},angular.element(document).ready(function(){var t=viewData.replace(/App\\Models\\/g,"");console.log("res",t);var o=JSON.parse(t);console.log("Data",o),e.report=o})}])},function(e,t){angular.module("besafe").controller("RoutesCtrl",["$scope","$rootScope","Routes","Food","MapService",function(e,t,o,n,a){e.data={},e.routes,e.page=0,e.returns=[{name:"casa",address_id:17663},{name:"basilikum",address_id:17660}],e.loadMore=!0,e.scenario="preorganize",e.status="pending",e.provider="Basilikum",e.regionVisible=!1,e.editAddress=!1,e.mapActive=!1,angular.element(document).ready(function(){e.getRoutes()}),e.save=function(t){if(e.submitted=!0,t){var n=!1;e.data.address_id&&(n=!0),o.saveAddress($.param(e.data)).then(function(t){n?e.updateAddress(t.address):e.routes.push(t.address),e.data={},e.submitted=!1,e.editAddress=!1},function(e){})}},e.changeScenario=function(){console.log("provider",e.provider),e.page=0,e.hideAll(),"Basilikum"==e.provider&&(e.scenario="preorganize"),e.routes=[],e.getRoutes()},e.activateMap=function(){e.mapActive=!0,console.log("Creating map data"),a.createMap(4.685419,-74.064161),e.createMapData()},e.createMapData=function(){console.log("Creating map data");for(route in e.routes){var t=e.routes[route].stops;for(item in t)console.log("Creating map data stop"),t[item].icon="http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+t[item].amount+"|FE6256|000000",t[item].marker=a.createStop(t[item]);e.routes[route].stops=t,console.log("Creating map data route");var o=a.getColor();e.routes[route].polyline=a.createRoute(e.routes[route],o)}},e.buildRouteData=function(t){var o=t.stops,n=[];for(item in o){o[item].details=JSON.parse(o[item].details);var r={lat:o[item].address.lat,lng:o[item].address["long"]};n.push(r),o[item].name=o[item].address.address,o[item].lat=o[item].address.lat,o[item]["long"]=o[item].address["long"],o[item].moving_delivery=null,e.mapActive&&(o[item].marker=a.createStop(o[item]))}if(t.stops=o,t.stopsLat=n,e.mapActive){var i=e.getRouteColor();t.polyline=a.createRoute(t,i)}return setTimeout(function(){var o=document.getElementById("route-"+t.id+"-table");new Sortable(o,{group:"routes",handle:".handle",dataIdAttr:t.id,onAdd:function(t){console.log("On add",t);var o=t.item.attributes,n=t.target.id;n=n.replace("route-",""),n=n.replace("-table","");var a=parseInt(n),r=null;for(item in o)"data-stop"==o[item].name&&(r=o[item].value);e.updateRouteLocation(a,r,t.newIndex,1e3)},onUpdate:function(t){var o=t.item.attributes,n=null,a=null;for(item in o)"data-route"==o[item].name&&(n=o[item].value),"data-stop"==o[item].name&&(a=o[item].value);n&&a&&e.updateRouteLocation(n,a,t.newIndex,t.oldIndex)}});console.log("Setting sortable")},1e3),t.address_id=17663,t},e.updateRouteLocation=function(t,o,n,a){console.log("Route",t),console.log("stop",o),console.log("index",n);var r=null,i=[];for(item in e.routes)if(e.routes[item].id==t){var s=e.routes[item],c=1;for(stopI in s.stops)s.stops[stopI].id==o?r=s.stops[stopI]:a>n?c>=n&&i.push(s.stops[stopI]):c>n&&i.push(s.stops[stopI]),c++}console.log("displacedStops",i),r||(r={},r.route_id=t,r.id=o),console.log("Moving stop",r),$(".preloader").fadeIn("slow"),e.updateRouteStop(r),setTimeout(function(){var t=1;if(i.length>0){for(item in i)e.updateSpeed(i[item],t),t++,console.log("displacing stop",i[item]);setTimeout(function(){window.location.reload()},300*(t+1))}else setTimeout(function(){window.location.reload()},300*(t+1))},1e3)},e.updateSpeed=function(t,o){setTimeout(function(){e.updateRouteStop(t)},300*(o+1))},e.getRoutes=function(){console.log("Status",e.status),console.log("provider",e.provider),e.page++;var t="includes=stops.address&order_by=id,asc&page="+e.page+"&type="+e.scenario+"&status="+e.status+"&provider="+e.provider;"pending"!=e.status&&(t="includes=stops.address&order_by=id,asc&page="+e.page+"&status="+e.status),o.getRoutes(t).then(function(t){var o=t.data;t.page==t.last_page&&(e.loadMore=!1);for(item in o)o[item]=e.buildRouteData(o[item]);e.routes=o},function(e){})},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.sendReminder=function(){n.sendReminder().then(function(e){},function(e){})},e.showAll=function(){console.log("Creating map data");for(route in e.routes){var o=e.routes[route].stops;for(item in o)console.log("Creating map data stop"),o[item].marker.setMap(t.map);e.routes[route].stops=o,e.routes[route].polyline.setMap(t.map)}},e.hideAll=function(){console.log("Creating map data");for(route in e.routes){var t=e.routes[route].stops;for(item in t)console.log("Creating map data stop"),t[item].marker&&t[item].marker.setMap(null);e.routes[route].stops=t,e.routes[route].polyline&&e.routes[route].polyline.setMap(null)}},e.showRoute=function(o){e.hideAll(),console.log("Creating map data");var n=o.stops;for(item in n)console.log("Creating map data stop"),n[item].marker.setMap(t.map);o.polyline.setMap(t.map)},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.updateRouteStop=function(e){o.updateRouteStop(e.id,e.route_id).then(function(e){},function(e){})},e.updateRouteDelivery=function(e){o.updateRouteStop(e.route_id,e.moving_delivery,e.id).then(function(e){},function(e){})},e.deleteRoute=function(e){o.deleteRoute(e).then(function(e){},function(e){})},e.deleteStop=function(e){o.deleteStop(e).then(function(e){window.location.reload()},function(e){})},e.sendStopToNewRoute=function(e){o.sendStopToNewRoute(e).then(function(e){window.location.reload()},function(e){})},e.addReturnStop=function(e,t){o.addReturnStop(e,t).then(function(e){window.location.reload()},function(e){})},e.buildRoute=function(e){n.buildScenarioRouteId(e.id).then(function(t){e.status="scheduled"},function(e){})},e.getPurchaseOrder=function(){n.getPurchaseOrder().then(function(e){},function(e){})},e.regenerateScenarios=function(){n.regenerateScenarios().then(function(e){window.location.reload()},function(e){})},e.regenerateDeliveries=function(){n.regenerateDeliveries().then(function(e){},function(e){})},e.getTotalShippingCosts=function(){n.getSummaryShipping(e.status).then(function(e){},function(e){})},e.getScenarioOrganization=function(){var t=e.getInputs();n.getScenarioOrganizationStructure(t).then(function(e){},function(e){})},e.buildScenarioLogistics=function(){var t=e.getInputs();n.buildScenarioLogistics(t).then(function(e){window.location.reload()},function(e){})},e.getInputs=function(){var t;return t="enqueue"==e.status?{status:"enqueue"}:{status:e.status,provider:e.provider,type:e.scenario}},e.getScenarioEmails=function(){var t=e.getInputs();n.getScenarioStructure(t).then(function(e){},function(e){})}}]).controller("RapigoCtrl",["$scope","Payments",function(e,t){e.data={},e.key,angular.element(document).ready(function(){var e=window.location.href;e.split("/")}),e.getUpdate=function(){t.getKeyStatus(e.key).then(function(e){},function(e){})}}]).controller("RapigoCtrl",["$scope","MapService","Routes",function(e,t,o){e.map={center:{latitude:4.65345,longitude:-74.049605},zoom:8},e.activeMarker=null,e.markerStatus="",t.createMap(4.65345,-74.049605),angular.element(document).ready(function(){var t=window.location.href,o=t.split("/");e.key=o[o.length-1],e.getUpdate()}),e.getUpdate=function(){o.getKeyStatus(e.key).then(function(o){if("success"==o.status){var n=o.result;n&&(e.markerStatus=n.status,n.curier&&n.curier.lat&&!isNaN(n.curier.lat)&&(e.activeMarker?e.activeMarker.setPosition(new google.maps.LatLng(n.curier.lat,n.curier.lon)):e.activeMarker=t.createLocationMarker(n.curier.lat,n.curier.lon,!0),t.setCenterMap(n.curier.lat,n.curier.lon)),setTimeout(function(){e.getUpdate()},5e3))}},function(e){})}}])},function(e,t){angular.module("besafe").controller("SitemapCtrl",["$scope","Cart","$rootScope","Modals",function(e,t,o,n){e.data={},e.user={},e.current=1,e.last=1,e.total=1,e.per_page=1,e.merchants=[],e.categories=[],e.regionVisible=!1,e.editMerchant=!1,e.submitted=!1,e.category,angular.element(document).ready(function(){}),o.$on("updateShippingAddress",function(){o.user?t.showConfirm(window.location.href):t.showConfirmExt(window.location.href)}),e.goTo=function(e,a){console.log("Going");var r=a.target.href;if(e.includes("nearby")||e.includes("coverage"))if(e.includes("nearby")?r+="/nearby":e.includes("coverage")&&(r+="/coverage"),console.log("Type",e),console.log("target",a.target.href),a.preventDefault(),o.shippingAddress){var i=n.getAllUrlParams();i||(i={}),i.lat=o.shippingAddress.lat,i["long"]=o.shippingAddress["long"],console.log("params",i),console.log("res",n.turnObjectToUrl(i,r)),window.location.href=n.turnObjectToUrl(i,r)}else o.user?t.showConfirm(r):t.showConfirmExt(r);else window.location.href=r}}]).controller("SearchCtrl",["$scope","$rootScope","$cookies","Modals",function(e,t,o,n){e.category="products|0|coverage",e.searchText="",e.showError=!1,angular.element(document).ready(function(){var t,o=window.location.href;o.includes("merchant")?e.category="merchants|0|list":o.includes("report")&&(e.category="reports|0|list"),t=n.getAllUrlParams(),t&&t.q&&(e.searchText=decodeURIComponent(t.q))}),e.selectCat=function(){e.category.length>0&&(e.showError=!1)},e.search=function(){if(e.category.length>0){console.log("Search: ",e.searchText," Category: ",e.category);var n=e.category.split("|"),a="";if("merchants"==n[0]?a="/a/merchant-search":"reports"==n[0]?a="/a/report-search":"products"==n[0]&&(a="/a/product-search"),"nearby"==n[2]||"coverage"==n[2]){if(!t.shippingAddress)return a+="0"==n[1]?"?q="+e.searchText:"?categories="+n[1]+"&q="+e.searchText,o.put("locationRefferrer",a,{path:"/"}),void(window.location.href="/location");a+="0"==n[1]?"?lat="+t.shippingAddress.lat+"&long="+t.shippingAddress["long"]+"&q="+e.searchText:"?categories="+n[1]+"&lat="+t.shippingAddress.lat+"&long="+t.shippingAddress["long"]+"&q="+e.searchText}else a+="0"==n[1]?"?q="+e.searchText:"?categories="+n[1]+"&q="+e.searchText;window.location.href=a}else e.showError=!0}}]).controller("HomeCtrl",["$scope","Cart","$rootScope","Modals",function(e,t,o,n){e.data={},e.user={},e.category,e.goTo=function(e,a,r){if(e.includes("nearby")||e.includes("coverage")){var i=a.currentTarget.href;if(r&&(e.includes("nearby")?i+="/nearby":e.includes("coverage")&&(i+="/coverage")),console.log("Type",e),console.log("target",a.currentTarget.href),a.preventDefault(),o.shippingAddress){var s;s=n.getAllUrlParams(i),s||(s={}),s.lat=o.shippingAddress.lat,s["long"]=o.shippingAddress["long"],console.log("params",s),console.log("res",n.turnObjectToUrl(s,i)),window.location.href=n.turnObjectToUrl(s,i)}else o.user?t.showConfirm(i):t.showConfirmExt(i)}}}])},function(e,t){angular.module("besafe").controller("SourcesCtrl",["$scope","Billing","$rootScope",function(e,t,o){function n(t){e.data.source=t,e.saveSource()}e.data={},e.months=[],e.years=[],e.branches=[{name:"Visa",value:"VISA"},{name:"Mastercard",value:"MASTERCARD"},{name:"Visa Debito",value:"VISA_DEBIT"},{name:"Diners",value:"DINERS"},{name:"American Express",value:"AMEX"}],e.sources=[],e.buying=!1,e.editSource=!1,e.showStripe=!1,e.hideDefault=!1,e.config={},angular.element(document).ready(function(){e.localGateway=e.config.gateway}),e.save=function(t){e.submitted=!0,console.log("Saving: "+t),t&&(e.showStripe=!0)},e.edit=function(){e.editSource?e.editSource=!1:e.editSource=!0};var a=stripe.elements({locale:$translate.use()}),r={base:{color:"#32325d",lineHeight:"24px",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}},s=a.create("card",{style:r});s.mount("#card-element"),s.addEventListener("change",function(e){var t=document.getElementById("card-errors");e.error?t.textContent=e.error.message:t.textContent=""});var c=document.getElementById("payment-form"),l={owner:{name:e.data.name,address:{line1:e.data.address,city:e.data.city,postal_code:e.data.postal,country:e.data.country},email:e.data.email}};c.addEventListener("submit",function(e){e.preventDefault(),stripe.createSource(s,l).then(function(e){if(e.error){var t=document.getElementById("card-errors");t.textContent=e.error.message}else n(e.source)})}),e.stripeCreateToken=function(){},e.loadMonths=function(){console.log("Loading months");var t=new Date;for(i=0;i<15;i++)e.years.push(t.getFullYear()+i);for(i=0;i<12;i++)e.months.push(1+i)},e.saveSource=function(){delete e.data.cvc,delete e.data.expMonth,delete e.data.expYear,delete e.data.number,delete e.data.postal,console.log("Data sent"),console.log(JSON.stringify(e.data)),console.log(JSON.stringify($.param(e.data))),t.createSource($.param(e.data),o.gateway).then(function(t){if(console.log("Return source"),console.log(JSON.stringify(t)),"card"==t.type){var o=t.card;o.type="card",e.sources.push(o),e.editSource=!1}e.data={},e.submitted=!1},function(e){})},e.getSources=function(o){t.getSources(o).then(function(t){var o=t.sources;for(item in o)if("card"==o[item].type){var n=o[item].card;n.type="card",n.id=o[item].id,n.is_default=o[item].is_default,e.sources.push(n)}0==o.length?(e.editSource=!0,e.hidedefault=!0,e.data["default"]=!0):e.hidedefault=!1},function(e){})},e.deleteSource=function(n){t.deleteSource(n.id,o.gateway).then(function(t){for(item in e.sources)e.sources[item].id==n.id&&(console.log("deleting source",e.sources[item]),e.sources.splice(item,1))},function(e){})},e.loadTestData=function(t){e.data.cvc="123",e.data.postal="33132",e.data.expYear="2020",e.data.expMonth="12"},e.selectSource=function(e){o.$broadcast("SourceSelected",{source:e.id})},o.$on("GetSources",function(t,o){e.getSources(o.gateway),e.buying=!0}),o.$on("GatewaySelected",function(t,n){o.gateway==e.localGateway&&(e.getSources(e.localGateway),e.loadMonths(),e.loadTestData())}),e.clean=function(){e.data={}},e.setAsDefault=function(n){var a={};a.source=n.id,t.setAsDefault(a,o.gateway).then(function(t){for(item in e.sources)e.sources[item].is_default=!1,e.sources[item].id==n.id&&(e.sources[item].is_default=!0)},function(e){window.location.reload()})}}]).controller("SourcesPayuCtrl",["$scope","Billing","$rootScope",function(e,t,o){e.data={},e.months=[],e.years=[],e.branches=[{name:"Visa",value:"VISA"},{name:"Mastercard",value:"MASTERCARD"},{name:"Visa Debito",value:"VISA_DEBIT"},{name:"Diners",value:"DINERS"},{name:"American Express",value:"AMEX"}],e.sources=[],e.buying=!1,e.showErrors=!1,e.editSource=!1,e.errors=[],e.config={},angular.element(document).ready(function(){e.localGateway="PayU"}),e.save=function(t){e.submitted=!0,e.showErrors=!1,console.log("Saving: "+t),t&&e.saveSource()},e.edit=function(){e.editSource?e.editSource=!1:e.editSource=!0},e.loadMonths=function(){console.log("Loading months");var t=new Date;for(i=0;i<15;i++)e.years.push(t.getFullYear()+i);for(i=0;i<12;i++)e.months.push(1+i)},e.saveSource=function(){console.log("Data sent"),console.log(JSON.stringify(e.data)),console.log(JSON.stringify($.param(e.data))),t.createSource($.param(e.data),e.localGateway).then(function(t){console.log("Reply to create"),console.log(JSON.stringify(t)),"success"==t.status?(e.getSources(),e.data={},e.data.country="CO",e.submitted=!1,e.editSource=!1):(e.editSource=!0,e.errors=t,e.showErrors=!0)},function(e){})},e.getSources=function(){t.getSources(e.localGateway).then(function(t){console.log("Sources"),e.sources=[];var o=t.sources;console.log(JSON.stringify(o));for(item in o){var n=o[item];n.type="card",e.sources.push(n)}0==o.length&&(e.editSource=!0)},function(e){})},e.deleteSource=function(o){t.deleteSource(o.token,e.localGateway).then(function(t){for(item in e.sources)e.sources[item].token==o.token&&(console.log("deleting source",e.sources[item]),e.sources.splice(item,1),0==e.sources.length&&(e.editSource=!0))},function(e){})},e.loadTestData=function(){e.data.name="Hoovert Arredondo",e.data.line1="Calle 73 # 0-24",e.data.line2="Apto 202",e.data.line3="",e.data.postalCode="",e.data.city="Bogota",e.data.state="Cundinamarca",e.data.country="CO",e.data.phone="3105507245",e.data.document="1020716535",e.data.number="4111111111111111",e.data.expMonth="10",e.data.expYear="2020",e.data.branch="VISA"},e.selectSource=function(e){o.$broadcast("SourceSelected",{source:e.id})},o.$on("GetSources",function(t,o){e.getSources(),e.buying=!0}),o.$on("GatewaySelected",function(t,n){o.gateway==e.localGateway&&(e.getSources(),e.loadTestData())}),e.clean=function(){e.data={}},e.setAsDefault=function(o){var n={};n.source=o.token,t.setAsDefault(n,e.localGateway).then(function(t){for(item in e.sources)e.sources[item].is_default=!1,e.sources[item].token==o.token&&(e.sources[item].is_default=!0)},function(e){window.location.reload()})}}]).controller("SubscriptionsCtrl",["$scope","Billing",function(e,t){e.data={},e.subscriptions=[],e.plans=[],e.showEdit=!1,e.localGateway="",angular.element(document).ready(function(){e.getSubscriptions()}),e.save=function(o){if(e.submitted=!0,o){var n={plan_id:e.data.plan_id};t.editSubscription(n,e.data.subscription_id,e.localGateway).then(function(t){e.data.subscription_id=""+e.data.subscription_id;for(item in e.subscriptions)e.subscriptions[item].source_id==e.data.subscription_id&&(console.log("deleting subscription",e.subscriptions[item]),e.subscriptions.splice(item,1));e.subscriptions.push(t.subscription)},function(e){})}},e.getSubscriptions=function(){t.getSubscriptions().then(function(t){e.subscriptions=t.subscriptions;for(x in e.subscriptions){var o=e.subscriptions[x].object;e.subscriptions[x].object_name=o.name,e.subscriptions[x].object_code=o.code,
e.subscriptions[x].object_status=o.status,e.subscriptions[x].object_ends=o.ends_at}},function(e){})},e.getPlans=function(){t.getPlans().then(function(t){e.plans=t.plans},function(e){})},e.deleteSubscription=function(o){t.deleteSubscription(o.source_id,o.gateway).then(function(t){var n=""+o.source_id;for(item in e.subscriptions)e.subscriptions[item].source_id==n&&e.subscriptions.splice(item,1)},function(e){})},e.clean=function(){e.data={}},e.editSubscription=function(t){e.data.subscription_id=t.id,e.getPlans(),e.showEdit=!0}}]).controller("PlansCtrl",["$scope","$rootScope",function(e,t){e.selectPlan=function(e){t.$broadcast("PlanSelected",{plan:e})}}]).controller("GatewaysCtrl",function(e,t){e.data={},e.objectSelected=!1,e.selectGateway=function(e){t.gateway=e,t.$broadcast("GatewaySelected")},t.$on("ObjectSelected",function(t,o){e.objectSelected=!0})}).controller("SubscriptionPlansStripeCtrl",function(e,t,o){function n(t,o){o.error||(e.data.source=o.id,e.createSubscription())}e.data={},e.months=[],e.years=[],e.sources=[],e.localGateway="",e.sourceSelected=!1,e.showSources=!1,e.buying=!0,e.data.object_id=1,angular.element(document).ready(function(){e.localGateway="Stripe"}),e.saveSimple=function(t){e.submitted=!0,t&&e.createSubscription()},e.save=function(t){e.submitted=!0,t&&e.stripeCreateToken()},e.loadMonths=function(){var t=new Date;for(i=0;i<15;i++)e.years.push(t.getFullYear()+i);for(i=0;i<12;i++)e.months.push(1+i)},e.editSources=function(){window.location.href="/sources"},e.loadTestData=function(){e.data.number="4242424242424242",e.data.cvc="123",e.data.postal="33132",e.data.expYear="2020",e.data.expMonth="12"},e.createSubscription=function(){e.data["default"]=!0,delete e.data.cvc,delete e.data.expMonth,delete e.data.expYear,delete e.data.number,delete e.data.postal,console.log("Data sent"),console.log(JSON.stringify(e.data)),console.log(JSON.stringify($.param(e.data))),t.createSubscription($.param(e.data),e.localGateway).then(function(t){"status"in t&&"success"==t.status&&(console.log("Subscription created"),e.data={},e.submitted=!1,window.location.href="/subscriptions"),e.errors=t,e.showErrors=!0},function(e){})},e.stripeCreateToken=function(){Stripe.source.create({type:"card",card:{number:e.data.number,cvc:e.data.cvc,exp_month:e.data.expMonth,exp_year:e.data.expYear},owner:{address:{postal_code:e.data.postal}}},n)},o.$on("PlanSelected",function(t,o){e.data.plan_id=o.plan}),o.$on("ObjectSelected",function(t,o){e.data.object_id=o.object_id}),o.$on("GatewaySelected",function(t,n){if(o.gateway==e.localGateway){console.log(JSON.stringify(e.config));var a=e.config.sources;console.log(e.localGateway);for(item in a)console.log(JSON.stringify(a[item])),a[item].gateway==e.localGateway&&a[item].has_default&&(e.sourceSelected=!0,console.log("Has default"));e.loadMonths(),e.loadTestData()}})}).controller("SubscriptionPlansPayuCtrl",["$scope","Billing","$rootScope",function(e,t,o){e.data={},e.months=[],e.years=[],e.branches=[{name:"Visa",value:"VISA"},{name:"Mastercard",value:"MASTERCARD"},{name:"Visa Debito",value:"VISA_DEBIT"},{name:"Diners",value:"DINERS"},{name:"American Express",value:"AMEX"}],e.sources=[],e.localGateway="",e.sourceSelected=!1,e.showSources=!1,e.buying=!0,e.hasDefault=!1,e.newCard=!1,e.data.object_id=1,angular.element(document).ready(function(){e.localGateway="PayU"}),e.saveSimple=function(t){e.submitted=!0,t&&e.createSubscription()},e.selectSource=function(t){e.data.source=t.token,e.submitted=!0,e.data.plan_id&&e.data.object_id&&(e.sourceSelected=!0,e.createSubscription())},e.newCardTrigger=function(){e.newCard=!0,e.sourceSelected=!1},e.getSources=function(){e.sourceSelected=!1,e.newCard=!1,t.getSources(e.localGateway).then(function(t){console.log("Sources"),e.sources=[];var o=t.sources;console.log(JSON.stringify(o));for(item in o){var n=o[item];n.type="card",e.sources.push(n)}0==o.length&&(e.newCard=!0)},function(e){})},e.save=function(t){e.submitted=!0,t&&(e.data["new"]=!0,e.createSubscription())},e.loadMonths=function(){var t=new Date;for(i=0;i<15;i++)e.years.push(t.getFullYear()+i);for(i=0;i<12;i++)e.months.push(1+i);console.log(JSON.stringify(e.months))},e.loadTestData=function(){console.log("Loading test data"),e.data.name="Hoovert Arredondo",e.data.line1="Calle 73 # 0-24",e.data.line2="Apto 202",e.data.line3="",e.data.postalCode="",e.data.city="Bogota",e.data.state="Cundinamarca",e.data.country="CO",e.data.phone="3105507245",e.data.document="1020716535",e.data.number="4111111111111111",e.data.expMonth="10",e.data.expYear="2020",e.data.branch="VISA"},e.createSubscription=function(){console.log("Data sent"),console.log(JSON.stringify(e.data)),console.log(JSON.stringify($.param(e.data))),t.createSubscription($.param(e.data),e.localGateway).then(function(t){return"status"in t&&"success"==t.status?(console.log("Subscription created"),e.data={},window.location.href="/subscriptions",e.submitted=!1,!0):(e.errors=t,void(e.showErrors=!0))},function(e){})},o.$on("PlanSelected",function(t,o){e.data.plan_id=o.plan}),o.$on("ObjectSelected",function(t,o){e.data.object_id=o.object_id}),o.$on("GatewaySelected",function(t,n){if(console.log(o.gateway),console.log(e.localGateway),console.log(o.gateway==e.localGateway),o.gateway==e.localGateway){console.log(JSON.stringify(e.config));var a=e.config.sources;console.log(e.localGateway);for(item in a)console.log(JSON.stringify(a[item])),a[item].gateway==e.localGateway&&a[item].has_default?(e.sourceSelected=!0,e.hasDefault=!0,console.log("Has default")):(e.sourceSelected=!1,e.hasDefault=!1,e.getSources());e.loadMonths(),e.loadTestData()}})}])},function(e,t){angular.module("besafe").controller("NotificationsCtrl",["$scope","$rootScope","Alerts",function(e,t,o){e.notifications=[],t.$broadcast("updateNotifList"),e.noavatar=API.avatar,e["delete"]=function(e){o.deleteNotification(e)},e.followNotification=function(e){o.get(e).then(function(e){console.log("After Get:"),console.log(JSON.stringify(e)),o.followNotification(e),console.log("After follow:"),console.log(JSON.stringify(e))},function(e){})},t.$on("updateNotifList",function(){e.notifications=[],o.loadNotificationsGlobal("50").then(function(o){for(notif in o){o[notif].created_at=new Date(o[notif].created_at),"location_first"==o[notif].type?o[notif]["class"]="ion-android-pin":"location_last"==o[notif].type?o[notif]["class"]="ion-android-pin":"notification_location"==o[notif].type?o[notif]["class"]="ion-android-compass":"emergency"==o[notif].type?o[notif]["class"]="ion-android-warning":"medical_emergency"==o[notif].type?o[notif]["class"]="ion-ios-medkit":"emergency_end"==o[notif].type?o[notif]["class"]="ion-flag":"user_message"==o[notif].type?o[notif]["class"]="ion-email":"group_message"==o[notif].type?o[notif]["class"]="ion-email":"new_contact"==o[notif].type?o[notif]["class"]="ion-person-stalker":"new_group"==o[notif].type?o[notif]["class"]="ion-person-stalker":"system"==o[notif].type&&(o[notif]["class"]="ion-alert");try{e.notifications.push(o[notif])}catch(n){console.log("Repetido"),console.log(JSON.stringify(o[notif]))}}t.notificationsChanged=!1},function(e){})}),t.$on("receivedNotification",function(e,o){t.$broadcast("updateNotifList")}),e.$on("$stateChangeSuccess",function(e,o,n,a,r){"tab.notifications"==o.name&&(console.log("Entering notifications"),1==t.notificationsChanged&&t.$broadcast("updateNotifList"))})}]).controller("UserRegisterCtrl",["$scope","LocationService","Users",function(e,t,o){e.data={},e.addresses,e.regionVisible=!1,e.cityVisible=!1,t.getCountries("").then(function(t){e.countries=t.data},function(e){})}]).controller("UserProfileCtrl",["$scope","$rootScope","Users","Modals",function(e,t,o,n){e.data={},angular.element(document).ready(function(){e.data=t.user}),t.$on("user_loaded",function(o,n){console.log("Loading user"),e.data=t.user}),e.save=function(t){e.submitted=!0,t&&(n.showLoader(),o.saveUser(e.data).then(function(t){n.hideLoader(),console.log("Resp",t),e.submitted=!1,"success"==t.status?(n.showToast("Actualizacion exitosa",$("#myaccountContent")),e.data=t.user):n.showToast("Hubo un error actualizando tus datos",$("#myaccountContent"))},function(e){}))}}]).controller("UserPasswordCtrl",["$scope","$rootScope","Users","Modals",function(e,t,o,n){e.data={},e.save=function(t){if(e.submitted=!0,t){if(e.data.password!=e.data.password_confirmation)return;n.showLoader(),o.updatePassword(e.data).then(function(t){n.hideLoader(),console.log("Resp",t),e.submitted=!1,"success"==t.status&&n.showToast("Actualizacion exitosa",$("#myaccountContent"))},function(e){n.hideLoader(),n.showToast("Contraseña incorrecta",$("#myaccountContent"))})}}}])},function(e,t){angular.module("besafe").controller("ZonesCtrl",["$scope","$rootScope","Zones","MapService","Merchants",function(e,t,o,n,a){e.data={},e.items=[],e.merchants=[],e.providers=[{name:"Mi Paquete",value:"MiPaquete"},{name:"Rapigo",value:"Rapigo"},{name:"Propio",value:"Propio"}],{name:"Basilikum",value:"Basilikum"},e.activeMerchant,e.activeMerchantObject={},e.searchTerms="",e.changeMerchant=!1,e.createNewMerchant=!1,e.loadMore=!0,e.page=0,angular.element(document).ready(function(){console.log("Getting merchants and zones"),e.getMerchants(),n.createMap(4.685419,-74.064161)}),e.getMerchants=function(){a.getMerchantsUser().then(function(t){"success"==t.status&&(e.merchants=t.data,e.activeMerchant=e.merchants[0].id,e.getItems())},function(e){})},t.$on("zone-updated",function(t,o){for(item in e.items)e.items[item].id==o.id&&(e.items[item].isActive=!0,e.$digest())}),e.buildItemData=function(e){return e.isActive=!1,e},e.changeActiveMerchant=function(){e.changeMerchant=!0},e.createItemStart=function(){e.createNewMerchant=!0},e.cancelChangeMerchant=function(){e.changeMerchant=!1},e.activateMap=function(){e.mapActive=!0,console.log("Creating map data"),e.createMapData()},e.createMapData=function(){console.log("Creating map data");for(item in e.items){console.log("Creating map data item");var t=n.getColor();e.items[item].polygon=n.createPolygon(e.items[item],t)}},e.clearMap=function(){for(item in e.items)console.log("Creating map data item"),e.items[item].polygon.setMap(null),e.items[item].isActive=!1},e.changeScenario=function(){e.clearMap(),e.items=[],e.page=0,e.getItems()},e.getColor=function(){var e=["#FF0000","#800000","#FFFF00","#808000","#00FF00","#008000","#00FFFF","#008080","#0000FF","#000080","#FF00FF","#800080"],t=Math.round(Math.random()*(e.length-1));return e[t]},e.selectItem=function(o){e.clearMap(),o.isActive=!0,o.polygon.setMap(t.map)},e.createItem=function(){e.clearMap();var a=t.map.getCenter(),r={lat:a.lat(),lng:a.lng()};console.log("Center Map",r.lat);var i=[{lat:r.lat+.006,lng:r.lng},{lat:r.lat-.006,lng:r.lng-.006},{lat:r.lat-.006,lng:r.lng+.006},{lat:r.lat+.006,lng:r.lng}],s={city_id:524,region_id:11,address_id:14,country_id:1,merchant_id:e.activeMerchant,provider:e.activeProvider,coverage:JSON.stringify(i),lat:4.649824,"long":-74.058881};o.createZoneItem(s).then(function(t){var o=n.getColor(),a=t.item;a.isActive=!1,a.polygon=n.createPolygon(a,o),e.items.push(a)},function(e){})},e.getItems=function(){e.page++;var t="order_by=id,desc&page="+e.page+"&merchant_id="+e.activeMerchant;o.getZones(t).then(function(t){t.page==t.last_page&&(e.loadMore=!1),console.log("Items",t.data);var o=t.data;for(item in o)o[item]=e.buildItemData(o[item]);e.items=e.items.concat(o),e.activateMap()},function(e){})},e.searchMerchants=function(){e.page++,a.searchMerchants(e.searchTerms).then(function(t){console.log("Items",t.data),e.merchants=t.data},function(e){})},e.selectMerchant=function(t){e.activeMerchantObject=t,e.clearMap(),e.page=0,e.items=[],e.activeMerchant=t.id+"",e.changeMerchant=!1,e.getItems()},e.selectMerchantObject=function(){console.log("Selecting merchant: ",e.activeMerchant),e.clearMap(),e.page=0,e.items=[],e.getItems()},e.updateItem=function(e){var t=e,n=[],a=null;t.polygon.getPaths().forEach(function(e,t){console.log("path",t);for(var o=e,r=0;r<o.getLength();r++){var i=o.getAt(r),s={lat:i.lat(),lng:i.lng()};n.push(s),0==r&&(a=s)}}),n.push(a);var r=t.polygon;delete t.polygon,delete t.isActive,t.coverage=JSON.stringify(n),console.log("Zone",t),console.log("Points",n),o.updateZoneItem(t).then(function(e){t.polygon=r,t.isActive=!1,console.log("updateZoneItem",e)},function(e){})},e.deleteItem=function(t){console.log("Zone",t),o.deleteZoneItem(t).then(function(o){for(t in e.items)console.log("Creating map data item"),e.items[t].polygon.setMap(null),e.items[t].isActive=!1,e.items.splice(t,1)},function(e){})}}])},function(e,t){angular.module("besafe").controller("ZonesPubCtrl",["$scope","$rootScope","Food","MapService",function(e,t,o,n){e.data={},e.items=[],e.merchants=[{name:"Plan de almuerzos",value:1299},{name:"Para preparar en casa",value:1300},{name:"Catering",value:1301}],e.providers=[{name:"Basilikum",value:"Basilikum"},{name:"Rapigo",value:"Rapigo"}],e.activeMerchant="1299",e.activeProvider="Basilikum",e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems(),n.createMap(4.685419,-74.064161)}),e.buildItemData=function(e){return e.isActive=!1,e},e.activateMap=function(){e.mapActive=!0,console.log("Creating map data"),e.createMapData()},e.createMapData=function(){console.log("Creating map data");for(item in e.items){console.log("Creating map data item");var t=n.getColor();e.items[item].polygon=n.createPolygon(e.items[item],t)}},e.clearMap=function(){for(item in e.items)console.log("Creating map data item"),e.items[item].polygon.setMap(null),e.items[item].isActive=!1},e.changeScenario=function(){e.clearMap(),e.items=[],e.page=0,e.getItems()},e.getColor=function(){var e=["#FF0000","#800000","#FFFF00","#808000","#00FF00","#008000","#00FFFF","#008080","#0000FF","#000080","#FF00FF","#800080"],t=Math.round(Math.random()*(e.length-1));return e[t]},e.selectItem=function(o){e.clearMap(),o.isActive=!0,o.polygon.setMap(t.map)},e.createItem=function(){e.clearMap();var t=[{lat:4.66188,lng:-74.056724},{lat:4.656747,lng:-74.060458},{lat:4.656277,lng:-74.052304}],a={city_id:524,region_id:11,address_id:14,country_id:1,merchant_id:e.activeMerchant,provider:e.activeProvider,coverage:JSON.stringify(t),lat:4.649824,"long":-74.058881};o.createZoneItem(a).then(function(t){var o=n.getColor(),a=t.item;a.polygon=n.createPolygon(a,o),e.items.push(a)},function(e){})},e.getItems=function(){e.page++;var t="order_by=id,desc&page="+e.page+"&merchant_id="+e.activeMerchant+"&provider="+e.activeProvider;o.getZones(t).then(function(t){t.page==t.last_page&&(e.loadMore=!1),console.log("Items",t.data);var o=t.data;for(item in o)o[item]=e.buildItemData(o[item]);e.items=e.items.concat(o),e.activateMap()},function(e){})},e.updateItem=function(e){var t=e,n=[],a=null;t.polygon.getPaths().forEach(function(e,t){console.log("path",t);for(var o=e,r=0;r<o.getLength();r++){var i=o.getAt(r),s={lat:i.lat(),lng:i.lng()};n.push(s),0==r&&(a=s)}}),n.push(a);var r=t.polygon;delete t.polygon,delete t.isActive,t.coverage=JSON.stringify(n),console.log("Zone",t),console.log("Points",n),o.updateZoneItem(t).then(function(e){t.polygon=r,console.log("updateZoneItem",e)},function(e){})},e.deleteItem=function(t){console.log("Zone",t),o.deleteZoneItem(t).then(function(o){for(t in e.items)console.log("Creating map data item"),e.items[t].polygon.setMap(null),e.items[t].isActive=!1,e.items.splice(t,1)},function(e){})}}])},function(e,t){angular.module("besafe").service("Addresses",["$q","$http",function(e,t){var o=function(){var o=e.defer();return t({method:"get",url:"/api/addresses"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},n=function(o){var n=e.defer();return t({method:"POST",url:"/api/addresses",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},a=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/addresses/"+o}).success(function(e){console.log(e),n.resolve(e)}).error(function(){n.reject("Failed to Delete Address")}),n.promise};return{getAddresses:o,saveAddress:n,deleteAddress:a}}])},function(e,t){angular.module("besafe").service("Billing",["$q","$http",function(e,t){var o=function(o,n){var a=e.defer();return t({method:"POST",url:"/api/billing/pay_cc/"+n,data:o}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to payCreditCard")}),a.promise},n=function(o){var n=e.defer();return t({method:"POST",url:"/api/billing/pay_in_bank/Local",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to payInBank")}),n.promise},a=function(o){var n=e.defer();return t({method:"POST",url:"/api/billing/complete_paid/Food",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to completePaidOrder")}),n.promise},r=function(o){var n=e.defer();return t({method:"POST",url:"/api/billing/retry/"+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to retryPayment")}),n.promise},i=function(o){var n=e.defer();return t({method:"POST",url:"/api/billing/add_transaction_costs/"+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to addTransactionCosts")}),n.promise},s=function(o,n){var a=e.defer();return t({method:"POST",url:"/api/billing/pay_debit/"+n,data:o}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to payDebit")}),a.promise},c=function(o,n){var a=e.defer();return t({method:"POST",url:"/api/billing/pay_cash/"+n,data:o}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to payCash")}),a.promise},l=function(o){var n="/api/payu/banks",a=e.defer();return t({method:"GET",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to getBanks")}),a.promise};return{payCreditCard:o,payInBank:n,completePaidOrder:a,retryPayment:r,addTransactionCosts:i,payDebit:s,payCash:c,getBanks:l}}])},function(e,t){angular.module("besafe").service("Booking",["$q","$http",function(e,t){var o=function(o){var n="/api/bookings",a=e.defer();return t({method:"get",url:n,params:o}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to getBookingsObject")}),a.promise},n=function(o){var n="/api/bookings/"+o,a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to getBooking")}),a.promise},a=function(){var o="/bookings/user",n=e.defer();return t({method:"get",url:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to getObjectsWithBookingUser")}),n.promise},r=function(o){var n="/api/bookings/"+o+"/check",a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to checkExistingBooking")}),a.promise},i=function(o){var n=e.defer();return t({method:"POST",url:"/api/bookings",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to addBookingObject")}),n.promise},s=function(o){var n=e.defer();return t({method:"POST",url:"/api/bookings/edit",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to editBookingObject")}),n.promise},c=function(o){var n=e.defer();return t({method:"POST",url:"/api/bookings/now",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to immediateBookingObject")}),n.promise},l=function(o){var n=e.defer();return t({method:"GET",url:"/api/availabilities",params:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to getAvailabilitiesObject")}),n.promise},d=function(o){var n=e.defer();return t({method:"POST",url:"/api/bookings/status",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to changeStatusBookingObject")}),n.promise},u=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/bookings/"+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to deleteBookingObject")}),n.promise},p=function(e){return 0==e?"Enero":1==e?"Febrero":2==e?"Marzo":3==e?"Abril":4==e?"Mayo":5==e?"Junio":6==e?"Julio":7==e?"Agosto":8==e?"Septiembre":9==e?"Octubre":10==e?"Noviembre":11==e?"Diciembre":void 0};return{getBookingsObject:o,getBooking:n,getObjectsWithBookingUser:a,checkExistingBooking:r,addBookingObject:i,editBookingObject:s,immediateBookingObject:c,getAvailabilitiesObject:l,changeStatusBookingObject:d,deleteBookingObject:u,getMonthName:p}}])},function(e,t){angular.module("besafe").service("Cart",["$q","$http","$mdDialog","Modals","$cookies","$rootScope",function(e,t,o,n,a,r){var i=function(e){o.show(n.getLocationPrompt()).then(function(t){"map"==t?(a.put("locationRefferrer",e,{path:"/"}),window.location.href="/location"):"address"==t&&g()},function(){})},s=function(e){a.put("locationRefferrer",e,{path:"/"}),window.location.href="/location"},c=function(e){return console.log("Checking: ",e,r.user),"booking"==e.type&&r.user?(appointmentbook(e.product),!1):(console.log("Check prod",r.shippingAddress),e.is_shippable?r.shippingAddress?d():(i(window.location.href),!1):d())};appointmentbook=function(e){var t=[],o=null,n=null;console.log("variants",e.variants);for(var a in e.variants)if(e.variant_id==e.variants[a].id){n=e.variants[a];break}console.log("Container",n),n.attributes&&(n.attributes.questions&&(t=n.attributes.questions),n.attributes.location&&(o=n.attributes.location));var r={availabilities:null,type:"Merchant",objectId:e.merchant_id,objectName:e.merchant_name,objectDescription:e.merchant_description,objectIcon:e.merchant_icon,expectedPrice:e.activeVariant.price,questions:t,product_variant_id:e.variant_id,quantity:e.amount,purpose:"external_book",alert:"#prod-cont-"+e.id};o&&(r.location=o),p(r)};var l=function(){var e=window.location.href,t=e.split("/"),o=t[t.length-1];return o.includes("?")&&(o=o.split("?")[0]),isNaN(o)?null:o},d=function(){if(r.merchant_id)return!0;var e=l();console.log("Searching for merchants in cat:",e),f(e)},u=function(){var e=l();console.log("Searching for merchants in cat:",e),f(e)},p=function(t){var a=e.defer();return o.show(n.getBookingPrompt(t)).then(function(e){console.log("Got result",r.cartMessage),n.hideLoader(),n.showToast(r.cartMessage,$(t.alert)),a.resolve(e)},function(){console.log("Got nothing"),n.hideLoader(),a.resolve()}),a.promise},g=function(){o.show(n.getAddressesPopup()).then(function(e){console.log("Got address",e),r.shippingAddress=e,r.lat=e.lat,a.put("shippingAddress",JSON.stringify(e),{path:"/"})},function(){console.log("Got nothing")})},f=function(e){o.show(n.getMerchantsPopup(e)).then(function(e){console.log("Got merchant",e);var t=n.getAllUrlParams();t||(t={});var o=window.location.href;o.includes("?")&&(o=o.split("?")[0]),t.merchant_id=e.id;var a=!0;for(var r in t)t.hasOwnProperty(r)&&(o=a?"?"+r+"="+t[r]:"&"+r+"="+t[r]);window.location.href=o},function(){console.log("Got nothing")})},m=function(o){console.log("Post to server",o);var n=e.defer();return t({method:"post",url:"/api/cart/add",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},h=function(){console.log("Post checkCart");var o=e.defer();return t({method:"post",url:"/api/cart/check",data:{}}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to checkCart")}),o.promise},v=function(t,a){console.log("Check variant: ",t);var i=c(t);t.merchant_id=r.merchant_id,t.item_id||(t.item_id=null);var s=t.product.activeVariant,l=e.defer();if(i)if(s.attributes&&s.attributes.questions&&"product"==s.type)o.show(n.getQuestionairePopup(s.attributes.questions)).then(function(e){var o=[];for(var n in e){var a={name:e[n].name,value:e[n].value};o.push(a)}var r={product_variant_id:t.id,merchant_id:t.merchant_id,quantity:t.quantity,item_id:t.item_id,extras:{data:o}};m(r).then(function(e){l.resolve(e)},function(){l.reject("Failed to get nearby")})},function(){l.resolve({status:"pending_questions",message:"Debes completar estas preguntas para comprar este producto"})});else{var d={product_variant_id:t.id,merchant_id:t.merchant_id,quantity:t.quantity,item_id:t.item_id,extras:a};m(d).then(function(e){l.resolve(e)},function(){l.reject("Failed to postToServer")})}else l.resolve({status:"pending_location",message:"msg"});return l.promise},y=function(o){var n=e.defer();return t({method:"post",url:"/api/cart/update",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},b=function(){var o=e.defer();return t({method:"GET",url:"/api/cart/get"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},_=function(){var o=e.defer();return t({method:"GET",url:"/api/cart/checkout"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},k=function(){var o=e.defer();return t({method:"post",url:"/api/cart/clear"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise};return{getCheckoutCart:_,getCart:b,addCartItem:v,postToServer:m,updateCartItem:y,showBooking:p,checkCart:h,showConfirm:i,showConfirmExt:s,clearCart:k,changeMerchant:u}}])},function(e,t){angular.module("besafe").service("Categories",["$q","$http",function(e,t){var o=function(o){var n="/api/categories/"+o,a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get nearby")}),a.promise};return{getCategories:o}}])},function(e,t){angular.module("besafe").service("Food",["$q","$http",function(e,t){var o=function(){var o="/api/food/newsletter",n=e.defer();return t({method:"get",url:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to sendNewsletter")}),n.promise},n=function(o){var n="/api/food/deliveries";o&&(n=n+"?"+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get getDeliveries")}),a.promise},a=function(o){var n="/api/food/menu";o&&(n=n+"?"+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get getArticles")}),a.promise},r=function(o){var n="/api/admin/zones";o&&(n=n+"?"+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get getArticles")}),a.promise},i=function(o){var n="/api/food/messages";o&&(n=n+"?"+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get getArticles")}),a.promise},s=function(){var o="/api/food/largest_addresses",n=e.defer();return t({method:"get",url:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get getLargestAddresses")}),n.promise},c=function(o){var n="/api/food/delegate_deliveries",a=e.defer();return t({method:"post",url:n,data:o}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get getLargestAddresses")}),a.promise},l=function(o,n){var a="/api/food/user/"+o+"/address/"+n,r=e.defer();return t({method:"post",url:a,data:{}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to updateDeliveryAddress")}),r.promise},d=function(o){var n="/api/food/update_dish",a=e.defer();return t({method:"post",url:n,data:o}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to updateDeliveryAddress")}),a.promise},u=function(o){var n="/api/food/build_route_id/"+o,a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to buildScenarioRouteId")}),a.promise},p=function(o){var n="/api/food/build_scenario_positive/"+o,a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to buildScenarioPositive")}),a.promise},g=function(o){var n="/api/food/build_complete_scenario/"+o,a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to buildCompleteScenario")}),a.promise},f=function(o){var n="/api/food/get_scenario_structure",a=e.defer();return t({method:"get",url:n,params:o}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to getScenarioStructure")}),a.promise},m=function(o){var n="/api/food/summary/"+o,a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to getSummaryShipping")}),a.promise},h=function(o){var n="/api/food/route_organize",a=e.defer();return t({method:"get",url:n,params:o}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to getScenarioOrganizationStructure")}),a.promise},v=function(o){var n="/api/food/build_scenario_logistics",a=e.defer();return t({method:"post",url:n,data:o}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to buildScenarioLogistics")}),a.promise},y=function(){var o="/api/food/purchase_order",n=e.defer();return t({method:"get",url:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to getPurchaseOrder")}),n.promise},b=function(){var o="/api/food/regenerate_scenarios",n=e.defer();return t({method:"get",url:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to regenerateScenarios")}),n.promise},_=function(){var o="/api/food/regenerate_deliveries",n=e.defer();return t({method:"get",url:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to regenerateDeliveries")}),n.promise},k=function(o){var n=e.defer();return t({method:"POST",url:"/api/food/menu/"+o.id,data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to updateMenuItem")}),n.promise},S=function(o){console.log("Updating zone item",o);var n=e.defer();return t({method:"PATCH",url:"/api/admin/zones/"+o.id,data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to updateZoneItem")}),n.promise},w=function(o){var n=e.defer();return t({method:"POST",url:"/api/admin/zones",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to createZoneItem")}),n.promise},C=function(o){var n=e.defer();return t({method:"POST",url:"/api/food/messages/"+o.id,data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to updateMessageItem")}),n.promise},A=function(){var o=e.defer();return t({method:"POST",url:"/api/food/reminder",data:{}}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to sendReminder")}),o.promise},M=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/food/messages/"+o.id}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to deleteMessageItem")}),n.promise},P=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/admin/zones/"+o.id}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to deleteZoneItem")}),n.promise},T=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/food/content/"+o.id}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to deleteMenuItem")}),n.promise},O=function(o){var n=e.defer();return t({method:"GET",url:"/api/articles?start_date="+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to getArticlesByDate")}),n.promise};return{getMenu:a,getZones:r,getPurchaseOrder:y,delegateDeliveriesAddress:c,getMessages:i,getArticlesByDate:O,updateDeliveryAddress:l,buildScenarioLogistics:v,regenerateDeliveries:_,getScenarioStructure:f,getSummaryShipping:m,buildScenarioRouteId:u,getDeliveries:n,sendReminder:A,buildCompleteScenario:g,regenerateScenarios:b,buildScenarioPositive:p,updateZoneItem:S,createZoneItem:w,updateMenuItem:k,getScenarioOrganizationStructure:h,updateMessageItem:C,sendNewsletter:o,deleteZoneItem:P,updateMissingDish:d,deleteMenuItem:T,deleteMessageItem:M,getLargestAddresses:s}}])},function(e,t){angular.module("besafe").service("Groups",["$q","$http",function(e,t){var o=function(){var o=e.defer();return t({method:"get",url:"/api/groups"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},n=function(o){var n=e.defer();return t({method:"POST",url:"/api/groups",data:o,headers:{"Content-Type":"application/x-www-form-urlencoded"
}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise};return{saveGroup:n,getGroups:o}}])},function(e,t){angular.module("besafe").service("Leads",["$q","$http",function(e,t){var o=function(o){var n="/api/leads",a=e.defer();return t({method:"post",url:n,data:o}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to sendLead")}),a.promise};return{sendLead:o}}])},function(e,t){angular.module("besafe").service("LocationService",["$q","$http","$rootScope",function(e,t,o){var n=function(o){var n=e.defer();return t({method:"get",url:"/api/locations"+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},a=function(o,n){var a=e.defer();return t({method:"get",headers:{"Content-Type":"application/json","X-Auth-Token":void 0,Authorization:void 0},url:"http://maps.googleapis.com/maps/api/geocode/json?latlng="+o+","+n+"&sensor=true"}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get nearby")}),a.promise},r=function(o){var n=e.defer();return console.log("Getting merchants"),console.log(JSON.stringify(o)),t({method:"get",url:"/api/merchants/nearby",params:o}).success(function(e){n.resolve(e)}).error(function(e){console.log(JSON.stringify(e)),n.reject("Failed to get nearby merchants")}),n.promise},i=function(o){console.log("Get locations trip: /historic_locations?target_id="+o.user_id+"&trip_id="+o.trip);var n=e.defer(),a="/historic_locations?target_id="+o.user_id+"&trip_id="+o.trip;return o.page&&(a=a+"&page="+o.page),o.perpage&&(a=a+"&per_page="+o.perpage),t.get(a).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},s=function(){var o=e.defer();return t({method:"get",url:"/api/locations/hash"}).success(function(e){o.resolve(e)}).error(function(e){console.log(JSON.stringify(e)),o.reject("Failed to get nearby")}),o.promise},c=function(o){var n=e.defer();return t({method:"get",url:"/api/cities?limit=50&region_id="+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},l=function(o){var n="/api/cities";o&&(n=n+"?"+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get nearby")}),a.promise},d=function(o){var n=e.defer();return t.post("/api/cities/from",o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},u=function(o){var n=e.defer();return t({method:"get",url:"/api/regions?limit=40&country_id="+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},p=function(o){var n=e.defer();return t({method:"get",url:"/api/countries?id="+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},g=function(){var o=e.defer();return t({method:"get",url:"/api/countries?limit=50&order_by=name,asc"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise};return{shared:n,merchants:r,getCountries:g,getCities:l,getUserHash:s,getCityFromLat:a,getRegionFromCity:d,getLocationsTrip:i,getCitiesRegion:c,getRegionsCountry:u,getCountry:p,getRegionName:function(e){for(region in o.regions){var t=o.regions[region];if(t.id==parseInt(e))return t.name}return null},isRegionsLoaded:function(){return!!o.regions},isCountriesLoaded:function(){return!!o.countries},getRegions:function(){return o.regions}}}])},function(e,t){angular.module("besafe").factory("MapService",["$q","$rootScope","LocationService",function(e,t,o){var n,a;t.map,t.iconpath="http://hoovert.com/images/icons",t.markers=[],t.polylines=[];var r,i=function(e,o){var n=new google.maps.LatLng(e,o);a={center:n,zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP},document.getElementById("map")&&(t.map=new google.maps.Map(document.getElementById("map"),a),r=new google.maps.InfoWindow,t.geocoder=new google.maps.Geocoder,t.mapActive=!0,t.mapLoaded=!0,t.tracking=!0,t.mapSemaphore=!0)},s=function(e){damap=t.map,console.log("info received in marker"),console.log(JSON.stringify(e));var o="";"still"==e.activity?(o="masculine-avatar.svg",console.log("entro still")):"on_foot"==e.activity?(console.log("entro on foot"),o="pedestrian-walking.svg"):"in_vehicle"==e.activity?o="car-front.svg":"on_bicycle"==e.activity?o="cycling.svg":"running"==e.activity?o="running.svg":""==e.activity&&(console.log("entro blank"),o="map-pin.svg");var n=new google.maps.Marker({id:e.id,user_id:e.user_id,position:new google.maps.LatLng(e.lat,e["long"]),map:damap,animation:google.maps.Animation.DROP,report_time:e.report_time,speed:e.speed,activity:e.activity,battery:e.battery,name:e.name,status:e.status,islast:e.islast,icon:{fillColor:"#ffffff",url:t.iconpath+"/"+o,fillOpacity:1,strokeColor:"#ffffff",strokeWeight:0,scaledSize:new google.maps.Size(35,35)}});return n.content='<div class="infoWindowContent">'+e.id+" "+e.name+"</div>",google.maps.event.addListener(n,"click",function(){r.setContent("<h2>"+n.report_time+"</h2>"+n.content),r.open(t.map,n)}),n},c=function(e,o,n){damap=t.map,console.log("info received in marker");var a=new google.maps.Marker({position:new google.maps.LatLng(e,o),map:damap,animation:google.maps.Animation.DROP,draggable:!0});return google.maps.event.addListener(a,"dragend",function(){var e=a.getPosition();y(e.lat(),e.lng()),A(e.lat(),e.lng(),1)}),n&&google.maps.event.trigger(a,"dragend"),t.locationMarker=a,a},l=function(e){damap=t.map;var o=new google.maps.Marker({id:e.id,position:new google.maps.LatLng(e.lat,e["long"]),map:damap,animation:google.maps.Animation.DROP,created_at:e.created_at,name:e.name});return o.content='<div class="infoWindowContent">'+e.id+" "+e.name+"</div>",google.maps.event.addListener(o,"click",function(){r.setContent("<h2>"+o.created_at+"</h2>"+o.content),r.open(t.map,o)}),o},d=function(e){damap=t.map,console.log("creating stop",e);var o=new google.maps.Marker({id:e.id,icon:e.icon,position:new google.maps.LatLng(e.lat,e["long"]),map:damap,animation:google.maps.Animation.DROP,name:e.name});return o.content='<div class="infoWindowContent">'+e.id+" "+e.name+"</div>",google.maps.event.addListener(o,"click",function(){r.setContent("<h2>"+o.created_at+"</h2>"+o.content),r.open(t.map,o)}),o},u=function(e,o){damap=t.map,console.log("createRoute",e);var n=e.stopsLat,a=new google.maps.Polyline({path:n,geodesic:!0,strokeColor:o,strokeOpacity:1,strokeWeight:2});return a.setMap(damap),a},p=function(){var e=["#FF0000","#800000","#FFFF00","#808000","#00FF00","#008000","#00FFFF","#008080","#0000FF","#000080","#FF00FF","#800080"],t=Math.round(Math.random()*(e.length-1));return e[t]},g=function(e,o){damap=t.map,console.log("createRoute",e);var n=JSON.parse(e.coverage),a=new google.maps.Polygon({id:e.id,paths:n,strokeColor:o,strokeOpacity:.8,editable:!0,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,draggable:!0,geodesic:!0});return a.setMap(damap),a.getPaths().forEach(function(o,n){google.maps.event.addListener(o,"insert_at",function(){console.log("zzinsert_at",e.id),t.$broadcast("zone-updated",e),e.isActive=!0}),google.maps.event.addListener(o,"remove_at",function(){console.log("zzinsert_at",e.id),t.$broadcast("zone-updated",e),e.isActive=!0}),google.maps.event.addListener(o,"set_at",function(){console.log("zzinsert_at",e.id),t.$broadcast("zone-updated",e)})}),google.maps.event.addListener(a,"dragend",function(){console.log("set_at.",a.id)}),a},f=function(e,o){if(console.log("Updating locations"),t.mapActive&&(console.log("Map Active"),t.mapSemaphore)){console.log("rootscope mapsemaphore true"),t.mapSemaphore=!1;var n="?page="+o+"&hash_id="+e;P(n,e)}},m=function(e){for(marker in t.markers)t.markers[marker]?t.markers[marker].user_id==e&&(t.markers[marker].setMap(null),t.markers.splice(marker,1)):t.markers.splice(marker,1)},h=function(e){for(polyline in t.polylines)if(t.polylines[polyline].user_id==e)return t.polylines[polyline];return null},v=function(e){console.log("add user to polyline"),t.mapLoaded||(t.mapLoaded=!0,i(e.lat,e["long"]));var o=new google.maps.LatLng(e.lat,e["long"]),n=h(e.user_id);if(n){m(e.user_id),console.log("pos added to existing poly");var a=n.getPath();a.push(o),"emergency"==e.status&&(n.status="emergency")}else{n=new google.maps.Polyline({strokeColor:"#000000",strokeOpacity:1,strokeWeight:3,user_id:e.user_id,name:e.name,status:e.status,visible:!0,isActive:!1});var a=n.getPath();a.push(o),n.setMap(t.map),console.log("new poly created and pos added: "+n.user_id),t.polylines.push(n)}e.owner_type="user",y(e.lat,e["long"]);var r=s(e);t.activeMarker=r,t.markers.push(r)},y=function(e,o){console.log("Setting map center"),n=new google.maps.LatLng(e,o),t.map&&(t.map.setZoom(15),t.map.setCenter(n))},b=function(e){for(target in e)e[target].id&&_(e[target])},_=function(e){console.log("Checking database for location: "+e.id),t.activeMarker?e.id>t.activeMarker.id&&(e.status=!0,console.log("Location exists: "),v(e)):v(e)},k=function(){t.map.addListener("dblclick",function(e){var o=e.latLng;t.locationMarker.setPosition(o),google.maps.event.trigger(t.locationMarker,"dragend"),y(o.lat(),o.lng()),A(o.lat(),o.lng(),1)}),t.map.addListener("click",function(e){var o=e.latLng;t.locationMarker.setPosition(o),google.maps.event.trigger(t.locationMarker,"dragend"),y(o.lat(),o.lng()),A(o.lat(),o.lng(),1)})},S=function(e){var t="";try{t=e[0].formatted_address}catch(o){}return t},w=function(e){if(e.length>0){var t,o=e[0],n=!1,a=0,r=o.address_components,i="";do{t=r[a];for(var s in t.types)"postal_code"==t.types[s]&&(i=t.long_name,n=!0);a++,a>=e.length&&(n=!0)}while(0==n);return console.log("decodePostalFromLatResult",i),i}},C=function(e){if(e.length>0){var t,o=e[0],n=!1,a=0,r=o.address_components,i="";do{t=r[a];for(var s in t.types)"administrative_area_level_1"==t.types[s]&&(i=t.long_name,n=!0);a++,a>=e.length&&(n=!0)}while(0==n);return console.log("decodeCityFromLatResult",i),i}},A=function(e,n,a){var r=this;M(e,n).then(function(i){if(console.log("Address from lat",i),i){var s=C(i),c="name="+s;console.log("Address where",c),o.getCities(c).then(function(o){if(console.log("Address data",o),o.total>0){var a=o.data,r=a[0];t.isActive=!1;var s={address:S(i),postal:w(i),lat:e,"long":n,city_id:r.id,region_id:r.region_id,country_id:1,countryCode:"CO"};t.shippingAddress?(t.shippingAddress.address=S(i),t.shippingAddress.postal=w(i),t.shippingAddress.lat=e,t.shippingAddress["long"]=n,t.shippingAddress.city_id=r.id,t.shippingAddress.region_id=r.region_id,t.shippingAddress.country_id=1):t.shippingAddress=s}else{var c={address:S(i),postal:w(i),lat:e,"long":n,country_id:1};t.shippingAddress?(t.shippingAddress.address=S(i),t.shippingAddress.postal=w(i),t.shippingAddress.lat=e,t.shippingAddress["long"]=n,t.shippingAddress.country_id=1):t.shippingAddress=c}},function(o){console.log(o);var a={address:S(i),postal:w(i),lat:e,"long":n,country_id:1};t.shippingAddress=a})}else if(console.log("Attempts",a),a<8){a++;var l=r;setTimeout(function(){l.getAddressAndPostal(e,n,a)},1e3)}})["catch"](function(e){console.log("Error getting location",e)})},M=function(o,n){var a=e.defer(),r={lat:parseFloat(o),lng:parseFloat(n)};return t.geocoder.geocode({location:r},function(e,t){"OK"===t?e[0]?a.resolve(e):a.resolve([]):window.alert("Geocoder failed due to: "+t)}),a.promise},P=function(e,n){o.shared(e).then(function(e){if(0==e.total)t.isActive=!1,alert("User has no active locations");else{var o=e.data;if(b(o),e.page<e.last_page){var a=e.page+1,r="?page="+a+"&hash_id="+n;P(r,n)}else t.mapSemaphore=!0,setTimeout(function(){console.log("Timeout Triggered"),f(n,e.page)},t.sharedTimeout)}},function(e){console.log(e)})};return{updateLocations:f,createMap:i,postMapLocation:k,createStop:d,createRoute:u,createLocationMarker:c,getColor:p,getAddressAndPostal:A,createPolygon:g,createReport:l}}])},function(e,t){angular.module("besafe").factory("MapDashService",["$q","$rootScope","LocationService",function(e,t,o){var n,a;t.map,t.iconpath="http://hoovert.com/images/icons",t.meicon="wasp.svg",t.markers=[],t.polylines=[];var r,s=function(e){var o=(t.markers.length,12),n=new google.maps.LatLng(4.704296,(-74.073775));a={center:n,zoom:o,mapTypeId:google.maps.MapTypeId.ROADMAP};var i=new google.maps.Map(document.getElementById(e),a);return r=new google.maps.InfoWindow,"map"==e&&(t.mapActive=!0,t.mapLoaded=!0,t.mapSemaphore=!0),i},c=function(e,o){console.log("Setting map center"),n=new google.maps.LatLng(e,o),t.map&&(t.map.setZoom(15),t.map.setCenter(n))},l=function(){return t.markers},d=function(e){for(marker in t.markers){var o=t.markers[marker];if(o.user_id==parseInt(e))return o}return null},u=function(e){for(polyline in t.polylines)if(t.polylines[polyline].user_id==e)return t.polylines[polyline];return null},p=function(e){for(polyline in t.polylines)if(t.polylines[polyline].user_id==e)return t.polylines[polyline];return null},g=function(e){if(console.log("add user to polyline"),P(e.user_id),"1"==e.islast)w(e.user_id);else{var o=new google.maps.LatLng(e.lat,e["long"]),n=u(e.user_id);if(n){I(e.user_id),console.log("pos added to existing poly");var a=n.getPath();a.push(o),"emergency"==e.status&&(n.status="emergency")}else{n=new google.maps.Polyline({strokeColor:"#000000",strokeOpacity:1,strokeWeight:3,user_id:e.user_id,name:e.name,status:e.status,visible:t.rootMapMarkers,isActive:!1});var a=n.getPath();a.push(o),t.rootMapMarkers?n.setMap(t.map):n.setMap(null),console.log("new poly created and pos added: "+n.user_id),t.polylines.push(n)}e.owner_type="user",v(e);var r=O(e,t.rootMapMarkers);t.markers.push(r)}},f=function(e){for(polyline in t.polylines)t.polylines[polyline].setMap(t.map)},m=function(){for(marker in t.merchants)t.merchants[marker].setMap(t.map)},h=function(){for(marker in t.reports)t.reports[marker].setMap(t.map);console.log("Done showing reports")},v=function(e){console.log("Check active: "+e.owner_type),console.log(JSON.stringify(e)),console.log("Active type: "+t.mapActiveType+" id: "+t.mapId),t.mapActiveType||(t.mapActiveType=e.owner_type),t.mapId||(t.mapId=e.user_id),t.mapActiveType==e.owner_type&&(console.log("type the same mapid: "+t.mapId+" user: "+e.user_id),"me"==t.mapActiveType&&k("me",-1,null),t.mapId==e.user_id&&(console.log("Set center map, id the same"),c(e.lat,e["long"])))},y=function(e,n){var a={lat:e,"long":n,radius:t.radius};o.merchants(a).then(function(e){var t=e.merchants;console.log(JSON.stringify(e)),console.log("merchants received from server: "+t.length),0==t.length?alert("No tenemos informacion de puntos de seguridad en ese punto"):S(e)},function(e){console.log(e)})},b=function(e,o){t.rootMapMarkers=!1,U(e,o).then(function(e){console.log("locations in trip: "+o+" count: "+e.length),console.log(JSON.stringify(e)),e.length>0?G(e):alert("No encuentro ese viaje")},function(e){})},_=function(){t.map.addListener("dblclick",function(e){var t=e.latLng;c(t.lat(),t.lng()),y(t.lat(),t.lng())}),t.memarkerpending&&(console.log("me marker was created before map so loading now"),t.memarkerpending=!1,t.memarker.setMap(t.map)),t.merchantspending&&(console.log("merchants were created before map so loading now"),m(),h(),t.merchantspending=!1),k(t.mapActiveType,t.mapId,null),alert("doble click para encontrar puntos de seguridad")},k=function(e,o,n){if(console.log("Setting as active: "+o+" type: "+e),t.mapActiveType=e,t.mapId=o,window.localStorage.setItem("MAP_ACTIVE_TYPE",e),window.localStorage.setItem("MAP_ACTIVE_ID",o),n)c(n.lat(),n.lng());else{var a=!1;if("emergency"==e||"user"==e||"medical_emergency"==e||"me"==e)t.tracking=!0,t.rootMapMarkers=!0,C(t.mapId)&&(a=!0);else if("trip"==e){var r=t.contactTrip,i=t.contactIdTrip;b(i,r),a=!0}if(!a){var s=t.markers.length;if(s>0){var l=t.markers[s-1];if(l){var d=l.getPosition(),u=d.latLng;if(u)return k("user",l.user_id),!0}}}if(!a&&t.trackingActive)return"me"!=e&&k("me",-1),!0}},S=function(e){var o=e.merchants;for(merchant in o){var n=!1;for(marker in t.merchants)if(o[merchant].id==t.merchants[marker].id){n=!0;break}0==n&&t.merchants.push(D(o[merchant]))}var a=e.reports;for(report in a){var n=!1;for(marker in t.reports)if(a[report].id==t.reports[marker].id){n=!0;break}0==n&&(a[report].type="Report",t.reports.push(D(a[report])))}return null},w=function(e){for(polyline in t.polylines)t.polylines[polyline]&&(t.polylines[polyline].user_id=e)&&(I(t.polylines[polyline].user_id),t.polylines[polyline].setMap(null),t.polylines.splice(polyline,1))},C=function(e){if(e>0){for(marker in t.markers)if(t.markers[marker].user_id=e){var o=t.markers[marker].getPosition();return c(o.lat(),o.lng()),t.markers[marker].setMap(t.map),!0}}else if(t.memarker){var o=t.memarker.getPosition();return c(o.lat(),o.lng()),!0}return!1},A=function(e){for(polyline in t.polylines)t.polylines[polyline]&&t.polylines[polyline].setMap(null)},M=function(e){var o=!1;for(unknown in t.followingUnknown)t.followingUnknown[unknown]==e&&(o=!0);0==o&&t.followingUnknown.push(e)},P=function(e){for(unknown in t.followingUnknown)if(t.followingUnknown[unknown]==e)return console.log("Removing user: "+e+" from unknowns"),t.followingUnknown.splice(unknown,1),!0;return!1},T=function(){t.followingUnknown.length>0?(t.tracking=!0,t.mapSemaphore=!0,console.log("Unknown markers"),console.log(JSON.stringify(t.followingUnknown)),setTimeout(function(){console.log("Timeout Triggered unknowns"),J()},t.sharedTimeout)):(window.localStorage.setItem("USER_TRACKING",!1),console.log("No one is sharing location with user"),t.$broadcast("NoSharers"))},O=function(e,o){o&&t.map?damap=t.map:damap=null,console.log("info received in marker"),console.log(JSON.stringify(e));var n="";"still"==e.activity?(n="masculine-avatar.svg",console.log("entro still")):"on_foot"==e.activity?(console.log("entro on foot"),n="pedestrian-walking.svg"):"in_vehicle"==e.activity?n="car-front.svg":"on_bicycle"==e.activity?n="cycling.svg":"running"==e.activity?n="running.svg":""==e.activity&&(console.log("entro blank"),n="map-pin.svg"),console.log("Icon path marker"),console.log(t.iconpath+"/"+n);var a=new google.maps.Marker({id:e.id,user_id:e.user_id,position:new google.maps.LatLng(e.lat,e["long"]),map:damap,animation:google.maps.Animation.DROP,report_time:e.report_time,speed:e.speed,activity:e.activity,battery:e.battery,name:e.name,status:e.status,islast:e.islast,icon:{fillColor:"#ffffff",url:t.iconpath+"/"+n,fillOpacity:1,strokeColor:"#ffffff",strokeWeight:0,scaledSize:new google.maps.Size(35,35)}});if(a.content='<div class="infoWindowContent">'+e.id+" "+e.name+"<br/><a onClick=\"window.open('http://waze.to/?ll="+e.lat+","+e["long"]+"&navigate=yes','_system','location=yes');return false;\">Waze</a><br/><a href=\"tel:"+e.phone+'">'+e.phone+"</a></div>",google.maps.event.addListener(a,"click",function(){r.setContent("<h2>"+a.report_time+"</h2>"+a.content),r.open(t.map,a);var e=a.getPosition();k("user",a.user_id,e)}),"emergency"==e.status){var i=a.getPosition();k("emergency",e.user_id,i)}return a},D=function(e){t.map?damap=t.map:(damap=null,t.merchantspending=!0,console.log("Merchant pending from adding to map"));var o="";"police"==e.type?o="police-shield.svg":"medical"==e.type?o="medic-suitcase.svg":"Report"==e.type&&(o="pin.svg"),console.log("icon: "+t.iconpath+"/"+o+" for type: "+e.type);var n=new google.maps.Marker({id:e.id,position:new google.maps.LatLng(e.lat,e["long"]),map:damap,animation:google.maps.Animation.DROP,icon:{fillColor:"#ffffff",url:t.iconpath+"/"+o,fillOpacity:1,strokeColor:"#ffffff",strokeWeight:0,scaledSize:new google.maps.Size(25,25)}});n.content='<div class="infoWindowContent">'+e.type+'<br/><a class="button icon-left ion-ios7-telephone button-calm button-outline" href="tel:+ '+e.telephone+'">'+e.telephone+"</a><br/>"+e.address+"<br/><a onClick=\"window.open('http://waze.to/?ll="+e.lat+","+e["long"]+"&navigate=yes','_system','location=yes');return false;\">Waze</a></div>";var o="";"police"==e.type?o="map-icon-police":"medical"==e.type?o="map-icon-health":"Report"==e.type&&(o="map-icon-report",n.content='<div class="infoWindowContent">'+e.type+"<br/>"+e.address+"<br/><a onClick=\"window.open('http://waze.to/?ll="+e.lat+","+e["long"]+"&navigate=yes','_system','location=yes');return false;\">Waze</a></div>"),console.log("creating merchant");var a=new google.maps.InfoWindow;return google.maps.event.addListener(n,"click",function(){a.setContent("<h2>"+e.name+"</h2>"+n.content),a.open(t.map,n)}),n},$=function(o){var n=e.defer(),a=0;for(target in o)o[target].id&&(a++,t.lastLocation<o[target].id&&(t.lastLocation=o[target].id),B(o[target]).then(function(e){a--,0==a&&n.resolve("done")},function(e){console.log("Error in checking locations"),console.error(JSON.stringify(e)),a--,0==a&&n.resolve("done")}));return n.promise},I=function(e){for(marker in t.markers)t.markers[marker]?t.markers[marker].user_id==e&&(t.markers[marker].setMap(null),t.markers.splice(marker,1)):t.markers.splice(marker,1)},F=function(){j(t.markers),A()},j=function(e){for(marker in e)e[marker]&&e[marker].setMap(null)},L=function(){if(t.tempMarkers){for(marker in t.tempMarkers)t.tempMarkers[marker]&&t.tempMarkers[marker].setMap(null);t.tempMarkers=[]}t.tempPolyline&&(t.tempPolyline.setMap(null),t.tempPolyline=null)},E=function(){R(t.markers),f()},R=function(e){for(marker in e)e[marker]&&e[marker].setMap(t.map)},x=function(e){for(marker in e)e[marker]?(console.log("id: "+e[marker].id),console.log("speed: "+e[marker].speed),console.log("activity: "+e[marker].activity),console.log("battery: "+e[marker].battery),console.log("lat: "+e[marker].lat),console.log("long: "+e[marker]["long"]),console.log("name: "+e[marker].name),console.log("trip: "+e[marker].trip),console.log("type: "+e[marker].type),console.log("user_id: "+e[marker].user_id),console.log("report_time: "+e[marker].report_time)):(console.log("Marker is null: "+marker),console.log(e[marker]))},N=function(e){console.log(t.markers.length);for(marker in t.markers)if(console.log("Comparing markers"),t.markers[marker]){if(console.log(t.markers[marker].id),console.log(e),t.markers[marker].id==e)return console.log("Marker found, returning now"),t.markers[marker]}else t.markers.splice(marker,1);return null},B=function(o){var n=e.defer();console.log("Checking database for location: "+o.id);var a=!1;for(item in t.markers)t.markers[item].id==o.id&&(a=!0);if(a){o.status=!0,console.log("Location exists: ");var r=d(o.user_id);r?(console.log("User Marker Found"),r.id>=o.id?console.log("User Marker older"):(console.log("User Marker newer"),g(o))):(console.log("Marker does not exist"),g(o)),n.resolve(o)}else o.status=!0,console.log("Location does not exists"),g(o);return n.promise},q=function(e,t,o){console.log("Trying sql contactTrips not implemented yet")},V=function(e){console.log("Trying sql user trips not implemented yet")},G=function(e){var o,n=[];t.tempMarkers&&j(t.tempMarkers),t.tempMarkers=[],console.log("Showing markers: "+e.length),console.log(JSON.stringify(e));var a,r,s;for(i=0;i<e.length;i++)e[i]&&(a=new google.maps.LatLng(e[i].lat,e[i]["long"]),console.log("Showing marker: "),r=e[i].trip,s=e[i].user_id,marker=O(e[i],!0),t.tempMarkers.push(marker),n.push(a),o=e[i]);t.contactIdTrip=s,t.contactTrip=r,c(a.lat(),a.lng());var l=new google.maps.Polyline({path:n,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2,user_id:o.user_id,name:o.name,status:"closed"});t.tempPolyline&&(t.tempPolyline.setMap(null),t.tempPolyline=null),l.setMap(t.map),t.tempPolyline=l},U=function(e,t){console.log("contact trip locations not implemented at present: "+e+" trip: "+t)},J=function(){if(console.log("Updating locations"),t.tracking)if(console.log("rootscope tracking true"),t.mapSemaphore){console.log("rootscope mapsemaphore true"),t.mapSemaphore=!1;var e=t.lastLocation,o=1,n="?page="+o+"&id_after="+e;H(n,e)}else T();else T()},z=function(e){console.log("saveTrip: "),console.log(JSON.stringify(e)),o.getLocationsTrip(e).then(function(o){var n=o.data;if(console.log("Locations received from server: "+n.length),console.log(JSON.stringify(n)),$(n),o.page<o.last_page){if(4==o.page)return void t.$broadcast("receivedTripDetail",{trigger_id:e.user_id});e.page=o.page+1,z(e)}else t.$broadcast("receivedTripDetail",{trigger_id:e.user_id})},function(e){console.log(e)})},H=function(e,n){o.shared(e).then(function(e){if(0==e.total)T();else{var o=e.data;if(o.reverse(),$(o).then(function(e){t.mapSharedLoaded=!0},function(e){console.log(e)}),e.page<e.last_page){var a=e.page+1,r="?page="+a+"&id_after="+n;H(r,n)}else t.mapSemaphore=!0,setTimeout(function(){console.log("Timeout Triggered"),J()},t.sharedTimeout)}},function(e){console.log(e)})};return{createMarker:O,clearTemps:L,createMap:s,getNearbyMerchants:y,contactTripsCount:V,deleteUserObjects:w,deleteUserMarkers:I,getUserPolyline:p,saveTrip:z,checkMarkers:$,contactTripLocations:U,contactTrips:q,consoleLogMarkers:x,getMarker:N,hideAllActiveMarkers:F,hideMarkers:j,showAllActiveMarkers:E,showMarkers:R,updateLocations:J,getMarkers:l,getUserMarker:d,displayTrip:G,addToUnknowns:M,removeFromUnknowns:P,setActive:k,checkActive:v,postMap:_}}])},function(e,t){angular.module("besafe").service("Merchants",["$q","$http",function(e,t){var o=function(o){var n="/api/merchants";o&&(n=n+"?"+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get merchants")}),a.promise},n=function(o){var n="/api/user/merchants";o&&(n=n+"?"+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get merchants")}),a.promise},a=function(o){var n="/api/reports";o&&(n=n+"?"+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get merchants")}),a.promise},r=function(o){var n="/api/private/merchants/coverage",a=e.defer();return t({method:"get",url:n,params:o}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get merchants")}),a.promise},i=function(o){var n="/api/private/merchants/nearby",a=e.defer();return t({method:"get",url:n,params:o}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get merchants")}),a.promise},s=function(o){var n="/api/private/reports/nearby",a=e.defer();return t({method:"get",url:n,params:o}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get merchants")}),a.promise},c=function(o){var n="/api/merchants";o&&(n=n+"?"+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get merchants")}),a.promise},l=function(o){var n="/api/admin/merchant/orders",a=e.defer();return t({method:"POST",url:n,data:o}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to getStoreExport")}),a.promise},d=function(o){var n="/api/admin/merchant/content",a=e.defer();return t({method:"POST",url:n,data:o}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to getStoreExport")}),a.promise},u=function(o){var n="/api/merchants/search";o&&(n=n+"?search="+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get merchants")}),a.promise},p=function(o){var n=e.defer(),a="/api/merchants",r="POST";if(o.id)var a="/api/merchants/"+o.id,r="PATCH";return t({method:r,url:a,data:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to save/create merchant")}),n.promise},g=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/merchants/"+o}).success(function(e){console.log(e),n.resolve(e)}).error(function(){n.reject("Failed to Delete Merchant")}),n.promise};return{getMerchants:o,getMerchantsNearby:i,getReportsNearby:s,getMerchantsUser:n,getReports:a,getMerchantsCoverage:r,getMerchantsPrivate:c,saveMerchant:p,getStoreContent:d,getStoreExport:l,searchMerchants:u,deleteMerchant:g}}])},function(e,t){angular.module("besafe").service("Modals",["$mdToast","$mdDialog",function(e,t){function o(){var e=g;e.bottom&&p.top&&(e.top=!1),e.top&&p.bottom&&(e.bottom=!1),e.right&&p.left&&(e.left=!1),e.left&&p.right&&(e.right=!1),p=angular.extend({},e)}var n=function(){return{controller:["$scope","$mdDialog","Addresses","$rootScope",function(e,t,o,n){e.addresses=[],e.getAddresses=function(){n.addresses&&n.addresses.length>0?e.addresses=n.addresses:o.getAddresses().then(function(t){e.addresses=t.addresses},function(e){})},e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.selectAddress=function(e){t.hide(e)},e.getAddresses()}],templateUrl:"/templates/addressList.html",parent:angular.element(document.body),clickOutsideToClose:!0}},a=function(){return{controller:["$scope","$mdDialog",function(e,t){e.enviar=function(){t.hide()}}],templateUrl:"/templates/exportConfirmation.html",parent:angular.element(document.body),clickOutsideToClose:!0}},r=function(){return{controller:["$scope","$mdDialog","Addresses","$rootScope",function(e,t,o,n){e.addresses=[],e.selectPlatform=function(e){t.hide(e)},e.hide=function(){t.hide()},e.cancel=function(){t.cancel()}}],templateUrl:"/templates/mobileApp.html",parent:angular.element(document.body),clickOutsideToClose:!0}},i=function(e){return{controller:["$scope","$mdDialog","Merchants","$rootScope",function(t,o,n,a){t.merchants=[],t.getMerchants=function(){var o=null;o=e?{lat:a.shippingAddress.lat,"long":a.shippingAddress["long"],category:e}:{lat:a.shippingAddress.lat,"long":a.shippingAddress["long"]},n.getMerchantsCoverage(o).then(function(e){t.merchants=e.data},function(e){})},t.hide=function(){o.hide()},t.cancel=function(){o.cancel()},t.selectMerchant=function(e){o.hide(e)},t.getMerchants()}],templateUrl:"/templates/merchantsList.html",parent:angular.element(document.body),clickOutsideToClose:!0}},s=function(e){return{controller:["$scope","$mdDialog","Merchants","$rootScope",function(t,o){t.questions=e,t.hide=function(){o.hide()},t.cancel=function(){o.cancel()},t.checkValue=function(e){console.log("Checking: ",e)},t.save=function(){o.hide(t.questions)}}],templateUrl:"/templates/questionaire.html",parent:angular.element(document.body),clickOutsideToClose:!0}},c=function(){return{controller:["$scope","$mdDialog",function(e,t){e.answer=function(e){t.hide(e)},e.cancel=function(){t.cancel()},e.hide=function(){t.hide()}}],templateUrl:"/templates/locationPrompt.html",parent:angular.element(document.body),clickOutsideToClose:!0}},l=function(){return{controller:["$scope","$mdDialog",function(e,t){e.answer=function(e){t.hide(e)},e.cancel=function(){t.cancel()},e.hide=function(){t.hide()}}],templateUrl:"/templates/locationExtPrompt.html",parent:angular.element(document.body),clickOutsideToClose:!0}},d=function(e){return{controller:"BookingCtrl",resolve:{getParams:function(){return e}},templateUrl:"/templates/booking.html",parent:angular.element(document.body),clickOutsideToClose:!0,backdrop:"static",keyboard:!1}},u=function(t,o){"CLEAR_CART"==t&&(t="Debes vaciar tu carro para esa compra");var n=f(),a=e.simple().textContent(t).position(n).hideDelay(3e3);o&&(a=e.simple().textContent(t).position(n).parent(o).hideDelay(3e3)),e.show(a)},p={bottom:!1,top:!0,left:!1,right:!0},g=angular.extend({},p),f=function(){return o(),Object.keys(g).filter(function(e){return g[e]}).join(" ")},m=function(){t.show({controller:function(){},template:'<md-dialog style="background-color:transparent;box-shadow:none"><div layout="row" layout-sm="column" layout-align="center center" aria-label="wait" style="overflow:hidden"><md-progress-circular md-mode="indeterminate" ></md-progress-circular></div></md-dialog>',parent:angular.element(document.body),clickOutsideToClose:!0,fullscreen:!1}).then(function(e){})},h=function(){t.hide().then(function(e){})},v=function(e,t){t.includes("?")&&(t=t.split("?")[0]);var o=!0;for(var n in e)e.hasOwnProperty(n)&&(o?(t+="?"+n+"="+e[n],o=!1):t+="&"+n+"="+e[n]);return t};return getAllUrlParams=function(e){var t=e?e.split("?")[1]:window.location.search.slice(1);console.log("Query string",t);var o=null;if(t){o={},t=t.split("#")[0];
for(var n=t.split("&"),a=0;a<n.length;a++){var r=n[a].split("="),i=r[0],s="undefined"==typeof r[1]||r[1];if(i=i.toLowerCase(),"string"==typeof s&&(s=s.toLowerCase()),i.match(/\[(\d+)?\]$/)){var c=i.replace(/\[(\d+)?\]/,"");if(o[c]||(o[c]=[]),i.match(/\[\d+\]$/)){var l=/\[(\d+)\]/.exec(i)[1];o[c][l]=s}else o[c].push(s)}else o[i]?o[i]&&"string"==typeof o[i]?(o[i]=[o[i]],o[i].push(s)):o[i].push(s):o[i]=s}}return o},{getAddressesPopup:n,getExportPopup:a,getBookingPrompt:d,getLocationPrompt:c,getLocationExtPrompt:l,getMerchantsPopup:i,getQuestionairePopup:s,showToast:u,getAppPopup:r,showLoader:m,turnObjectToUrl:v,hideLoader:h,getAllUrlParams:getAllUrlParams}}])},function(e,t){angular.module("besafe").service("Orders",["$q","$http",function(e,t){var o=function(o){var n="/api/orders";o&&(n=n+"?"+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get orders")}),a.promise},n=function(o,n){var a="/api/store/reports",r=e.defer();return console.log("getStoreExport",o,n),t({method:"POST",url:a,data:{from:o,to:n}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getStoreExport")}),r.promise},a=function(o){var n="/api/items/status",a=e.defer();return console.log("fullfillOrder",o),t({method:"POST",url:n,data:o}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to fullfillOrder")}),a.promise},r=function(o){var n=e.defer();return t({method:"POST",url:"/api/orders/"+o+"/approve",data:{}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to approveOrder")}),n.promise},i=function(o,n){var a=e.defer();return t({method:"POST",url:"/api/orders/"+n+"/build",data:{status:o}}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to updateOrderStatus")}),a.promise},s=function(o){console.log("Setting order address: ",o);var n=e.defer();return t({method:"POST",url:"/api/orders/shipping",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to setShippingAddress")}),n.promise},c=function(o,n){var a=e.defer();return t({method:"POST",url:"/api/orders/platform/shipping/"+o,data:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to setPlatformShippingCondition")}),a.promise},l=function(o,n){var a=e.defer();return t({method:"GET",url:"/api/orders/platform/shipping/"+o,params:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to updateOrderStatus")}),a.promise},d=function(o,n){var a=e.defer();return t({method:"POST",url:"/api/orders/prepare/"+n,data:o}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to prepareOrder")}),a.promise},u=function(o,n){var a=e.defer();return t({method:"POST",url:"/api/orders/discounts/"+n+"/"+o,data:{}}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to setDiscounts")}),a.promise},p=function(o){var n=e.defer();return t({method:"POST",url:"/api/orders/coupon",data:{coupon:o}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to setCoupon")}),n.promise},g=function(o,n){var a=e.defer();return t({method:"POST",url:"/api/orders/check/"+o,data:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to checkOrder")}),a.promise},f=function(){var o=e.defer();return t({method:"GET",url:"/api/orders/active"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to getOrder")}),o.promise};return{getOrders:o,getOrder:f,checkOrder:g,approveOrder:r,fullfillOrder:a,setShippingAddress:s,prepareOrder:d,setPlatformShippingCondition:c,getPlatformShippingPrice:l,setDiscounts:u,setCoupon:p,getStoreExport:n,updateOrderStatus:i}}])},function(e,t){angular.module("besafe").service("Passport",["$q","$http",function(e,t){var o=function(){var o=e.defer();return t({method:"GET",url:"/oauth/clients"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get clients")}),o.promise},n=function(o){var n=e.defer();return t({method:"POST",url:"/oauth/clients",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to create client")}),n.promise},a=function(o,n){var a=e.defer();return t({method:"PUT",url:"/oauth/clients/"+n,data:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to update client")}),a.promise},r=function(o){var n=e.defer();return t({method:"DELETE",url:"/oauth/clients/"+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to delete client")}),n.promise},i=function(){var o=e.defer();return t({method:"get",url:"/oauth/scopes"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},s=function(){var o=e.defer();return t({method:"get",url:"/oauth/personal-access-tokens"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},c=function(o){var n=e.defer();return t({method:"POST",url:"/oauth/personal-access-tokens",data:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to create client")}),n.promise},l=function(o){var n=e.defer();return t({method:"DELETE",url:"/oauth/personal-access-tokens/"+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to delete client")}),n.promise},d=function(){var o=e.defer();return t({method:"get",url:"/api/user/authtokens"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},u=function(o){var n=e.defer();return t({method:"DELETE",url:"/oauth/tokens/"+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to delete client")}),n.promise};return{getOauthClients:o,createOauthClient:n,updateOauthClient:a,deleteOauthClient:r,getScopes:i,getPersonalAccessTokens:s,deletePersonalAccessTokens:l,getTokens:d,deleteTokens:u,createPersonalAccessToken:c}}])},function(e,t){angular.module("besafe").service("Payments",["$q","$http",function(e,t){var o=function(o){var n="/api/payments";o&&(n=n+"?"+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get payments")}),a.promise},n=function(o){var n="/api/billing/payments";o&&(n=n+"?"+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get payments")}),a.promise},a=function(o){var n=e.defer();return t({method:"POST",url:"/api/payments/"+o+"/approve",data:{}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to approvePayment")}),n.promise},r=function(o){var n=e.defer();return t({method:"POST",url:"/api/billing/retry/"+o,data:{}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to retryPayment")}),n.promise},i=function(o){var n=e.defer();return t({method:"POST",url:"/api/billing/add_transaction_costs/"+o,data:{}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to addTransactionCosts")}),n.promise};return{getPayments:o,getPaymentsUser:n,retryPayment:r,addTransactionCosts:i,approvePayment:a}}])},function(e,t){angular.module("besafe").service("ProductImport",["$q","$http",function(e,t){var o=function(o){var n="/api/admin/store/products";o&&(n=n+"?"+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to getProducts")}),a.promise},n=function(o){var n="/api/admin/store/variants";o&&(n=n+"?"+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to getVariants")}),a.promise},a=function(o){var n="/api/admin/store/merchants";o&&(n=n+"?"+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to getMerchants")}),a.promise},r=function(o){var n="/api/admin/store/categories";o&&(n=n+"?"+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to getCategories")}),a.promise},i=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/admin/store/products/"+o.id}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to deleteProductItem")}),n.promise},s=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/admin/store/merchants/"+o.id}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to deleteMerchantItem")}),n.promise},c=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/admin/store/variants/"+o.id}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to deleteVariantItem")}),n.promise},l=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/admin/store/categories/"+o.id}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to deleteCategoryItem")}),n.promise};return{getProducts:o,getVariants:n,getMerchants:a,getCategories:r,deleteProductItem:i,deleteMerchantItem:s,deleteVariantItem:c,deleteCategoryItem:l}}])},function(e,t){angular.module("besafe").service("Products",["$q","$http",function(e,t){var o=function(o){var n=e.defer();return t({method:"post",url:"/api/ratings",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to addRating")}),n.promise},n=function(o){var n=e.defer();return t({method:"post",url:"/api/favorites",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to addRating")}),n.promise},a=function(o){var n=e.defer();return t({method:"post",url:"/api/favorites/delete",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to addRating")}),n.promise},r=function(o){var n=e.defer();return t({method:"post",url:"/api/products/favorites",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to addRating")}),n.promise},i=function(o){var n=e.defer();return t({method:"GET",url:"/api/merchants/products",params:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to getProductsMerchant")}),n.promise},s=function(o){var n=e.defer();return t({method:"GET",url:"/api/products/search",params:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to searchProducts")}),n.promise},c=function(e,t){var o={};return o.id=e.product_id,o.name=e.prod_name,o.description=e.prod_desc,o.isActive=e.isActive,o.slug=e.slug,o.description_more=!1,o.more=!1,o.type=e.type,o.merchant_description_more=!1,t&&(o.merchant_name=t.merchant_name,o.merchant_id=t.merchant_id,o.merchant_description=t.merchant_description,o.merchant_attributes=t.merchant_attributes,o.src=t.merchant_icon,o.merchant_type=t.merchant_type),o.inCart=!1,e.is_on_sale?(o.onsale=!0,o.subtotal=o.price,o.exsubtotal=o.exprice):(o.subtotal=o.price,o.onsale=!1),o=f(e,o),o.item_id=null,o.amount=e.min_quantity,o.imgs=[],o.variants=[],o},l=function(e){var t={};return console.log("Variant",e),t.id=e.id,t.description=e.description,t.type=e.type,e.attributes.length>0?(t.attributes=JSON.parse(e.attributes),t.attributes.buyers?t.unitPrice=t.price/t.attributes.buyers:t.unitPrice=t.price):t.attributes="",e.is_on_sale?(t.exprice=e.price,t.price=e.sale):t.price=e.price,t.is_on_sale=e.is_on_sale,t.min_quantity=e.min_quantity,t},d=function(e,t){for(var o in t)if(t[o].id==e.category_id)return t[o];var n={name:e.category_name,id:e.category_id,description:e.category_description,products:[],more:!1};return t.push(n),n},u=function(e,t,o){for(var n in t)for(var a in t[n].products)if(t[n].products[a].id==e.product_id)return t[n].products[a];var r=c(e,o);return r},p=function(e){if(e.products_variants.length>0){for(var t=[],o=[],n=0;n<e.products_variants.length;n++)if(!o.includes(e.products_variants[n].id)){o.push(e.products_variants[n].id);var a=d(e.products_variants[n],t);console.log("Category found",a);var r=u(e.products_variants[n],t,e.merchant_products[0]);console.log("product found",r),g(r,a.products)||a.products.push(r);var i=l(e.products_variants[n]);i.price<r.price&&(r=f(i,r)),g(i,r.variants)||r.variants.push(i)}for(var s in e.products_files)for(var c=0;c<t.length;c++)for(var p in t[c].products){var m={};if(e.products_files[s].trigger_id==t[c].products[p].id){m.file=e.products_files[s].file,0==t[c].products[p].imgs.length&&(t[c].products[p].src=m.file),t[c].products[p].imgs.push(m);break}}return console.log("resultbuildCat",t),t}return null},g=function(e,t){var o;for(o in t)if(t[o].id==e.id)return!0;return!1},f=function(e,t){if(e.is_on_sale?(t.price=e.price,t.onsale=!0,t.exprice=e.exprice):(t.price=e.price,t.onsale=!1),t.variant_id=e.id,e.attributes){var o=e.attributes;o.buyers?(t.unitPrice=t.price/o.buyers,t.unitLunches=o.buyers):(t.unitPrice=t.price,t.unitLunches=1)}else t.unitPrice=t.price,t.unitLunches=1;return t};return{addRating:o,deleteFavorite:a,checkFavorite:r,addFavorite:n,searchProducts:s,getProductsMerchant:i,buildProductInformation:p}}])},function(e,t){angular.module("besafe").service("Routes",["$q","$http",function(e,t){var o=function(o){var n="/api/routes";o&&(n=n+"?"+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get routes")}),a.promise},n=function(o){var n="/api/routes/"+o,a=e.defer();return t({method:"delete",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to deleteRoute")}),a.promise},a=function(o){var n="/api/rapigo/status/"+o,a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to getKeyStatus")}),a.promise},r=function(o){var n="/api/stops/"+o,a=e.defer();return t({method:"delete",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to deleteStop")}),a.promise},i=function(o){var n=e.defer();return t({method:"POST",url:"/api/routes/"+o+"/build",data:{}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to buildRoute")}),n.promise},s=function(o,n){var a=e.defer();return t({method:"POST",url:"/api/routes/"+o+"/stop/"+n,data:{}}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to updateRouteStops")}),a.promise},c=function(o,n,a){var r=e.defer();return t({method:"POST",url:"/api/routes/add_delivery",data:{route_id:o,delivery_id:n,stop_id:a}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to updateRouteDelivery")}),r.promise},l=function(o){var n=e.defer();return t({method:"POST",url:"/api/routes/stop/"+o,data:{}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to sendStopToNewRoute")}),n.promise},d=function(o,n){var a=e.defer();return t({method:"POST",url:"/api/routes/"+o+"/return",data:{address_id:n}}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to sendStopToNewRoute")}),a.promise};return{getRoutes:o,deleteStop:r,getKeyStatus:a,deleteRoute:n,sendStopToNewRoute:l,buildRoute:i,addReturnStop:d,updateRouteStop:s,updateRouteDelivery:c}}])},function(e,t){angular.module("besafe").service("Users",["$q","$http",function(e,t){var o=function(o){var n=e.defer();return t({method:"POST",url:"/user/billingAddress/"+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},n=function(){var o=e.defer();return t({method:"get",url:"/api/addresses"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},a=function(o){var n=e.defer();return t({method:"POST",url:"/api/addresses",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},r=function(o){var n=e.defer();return t({method:"POST",url:"/api/user",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to create user")}),n.promise},i=function(o){var n=e.defer();return t({method:"POST",url:"/api/user/change_password",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to updatePassword")}),n.promise},s=function(){var o=e.defer();return t({method:"GET",url:"/api/user"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get user")}),o.promise},c=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/addresses/"+o}).success(function(e){console.log(e),n.resolve(e)}).error(function(){n.reject("Failed to Delete Address")}),n.promise},l=function(o){var n="";o.length>0&&(n="?name=*"+o+"*");var a=e.defer();return t({method:"get",url:"/api/contacts"+n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get nearby")}),a.promise};return{setAsBillingAddress:o,getAddresses:n,saveAddress:a,deleteAddress:c,updatePassword:i,saveUser:r,getContacts:l,getUser:s}}])},function(e,t){angular.module("besafe").service("Zones",["$q","$http",function(e,t){var o=function(o){var n="/api/admin/zones";o&&(n=n+"?"+o);var a=e.defer();return t({method:"get",url:n}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get getArticles")}),a.promise},n=function(o){console.log("Updating zone item",o);var n=e.defer();return t({method:"PATCH",url:"/api/admin/zones/"+o.id,data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to updateZoneItem")}),n.promise},a=function(o){var n=e.defer();return t({method:"POST",url:"/api/admin/zones",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to createZoneItem")}),n.promise},r=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/admin/zones/"+o.id}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to deleteZoneItem")}),n.promise};return{getZones:o,updateZoneItem:n,createZoneItem:a,deleteZoneItem:r}}])},function(e,t,o){o(0),o(1),o(27),o(17),o(22),o(9),o(10),o(2),o(8),o(26),o(25),o(3),o(24),o(20),o(12),o(21),o(15),o(18),o(19),o(23),o(16),o(11),o(6),o(7),o(5),o(4),o(13),o(14),o(28),o(29),o(39),o(32),o(41),o(34),o(33),o(42),o(40),o(49),o(38),o(47),o(31),o(44),o(36),o(30),o(48),o(45),o(43),o(46),o(35),o(50),e.exports=o(37)}]);