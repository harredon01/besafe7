!function(e){function t(n){if(o[n])return o[n].exports;var r=o[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,t,o){Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var o=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=49)}([function(e,t){"use strict";var o=angular.module("besafe",["besafe.constants","ngCookies","ngMaterial","ngAnimate","ngAria"]);o.config(function(){}).run(["$http","$rootScope","$cookies","Users","Modals",function(e,t,o,n,r){function a(){var t=o.get("cart-uuid");if(t&&t.length>0)console.log("Cart cookie found");else{var n=i();console.log("setting cart cookie"),o.put("cart-uuid",n,{path:"/"})}e.defaults.headers.common["X-device-id"]=t}function i(){var e=(new Date).getTime(),t=performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){var n=16*Math.random();return e>0?(n=(e+n)%16|0,e=Math.floor(e/16)):(n=(t+n)%16|0,t=Math.floor(t/16)),("x"===o?n:3&n|8).toString(16)})}function s(){console.log("Get cart"),t.$broadcast("updateHeadCart")}console.log("Searching for user"),angular.element(document).ready(function(){}),a(),n.getUser().then(function(e){console.log("user loaded",e),t.user=e.user,t.hasSavedCard=e.savedCard,e.merchants>0?t.hasMerchants=!0:t.hasMerchants=!1,console.log("Has saved card",t.hasSavedCard),t.$broadcast("user_loaded")},function(e){document.getElementById("mi_cuenta").remove(),document.getElementById("mi_cuenta2").remove()}),s();var c=o.get("shippingAddress");c&&c.length>0&&(t.shippingAddress=JSON.parse(c));var d=r.getAllUrlParams(null);console.log("Checking params",d),d.merchant_id&&d.merchant_id.length>0&&(t.merchant_id=d.merchant_id),d.lat&&d.lat.length>0&&(console.log("saving lat"),t.lat=d.lat),e.defaults.headers.common.Accept="application/json",t.changeShippingHeader=function(){console.log("changeShippingHeader"),t.$broadcast("updateShippingAddress")}}])},function(e,t){angular.module("besafe.constants",[]).constant("API",{address:"http://lonchis.com.co/api",website:"http://lonchis.com.co",avatar:"http://lonchis.com.co/avatars/avatar.jpg"})},function(e,t){angular.module("besafe").controller("PersonalTokensCtrl",["$scope","Passport","$rootScope",function(e,t,o){e.data={},e.data.scopes=[],e.personalAccessTokens,e.showForm=!1,e.showToken=!1,angular.element(document).ready(function(){e.getPersonalAccessTokens()}),e.save=function(n){e.submitted=!0,n&&(e.data.scopes=[""],t.createPersonalAccessToken($.param(e.data)).then(function(t){e.token=t.accessToken,e.personalAccessTokens.push(t.token),o.$broadcast("getTokens"),e.data={},e.data.scopes=[],e.submitted=!1,e.showToken=!0,e.showForm=!1},function(e){}))},e.getPersonalAccessTokens=function(){t.getPersonalAccessTokens().then(function(t){e.personalAccessTokens=t},function(e){}),t.getScopes().then(function(t){e.scopes=t},function(e){})},e.deletePersonalToken=function(o){t.deletePersonalAccessTokens(o).then(function(){for(item in e.personalAccessTokens)e.personalAccessTokens[item].id==o&&e.personalAccessTokens.splice(item,1)},function(e){})},e.clean=function(){e.data={}},e.newPersonalAccessToken=function(){e.showForm=!0,e.showToken=!1}}]).controller("OauthClientsCtrl",["$scope","Passport","Users",function(e,t,o){e.data={},e.oauthClients,e.showForm=!1,angular.element(document).ready(function(){e.getOauthClients()}),e.save=function(o){e.submitted=!0,o&&(e.data.id?t.updateOauthClient($.param(e.data),e.data.id).then(function(t){e.updateOauthClient(t),e.showForm=!1,e.data={},e.submitted=!1},function(e){}):t.createOauthClient($.param(e.data)).then(function(t){e.oauthClients.push(t),e.showForm=!1,e.data={},e.submitted=!1},function(e){}))},e.updateOauthClient=function(t){for(item in e.oauthClients)e.oauthClients[item].id==t.id&&(e.oauthClients.splice(item,1),e.oauthClients.push(t))},e.getOauthClients=function(){t.getOauthClients().then(function(t){e.oauthClients=t},function(e){})},e.newOauthClient=function(){e.showForm=!0},e.editOauthClient=function(t){e.showForm=!0,e.data.id=angular.element(document.querySelector("tr#oauthClient-"+t+" span.id")).html(),e.data.name=angular.element(document.querySelector("tr#oauthClient-"+t+" span.name")).html(),e.data.redirect=angular.element(document.querySelector("tr#oauthClient-"+t+" span.redirect")).html()},e.deleteOauthClient=function(o){t.deleteOauthClient(o).then(function(t){for(item in e.oauthClients)e.oauthClients[item].id==o&&(console.log("deleting oauthClient",e.oauthClients[item]),e.oauthClients.splice(item,1))},function(e){})},e.clean=function(){e.data={}}}]).controller("TokensCtrl",["$scope","Passport","$rootScope",function(e,t,o){e.tokens,angular.element(document).ready(function(){e.getTokens()}),o.$on("getTokens",function(t,o){e.getTokens()}),e.getTokens=function(){t.getTokens().then(function(t){e.tokens=t},function(e){})},e.deleteToken=function(o){t.deleteTokens(o).then(function(){for(item in e.tokens)e.tokens[item].id==o&&e.tokens.splice(item,1)},function(e){})}}])},function(e,t){angular.module("besafe").controller("AddressesCtrl",["$scope","$rootScope","LocationService","Addresses","$mdDialog","Modals","$cookies",function(e,t,o,n,r,a,i){e.data={},e.addresses,e.regionVisible=!1,e.editAddress=!1,angular.element(document).ready(function(){e.getAddresses();var n="",r=i.get("creating_address");r&&(i.remove("creating_address",{path:"/"}),console.log("creat",i.get("creating_address")),console.log("Loading address from cookie",t.shippingAddress),e.editAddress=!0,e.data=t.shippingAddress,e.data.address_id=t.shippingAddress.id,e.data.name&&e.data.name.length>0||(e.data.name=t.user.name),e.data.phone&&e.data.phone.length>0||(e.data.phone=t.user.cellphone),e.selectPlace(e.data.country_id,e.data.region_id)),o.getCountries(n).then(function(t){e.countries=t.data},function(e){})}),e.save=function(t){if(e.submitted=!0,t){var o=!1;i.remove("creating_address",{path:"/"}),i.remove("creating_address",{path:"/"}),i.remove("creating_address",{path:"/"}),e.data.address_id&&(o=!0),n.saveAddress(e.data).then(function(t){"success"==t.status?(a.showToast("Actualizacion exitosa",$("#myaccountContent")),o?e.updateAddress(t.address):e.addresses.push(t.address),e.data={},e.editAddress=!1):a.showToast("Hubo un error porfavor comunicate con soporte",$("#myaccountContent")),e.submitted=!1},function(e){})}},e.getAddresses=function(){n.getAddresses().then(function(t){e.addresses=t.addresses},function(e){})},e.newAddress=function(){r.show(a.getLocationPrompt()).then(function(e){"map"==e?(i.put("locationRefferrer",window.location.href,{path:"/"}),i.put("creating_address",!0,{path:"/"}),window.location.href="/location"):"address"==e&&showAdvanced()},function(){})},e.deleteAddress=function(t){i.remove("shippingAddress",{path:"/"}),n.deleteAddress(t.id).then(function(o){for(item in e.addresses)console.log("a",e.addresses[item].id),console.log("b",t.id),console.log("c",e.addresses[item].id==t.id),e.addresses[item].id==t.id&&(console.log("deleting address",e.addresses[item]),e.addresses.splice(item,1))},function(e){})},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.updateAddress=function(t){for(item in e.addresses)e.addresses[item].id==t.id&&(e.addresses.splice(item,1),e.addresses.push(t))},e.selectCountry=function(){for(item in e.countries)e.countries[item].id==e.data.country_id&&(e.data.country=e.countries[item].country_iso);o.getRegionsCountry(e.data.country_id).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1},function(e){})},e.selectRegion=function(){for(item in e.regions)e.countries[item].id==e.data.region_id&&(e.data.region=e.countries[item].name);o.getCitiesRegion(e.data.region_id).then(function(t){e.cities=t.data,e.cityVisible=!0,console.log("Setting cities",e.cities)},function(e){})},e.selectPlace=function(t,n,r){e.data.country_id=t,o.getRegionsCountry(t).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1,console.log("Setting region",e.data.region_id),e.data.region_id=n,o.getCitiesRegion(n).then(function(t){e.cities=t.data,e.cityVisible=!0,console.log("Setting city_id",e.data.city_id),console.log("Setting cities",e.cities),e.data.city_id=r},function(e){})},function(e){})},e.editAddressObj=function(t){if(e.editAddress=!0,t.lat)i.put("shippingAddress",JSON.stringify(t),{path:"/"}),i.put("locationRefferrer",window.location.href,{path:"/"}),i.put("creating_address",!0,{path:"/"}),window.location.href="/location";else for(item in e.addresses)e.addresses[item].id==t.id&&(e.data=e.addresses[item],e.data.address_id=t.id,e.selectPlace(e.data.country_id,e.data.region_id))}}])},function(e,t){angular.module("besafe").controller("AdminCategoriesCtrl",["$scope","ProductImport",function(e,t){e.data={},e.items=[],e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems()}),e.buildItemData=function(e){return e},e.getItems=function(){e.page++;var o="order_by=id,desc&page="+e.page;t.getCategories(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1),console.log("Items",t.data);var o=t.data;for(item in o)o[item]=e.buildItemData(o[item]);e.items=e.items.concat(o)},function(e){})},e.updateItem=function(e){t.updateCategoryItem(e).then(function(e){},function(e){})},e.deleteItem=function(e){t.deleteCategoryItem(e).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("AdminMerchantsCtrl",["$scope","ProductImport",function(e,t){e.data={},e.items=[],e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems()}),e.buildItemData=function(e){return e},e.getItems=function(){e.page++;var o="order_by=id,desc&page="+e.page;t.getMerchants(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1),console.log("Items",t.data);var o=t.data;for(item in o)o[item]=e.buildItemData(o[item]);e.items=e.items.concat(o)},function(e){})},e.updateItem=function(e){t.updateMerchantItem(e).then(function(e){},function(e){})},e.deleteItem=function(e){t.deleteMerchantItem(e).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("AdminProductsCtrl",["$scope","ProductImport",function(e,t){e.data={},e.items=[],e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems()}),e.buildItemData=function(e){return e},e.getItems=function(){e.page++;var o="order_by=id,desc&includes=productVariants,categories&page="+e.page;t.getProducts(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1),console.log("Items",t.data);var o=t.data;for(item in o)o[item]=e.buildItemData(o[item]);e.items=e.items.concat(o)},function(e){})},e.updateItem=function(e){t.updateProductItem(e).then(function(e){},function(e){})},e.deleteItem=function(e){t.deleteProductItem(e).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("AdminVariantsCtrl",["$scope","ProductImport",function(e,t){e.data={},e.items=[],e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems()}),e.buildItemData=function(e){return e},e.getItems=function(){e.page++;var o="order_by=id,desc&includes=product.merchants&page="+e.page;t.getVariants(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1),console.log("Items",t.data);var o=t.data;for(item in o)o[item]=e.buildItemData(o[item]);e.items=e.items.concat(o)},function(e){})},e.updateItem=function(e){t.updateVariantItem(e).then(function(e){},function(e){})},e.deleteItem=function(e){t.deleteVariantItem(e).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("CartCtrl",["$scope","Cart","$rootScope",function(e,t,o){e.subtotal=0,e.total=0,angular.element(document).ready(function(){setTimeout(function(){e.getCart()},300)}),e.clean=function(){angular.forEach(angular.element(".item-attributes"),function(e,t){var o=angular.element(e),n=JSON.parse(o.html()),r="";for(x in n)r+=x+": "+n[x]+" <br/>";o.html(r),o.css("display","block")})},o.$on("updateHeadCart",function(){console.log("Get cart"),e.getCart()}),o.$on("loadHeadCart",function(t,o){console.log("Loading cart",o),e.loadCart(o)}),e.getCart=function(){t.getCart().then(function(t){console.log("Get Cart",t),"error"==t.status?alert(t.message):(e.loadCart(t),o.$broadcast("loadCartVariants",t))},function(e){})},e.loadCart=function(t){e.items=t.items,e.totalItems=t.totalItems,e.subtotal=t.subtotal,e.total=t.total},e.updateCartItem=function(o){var n=angular.element(document.querySelector("input[name=quantity-"+o+"]")).val();console.log("da qty: "+n),t.updateCartItem(o,n).then(function(t){"error"==t.status&&alert(t.message),e.getCart()},function(e){})},e.clearCart=function(){t.clearCart().then(function(t){e.getCart()},function(e){})},e.deleteCartItem=function(n){t.updateCartItem(n,0).then(function(t){console.log("delete",t),"error"==t.status?alert(t.message):(e.loadCart(t.cart),o.$broadcast("loadCartVariants",t.cart))},function(e){})}}])},function(e,t){angular.module("besafe").controller("CheckoutCartCtrl",["$scope","$rootScope","Users","Orders","Products","Modals",function(e,t,o,n,r,a){e.data={},e.coupon="",t.isDigital=!1,angular.element(document).ready(function(){e.getCart(!0)}),e.cleanJson=function(){angular.forEach(angular.element(".item-attributes"),function(e,t){var o=angular.element(e),n=JSON.parse(o.html()),r="";for(x in n)r+=x+": "+n[x]+" <br/>";o.html(r),o.css("display","block")})},e.getCart=function(t){r.getCheckoutCart().then(function(o){"error"==o.status?alert(o.message):e.loadCart(o,t)},function(e){})},e.getOrder=function(e){n.getOrder().then(function(e){t.isDigital=!0,t.activeOrder=e.data},function(e){})},e.updateCartItem=function(t){var o=angular.element(document.querySelector("input[name=check-quantity-"+t+"]")).val();r.updateCartItem(t,o).then(function(t){"error"==t.status&&alert(t.message),e.getCart(!1)},function(e){})},e.clearCart=function(){r.clearCart().then(function(t){e.getCart()},function(e){})},e.loadCart=function(o,n){if(o.items.length>0){var r=o.items,a=!1;for(var i in r){var s=r[i];console.log("Item: ",s.attributes),s.attributes.is_shippable&&(a=!0)}e.items=o.items,e.totalItems=o.totalItems,e.subtotal=o.subtotal,e.shipping=o.shipping,e.tax=o.tax,e.sale=o.sale,e.coupon=o.coupon,e.discount=o.sale+o.coupon,e.total=o.total,console.log("Broadcasting shippable: ",a),n&&(a?t.$broadcast("Shippable"):(e.getOrder(),t.$broadcast("NotShippable")))}else window.location.href="/"},e.prepareOrder=function(){t.$broadcast("prepareOrder")},e.deleteCartItem=function(t){r.updateCartItem(t,0).then(function(t){"error"==t.status&&alert(t.message),e.getCart()},function(e){})},e.setCoupon=function(){e.coupon&&e.coupon.length>0?(a.showLoader(),n.setCoupon(e.coupon).then(function(t){a.hideLoader(),t&&("success"==t.status?(e.getCart(!1),e.coupon="",a.showToast("Cupon agregado exitosamente",$("#checkout-cart"))):a.showToast("No puedes usar ese cupon",$("#checkout-cart")))},function(e){})):a.showToast("Ingresa un cupon")},t.$on("updateCheckoutCart",function(t,o){e.getCart(!1)}),t.$on("updateLoadedCart",function(t,o){console.log("updateLoadedCart",o),e.loadCart(o)})}]).controller("CheckoutShippingCtrl",["$scope","$rootScope","LocationService","Users","Cart","$cookies","Orders","Modals","Billing",function(e,t,o,n,r,a,i,s,c){e.data={},e.addressSet={},e.shipping=[],e.regionVisible=!1,e.addressesFetched=!1,e.cityVisible=!1,e.addAddress=!1,e.visible=!1,t.shippingAddressSet=!0,t.shippingCondition=!0,t.shippingConditionSet=!1,t.billingAddressSet=!1,t.paymentMethodSet=!1,t.$on("Shippable",function(o,n){t.shippingAddressSet=!1,t.shippingCondition=!1,t.billingAddressSet=!1,t.paymentMethodSet=!1,e.visible=!0;var r=a.get("shippingAddress"),i=null;r&&r.length>0&&(i=JSON.parse(r)),console.log("Shipping address: ",i),console.log("$rootScope.user: ",t.user),i?(i.name||(e.addAddress=!0,e.data=i,t.user&&(e.data.name=t.user.name,e.data.phone=t.user.cellphone),e.selectPlace(e.data.country_id,e.data.region_id,e.data.city_id)),i.id&&e.selectAddress(i)):e.getAddresses()}),e.countries=[{name:"Colombia",id:1},{name:"Colombia2",id:2}],angular.element(document).ready(function(){}),t.$on("prepareOrder",function(t,o){e.prepareOrder()}),t.$on("NotShippable",function(t,o){e.visible=!1}),t.$on("getAddresses",function(t,o){e.getAddresses()}),e.cleanJson=function(){angular.forEach(angular.element(".item-attributes"),function(e,t){var o=angular.element(e),n=JSON.parse(o.html()),r="";for(x in n)r+=x+": "+n[x]+" <br/>";o.html(r),o.css("display","block")})},e.save=function(t){e.submitted=!0,t&&(s.showLoader(),n.saveAddress(e.data).then(function(t){s.hideLoader(),"success"==t.status&&(e.selectAddress(t.address),e.data={},e.submitted=!1,e.hideAddressForm())},function(e){}))},e.getAddresses=function(){n.getAddresses().then(function(e){t.addresses=e.addresses},function(e){})},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.selectCountry=function(t){o.getRegionsCountry(t).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1},function(e){})},e.selectRegion=function(t){o.getCitiesRegion(t).then(function(t){e.cities=t.data,e.cityVisible=!0},function(e){})},e.selectPlace=function(t,n,r){e.data.country_id=t,o.getRegionsCountry(t).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1,console.log("Setting region",e.data.region_id),e.data.region_id=n,o.getCitiesRegion(n).then(function(t){e.cities=t.data,e.cityVisible=!0,console.log("Setting city_id",e.data.city_id),console.log("Setting cities",e.cities),e.data.city_id=r},function(e){})},function(e){})},e.selectAddress=function(o){e.addressSet=o;var n={address_id:o.id};s.showLoader(),i.setShippingAddress(n).then(function(n){if(console.log("Set shipping address",n),"success"==n.status){t.shippingAddressSet=!0,t.shippingAddress=o,a.put("shippingAddress",JSON.stringify(t.shippingAddress),{path:"/"});var r=n.order,c=JSON.parse(r.attributes);r.attributes=c,t.activeOrder=r;var d=c.providers;for(var l in d)console.log("Providers: ",d[l]);console.log("Setting discounts",t.shippingAddressSet),i.setDiscounts(r.id,"Booking").then(function(o){console.log("Discounts set",o);var n={payers:[t.user.id],platform:"Booking"};i.checkOrder(r.id,n).then(function(o){console.log("Check Order Result",o),s.hideLoader();var n=o.order;"success"==o.status?(s.showToast("Direccion guardada",$("#checkout-shipping")),t.$broadcast("updateCheckoutCart")):e.handleCheckError(o,n)},function(e){})},function(e){})}else s.hideLoader(),s.showToast("Fuera de cobertura para esta orden",$("#checkout-shipping"))},function(e){})},e.addCartItem=function(e,o){r.addCartItem(e,o).then(function(e){"error"==e.status?alert(e.message):t.$broadcast("updateCheckoutCart")},function(e){})},e.setShippingCondition=function(e){s.showLoader(),i.setPlatformShippingCondition(t.activeOrder.id,e.platform).then(function(e){s.hideLoader(),console.log("setPlatformShippingPrice Result",e),"success"==e.status?(t.$broadcast("updateLoadedCart",e.cart),t.activeOrder=e.order,t.shippingConditionSet=!0,s.showToast("Envio agregado exitosamente",$("#checkout-shipping"))):s.showToast("Hubo un error con ese metodo de envio",$("#checkout-shipping"))},function(e){s.showToast("Hubo un error con ese metodo de envio",$("#checkout-shipping"))})},e.handleCheckError=function(t,o){if("credits"==t.type){var n=parseInt(t.required_credits);console.log("Required credits",n),console.log("creditItem",t.creditItem),s.showToast("Hemos agregado un item obligatorio",$("#checkout-shipping")),console.log("creditItemMerchant",t.creditItemMerchant);var r={order_id:o.id,product_variant_id:t.creditItem.id,quantity:n,item_id:null,merchant_id:t.creditItemMerchant};e.addCartItem(r,[])}else if("buyers"==t.type);else if("shipping"==t.type){if(s.showToast("Debes seleccionar proveedor de envio",$("#checkout-shipping")),0==e.shipping.length){e.expectedProviders=0;var a=JSON.parse(o.attributes);if(a.providers)for(var i in a.providers)e.expectedProviders++,e.getPlatformShippingPrice(t.order.id,a.providers[i])}}else"delivery"==t.type},e.getPlatformShippingPrice=function(t,o){i.getPlatformShippingPrice(t,o).then(function(t){if(console.log("getPlatformShippingPrice Result",t),"success"==t.status){var n={platform:o,price:t.price};e.shipping.push(n)}},function(e){})},e.showAddressForm=function(){a.put("locationRefferrer",window.location.href,{path:"/"}),window.location.href="/location"},e.hideAddressForm=function(){e.addAddress=!1},e.changeAddress=function(){console.log("Change address"),t.shippingAddressSet=!1,e.addAddress=!1,t.addresses&&t.addresses.length>0||e.getAddresses()},e.changeShipping=function(){t.shippingConditionSet=!1},e.prepareOrder=function(){s.showLoader(),e.showPayment=!1,e.shippingError=!1;var o=[t.user.id],n="limit",r=3,a={order_id:t.activeOrder.id,payers:o,delivery_date:null,split_order:!1,platform:"Booking",recurring:!1,recurring_type:n,recurring_value:r,merchant_id:t.activeOrder.merchant_id};i.prepareOrder(a,"Booking").then(function(o){if(s.hideLoader(),o)if("success"==o.status)if(s.showToast("Pago creado exitosamente",$("#checkout-cart")),console.log("orderProvider",o),t.activePayment=o.payment,t.activeOrder=o.order,t.activePayment.total==t.activePayment.transaction_cost){var n={payment_id:this.payment.id};s.showLoader(),c.completePaidOrder(n).then(function(t){s.hideLoader(),"success"==t.status?e.transactionResponse(null,!0):e.showPayment=!0},function(t){e.showPayment=!0,console.log("completePaidOrderError",t)})}else t.$broadcast("activatePayment");else e.handleCheckError(o)},function(e){s.hideLoader(),console.log("getCartError",e),s.showToast("Hubo un error porfavor comunicate mas tarde",$("#checkout-cart"))})}}]).controller("CheckoutBillingCtrl",["$scope","$rootScope","LocationService","Users","Billing","$location","$anchorScroll","Modals","$mdDialog","Cart",function(e,t,o,n,r,a,s,c,d,l){e.data={},e.data2={},e.data3={},e.data4={},e.transaction={},e.banks=[],t.paymentActive=!1,e.creditCardVisible=!1,e.creditPayerVisible=!1,e.creditBuyerVisible=!1,e.credito=!1,e.showResult=!1,e.resultHeader="",e.resultBody="",e.cash=!1,e.debito=!1,angular.element(document).ready(function(){var t=new Date;e.years=[],e.months=[];var o=t.getFullYear();for(i=0;i<12;i++)i<9?e.months.push("0"+(i+1)):e.months.push(i+1);for(i=0;i<13;i++)e.years.push(o+i)}),t.$on("activatePayment",function(e,o){t.paymentActive=!0,setTimeout(function(){a.hash("payment-methods"),s()},800)}),e.keytab=function(e,t){console.log("Event",e);var o=e.target||e.srcElement,n=o.nextElementSibling;console.log("nextInput",n),console.log("target",o),console.log("targetvalue",o.value),console.log("targettype",o.nodeType),o.value.length<t||null!=n&&n.focus()},e.creditTab=function(t){var o=t.target||t.srcElement,n=o.value,r=/^(?:5[1-5][0-9]{2}|222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/.test(n)?"MASTERCARD":/^(4[0-9]{12}(?:[0-9]{3})?$)|(^606374[0-9]{10}$)/.test(n)?"VISA":/^3[47][0-9]{13}$/.test(n)?"AMEX":/^[35](?:0[0-5]|[68][0-9])[0-9]{11}$|^30[0-5]{11}$|^3095[0-9]{10}$|^36[0-9]{12}$|^3[89][0-9]{12}$/.test(n)?"DINERS":/^6(?:011|5[0-9]{2}|4[4-9][0-9])[0-9]{12}$/.test(n)?"DISCOVER":/^589562[0-9]{10}$/.test(n)?"NARANJA":/^603488[0-9]{10}$|^2799[0-9]{9}$/.test(n)?"SHOPPING":/^604(([23][0-9]{2})|(400))[0-9]{10}$|^589657[0-9]{10}$/.test(n)?"CABAL":/^603493[0-9]{10}$/.test(n)?"ARGENCARD":/^590712[0-9]{10}$/.test(n)?"CODENSA":/^627180[0-9]{10}$/.test(n)?"CMR":"";console.log("Credit branch",r),e.data2.cc_branch=r},e.transactionResponse=function(t){c.hideLoader(),console.log("Response payu",t),l.clearCart(),"error"!=t.message?(e.showResult=!0,e.transaction=t.transaction,"APPROVED"==t.transaction.transaction_state?(e.resultHeader="Pago aprobado",e.resultBody="Tu pago ha sido completado, revisa tu correo para recibir tu compra"):"PENDING"==t.transaction.transaction_state?(e.resultHeader="Pago pendiente",e.resultBody="Tu transaccion esta siendo verificada, cuando complete la verificacion recibiras un correo con el resultado"):(e.resultHeader="Pago negado",e.resultBody="Tu transaccion ha sido negada. Porfavor intenta otro metodo u otra tarjeta. En Mi cuenta > Mis Pagos puedes reintentar el pago")):c.showToast("Hubo un error. Porfavor verifica tus datos",$("#checkout-payment"))},e.payCreditCard=function(o){e.submitted2=!0,o&&(e.data2.platform="Booking",e.data2.email=!0,e.data2.payment_id=t.activePayment.id,c.showLoader(),r.payCreditCard(e.data2,"PayU").then(function(t){e.transactionResponse(t)},function(e){}))},e.quickPay=function(){var o={quick:!0,payment_id:t.activePayment.id,platform:"Booking"};c.showLoader(),r.payCreditCard(o,"PayU").then(function(t){e.transactionResponse(t)},function(e){})},e.selectOption=function(t){e.data4.payment_method=t},e.populatePayer=function(){e.data2.payer_name?0==e.data2.payer_name.length&&(e.data2.payer_name=e.data2.cc_name):e.data2.payer_name=e.data2.cc_name},e.payDebitCard=function(o){e.submitted3=!0,o&&(e.data3.platform="Booking",e.data3.email=!0,e.data3.payment_id=t.activePayment.id,c.showLoader(),r.payDebit(e.data3,"PayU").then(function(e){"SUCCESS"==e.code&&"PENDING"==e.transactionResponse.state?l.clearCart().then(function(t){window.location.href=e.transactionResponse.extraParameters.BANK_URL},function(e){c.hideLoader()}):(c.hideLoader(),c.showToast("Hubo un problema. Porfavor intenta otro medio. ",$("#checkout-payment")))},function(e){c.hideLoader()}))},e.payCash=function(o){e.submitted4=!0,o&&(c.showLoader(),e.data4.platform="Booking",e.data4.email=!0,e.data4.payment_id=t.activePayment.id,r.payCash(e.data4,"PayU").then(function(e){c.hideLoader(),console.log("after payCash"),console.log(JSON.stringify(e)),"SUCCESS"==e.code?l.clearCart().then(function(t){e.transactionResponse.extraParameters.URL_PAYMENT_RECEIPT_HTML?window.location.href=e.transactionResponse.extraParameters.URL_PAYMENT_RECEIPT_HTML:c.showToast("Hubo un problema. Porfavor intenta otro medio. ",$("#checkout-payment"))},function(e){}):c.showToast("Hubo un problema. Porfavor intenta otro medio. ",$("#checkout-payment"))},function(e){}))},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.clean2=function(){e.data2={}},e.fill=function(){e.data2.cc_branch="VISA",e.data2.cc_name="APPROVED",e.data2.cc_number="4111111111111111",e.data2.cc_security_code="123",e.data2.cc_expiration_month="09",e.data2.cc_expiration_year="2017",e.data2.payer_email="harredon01@gmail.com",e.data2.payer_id="321321321"},e.fill2=function(){e.data3.user_type="N",e.data3.pse_reference2="CC",e.data3.pse_reference3="1020716535",e.data3.payer_email="harredon01@gmail.com"},e.fill3=function(){e.data4.payer_email="harredon01@gmail.com"},e.selectCountry=function(t){o.getRegionsCountry(t).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1},function(e){})},e.selectRegion=function(t){o.getCitiesRegion(t).then(function(t){e.cities=t.data,e.cityVisible=!0},function(e){})},e.selectPlace=function(t,n,r){e.data.country_id=t,o.getRegionsCountry(t).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1,e.data.region_id=n,o.getCitiesRegion(n).then(function(t){e.cities=t.data,e.cityVisible=!0,e.data.city_id=r},function(e){})},function(e){})},e.showAddressForm=function(){e.addAddress=!0,e.data.type="billing"},e.hideAddressForm=function(){e.addAddress=!1},e.useUserDebit=function(){e.data3.user_type="N",e.data3.doc_type="N",e.data3.payer_name=t.user.name,e.data3.payer_id=t.user.docNum,e.data3.payer_phone=t.user.cellphone,e.data3.payer_email=t.user.email},e.useUserCredit=function(){e.data2.cc_name=t.user.name,e.data2.payer_name=t.user.name,e.data2.payer_id=t.user.docNum,e.data2.payer_phone=t.user.cellphone,e.data2.payer_email=t.user.email,e.addAddress=!1},e.useUserCash=function(){e.data4.payer_email=t.user.email,e.data4.payer_id=t.user.docNum},e.fetchAddressForUse=function(o,n){"shipping"==o?e.setAddressInfields(n,t.shippingAddress):"other"==o&&d.show(c.getAddressesPopup()).then(function(t){console.log("Got address",t),e.setAddressInfields(n,t)},function(){console.log("Got nothing")})},e.setAddressInfields=function(t,o){"payer"==t?(e.data2.payer_address=o.address,e.data2.payer_postal=o.postal,e.data2.payer_city=o.cityName,e.data2.payer_state=o.regionName,e.data2.payer_country=o.countryCode,e.data2.payer_phone=o.phone):"buyer"==t&&(e.data2.buyer_address=o.address,e.data2.buyer_postal=o.postal,e.data2.buyer_city=o.cityName,e.data2.buyer_state=o.regionName,e.data2.buyer_country=o.countryCode,e.data2.buyer_phone=o.phone)},e.showMethod=function(o){e.credito=!1,e.cash=!1,e.debito=!1,"PSE"==o&&(e.debito=!0,r.getBanks().then(function(t){e.banks=t.banks},function(e){})),"CC"==o&&(e.data2.buyer_country="CO",e.data2.payer_country="CO",t.addresses&&t.addresses.length>0||t.$broadcast("getAddresses"),e.credito=!0),"BALOTO"==o&&(e.cash=!0)}}]).controller("CheckoutGatewaysCtrl",function(){})},function(e,t){angular.module("besafe").controller("DeliveriesCtrl",["$scope","$rootScope","Food","MapService",function(e,t,o,n){e.data={},e.listArticles={},e.deliveries=[],e.page=0,e.loadMore=!0,e.status="enqueue",e.activeDate="",e.regionVisible=!1,e.editAddress=!1,e.mapActive=!1,angular.element(document).ready(function(){var t=new Date,o=t.getDay();o<6?t.setDate(t.getDate()+1):6==o&&t.setDate(t.getDate()+2),e.activeDate=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(),e.getArticles(),e.buildDatePicker()}),e.buildDatePicker=function(){var t="yy-mm-dd";$("#from").datepicker({defaultDate:"+1d",changeMonth:!0,numberOfMonths:2,dateFormat:t}).on("change",function(){console.log("date1",e.activeDate);var t=e.getDate(this);e.activeDate=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(),console.log("date",e.activeDate)})},e.getDate=function(e){console.log("Get date",e.value);var t;try{t=$.datepicker.parseDate("yy-mm-dd",e.value)}catch(o){t=null}return t},e.updateDels=function(){e.page=0,e.deliveries=[],e.getArticles()},e.activateMap=function(){e.mapActive=!0,console.log("Creating map data"),n.createMap(4.685419,-74.064161),e.createMapData()},e.changeScenario=function(){e.getDeliveries()},e.createMapData=function(){console.log("Creating map data");var t=e.deliveries[0],o=0,r=0;for(var a in e.deliveries)r++,e.deliveries[a].address_id==t.address_id?o++:(t.icon="http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+o+"|FE6256|000000",n.createStop(t),t=e.deliveries[a],o=1),r==e.deliveries.length&&(t.icon="http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+o+"|FE6256|000000",n.createStop(t))},e.getDeliveries=function(){console.log("Status",e.status),e.page++;var t="includes=user,address&limit=50&order_by=address_id,asc&page="+e.page+"&status="+e.status+"&delivery="+e.activeDate+" 12:00:00";o.getDeliveries(t).then(function(t){var o=t.data;if(t.page==t.last_page&&(e.loadMore=!1),o.length>0)for(item in o){var n=o[item];n.details=JSON.parse(n.details),n.name=n.address.address,n.lat=n.address.lat,n.delivery=new Date(n.delivery),n["long"]=n.address["long"],e.deliveries.push(n)}console.log("Deliveries",e.deliveries),e.replaceFood()},function(e){})},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.sendReminder=function(){o.sendReminder().then(function(e){},function(e){})},e.sendNewsletter=function(){o.sendNewsletter()},e.showAll=function(){console.log("Creating map data");for(item in e.deliveries)e.deliveries[item].marker.setMap(t.map)},e.hideAll=function(){for(item in e.deliveries)e.deliveries[item].marker.setMap(null)},e.showDelivery=function(o){e.hideAll(),o.marker.setMap(t.map)},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.updateDeliveryAddress=function(e,t){o.updateDeliveryAddress(e,t).then(function(e){window.location.reload()},function(e){})},e.getPurchaseOrder=function(){o.getPurchaseOrder().then(function(e){},function(e){})},e.getArticle=function(t){console.log("getArticle",t);for(var o in e.listArticles)if(e.listArticles[o].id==t)return console.log("getArticleres",e.listArticles[o]),e.listArticles[o]},e.replaceFood=function(){
console.log("articles",e.listArticles);for(var t in e.deliveries){console.log("delivery",e.deliveries[t].id);var o=e.deliveries[t].details;if(o.dish){e.deliveries[t].build=!1,e.deliveries[t].type_id=o.dish.type_id;var n=e.getArticle(o.dish.type_id);if(n){o.tipoAlmuerzo=n.name;for(item2 in n.attributes.entradas)n.attributes.entradas[item2].codigo==o.dish.starter_id&&(o.entrada=n.attributes.entradas[item2].valor,e.deliveries[t].starter_id=o.dish.starter_id);for(item3 in n.attributes.plato)n.attributes.plato[item3].codigo==o.dish.main_id&&(o.plato=n.attributes.plato[item3].valor,e.deliveries[t].main_id=o.dish.main_id);delete o.dish,delete o.products,delete o.merchant_id,e.deliveries[t].details=o}console.log("deliveryDone",e.deliveries[t].id)}else e.deliveries[t].type_id=null,e.deliveries[t].starter_id=null,e.deliveries[t].main_id=null,e.deliveries[t].build=!0}},e.selectMissingType=function(t){var o=e.getArticle(t.type_id);t.starters=o.attributes.entradas,t.mains=o.attributes.plato},e.selectDish=function(t){var n=t.details,r=e.getArticle(t.type_id);n.tipoAlmuerzo=r.name;for(item2 in r.attributes.entradas)r.attributes.entradas[item2].codigo==t.starter_id&&(n.entrada=r.attributes.entradas[item2].valor);for(item3 in r.attributes.plato)r.attributes.plato[item3].codigo==t.main_id&&(n.plato=r.attributes.plato[item3].valor);t.details=n;var a={delivery_id:t.id,type_id:t.type_id,main_id:t.main_id};t.starter_id&&(a.starter_id=t.starter_id),t.build=!1,console.log("Updating dish: ",a),o.updateMissingDish(a)},e.getArticles=function(){o.getArticlesByDate(e.activeDate).then(function(t){e.listArticles=t.data;for(var o in e.listArticles)e.listArticles[o].attributes=JSON.parse(e.listArticles[o].attributes);e.getDeliveries()},function(e){})},e.regenerateDeliveries=function(){o.regenerateDeliveries().then(function(e){},function(e){})},e.getInputs=function(){var t;return t="enqueue"==e.status?{status:"enqueue"}:{status:e.status,provider:e.provider,type:e.scenario}}}])},function(e,t){angular.module("besafe").controller("ExportsCtrl",["$scope","Users","Merchants",function(e,t,o){e.data={},e.orders,e.from,e.to,e.user,e.activeMerchant,e.activeMerchantObject,e.changeMerchant=!0,e.showSearch=!1,e.datPickerBuilt=!1,e.loadMore=!0,e.page=0,angular.element(document).ready(function(){t.getUser().then(function(t){console.log("Result",t),e.user=t.user,e.user.id<4&&(e.showSearch=!0),e.getMerchantsPrivate()},function(e){})}),e.getMerchants=function(){e.page++,o.searchMerchants(e.searchTerms).then(function(t){console.log("Items",t.data),e.merchants=t.data},function(e){})},e.getMerchantsPrivate=function(){e.page++;var t="owner_id="+e.user.id+"&page="+e.page;o.getMerchantsPrivate(t).then(function(t){console.log("Items",t.data),e.merchants=t.data},function(e){})},e.changeActiveMerchant=function(){e.changeMerchant=!0},e.cancelChangeMerchant=function(){e.changeMerchant=!1},e.selectMerchant=function(t){e.page=0,e.items=[],e.activeMerchantObject=t,e.activeMerchant=t.id+"",e.changeMerchant=!1,e.datPickerBuilt||setTimeout(function(){e.buildDatePicker()},800)},e.buildDatePicker=function(){e.datPickerBuilt=!0;var t="yy-mm-dd",o=$("#from").datepicker({defaultDate:"-1m",changeMonth:!0,numberOfMonths:2,dateFormat:t}).on("change",function(){n.datepicker("option","minDate",e.getDate(this)),e.from=e.getDate(this)}),n=$("#to").datepicker({defaultDate:"+1w",changeMonth:!0,numberOfMonths:2,dateFormat:t}).on("change",function(){o.datepicker("option","maxDate",e.getDate(this)),e.to=e.getDate(this)})},e.getDate=function(e){console.log("Get date",e.value);var t;try{t=$.datepicker.parseDate("yy-mm-dd",e.value)}catch(o){t=null}return t},e.startExport=function(t){"orders"==t?e.getStoreExport():e.getContentExport(t)},e.getStoreExport=function(){console.log("Date",e.from,e.to);var t={from:e.from,to:e.to,merchant_id:e.activeMerchant,type:"products"};o.getStoreExport(t).then(function(e){},function(e){})},e.getContentExport=function(t){var n={merchant_id:e.activeMerchant,type:t};o.getStoreContent(n).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("FoodAddressesCtrl",["$scope","Food",function(e,t){e.data={},e.addresses,e.regionVisible=!1,e.editAddress=!1,e.mapActive=!1,angular.element(document).ready(function(){e.getAddresses()}),e.delegateAddress=function(e,o){var n="";n="Rapigo"==e.provider?"Basilikum":"Rapigo";var r=(new Date(e.delivery),{address:e.address,provider:n,complete:o,merchant_id:e.merchant_id});t.delegateDeliveriesAddress(r).then(function(e){},function(e){})},e.buildAddressData=function(e){return e},e.getAddresses=function(){t.getLargestAddresses().then(function(t){var o=t.data;for(item in o)o[item]=e.buildAddressData(o[item]);e.addresses=o},function(e){})}}])},function(e,t){angular.module("besafe").controller("FoodMessagesCtrl",["$scope","Food",function(e,t){e.data={},e.items=[],e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems()}),e.buildItemData=function(e){return e},e.getItems=function(){e.page++;var o="order_by=id,desc&page="+e.page;t.getMessages(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1);var o=t.data;for(item in o)o[item]=e.buildItemData(o[item]);e.items=e.items.concat(o),console.log("Load more",e.loadMore)},function(e){})},e.updateItem=function(e){t.updateMessageItem(e).then(function(e){},function(e){})},e.deleteItem=function(e){t.deleteMessageItem(e).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("GroupsSelectionCtrl",["$scope","Groups","$rootScope","Users",function(e,t,o,n){e.data={},e.invites=[],e.groups=[],e.contacts=[],e.chosen=[],e.searchText="",e.objectSelected=!1,e.editGroup=!1,e.isActive=!1,e.save=function(t){e.submitted=!0,console.log("Saving: "+t),t&&e.saveGroup()},e.groupToggle=function(){e.editGroup?e.editGroup=!1:(e.editGroup=!0,0==e.contacts.length&&e.getContacts())},e.activation=function(){e.isActive?e.isActive=!1:e.isActive=!0},e.saveGroup=function(){console.log("Data sent"),console.log(JSON.stringify(e.data)),console.log(JSON.stringify($.param(e.data)));var o={name:e.data.name,is_public:!0,contacts:e.invites,completeData:e.chosen};t.saveGroup($.param(o)).then(function(t){console.log("Return group"),console.log(JSON.stringify(t)),"success"==t.status&&(e.selectGroup(t.group),e.groups.push(t.group)),e.data={},e.submitted=!1},function(e){})},e.getGroups=function(){t.getGroups().then(function(t){var o=t.data;for(item in o){var n=o[item];n.is_selected=!1,e.groups.push(n)}0==o.length&&(e.editGroup=!0)},function(e){})},e.getContacts=function(){n.getContacts(e.searchText).then(function(t){e.contacts=[],e.contacts=t.data},function(e){})},e.selectContact=function(t){e.invites.push(t.contact_id),e.chosen.push(t);for(item in e.contacts)e.contacts[item].contact_id==t.contact_id&&e.contacts.splice(item,1)},e.deleteContact=function(t){for(item in e.chosen)e.chosen[item].contact_id==t.contact_id&&e.chosen.splice(item,1);for(item in e.invites)e.invites[item]==t.contact_id&&e.chosen.splice(item,1)},e.selectGroup=function(t){t.is_selected=!0,e.isActive=!1,o.$broadcast("ObjectSelected",{object_id:t.id})},o.$on("PlanSelected",function(t,o){e.isActive=!0,0==e.groups.length&&e.getGroups()}),e.clean=function(){e.data={},e.invites=[]}}])},function(e,t){angular.module("besafe").controller("LeadCtrl",["$scope","Leads","Modals",function(e,t,o){e.data={},e.key="",e.submitted=!1,e.category,angular.element(document).ready(function(){var t=viewData;console.log("res",t);var o=JSON.parse(t);e.key=o.key}),e.send=function(n){e.submitted=!0,n&&grecaptcha.ready(function(){grecaptcha.execute(e.key,{action:"submit"}).then(function(n){e.data.captcha=n,o.showLoader(),t.sendLead(e.data).then(function(e){o.hideLoader(),o.showToast("Mensaje enviado",$("#contact-form"))},function(e){})})})}}])},function(e,t){angular.module("besafe").controller("MapLocationCtrl",["$scope","$rootScope","MapService","$cookies",function(e,t,o,n){e.map={center:{latitude:4.65345,longitude:-74.049605},zoom:8},t.activeMarker=null,t.markers=[],t.mapLoaded=!1;var r=window.location.href,a=r.split("/map/");console.log("url"),console.log(JSON.stringify(a)),o.createMap(4.65345,-74.049605),o.postMapLocation(),console.log(navigator.geolocation),t.shippingAddress&&t.shippingAddress.lat?(console.log("Loading address from cookie",t.shippingAddress),o.createLocationMarker(t.shippingAddress.lat,t.shippingAddress["long"],!0)):navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){e.$apply(function(){console.log("Position",t),e.position=t,o.createLocationMarker(t.coords.latitude,t.coords.longitude,!0)})},function(t){e.$apply(function(){console.log("Position",t),o.createLocationMarker(4.654258,-74.062643,!0)})}):e["default"](),e["default"]=function(){o.createLocationMarker(4.65345,-74.049605,!1)},e.cancel=function(){window.history.back()},e.saveLocation=function(){console.log("Loading address to cookie",t.shippingAddress),n.put("shippingAddress",JSON.stringify(t.shippingAddress),{path:"/"}),console.log("shippingAddress",JSON.stringify(t.shippingAddress));var e=n.get("locationRefferrer");n.remove("locationRefferrer");var o="";e&&e.length>0?(o="",console.log("location",e),o=e.includes("?")?e+"&lat="+t.shippingAddress.lat+"&long="+t.shippingAddress["long"]:e+"?lat="+t.shippingAddress.lat+"&long="+t.shippingAddress["long"],console.log("url",o)):o="/?lat="+t.shippingAddress.lat+"&long="+t.shippingAddress["long"],console.log("url",o),window.location.href=o}}])},function(e,t){angular.module("besafe").controller("MenuCtrl",["$scope","Food",function(e,t){e.data={},e.items=[],e.loadMore=!0,e.page=0,e.contentType="",e.config={},angular.element(document).ready(function(){e.getItems(),e.contentType=e.config.content}),e.buildItemData=function(e){return e.attributes=JSON.parse(e.attributes),e},e.getItems=function(){e.page++;var o="type=lunch&order_by=id,desc&page="+e.page;t.getMenu(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1);var o=t.data;for(item in o)o[item]=e.buildItemData(o[item]);e.items=e.items.concat(o)},function(e){})},e.updateItem=function(e){t.updateMenuItem(e).then(function(e){},function(e){})},e.deleteItem=function(e){t.deleteMenuItem(e).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("MerchantsCtrl",["$scope","Merchants","Modals",function(e,t,o){e.data={},e.user={},e.current=1,e.last=1,e.total=1,e.per_page=1,e.merchants=[],e.categories=[],e.regionVisible=!1,e.editMerchant=!1,e.submitted=!1,e.category,angular.element(document).ready(function(){var t=viewData.replace(/App\\Models\\/g,"");console.log("res",t);var o=JSON.parse(t);console.log("Data",o),e.category=o.category,e.merchants=o.data,e.current=o.page,e.per_page=o.per_page,e.last=o.last_page,e.total=o.total,document.getElementById("dissapear").remove()}),e.goTo=function(n){e.current=n,e.merchants=[],o.showLoader();var r="category_id="+e.category.id+"&page="+e.current+"&limit=2";e.category.type.includes("nearby")?t.getMerchantsNearby(r).then(function(t){e.loadResults(t)},function(e){}):e.category.type.includes("coverage")?t.getMerchantsCoverage(r).then(function(t){e.loadResults(t)},function(e){}):t.getMerchants(r).then(function(t){e.loadResults(t)},function(e){})},e.loadResults=function(t){e.merchants=t.data,e.current=parseInt(t.page),e.per_page=parseInt(t.per_page),e.last=parseInt(t.last_page),e.total=parseInt(t.total),o.hideLoader()},e.openItem=function(t){var o="",n=t.id;t.categorizable_id&&(n=t.categorizable_id),o=e.category?e.category.type.includes("products")?"/a/products/"+e.category.url+"?merchant_id="+n:"/a/merchant/"+t.slug:"/a/merchant/"+t.slug+"/products",window.location.href=o}}]).controller("MerchantDetailCtrl",["$scope","Merchants","Modals","$mdDialog",function(e,t,o,n){e.data={},e.user={},e.merchant={},angular.element(document).ready(function(){var t=viewData.replace(/App\\Models\\/g,"");console.log("res",t);var o=JSON.parse(t);console.log("Data",o),e.merchant=o.merchant}),e.booking=function(){console.log("Booking"),n.show(o.getAppPopup()).then(function(e){var t="";"ios"==e?t="":"android"==e?t="":"web"==e&&(t=""),console.log("Url",e,t)},function(){})}}])},function(e,t){angular.module("besafe").controller("OrdersCtrl",["$scope","Orders",function(e,t){e.data={},e.orders,e.from,e.to,e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.buildDatePicker(),e.getOrders()}),e.buildDatePicker=function(){var t="yy-mm-dd",o=$("#from").datepicker({defaultDate:"-1m",changeMonth:!0,numberOfMonths:2,dateFormat:t}).on("change",function(){n.datepicker("option","minDate",e.getDate(this)),e.from=e.getDate(this)}),n=$("#to").datepicker({defaultDate:"+1w",changeMonth:!0,numberOfMonths:2,dateFormat:t}).on("change",function(){o.datepicker("option","maxDate",e.getDate(this)),e.to=e.getDate(this)})},e.getDate=function(e){console.log("Get date",e.value);var t;try{t=$.datepicker.parseDate("yy-mm-dd",e.value)}catch(o){t=null}return t},e.buildOrderData=function(e){var t=e.items;for(item in t)t[item].attributes=JSON.parse(t[item].attributes);return e.items=t,e},e.getOrders=function(){e.page++;var o="includes=orderConditions,items,payments,user&order_by=id,desc&page="+e.page;t.getOrders(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1);var o=t.data;for(item in o)o[item]=e.buildOrderData(o[item]);e.orders=o},function(e){})},e.updateOrderStatus=function(e,o){t.updateOrderStatus(e,o).then(function(e){},function(e){})},e.getStoreExport=function(){console.log("Date",e.from,e.to),t.getStoreExport(e.from,e.to).then(function(e){},function(e){})},e.approveOrder=function(e){t.approveOrder(e.id).then(function(t){e.status="scheduled"},function(e){})}}])},function(e,t){angular.module("besafe").controller("PaymentsCtrl",["$scope","Payments","Merchants",function(e,t,o){e.data={},e.payments,e.loadMore=!0,e.page=0,e.regionVisible=!1,e.editPayment=!1,angular.element(document).ready(function(){e.getPayments()}),e.getPayments=function(){e.page++;var o="includes=order,user&order_by=id,desc&page="+e.page;t.getPayments(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1),e.payments=t.data},function(e){})},e.approvePayment=function(e){t.approvePayment(e.id).then(function(t){e.status="approved"},function(e){})}}]).controller("PaymentsUserCtrl",["$scope","Payments",function(e,t){e.data={},e.payments,e.loadMore=!0,e.page=0,e.regionVisible=!1,e.editPayment=!1,angular.element(document).ready(function(){e.getPayments()}),e.getPayments=function(){e.page++;var o="includes=order,user&order_by=id,desc&page="+e.page;t.getPaymentsUser(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1),e.payments=t.data},function(e){})},e.approvePayment=function(e){t.approvePayment(e.id).then(function(t){e.status="approved"},function(e){})}}]).controller("PaymentsMerchantCtrl",["$scope","Orders","Merchants",function(e,t,o){e.data={},e.orders=[],e.merchants=[],e.merchant_id,e.loadMore=!0,e.page=0,e.regionVisible=!1,e.editPayment=!1,angular.element(document).ready(function(){e.getMerchants()}),e.getOrders=function(o){e.page++;var n="includes=items,orderAddresses,user&order_by=id,desc&page="+e.page+"&merchant_id="+o;t.getOrders(n).then(function(t){t.page==t.last_page&&(e.loadMore=!1),e.orders=t.data},function(e){})},e.selectMerchant=function(){e.orders=[],e.page=0,e.getOrders(e.merchant_id)},e.getMerchants=function(){o.getMerchantsUser().then(function(t){"success"==t.status&&(e.merchants=t.data,0==e.orders.length&&e.merchants.length>0&&e.getOrders(e.merchants[0].id))},function(e){})},e.fullfillOrder=function(e){}}]).controller("PaymentsUserCtrl",["$scope","Payments",function(e,t){e.data={},e.payments,e.loadMore=!0,e.page=0,e.regionVisible=!1,e.editPayment=!1,angular.element(document).ready(function(){e.getPayments()}),e.getPayments=function(){e.page++;var o="includes=order,user&order_by=id,desc&page="+e.page;t.getPaymentsUser(o).then(function(t){t.page==t.last_page&&(e.loadMore=!1),e.payments=t.data},function(e){})},e.approvePayment=function(e){t.approvePayment(e.id).then(function(t){e.status="approved"},function(e){})}}]).controller("PaymentDetailCtrl",["$scope","Payments","$rootScope",function(e,t,o){e.data={},e.payment={},angular.element(document).ready(function(){e.getPayments()}),e.getPayments=function(){e.page++;var o=window.location.href,n=o.split("/");console.log("Payment id",n[n.length-1]);var r="id="+n[n.length-1]+"&includes=order.items,order.orderConditions,order.orderAddresses";t.getPaymentsUser(r).then(function(t){if(t.total>0){var o=t.data;e.payment=o[0]}},function(e){})},e.addTransactionCosts=function(){t.addTransactionCosts(e.payment.id).then(function(t){"success"==t.status?(console.log("after addTransactionCosts"),e.payment=t.payment):this.api.toast("PAYMENTS.ERROR_CHANGE")},function(e){})},e.retryPayment=function(){t.retryPayment(e.payment.id).then(function(e){console.log("after addTransactionCosts",e),"success"==e.status?(o.activePayment=e.payment,o.paymentActive=!0):this.api.toast("PAYMENTS.ERROR_CHANGE")},function(e){})}}])},function(e,t){angular.module("besafe").controller("ProductsCtrl",["$scope","Cart","$rootScope","$sce","Products","$mdDialog","Modals",function(e,t,o,n,r,a,i){e.categories=[],e.prodIds=[],e.hasLocation=!1,e.hasMerchant=!1,e.merchantObj={},e.current=1,e.last=1,e.range,e.params={},e.per_page=1,e.category_id=null,e.total=1,e.local_total=0,angular.element(document).ready(function(){e.clean();var t=viewData.replace(/App\\Models\\/g,"");console.log("viewData",t);var r=JSON.parse(t);console.log("Data",t),e.categories=r.categories,e.current=r.page,e.last=r.last_page,e.current=r.page,e.per_page=r.per_page,e.total=r.total,r.category&&(e.category_id=r.category.id),console.log(e.categories),e.$apply(function(){for(var t in e.categories)for(var r in e.categories[t].products)e.prodIds.push(e.categories[t].products[r].id),o.merchant_id||(o.merchant_id=e.categories[0].products[0].merchant_id),e.local_total++,e.categories[t].products[r].files&&e.categories[t].products[r].files.length>0&&(e.categories[t].products[r].imgs=e.categories[t].products[r].files),e.categories[t].products[r].imgs&&e.categories[t].products[r].imgs.length>0&&(e.categories[t].products[r].src=e.categories[t].products[r].imgs[0].file),e.categories[t].products[r].description=n.trustAsHtml(e.categories[t].products[r].description),e.categories[t].products[r].activeVariant=e.categories[t].products[r].variants[0],e.categories[t].products[r].variant_id=e.categories[t].products[r].variants[0].id,e.categories[t].products[r].quantity=e.categories[t].products[r].variants[0].min_quantity,e.categories[t].products[r].item_id=null,e.categories[t].products[r].isFavorite=!1}),console.log(e.categories),document.getElementById("dissapear").remove(),e.params=i.getAllUrlParams(),e.params.includes="files,merchant",e.category_id&&(e.params.category_id=e.category_id)}),o.$on("loadCartVariants",function(t,n){e.updateProductsCart(n,!1),o.user&&e.checkFavorites()}),e.clean=function(){angular.forEach(angular.element(".product-attributes"),function(e,t){var o=angular.element(e),n=JSON.parse(o.html()),r="";for(x in n)r+=x+": "+n[x]+" <br/>";o.html(r),o.css("display","block")})},e.changeStore=function(){t.changeMerchant()},e.filterPrice=function(){console.log("Filtering",$("#amount").val());var t=$("#amount").val();t=t.replace("$",""),t=t.replace("$",""),console.log("Filtering",t);var o=t.split("-");console.log("Filtering",o),e.params.high=parseInt(o[1].trim()),e.params.low=parseInt(o[0].trim()),e.goTo(1)},e.goTo=function(t){e.params.page=t,i.showLoader(),e.categories=[],r.getProductsMerchant(e.params).then(function(t){if(console.log("params",e.params),console.log("response",t),t.products_total>0){e.categories=r.buildProductInformation(t),console.log("Result build product",e.categories);var o=e.categories[0].products[0].merchant_attributes;"string"==typeof o&&(o=JSON.parse(o)),o.store_active&&1==o.store_active&&(e.storeActive=!0),e.merchantObj.merchant_name=e.categories[0].products[0].merchant_name,e.merchantObj.merchant_description=e.categories[0].products[0].merchant_description,e.merchantObj.src=e.categories[0].products[0].src,e.merchantObj.merchant_type=e.categories[0].products[0].merchant_type,e.categories.length>0&&(e.categories[0].more=!0,e.categories[0].products.length>0&&(e.categories[0].products[0].more=!0),e.categories[0].products.length>1&&(e.categories[0].products[1].more=!0)),e.current=parseInt(t.page),e.prodIds=[],e.last=parseInt(t.last_page),e.current=parseInt(t.page),e.per_page=parseInt(t.per_page),e.total=parseInt(t.total),e.local_total=0;for(var a in e.categories)for(var s in e.categories[a].products)e.local_total++,e.prodIds.push(e.categories[a].products[s].id),e.categories[a].products[s].description=n.trustAsHtml(e.categories[a].products[s].description),e.categories[a].products[s].activeVariant=e.categories[a].products[s].variants[0],e.categories[a].products[s].variant_id=e.categories[a].products[s].variants[0].id,e.categories[a].products[s].quantity=e.categories[a].products[s].variants[0].min_quantity,e.categories[a].products[s].item_id=null}i.hideLoader()},function(e){})},e.selectVariant=function(e){for(var t in e.variants)e.variant_id==e.variants[t].id&&(e.activeVariant=e.variants[t])},e.addCartItem=function(e){var n={id:e.activeVariant.id,quantity:e.quantity,item_id:e.item_id,product:e};t.addCartItem(n,[]).then(function(t){console.log("Add cart",t),"success"==t.status?(i.showToast("Carrito actualizado",$("#prod-cont-"+e.id)),e.item_id=t.item.id,e.quantity=t.item.quantity,o.$broadcast("loadHeadCart",t.cart)):i.showToast(t.message,$("#prod-cont-"+e.id))},function(e){})},e.checkFavorites=function(){var t={product_ids:e.prodIds};r.checkFavorite(t).then(function(t){if(console.log("checkFavorites res",t),"success"==t.status){var o=t.data;for(var n in o)for(var r in e.categories)for(var a in e.categories[r].products)e.categories[r].products[a].id==o[n].favoritable_id&&(e.categories[r].products[a].isFavorite=!0)}},function(e){})},e.addFavorite=function(e){if(o.user){var t={object_id:e.id,type:"Product"};r.addFavorite(t).then(function(t){console.log("Add addFavorite",t),"success"==t.status?(e.isFavorite=!0,i.showToast("Agregado",$("#prod-cont-"+e.id))):i.showToast(t.message,$("#prod-cont-"+e.id))},function(e){})}else i.showToast("Debes estar logueado para guardar productos",$("#prod-cont-"+e.id))},e.deleteFavorite=function(e){var t={object_id:e.id,type:"Product"};r.deleteFavorite(t).then(function(t){console.log("Add addFavorite",t),"success"==t.status?i.showToast("Agregado",$("#prod-cont-"+e.id)):i.showToast(t.message,$("#prod-cont-"+e.id))},function(e){})},e.updateProductsCart=function(t,o){e:for(var n in t.items)for(var r in e.categories)for(var a in e.categories[r].products){e.categories[r].products[a].item_id=null;for(var i in e.categories[r].products[a].variants){var s=t.items[n],c=e.categories[r].products[a].variants[i];if(s.attributes.product_variant_id==c.id&&(e.categories[r].products[a].item_id=s.id,e.categories[r].products[a].quantity=s.quantity,o))continue e}}},e.changeCartQuantity=function(e,n){"+"==n?e.quantity++:e.quantity--,t.updateCartItem(e.item_id,e.quantity).then(function(e){"error"==e.status?alert(e.message):o.$broadcast("loadHeadCart",e.cart)},function(e){})}}]).controller("ProductDetailCtrl",["$scope","Cart","$rootScope","$sce","Products","$mdDialog","Modals",function(e,t,o,n,r,a,i){e.hasLocation=!1,e.hasMerchant=!1,e.product={},e.related_products=[],e.category_id=null,e.rating={},angular.element(document).ready(function(){e.clean();var t=viewData.replace(/App\\Models\\/g,"");console.log("viewData",t);var o=JSON.parse(t);console.log("Data",o),e.product=o.product,e.related_products=o.related_products[0].products;for(var r in e.related_products){var a=e.related_products[r].variants[0];for(var i in e.related_products[r].variants)e.related_products[r].variants[i].is_on_sale&&a.is_on_sale?e.related_products[r].variants[i].sale<a.sale&&(a=e.related_products[r].variants[i]):!e.related_products[r].variants[i].is_on_sale&&a.is_on_sale?e.related_products[r].variants[i].price<a.sale&&(a=e.related_products[r].variants[i]):e.related_products[r].variants[i].is_on_sale||a.is_on_sale?e.related_products[r].variants[i].is_on_sale&&!a.is_on_sale&&e.related_products[r].variants[i].sale<a.price&&(a=e.related_products[r].variants[i]):e.related_products[r].variants[i].price<a.price&&(a=e.related_products[r].variants[i]);e.related_products[r].activeVariant=a,e.related_products[r].variant_id=a.id}e.rating.type="Product",e.rating.object_id=e.product.id,e.rating.rating="5",e.product.variants=e.product.product_variants,e.product.activeVariant=e.product.variants[0],e.product.quantity=e.product.activeVariant.min_quantity,e.product.variant_id=e.product.variants[0].id,e.product.description=n.trustAsHtml(e.product.description),document.getElementById("dissapear").remove()}),o.$on("loadCartVariants",function(t,o){e.updateProductsCart(o,!1)}),e.clean=function(){angular.forEach(angular.element(".product-attributes"),function(e,t){var o=angular.element(e),n=JSON.parse(o.html()),r="";for(x in n)r+=x+": "+n[x]+" <br/>";o.html(r),o.css("display","block")})},e.selectVariant=function(e){for(var t in e.variants)e.variant_id==e.variants[t].id&&(e.activeVariant=e.variants[t])},e.addCartItem=function(e){var n={id:e.activeVariant.id,quantity:e.quantity,item_id:e.item_id,product:e};t.addCartItem(n,[]).then(function(t){console.log("Add cart",t),"success"==t.status?(e.item_id=t.item.id,e.quantity=t.item.quantity,o.$broadcast("loadHeadCart",t.cart)):i.showToast(t.message)},function(e){})},e.addRating=function(){return console.log("Rating",e.rating),o.user?e.rating.rating.length>0?void i.showToast("Agrega una calificacion",$("#toast-container")):e.rating.comment.length>0?void i.showToast("Agrega una observacion a tu calificacion",$("#toast-container")):void r.addRating(e.rating).then(function(e){console.log("Add cart",e),"success"==e.status?i.showToast("Mensaje enviado. Si vuelves a enviar se anula el anterior",$("#toast-container")):i.showToast(e.message,$("#toast-container"))},function(e){}):(console.log("Debes estar loguedo para comentar"),void i.showToast("Debes estar loguedo para comentar",$("#toast-container")))},e.updateProductsCart=function(t,o){var n=e.related_products;for(var r in t.items)for(var a in n)for(var i in n[a].variants){var s=t.items[r],c=n[a].variants[i];if(s.attributes.product_variant_id==c.id&&(n[a].item_id=s.id,n[a].quantity=s.quantity,o))break}},e.changeCartQuantity=function(e,n){"+"==n?e.quantity++:e.quantity--,t.updateCartItem(e.item_id,e.quantity).then(function(e){"error"==e.status?alert(e.message):o.$broadcast("loadHeadCart",e.cart)},function(e){})}}])},function(e,t){angular.module("besafe").controller("ReportsCtrl",["$scope","Merchants","Modals",function(e,t,o){e.data={},e.user={},e.current=1,e.last=1,e.total=1,e.per_page=1,e.reports=[],e.categories=[],e.regionVisible=!1,e.editMerchant=!1,e.submitted=!1,e.category,angular.element(document).ready(function(){var t=viewData.replace(/App\\Models\\/g,"");console.log("res",t);var o=JSON.parse(t);console.log("Data",o),e.category=o.category,e.reports=o.data,e.current=o.page,e.per_page=o.per_page,e.last=o.last_page,e.total=o.total,document.getElementById("dissapear").remove()}),e.goTo=function(n){e.current=n,e.reports=[],o.showLoader();var r="category_id="+e.category.id+"&page="+e.current+"&limit=2";e.category.type.includes("nearby")?t.getReportsNearby(r).then(function(t){e.loadResults(t)},function(e){}):t.getReports(r).then(function(t){e.loadResults(t)},function(e){})},e.loadResults=function(t){e.reports=t.data,e.current=parseInt(t.page),e.per_page=parseInt(t.per_page),e.last=parseInt(t.last_page),e.total=parseInt(t.total),o.hideLoader()}}]).controller("ReportDetailCtrl",["$scope","Merchants","Modals",function(e,t,o){e.report={},angular.element(document).ready(function(){var t=viewData.replace(/App\\Models\\/g,"");console.log("res",t);var o=JSON.parse(t);console.log("Data",o),e.report=o})}])},function(e,t){angular.module("besafe").controller("RoutesCtrl",["$scope","$rootScope","Routes","Food","MapService",function(e,t,o,n,r){e.data={},e.routes,e.page=0,e.returns=[{name:"casa",address_id:17663},{name:"basilikum",address_id:17660}],e.loadMore=!0,e.scenario="preorganize",e.status="pending",e.provider="Basilikum",e.regionVisible=!1,e.editAddress=!1,e.mapActive=!1,angular.element(document).ready(function(){e.getRoutes()}),e.save=function(t){if(e.submitted=!0,t){var n=!1;e.data.address_id&&(n=!0),o.saveAddress($.param(e.data)).then(function(t){n?e.updateAddress(t.address):e.routes.push(t.address),e.data={},e.submitted=!1,e.editAddress=!1},function(e){})}},e.changeScenario=function(){console.log("provider",e.provider),e.page=0,e.hideAll(),"Basilikum"==e.provider&&(e.scenario="preorganize"),e.routes=[],e.getRoutes()},e.activateMap=function(){e.mapActive=!0,console.log("Creating map data"),r.createMap(4.685419,-74.064161),e.createMapData()},e.createMapData=function(){console.log("Creating map data");for(route in e.routes){var t=e.routes[route].stops;for(item in t)console.log("Creating map data stop"),t[item].icon="http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+t[item].amount+"|FE6256|000000",t[item].marker=r.createStop(t[item]);e.routes[route].stops=t,console.log("Creating map data route");var o=r.getColor();e.routes[route].polyline=r.createRoute(e.routes[route],o)}},e.buildRouteData=function(t){var o=t.stops,n=[];for(item in o){o[item].details=JSON.parse(o[item].details);var a={lat:o[item].address.lat,lng:o[item].address["long"]};n.push(a),o[item].name=o[item].address.address,o[item].lat=o[item].address.lat,o[item]["long"]=o[item].address["long"],o[item].moving_delivery=null,e.mapActive&&(o[item].marker=r.createStop(o[item]))}if(t.stops=o,t.stopsLat=n,e.mapActive){var i=e.getRouteColor();t.polyline=r.createRoute(t,i)}return setTimeout(function(){var o=document.getElementById("route-"+t.id+"-table");new Sortable(o,{group:"routes",handle:".handle",dataIdAttr:t.id,onAdd:function(t){console.log("On add",t);var o=t.item.attributes,n=t.target.id;n=n.replace("route-",""),n=n.replace("-table","");var r=parseInt(n),a=null;for(item in o)"data-stop"==o[item].name&&(a=o[item].value);e.updateRouteLocation(r,a,t.newIndex,1e3)},onUpdate:function(t){var o=t.item.attributes,n=null,r=null;for(item in o)"data-route"==o[item].name&&(n=o[item].value),"data-stop"==o[item].name&&(r=o[item].value);n&&r&&e.updateRouteLocation(n,r,t.newIndex,t.oldIndex)}});console.log("Setting sortable")},1e3),t.address_id=17663,t},e.updateRouteLocation=function(t,o,n,r){console.log("Route",t),console.log("stop",o),console.log("index",n);var a=null,i=[];for(item in e.routes)if(e.routes[item].id==t){var s=e.routes[item],c=1;for(stopI in s.stops)s.stops[stopI].id==o?a=s.stops[stopI]:r>n?c>=n&&i.push(s.stops[stopI]):c>n&&i.push(s.stops[stopI]),c++}console.log("displacedStops",i),a||(a={},a.route_id=t,a.id=o),console.log("Moving stop",a),$(".preloader").fadeIn("slow"),e.updateRouteStop(a),setTimeout(function(){var t=1;if(i.length>0){for(item in i)e.updateSpeed(i[item],t),t++,console.log("displacing stop",i[item]);setTimeout(function(){window.location.reload()},300*(t+1))}else setTimeout(function(){window.location.reload()},300*(t+1))},1e3)},e.updateSpeed=function(t,o){setTimeout(function(){e.updateRouteStop(t)},300*(o+1))},e.getRoutes=function(){console.log("Status",e.status),console.log("provider",e.provider),e.page++;var t="includes=stops.address&order_by=id,asc&page="+e.page+"&type="+e.scenario+"&status="+e.status+"&provider="+e.provider;"pending"!=e.status&&(t="includes=stops.address&order_by=id,asc&page="+e.page+"&status="+e.status),o.getRoutes(t).then(function(t){var o=t.data;t.page==t.last_page&&(e.loadMore=!1);for(item in o)o[item]=e.buildRouteData(o[item]);e.routes=o},function(e){})},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.sendReminder=function(){n.sendReminder().then(function(e){},function(e){})},e.showAll=function(){console.log("Creating map data");for(route in e.routes){var o=e.routes[route].stops;
for(item in o)console.log("Creating map data stop"),o[item].marker.setMap(t.map);e.routes[route].stops=o,e.routes[route].polyline.setMap(t.map)}},e.hideAll=function(){console.log("Creating map data");for(route in e.routes){var t=e.routes[route].stops;for(item in t)console.log("Creating map data stop"),t[item].marker&&t[item].marker.setMap(null);e.routes[route].stops=t,e.routes[route].polyline&&e.routes[route].polyline.setMap(null)}},e.showRoute=function(o){e.hideAll(),console.log("Creating map data");var n=o.stops;for(item in n)console.log("Creating map data stop"),n[item].marker.setMap(t.map);o.polyline.setMap(t.map)},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.updateRouteStop=function(e){o.updateRouteStop(e.id,e.route_id).then(function(e){},function(e){})},e.updateRouteDelivery=function(e){o.updateRouteStop(e.route_id,e.moving_delivery,e.id).then(function(e){},function(e){})},e.deleteRoute=function(e){o.deleteRoute(e).then(function(e){},function(e){})},e.deleteStop=function(e){o.deleteStop(e).then(function(e){window.location.reload()},function(e){})},e.sendStopToNewRoute=function(e){o.sendStopToNewRoute(e).then(function(e){window.location.reload()},function(e){})},e.addReturnStop=function(e,t){o.addReturnStop(e,t).then(function(e){window.location.reload()},function(e){})},e.buildRoute=function(e){n.buildScenarioRouteId(e.id).then(function(t){e.status="scheduled"},function(e){})},e.getPurchaseOrder=function(){n.getPurchaseOrder().then(function(e){},function(e){})},e.regenerateScenarios=function(){n.regenerateScenarios().then(function(e){window.location.reload()},function(e){})},e.regenerateDeliveries=function(){n.regenerateDeliveries().then(function(e){},function(e){})},e.getTotalShippingCosts=function(){n.getSummaryShipping(e.status).then(function(e){},function(e){})},e.getScenarioOrganization=function(){var t=e.getInputs();n.getScenarioOrganizationStructure(t).then(function(e){},function(e){})},e.buildScenarioLogistics=function(){var t=e.getInputs();n.buildScenarioLogistics(t).then(function(e){window.location.reload()},function(e){})},e.getInputs=function(){var t;return t="enqueue"==e.status?{status:"enqueue"}:{status:e.status,provider:e.provider,type:e.scenario}},e.getScenarioEmails=function(){var t=e.getInputs();n.getScenarioStructure(t).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("SitemapCtrl",["$scope","Cart","$rootScope","Modals",function(e,t,o,n){e.data={},e.user={},e.current=1,e.last=1,e.total=1,e.per_page=1,e.merchants=[],e.categories=[],e.regionVisible=!1,e.editMerchant=!1,e.submitted=!1,e.category,angular.element(document).ready(function(){}),o.$on("updateShippingAddress",function(){o.user?t.showConfirm(window.location.href):t.showConfirmExt(window.location.href)}),e.goTo=function(e,r){console.log("Going");var a=r.target.href;if(e.includes("nearby")||e.includes("coverage"))if(e.includes("nearby")?a+="/nearby":e.includes("coverage")&&(a+="/coverage"),console.log("Type",e),console.log("target",r.target.href),r.preventDefault(),o.shippingAddress){var i=n.getAllUrlParams();i&&i.length>0||(i={}),i.lat=o.shippingAddress.lat,i["long"]=o.shippingAddress["long"],console.log("params",i),console.log("res",n.turnObjectToUrl(i,a)),window.location.href=n.turnObjectToUrl(i,a)}else o.user?t.showConfirm(a):t.showConfirmExt(a);else window.location.href=a}}]).controller("SearchCtrl",["$scope","$rootScope","$cookies",function(e,t,o){e.category="",e.searchText="",e.showError=!1,angular.element(document).ready(function(){}),e.selectCat=function(){e.category.length>0&&(e.showError=!1)},e.search=function(){if(e.category.length>0){console.log("Search: ",e.searchText," Category: ",e.category);var n=e.category.split("|"),r="";if("merchants"==n[0]?r="/a/merchant-search":"reports"==n[0]?r="/a/report-search":"products"==n[0]&&(r="/a/product-search"),"nearby"==n[2]||"coverage"==n[2]){if(!t.shippingAddress)return r+="0"==n[1]?"?q="+e.searchText:"?categories="+n[1]+"&q="+e.searchText,o.put("locationRefferrer",r,{path:"/"}),void(window.location.href="/location");r+="0"==n[1]?"?lat="+t.shippingAddress.lat+"&long="+t.shippingAddress["long"]+"&q="+e.searchText:"?categories="+n[1]+"&lat="+t.shippingAddress.lat+"&long="+t.shippingAddress["long"]+"&q="+e.searchText}else r+="0"==n[1]?"?q="+e.searchText:"?categories="+n[1]+"&q="+e.searchText;window.location.href=r}else e.showError=!0}}]).controller("HomeCtrl",["$scope","Cart","$rootScope","Modals",function(e,t,o,n){e.data={},e.user={},e.category,e.goTo=function(e,r){if(e.includes("nearby")||e.includes("coverage")){var a=r.currentTarget.href;if(e.includes("nearby")?a+="/nearby":e.includes("coverage")&&(a+="/coverage"),console.log("Type",e),console.log("target",r.currentTarget.href),r.preventDefault(),o.shippingAddress){var i=n.getAllUrlParams();i&&i.length>0||(i={}),i.lat=o.shippingAddress.lat,i["long"]=o.shippingAddress["long"],console.log("params",i),console.log("res",n.turnObjectToUrl(i,a)),window.location.href=n.turnObjectToUrl(i,a)}else o.user?t.showConfirm(a):t.showConfirmExt(a)}}}])},function(e,t){angular.module("besafe").controller("SourcesCtrl",["$scope","Billing","$rootScope",function(e,t,o){function n(t){e.data.source=t,e.saveSource()}e.data={},e.months=[],e.years=[],e.branches=[{name:"Visa",value:"VISA"},{name:"Mastercard",value:"MASTERCARD"},{name:"Visa Debito",value:"VISA_DEBIT"},{name:"Diners",value:"DINERS"},{name:"American Express",value:"AMEX"}],e.sources=[],e.buying=!1,e.editSource=!1,e.showStripe=!1,e.hideDefault=!1,e.config={},angular.element(document).ready(function(){e.localGateway=e.config.gateway}),e.save=function(t){e.submitted=!0,console.log("Saving: "+t),t&&(e.showStripe=!0)},e.edit=function(){e.editSource?e.editSource=!1:e.editSource=!0};var r=stripe.elements({locale:$translate.use()}),a={base:{color:"#32325d",lineHeight:"24px",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}},s=r.create("card",{style:a});s.mount("#card-element"),s.addEventListener("change",function(e){var t=document.getElementById("card-errors");e.error?t.textContent=e.error.message:t.textContent=""});var c=document.getElementById("payment-form"),d={owner:{name:e.data.name,address:{line1:e.data.address,city:e.data.city,postal_code:e.data.postal,country:e.data.country},email:e.data.email}};c.addEventListener("submit",function(e){e.preventDefault(),stripe.createSource(s,d).then(function(e){if(e.error){var t=document.getElementById("card-errors");t.textContent=e.error.message}else n(e.source)})}),e.stripeCreateToken=function(){},e.loadMonths=function(){console.log("Loading months");var t=new Date;for(i=0;i<15;i++)e.years.push(t.getFullYear()+i);for(i=0;i<12;i++)e.months.push(1+i)},e.saveSource=function(){delete e.data.cvc,delete e.data.expMonth,delete e.data.expYear,delete e.data.number,delete e.data.postal,console.log("Data sent"),console.log(JSON.stringify(e.data)),console.log(JSON.stringify($.param(e.data))),t.createSource($.param(e.data),o.gateway).then(function(t){if(console.log("Return source"),console.log(JSON.stringify(t)),"card"==t.type){var o=t.card;o.type="card",e.sources.push(o),e.editSource=!1}e.data={},e.submitted=!1},function(e){})},e.getSources=function(o){t.getSources(o).then(function(t){var o=t.sources;for(item in o)if("card"==o[item].type){var n=o[item].card;n.type="card",n.id=o[item].id,n.is_default=o[item].is_default,e.sources.push(n)}0==o.length?(e.editSource=!0,e.hidedefault=!0,e.data["default"]=!0):e.hidedefault=!1},function(e){})},e.deleteSource=function(n){t.deleteSource(n.id,o.gateway).then(function(t){for(item in e.sources)e.sources[item].id==n.id&&(console.log("deleting source",e.sources[item]),e.sources.splice(item,1))},function(e){})},e.loadTestData=function(t){e.data.cvc="123",e.data.postal="33132",e.data.expYear="2020",e.data.expMonth="12"},e.selectSource=function(e){o.$broadcast("SourceSelected",{source:e.id})},o.$on("GetSources",function(t,o){e.getSources(o.gateway),e.buying=!0}),o.$on("GatewaySelected",function(t,n){o.gateway==e.localGateway&&(e.getSources(e.localGateway),e.loadMonths(),e.loadTestData())}),e.clean=function(){e.data={}},e.setAsDefault=function(n){var r={};r.source=n.id,t.setAsDefault(r,o.gateway).then(function(t){for(item in e.sources)e.sources[item].is_default=!1,e.sources[item].id==n.id&&(e.sources[item].is_default=!0)},function(e){window.location.reload()})}}]).controller("SourcesPayuCtrl",["$scope","Billing","$rootScope",function(e,t,o){e.data={},e.months=[],e.years=[],e.branches=[{name:"Visa",value:"VISA"},{name:"Mastercard",value:"MASTERCARD"},{name:"Visa Debito",value:"VISA_DEBIT"},{name:"Diners",value:"DINERS"},{name:"American Express",value:"AMEX"}],e.sources=[],e.buying=!1,e.showErrors=!1,e.editSource=!1,e.errors=[],e.config={},angular.element(document).ready(function(){e.localGateway="PayU"}),e.save=function(t){e.submitted=!0,e.showErrors=!1,console.log("Saving: "+t),t&&e.saveSource()},e.edit=function(){e.editSource?e.editSource=!1:e.editSource=!0},e.loadMonths=function(){console.log("Loading months");var t=new Date;for(i=0;i<15;i++)e.years.push(t.getFullYear()+i);for(i=0;i<12;i++)e.months.push(1+i)},e.saveSource=function(){console.log("Data sent"),console.log(JSON.stringify(e.data)),console.log(JSON.stringify($.param(e.data))),t.createSource($.param(e.data),e.localGateway).then(function(t){console.log("Reply to create"),console.log(JSON.stringify(t)),"success"==t.status?(e.getSources(),e.data={},e.data.country="CO",e.submitted=!1,e.editSource=!1):(e.editSource=!0,e.errors=t,e.showErrors=!0)},function(e){})},e.getSources=function(){t.getSources(e.localGateway).then(function(t){console.log("Sources"),e.sources=[];var o=t.sources;console.log(JSON.stringify(o));for(item in o){var n=o[item];n.type="card",e.sources.push(n)}0==o.length&&(e.editSource=!0)},function(e){})},e.deleteSource=function(o){t.deleteSource(o.token,e.localGateway).then(function(t){for(item in e.sources)e.sources[item].token==o.token&&(console.log("deleting source",e.sources[item]),e.sources.splice(item,1),0==e.sources.length&&(e.editSource=!0))},function(e){})},e.loadTestData=function(){e.data.name="Hoovert Arredondo",e.data.line1="Calle 73 # 0-24",e.data.line2="Apto 202",e.data.line3="",e.data.postalCode="",e.data.city="Bogota",e.data.state="Cundinamarca",e.data.country="CO",e.data.phone="3105507245",e.data.document="1020716535",e.data.number="4111111111111111",e.data.expMonth="10",e.data.expYear="2020",e.data.branch="VISA"},e.selectSource=function(e){o.$broadcast("SourceSelected",{source:e.id})},o.$on("GetSources",function(t,o){e.getSources(),e.buying=!0}),o.$on("GatewaySelected",function(t,n){o.gateway==e.localGateway&&(e.getSources(),e.loadTestData())}),e.clean=function(){e.data={}},e.setAsDefault=function(o){var n={};n.source=o.token,t.setAsDefault(n,e.localGateway).then(function(t){for(item in e.sources)e.sources[item].is_default=!1,e.sources[item].token==o.token&&(e.sources[item].is_default=!0)},function(e){window.location.reload()})}}]).controller("SubscriptionsCtrl",["$scope","Billing",function(e,t){e.data={},e.subscriptions=[],e.plans=[],e.showEdit=!1,e.localGateway="",angular.element(document).ready(function(){e.getSubscriptions()}),e.save=function(o){if(e.submitted=!0,o){var n={plan_id:e.data.plan_id};t.editSubscription(n,e.data.subscription_id,e.localGateway).then(function(t){e.data.subscription_id=""+e.data.subscription_id;for(item in e.subscriptions)e.subscriptions[item].source_id==e.data.subscription_id&&(console.log("deleting subscription",e.subscriptions[item]),e.subscriptions.splice(item,1));e.subscriptions.push(t.subscription)},function(e){})}},e.getSubscriptions=function(){t.getSubscriptions().then(function(t){e.subscriptions=t.subscriptions;for(x in e.subscriptions){var o=e.subscriptions[x].object;e.subscriptions[x].object_name=o.name,e.subscriptions[x].object_code=o.code,e.subscriptions[x].object_status=o.status,e.subscriptions[x].object_ends=o.ends_at}},function(e){})},e.getPlans=function(){t.getPlans().then(function(t){e.plans=t.plans},function(e){})},e.deleteSubscription=function(o){t.deleteSubscription(o.source_id,o.gateway).then(function(t){var n=""+o.source_id;for(item in e.subscriptions)e.subscriptions[item].source_id==n&&e.subscriptions.splice(item,1)},function(e){})},e.clean=function(){e.data={}},e.editSubscription=function(t){e.data.subscription_id=t.id,e.getPlans(),e.showEdit=!0}}]).controller("PlansCtrl",["$scope","$rootScope",function(e,t){e.selectPlan=function(e){t.$broadcast("PlanSelected",{plan:e})}}]).controller("GatewaysCtrl",function(e,t){e.data={},e.objectSelected=!1,e.selectGateway=function(e){t.gateway=e,t.$broadcast("GatewaySelected")},t.$on("ObjectSelected",function(t,o){e.objectSelected=!0})}).controller("SubscriptionPlansStripeCtrl",function(e,t,o){function n(t,o){o.error||(e.data.source=o.id,e.createSubscription())}e.data={},e.months=[],e.years=[],e.sources=[],e.localGateway="",e.sourceSelected=!1,e.showSources=!1,e.buying=!0,e.data.object_id=1,angular.element(document).ready(function(){e.localGateway="Stripe"}),e.saveSimple=function(t){e.submitted=!0,t&&e.createSubscription()},e.save=function(t){e.submitted=!0,t&&e.stripeCreateToken()},e.loadMonths=function(){var t=new Date;for(i=0;i<15;i++)e.years.push(t.getFullYear()+i);for(i=0;i<12;i++)e.months.push(1+i)},e.editSources=function(){window.location.href="/sources"},e.loadTestData=function(){e.data.number="4242424242424242",e.data.cvc="123",e.data.postal="33132",e.data.expYear="2020",e.data.expMonth="12"},e.createSubscription=function(){e.data["default"]=!0,delete e.data.cvc,delete e.data.expMonth,delete e.data.expYear,delete e.data.number,delete e.data.postal,console.log("Data sent"),console.log(JSON.stringify(e.data)),console.log(JSON.stringify($.param(e.data))),t.createSubscription($.param(e.data),e.localGateway).then(function(t){"status"in t&&"success"==t.status&&(console.log("Subscription created"),e.data={},e.submitted=!1,window.location.href="/subscriptions"),e.errors=t,e.showErrors=!0},function(e){})},e.stripeCreateToken=function(){Stripe.source.create({type:"card",card:{number:e.data.number,cvc:e.data.cvc,exp_month:e.data.expMonth,exp_year:e.data.expYear},owner:{address:{postal_code:e.data.postal}}},n)},o.$on("PlanSelected",function(t,o){e.data.plan_id=o.plan}),o.$on("ObjectSelected",function(t,o){e.data.object_id=o.object_id}),o.$on("GatewaySelected",function(t,n){if(o.gateway==e.localGateway){console.log(JSON.stringify(e.config));var r=e.config.sources;console.log(e.localGateway);for(item in r)console.log(JSON.stringify(r[item])),r[item].gateway==e.localGateway&&r[item].has_default&&(e.sourceSelected=!0,console.log("Has default"));e.loadMonths(),e.loadTestData()}})}).controller("SubscriptionPlansPayuCtrl",["$scope","Billing","$rootScope",function(e,t,o){e.data={},e.months=[],e.years=[],e.branches=[{name:"Visa",value:"VISA"},{name:"Mastercard",value:"MASTERCARD"},{name:"Visa Debito",value:"VISA_DEBIT"},{name:"Diners",value:"DINERS"},{name:"American Express",value:"AMEX"}],e.sources=[],e.localGateway="",e.sourceSelected=!1,e.showSources=!1,e.buying=!0,e.hasDefault=!1,e.newCard=!1,e.data.object_id=1,angular.element(document).ready(function(){e.localGateway="PayU"}),e.saveSimple=function(t){e.submitted=!0,t&&e.createSubscription()},e.selectSource=function(t){e.data.source=t.token,e.submitted=!0,e.data.plan_id&&e.data.object_id&&(e.sourceSelected=!0,e.createSubscription())},e.newCardTrigger=function(){e.newCard=!0,e.sourceSelected=!1},e.getSources=function(){e.sourceSelected=!1,e.newCard=!1,t.getSources(e.localGateway).then(function(t){console.log("Sources"),e.sources=[];var o=t.sources;console.log(JSON.stringify(o));for(item in o){var n=o[item];n.type="card",e.sources.push(n)}0==o.length&&(e.newCard=!0)},function(e){})},e.save=function(t){e.submitted=!0,t&&(e.data["new"]=!0,e.createSubscription())},e.loadMonths=function(){var t=new Date;for(i=0;i<15;i++)e.years.push(t.getFullYear()+i);for(i=0;i<12;i++)e.months.push(1+i);console.log(JSON.stringify(e.months))},e.loadTestData=function(){console.log("Loading test data"),e.data.name="Hoovert Arredondo",e.data.line1="Calle 73 # 0-24",e.data.line2="Apto 202",e.data.line3="",e.data.postalCode="",e.data.city="Bogota",e.data.state="Cundinamarca",e.data.country="CO",e.data.phone="3105507245",e.data.document="1020716535",e.data.number="4111111111111111",e.data.expMonth="10",e.data.expYear="2020",e.data.branch="VISA"},e.createSubscription=function(){console.log("Data sent"),console.log(JSON.stringify(e.data)),console.log(JSON.stringify($.param(e.data))),t.createSubscription($.param(e.data),e.localGateway).then(function(t){return"status"in t&&"success"==t.status?(console.log("Subscription created"),e.data={},window.location.href="/subscriptions",e.submitted=!1,!0):(e.errors=t,void(e.showErrors=!0))},function(e){})},o.$on("PlanSelected",function(t,o){e.data.plan_id=o.plan}),o.$on("ObjectSelected",function(t,o){e.data.object_id=o.object_id}),o.$on("GatewaySelected",function(t,n){if(console.log(o.gateway),console.log(e.localGateway),console.log(o.gateway==e.localGateway),o.gateway==e.localGateway){console.log(JSON.stringify(e.config));var r=e.config.sources;console.log(e.localGateway);for(item in r)console.log(JSON.stringify(r[item])),r[item].gateway==e.localGateway&&r[item].has_default?(e.sourceSelected=!0,e.hasDefault=!0,console.log("Has default")):(e.sourceSelected=!1,e.hasDefault=!1,e.getSources());e.loadMonths(),e.loadTestData()}})}])},function(e,t){angular.module("besafe").controller("NotificationsCtrl",["$scope","$rootScope","Alerts",function(e,t,o){e.notifications=[],t.$broadcast("updateNotifList"),e.noavatar=API.avatar,e["delete"]=function(e){o.deleteNotification(e)},e.followNotification=function(e){o.get(e).then(function(e){console.log("After Get:"),console.log(JSON.stringify(e)),o.followNotification(e),console.log("After follow:"),console.log(JSON.stringify(e))},function(e){})},t.$on("updateNotifList",function(){e.notifications=[],o.loadNotificationsGlobal("50").then(function(o){for(notif in o){o[notif].created_at=new Date(o[notif].created_at),"location_first"==o[notif].type?o[notif]["class"]="ion-android-pin":"location_last"==o[notif].type?o[notif]["class"]="ion-android-pin":"notification_location"==o[notif].type?o[notif]["class"]="ion-android-compass":"emergency"==o[notif].type?o[notif]["class"]="ion-android-warning":"medical_emergency"==o[notif].type?o[notif]["class"]="ion-ios-medkit":"emergency_end"==o[notif].type?o[notif]["class"]="ion-flag":"user_message"==o[notif].type?o[notif]["class"]="ion-email":"group_message"==o[notif].type?o[notif]["class"]="ion-email":"new_contact"==o[notif].type?o[notif]["class"]="ion-person-stalker":"new_group"==o[notif].type?o[notif]["class"]="ion-person-stalker":"system"==o[notif].type&&(o[notif]["class"]="ion-alert");try{e.notifications.push(o[notif])}catch(n){console.log("Repetido"),console.log(JSON.stringify(o[notif]))}}t.notificationsChanged=!1},function(e){})}),t.$on("receivedNotification",function(e,o){t.$broadcast("updateNotifList")}),e.$on("$stateChangeSuccess",function(e,o,n,r,a){"tab.notifications"==o.name&&(console.log("Entering notifications"),1==t.notificationsChanged&&t.$broadcast("updateNotifList"))})}]).controller("UserRegisterCtrl",["$scope","LocationService","Users",function(e,t,o){e.data={},e.addresses,e.regionVisible=!1,e.cityVisible=!1,t.getCountries("").then(function(t){e.countries=t.data},function(e){})}]).controller("UserProfileCtrl",["$scope","$rootScope","Users","Modals",function(e,t,o,n){e.data={},angular.element(document).ready(function(){e.data=t.user}),t.$on("user_loaded",function(o,n){console.log("Loading user"),e.data=t.user}),e.save=function(t){e.submitted=!0,t&&(n.showLoader(),o.saveUser(e.data).then(function(t){n.hideLoader(),console.log("Resp",t),e.submitted=!1,"success"==t.status?(n.showToast("Actualizacion exitosa",$("#myaccountContent")),e.data=t.user):n.showToast("Hubo un error actualizando tus datos",$("#myaccountContent"))},function(e){}))}}]).controller("UserPasswordCtrl",["$scope","$rootScope","Users","Modals",function(e,t,o,n){e.data={},e.save=function(t){if(e.submitted=!0,t){if(e.data.password!=e.data.password_confirmation)return;n.showLoader(),o.updatePassword(e.data).then(function(t){n.hideLoader(),console.log("Resp",t),e.submitted=!1,"success"==t.status&&n.showToast("Actualizacion exitosa",$("#myaccountContent"))},function(e){n.hideLoader(),n.showToast("Contrasea incorrecta",$("#myaccountContent"))})}}}])},function(e,t){angular.module("besafe").controller("ZonesCtrl",["$scope","$rootScope","Zones","MapService","Merchants",function(e,t,o,n,r){e.data={},e.items=[],e.merchants=[{name:"Plan de almuerzos",value:1299,id:1299},{name:"Para preparar en casa",value:1300,id:1300},{name:"Catering",value:1301,id:1301}],e.providers=[{name:"Basilikum",value:"Basilikum"},{name:"Rapigo",value:"Rapigo"}],e.activeMerchant="1299",e.activeMerchantObject={name:"Plan de almuerzos",value:1299,id:1299},e.activeProvider="Basilikum",e.searchTerms="",e.changeMerchant=!1,e.createNewMerchant=!1,e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems(),n.createMap(4.685419,-74.064161)}),t.$on("zone-updated",function(t,o){for(item in e.items)e.items[item].id==o.id&&(e.items[item].isActive=!0,e.$digest())}),e.buildItemData=function(e){return e.isActive=!1,e},e.changeActiveMerchant=function(){e.changeMerchant=!0},e.createItemStart=function(){e.createNewMerchant=!0},e.cancelChangeMerchant=function(){e.changeMerchant=!1},e.activateMap=function(){e.mapActive=!0,console.log("Creating map data"),e.createMapData()},e.createMapData=function(){console.log("Creating map data");for(item in e.items){console.log("Creating map data item");var t=n.getColor();e.items[item].polygon=n.createPolygon(e.items[item],t)}},e.clearMap=function(){for(item in e.items)console.log("Creating map data item"),e.items[item].polygon.setMap(null),e.items[item].isActive=!1},e.changeScenario=function(){e.clearMap(),e.items=[],e.page=0,e.getItems()},e.getColor=function(){var e=["#FF0000","#800000","#FFFF00","#808000","#00FF00","#008000","#00FFFF","#008080","#0000FF","#000080","#FF00FF","#800080"],t=Math.round(Math.random()*(e.length-1));return e[t]},e.selectItem=function(o){e.clearMap(),o.isActive=!0,o.polygon.setMap(t.map)},e.createItem=function(){e.clearMap();var r=t.map.getCenter(),a={lat:r.lat(),lng:r.lng()};console.log("Center Map",a.lat);var i=[{lat:a.lat+.006,lng:a.lng},{lat:a.lat-.006,lng:a.lng-.006},{lat:a.lat-.006,lng:a.lng+.006},{lat:a.lat+.006,lng:a.lng}],s={city_id:524,region_id:11,address_id:14,country_id:1,merchant_id:e.activeMerchant,provider:e.activeProvider,coverage:JSON.stringify(i),lat:4.649824,"long":-74.058881};o.createZoneItem(s).then(function(t){var o=n.getColor(),r=t.item;r.isActive=!1,r.polygon=n.createPolygon(r,o),e.items.push(r)},function(e){})},e.getItems=function(){e.page++;var t="order_by=id,desc&page="+e.page+"&merchant_id="+e.activeMerchant+"&provider="+e.activeProvider;o.getZones(t).then(function(t){t.page==t.last_page&&(e.loadMore=!1),console.log("Items",t.data);var o=t.data;for(item in o)o[item]=e.buildItemData(o[item]);e.items=e.items.concat(o),e.activateMap()},function(e){})},e.getMerchants=function(){e.page++,r.searchMerchants(e.searchTerms).then(function(t){console.log("Items",t.data),e.merchants=t.data},function(e){})},e.selectMerchant=function(t){e.activeMerchantObject=t,e.clearMap(),e.page=0,e.items=[],e.activeMerchant=t.id+"",e.changeMerchant=!1,e.getItems()},e.updateItem=function(e){var t=e,n=[],r=null;t.polygon.getPaths().forEach(function(e,t){console.log("path",t);for(var o=e,a=0;a<o.getLength();a++){var i=o.getAt(a),s={lat:i.lat(),lng:i.lng()};n.push(s),0==a&&(r=s)}}),n.push(r);var a=t.polygon;delete t.polygon,delete t.isActive,t.coverage=JSON.stringify(n),console.log("Zone",t),console.log("Points",n),o.updateZoneItem(t).then(function(e){t.polygon=a,t.isActive=!1,console.log("updateZoneItem",e)},function(e){})},e.deleteItem=function(t){console.log("Zone",t),o.deleteZoneItem(t).then(function(o){for(t in e.items)console.log("Creating map data item"),e.items[t].polygon.setMap(null),e.items[t].isActive=!1,e.items.splice(t,1)},function(e){})}}])},function(e,t){angular.module("besafe").controller("ZonesPubCtrl",["$scope","$rootScope","Food","MapService",function(e,t,o,n){e.data={},e.items=[],e.merchants=[{name:"Plan de almuerzos",value:1299},{name:"Para preparar en casa",value:1300},{name:"Catering",value:1301}],e.providers=[{name:"Basilikum",value:"Basilikum"},{name:"Rapigo",value:"Rapigo"}],e.activeMerchant="1299",e.activeProvider="Basilikum",e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems(),n.createMap(4.685419,-74.064161)}),e.buildItemData=function(e){return e.isActive=!1,e},e.activateMap=function(){e.mapActive=!0,console.log("Creating map data"),e.createMapData()},e.createMapData=function(){console.log("Creating map data");for(item in e.items){console.log("Creating map data item");var t=n.getColor();e.items[item].polygon=n.createPolygon(e.items[item],t)}},e.clearMap=function(){for(item in e.items)console.log("Creating map data item"),e.items[item].polygon.setMap(null),e.items[item].isActive=!1},e.changeScenario=function(){e.clearMap(),e.items=[],e.page=0,e.getItems()},e.getColor=function(){var e=["#FF0000","#800000","#FFFF00","#808000","#00FF00","#008000","#00FFFF","#008080","#0000FF","#000080","#FF00FF","#800080"],t=Math.round(Math.random()*(e.length-1));return e[t]},e.selectItem=function(o){e.clearMap(),o.isActive=!0,o.polygon.setMap(t.map)},e.createItem=function(){e.clearMap();var t=[{lat:4.66188,lng:-74.056724},{lat:4.656747,lng:-74.060458},{lat:4.656277,lng:-74.052304}],r={city_id:524,region_id:11,address_id:14,country_id:1,merchant_id:e.activeMerchant,provider:e.activeProvider,coverage:JSON.stringify(t),lat:4.649824,"long":-74.058881};o.createZoneItem(r).then(function(t){var o=n.getColor(),r=t.item;r.polygon=n.createPolygon(r,o),e.items.push(r)},function(e){})},e.getItems=function(){e.page++;var t="order_by=id,desc&page="+e.page+"&merchant_id="+e.activeMerchant+"&provider="+e.activeProvider;o.getZones(t).then(function(t){t.page==t.last_page&&(e.loadMore=!1),console.log("Items",t.data);var o=t.data;for(item in o)o[item]=e.buildItemData(o[item]);e.items=e.items.concat(o),e.activateMap()},function(e){})},e.updateItem=function(e){var t=e,n=[],r=null;t.polygon.getPaths().forEach(function(e,t){console.log("path",t);for(var o=e,a=0;a<o.getLength();a++){var i=o.getAt(a),s={lat:i.lat(),lng:i.lng()};n.push(s),0==a&&(r=s)}}),n.push(r);var a=t.polygon;delete t.polygon,delete t.isActive,t.coverage=JSON.stringify(n),console.log("Zone",t),console.log("Points",n),o.updateZoneItem(t).then(function(e){t.polygon=a,console.log("updateZoneItem",e)},function(e){})},e.deleteItem=function(t){console.log("Zone",t),o.deleteZoneItem(t).then(function(o){for(t in e.items)console.log("Creating map data item"),e.items[t].polygon.setMap(null),e.items[t].isActive=!1,e.items.splice(t,1)},function(e){})}}])},function(e,t){angular.module("besafe").service("Addresses",["$q","$http",function(e,t){var o=function(){var o=e.defer();return t({method:"get",url:"/api/addresses"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},n=function(o){var n=e.defer();return t({method:"POST",url:"/api/addresses",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},r=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/addresses/"+o}).success(function(e){console.log(e),n.resolve(e)}).error(function(){n.reject("Failed to Delete Address")}),n.promise};return{getAddresses:o,saveAddress:n,deleteAddress:r}}])},function(e,t){angular.module("besafe").service("Billing",["$q","$http",function(e,t){var o=function(o,n){var r=e.defer();return t({method:"POST",url:"/api/billing/pay_cc/"+n,data:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to payCreditCard")}),r.promise},n=function(o){var n=e.defer();return t({method:"POST",url:"/api/billing/pay_in_bank/Local",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to payInBank")}),n.promise},r=function(o){var n=e.defer();return t({method:"POST",url:"/api/billing/complete_paid/Food",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to completePaidOrder")}),n.promise},a=function(o){var n=e.defer();return t({method:"POST",url:"/api/billing/retry/"+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to retryPayment")}),n.promise},i=function(o){var n=e.defer();return t({method:"POST",url:"/api/billing/add_transaction_costs/"+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to addTransactionCosts")}),n.promise},s=function(o,n){var r=e.defer();return t({method:"POST",url:"/api/billing/pay_debit/"+n,data:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to payDebit")}),r.promise},c=function(o,n){var r=e.defer();return t({method:"POST",url:"/api/billing/pay_cash/"+n,data:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to payCash")}),r.promise},d=function(o){var n="/api/payu/banks",r=e.defer();return t({method:"GET",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getBanks")}),r.promise};return{payCreditCard:o,payInBank:n,completePaidOrder:r,retryPayment:a,addTransactionCosts:i,payDebit:s,payCash:c,getBanks:d}}])},function(e,t){angular.module("besafe").service("Cart",["$q","$http","$mdDialog","Modals","$cookies","$rootScope",function(e,t,o,n,r,a){var i=function(e){o.show(n.getLocationPrompt()).then(function(t){"map"==t?(r.put("locationRefferrer",e,{path:"/"}),window.location.href="/location"):"address"==t&&p()},function(){})},s=function(e){r.put("locationRefferrer",e,{path:"/"}),window.location.href="/location"},c=function(e){return console.log("Check prod",a.shippingAddress),e.is_shippable?a.shippingAddress?l():(i(window.location.href),!1):l()},d=function(){var e=window.location.href,t=e.split("/"),o=t[t.length-1];return o.includes("?")&&(o=o.split("?")[0]),isNaN(o)?null:o},l=function(){if(a.merchant_id)return!0;var e=d();console.log("Searching for merchants in cat:",e),g(e)},u=function(){var e=d();console.log("Searching for merchants in cat:",e),g(e)},p=function(){o.show(n.getAddressesPopup()).then(function(e){console.log("Got address",e),a.shippingAddress=e,a.lat=e.lat,r.put("shippingAddress",JSON.stringify(e),{path:"/"}),l()},function(){console.log("Got nothing")})},g=function(e){o.show(n.getMerchantsPopup(e)).then(function(e){console.log("Got merchant",e);var t=n.getAllUrlParams(),o=window.location.href;o.includes("?")&&(o=o.split("?")[0]),t.merchant_id=e.id;var r=!0;for(var a in t)t.hasOwnProperty(a)&&(o=r?"?"+a+"="+t[a]:"&"+a+"="+t[a]);window.location.href=o},function(){console.log("Got nothing")})},f=function(o){console.log("Post to server",o);var n=e.defer();return t({method:"post",url:"/api/cart/add",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},m=function(t,r){console.log("Check variant: ",t);var i=c(t);t.merchant_id=a.merchant_id,t.item_id||(t.item_id=null);var s=t.product.activeVariant,d=e.defer();if(i)if(s.attributes.questions)o.show(n.getQuestionairePopup(s.attributes.questions)).then(function(e){var o=[];for(var n in e){var r={name:e[n].name,value:e[n].value};o.push(r)}var a={product_variant_id:t.id,merchant_id:t.merchant_id,quantity:t.quantity,item_id:t.item_id,extras:{data:o}};f(a).then(function(e){d.resolve(e)},function(){d.reject("Failed to get nearby")})},function(){d.resolve({status:"pending_questions",message:"Debes completar estas preguntas para comprar este producto"})});else{var l={product_variant_id:t.id,merchant_id:t.merchant_id,quantity:t.quantity,item_id:t.item_id,extras:r};f(l).then(function(e){d.resolve(e);
},function(){d.reject("Failed to postToServer")})}else d.resolve({status:"pending_location",message:"msg"});return d.promise},h=function(o,n){var r=e.defer();return t({method:"post",url:"/api/cart/update",data:{item_id:o,quantity:n}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get nearby")}),r.promise},v=function(){var o=e.defer();return t({method:"GET",url:"/api/cart/get"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},y=function(){var o=e.defer();return t({method:"GET",url:"/api/cart/checkout"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},_=function(){var o=e.defer();return t({method:"post",url:"/api/cart/clear"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise};return{getCheckoutCart:y,getCart:v,addCartItem:m,updateCartItem:h,showConfirm:i,showConfirmExt:s,clearCart:_,changeMerchant:u}}])},function(e,t){angular.module("besafe").service("Categories",["$q","$http",function(e,t){var o=function(o){var n="/api/categories/"+o,r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get nearby")}),r.promise};return{getCategories:o}}])},function(e,t){angular.module("besafe").service("Food",["$q","$http",function(e,t){var o=function(){var o="/api/food/newsletter",n=e.defer();return t({method:"get",url:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to sendNewsletter")}),n.promise},n=function(o){var n="/api/food/deliveries";o&&(n=n+"?"+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get getDeliveries")}),r.promise},r=function(o){var n="/api/food/menu";o&&(n=n+"?"+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get getArticles")}),r.promise},a=function(o){var n="/api/admin/zones";o&&(n=n+"?"+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get getArticles")}),r.promise},i=function(o){var n="/api/food/messages";o&&(n=n+"?"+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get getArticles")}),r.promise},s=function(){var o="/api/food/largest_addresses",n=e.defer();return t({method:"get",url:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get getLargestAddresses")}),n.promise},c=function(o){var n="/api/food/delegate_deliveries",r=e.defer();return t({method:"post",url:n,data:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get getLargestAddresses")}),r.promise},d=function(o,n){var r="/api/food/user/"+o+"/address/"+n,a=e.defer();return t({method:"post",url:r,data:{}}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to updateDeliveryAddress")}),a.promise},l=function(o){var n="/api/food/update_dish",r=e.defer();return t({method:"post",url:n,data:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to updateDeliveryAddress")}),r.promise},u=function(o){var n="/api/food/build_route_id/"+o,r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to buildScenarioRouteId")}),r.promise},p=function(o){var n="/api/food/build_scenario_positive/"+o,r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to buildScenarioPositive")}),r.promise},g=function(o){var n="/api/food/build_complete_scenario/"+o,r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to buildCompleteScenario")}),r.promise},f=function(o){var n="/api/food/get_scenario_structure",r=e.defer();return t({method:"get",url:n,params:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getScenarioStructure")}),r.promise},m=function(o){var n="/api/food/summary/"+o,r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getSummaryShipping")}),r.promise},h=function(o){var n="/api/food/route_organize",r=e.defer();return t({method:"get",url:n,params:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getScenarioOrganizationStructure")}),r.promise},v=function(o){var n="/api/food/build_scenario_logistics",r=e.defer();return t({method:"post",url:n,data:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to buildScenarioLogistics")}),r.promise},y=function(){var o="/api/food/purchase_order",n=e.defer();return t({method:"get",url:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to getPurchaseOrder")}),n.promise},_=function(){var o="/api/food/regenerate_scenarios",n=e.defer();return t({method:"get",url:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to regenerateScenarios")}),n.promise},b=function(){var o="/api/food/regenerate_deliveries",n=e.defer();return t({method:"get",url:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to regenerateDeliveries")}),n.promise},S=function(o){var n=e.defer();return t({method:"POST",url:"/api/food/menu/"+o.id,data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to updateMenuItem")}),n.promise},C=function(o){console.log("Updating zone item",o);var n=e.defer();return t({method:"PATCH",url:"/api/admin/zones/"+o.id,data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to updateZoneItem")}),n.promise},w=function(o){var n=e.defer();return t({method:"POST",url:"/api/admin/zones",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to createZoneItem")}),n.promise},k=function(o){var n=e.defer();return t({method:"POST",url:"/api/food/messages/"+o.id,data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to updateMessageItem")}),n.promise},A=function(){var o=e.defer();return t({method:"POST",url:"/api/food/reminder",data:{}}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to sendReminder")}),o.promise},M=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/food/messages/"+o.id}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to deleteMessageItem")}),n.promise},P=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/admin/zones/"+o.id}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to deleteZoneItem")}),n.promise},$=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/food/content/"+o.id}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to deleteMenuItem")}),n.promise},T=function(o){var n=e.defer();return t({method:"GET",url:"/api/articles?start_date="+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to getArticlesByDate")}),n.promise};return{getMenu:r,getZones:a,getPurchaseOrder:y,delegateDeliveriesAddress:c,getMessages:i,getArticlesByDate:T,updateDeliveryAddress:d,buildScenarioLogistics:v,regenerateDeliveries:b,getScenarioStructure:f,getSummaryShipping:m,buildScenarioRouteId:u,getDeliveries:n,sendReminder:A,buildCompleteScenario:g,regenerateScenarios:_,buildScenarioPositive:p,updateZoneItem:C,createZoneItem:w,updateMenuItem:S,getScenarioOrganizationStructure:h,updateMessageItem:k,sendNewsletter:o,deleteZoneItem:P,updateMissingDish:l,deleteMenuItem:$,deleteMessageItem:M,getLargestAddresses:s}}])},function(e,t){angular.module("besafe").service("Groups",["$q","$http",function(e,t){var o=function(){var o=e.defer();return t({method:"get",url:"/api/groups"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},n=function(o){var n=e.defer();return t({method:"POST",url:"/api/groups",data:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise};return{saveGroup:n,getGroups:o}}])},function(e,t){angular.module("besafe").service("Leads",["$q","$http",function(e,t){var o=function(o){var n="/api/leads",r=e.defer();return t({method:"post",url:n,data:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to sendLead")}),r.promise};return{sendLead:o}}])},function(e,t){angular.module("besafe").service("LocationService",["$q","$http","$rootScope",function(e,t,o){var n=function(o){var n=e.defer();return t({method:"get",url:"/api/locations"+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},r=function(o,n){var r=e.defer();return t({method:"get",headers:{"Content-Type":"application/json","X-Auth-Token":void 0,Authorization:void 0},url:"http://maps.googleapis.com/maps/api/geocode/json?latlng="+o+","+n+"&sensor=true"}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get nearby")}),r.promise},a=function(o){var n=e.defer();return console.log("Getting merchants"),console.log(JSON.stringify(o)),t({method:"get",url:"/api/merchants/nearby",params:o}).success(function(e){n.resolve(e)}).error(function(e){console.log(JSON.stringify(e)),n.reject("Failed to get nearby merchants")}),n.promise},i=function(o){console.log("Get locations trip: /historic_locations?target_id="+o.user_id+"&trip_id="+o.trip);var n=e.defer(),r="/historic_locations?target_id="+o.user_id+"&trip_id="+o.trip;return o.page&&(r=r+"&page="+o.page),o.perpage&&(r=r+"&per_page="+o.perpage),t.get(r).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},s=function(){var o=e.defer();return t({method:"get",url:"/api/locations/hash"}).success(function(e){o.resolve(e)}).error(function(e){console.log(JSON.stringify(e)),o.reject("Failed to get nearby")}),o.promise},c=function(o){var n=e.defer();return t({method:"get",url:"/api/cities?limit=50&region_id="+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},d=function(o){var n="/api/cities";o&&(n=n+"?"+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get nearby")}),r.promise},l=function(o){var n=e.defer();return t.post("/api/cities/from",o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},u=function(o){var n=e.defer();return t({method:"get",url:"/api/regions?limit=40&country_id="+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},p=function(o){var n=e.defer();return t({method:"get",url:"/api/countries?id="+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},g=function(){var o=e.defer();return t({method:"get",url:"/api/countries?limit=50&order_by=name,asc"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise};return{shared:n,merchants:a,getCountries:g,getCities:d,getUserHash:s,getCityFromLat:r,getRegionFromCity:l,getLocationsTrip:i,getCitiesRegion:c,getRegionsCountry:u,getCountry:p,getRegionName:function(e){for(region in o.regions){var t=o.regions[region];if(t.id==parseInt(e))return t.name}return null},isRegionsLoaded:function(){return!!o.regions},isCountriesLoaded:function(){return!!o.countries},getRegions:function(){return o.regions}}}])},function(e,t){angular.module("besafe").factory("MapService",["$q","$rootScope","LocationService",function(e,t,o){var n,r;t.map,t.iconpath="http://hoovert.com/images/icons",t.markers=[],t.polylines=[];var a,i=function(e,o){var n=new google.maps.LatLng(e,o);r={center:n,zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP},document.getElementById("map")&&(t.map=new google.maps.Map(document.getElementById("map"),r),a=new google.maps.InfoWindow,t.geocoder=new google.maps.Geocoder,t.mapActive=!0,t.mapLoaded=!0,t.tracking=!0,t.mapSemaphore=!0)},s=function(e){damap=t.map,console.log("info received in marker"),console.log(JSON.stringify(e));var o="";"still"==e.activity?(o="masculine-avatar.svg",console.log("entro still")):"on_foot"==e.activity?(console.log("entro on foot"),o="pedestrian-walking.svg"):"in_vehicle"==e.activity?o="car-front.svg":"on_bicycle"==e.activity?o="cycling.svg":"running"==e.activity?o="running.svg":""==e.activity&&(console.log("entro blank"),o="map-pin.svg");var n=new google.maps.Marker({id:e.id,user_id:e.user_id,position:new google.maps.LatLng(e.lat,e["long"]),map:damap,animation:google.maps.Animation.DROP,report_time:e.report_time,speed:e.speed,activity:e.activity,battery:e.battery,name:e.name,status:e.status,islast:e.islast,icon:{fillColor:"#ffffff",url:t.iconpath+"/"+o,fillOpacity:1,strokeColor:"#ffffff",strokeWeight:0,scaledSize:new google.maps.Size(35,35)}});return n.content='<div class="infoWindowContent">'+e.id+" "+e.name+"</div>",google.maps.event.addListener(n,"click",function(){a.setContent("<h2>"+n.report_time+"</h2>"+n.content),a.open(t.map,n)}),n},c=function(e,o,n){damap=t.map,console.log("info received in marker");var r=new google.maps.Marker({position:new google.maps.LatLng(e,o),map:damap,animation:google.maps.Animation.DROP,draggable:!0});return google.maps.event.addListener(r,"dragend",function(){var e=r.getPosition();y(e.lat(),e.lng()),A(e.lat(),e.lng(),1)}),n&&google.maps.event.trigger(r,"dragend"),t.locationMarker=r,r},d=function(e){damap=t.map;var o=new google.maps.Marker({id:e.id,position:new google.maps.LatLng(e.lat,e["long"]),map:damap,animation:google.maps.Animation.DROP,created_at:e.created_at,name:e.name});return o.content='<div class="infoWindowContent">'+e.id+" "+e.name+"</div>",google.maps.event.addListener(o,"click",function(){a.setContent("<h2>"+o.created_at+"</h2>"+o.content),a.open(t.map,o)}),o},l=function(e){damap=t.map,console.log("creating stop",e);var o=new google.maps.Marker({id:e.id,icon:e.icon,position:new google.maps.LatLng(e.lat,e["long"]),map:damap,animation:google.maps.Animation.DROP,name:e.name});return o.content='<div class="infoWindowContent">'+e.id+" "+e.name+"</div>",google.maps.event.addListener(o,"click",function(){a.setContent("<h2>"+o.created_at+"</h2>"+o.content),a.open(t.map,o)}),o},u=function(e,o){damap=t.map,console.log("createRoute",e);var n=e.stopsLat,r=new google.maps.Polyline({path:n,geodesic:!0,strokeColor:o,strokeOpacity:1,strokeWeight:2});return r.setMap(damap),r},p=function(){var e=["#FF0000","#800000","#FFFF00","#808000","#00FF00","#008000","#00FFFF","#008080","#0000FF","#000080","#FF00FF","#800080"],t=Math.round(Math.random()*(e.length-1));return e[t]},g=function(e,o){damap=t.map,console.log("createRoute",e);var n=JSON.parse(e.coverage),r=new google.maps.Polygon({id:e.id,paths:n,strokeColor:o,strokeOpacity:.8,editable:!0,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,draggable:!0,geodesic:!0});return r.setMap(damap),r.getPaths().forEach(function(o,n){google.maps.event.addListener(o,"insert_at",function(){console.log("zzinsert_at",e.id),t.$broadcast("zone-updated",e),e.isActive=!0}),google.maps.event.addListener(o,"remove_at",function(){console.log("zzinsert_at",e.id),t.$broadcast("zone-updated",e),e.isActive=!0}),google.maps.event.addListener(o,"set_at",function(){console.log("zzinsert_at",e.id),t.$broadcast("zone-updated",e)})}),google.maps.event.addListener(r,"dragend",function(){console.log("set_at.",r.id)}),r},f=function(e,o){if(console.log("Updating locations"),t.mapActive&&(console.log("Map Active"),t.mapSemaphore)){console.log("rootscope mapsemaphore true"),t.mapSemaphore=!1;var n="?page="+o+"&hash_id="+e;P(n,e)}},m=function(e){for(marker in t.markers)t.markers[marker]?t.markers[marker].user_id==e&&(t.markers[marker].setMap(null),t.markers.splice(marker,1)):t.markers.splice(marker,1)},h=function(e){for(polyline in t.polylines)if(t.polylines[polyline].user_id==e)return t.polylines[polyline];return null},v=function(e){console.log("add user to polyline"),t.mapLoaded||(t.mapLoaded=!0,i(e.lat,e["long"]));var o=new google.maps.LatLng(e.lat,e["long"]),n=h(e.user_id);if(n){m(e.user_id),console.log("pos added to existing poly");var r=n.getPath();r.push(o),"emergency"==e.status&&(n.status="emergency")}else{n=new google.maps.Polyline({strokeColor:"#000000",strokeOpacity:1,strokeWeight:3,user_id:e.user_id,name:e.name,status:e.status,visible:!0,isActive:!1});var r=n.getPath();r.push(o),n.setMap(t.map),console.log("new poly created and pos added: "+n.user_id),t.polylines.push(n)}e.owner_type="user",y(e.lat,e["long"]);var a=s(e);t.activeMarker=a,t.markers.push(a)},y=function(e,o){console.log("Setting map center"),n=new google.maps.LatLng(e,o),t.map&&(t.map.setZoom(15),t.map.setCenter(n))},_=function(e){for(target in e)e[target].id&&b(e[target])},b=function(e){console.log("Checking database for location: "+e.id),t.activeMarker?e.id>t.activeMarker.id&&(e.status=!0,console.log("Location exists: "),v(e)):v(e)},S=function(){t.map.addListener("dblclick",function(e){var o=e.latLng;t.locationMarker.setPosition(o),google.maps.event.trigger(t.locationMarker,"dragend"),y(o.lat(),o.lng()),A(o.lat(),o.lng(),1)}),t.map.addListener("click",function(e){var o=e.latLng;t.locationMarker.setPosition(o),google.maps.event.trigger(t.locationMarker,"dragend"),y(o.lat(),o.lng()),A(o.lat(),o.lng(),1)})},C=function(e){var t="";try{t=e[0].formatted_address}catch(o){}return t},w=function(e){if(e.length>0){var t,o=e[0],n=!1,r=0,a=o.address_components,i="";do{t=a[r];for(var s in t.types)"postal_code"==t.types[s]&&(i=t.long_name,n=!0);r++,r>=e.length&&(n=!0)}while(0==n);return console.log("decodePostalFromLatResult",i),i}},k=function(e){if(e.length>0){var t,o=e[0],n=!1,r=0,a=o.address_components,i="";do{t=a[r];for(var s in t.types)"administrative_area_level_1"==t.types[s]&&(i=t.long_name,n=!0);r++,r>=e.length&&(n=!0)}while(0==n);return console.log("decodeCityFromLatResult",i),i}},A=function(e,n,r){var a=this;M(e,n).then(function(i){if(console.log("Address from lat",i),i){var s=k(i),c="name="+s;console.log("Address where",c),o.getCities(c).then(function(o){if(console.log("Address data",o),o.total>0){var r=o.data,a=r[0];t.isActive=!1;var s={address:C(i),postal:w(i),lat:e,"long":n,city_id:a.id,region_id:a.region_id,country_id:1};t.shippingAddress?(t.shippingAddress.address=C(i),t.shippingAddress.postal=w(i),t.shippingAddress.lat=e,t.shippingAddress["long"]=n,t.shippingAddress.city_id=a.id,t.shippingAddress.region_id=a.region_id,t.shippingAddress.country_id=1):t.shippingAddress=s}else{var c={address:C(i),postal:w(i),lat:e,"long":n,country_id:1};t.shippingAddress?(t.shippingAddress.address=C(i),t.shippingAddress.postal=w(i),t.shippingAddress.lat=e,t.shippingAddress["long"]=n,t.shippingAddress.country_id=1):t.shippingAddress=c}},function(o){console.log(o);var r={address:C(i),postal:w(i),lat:e,"long":n,country_id:1};t.shippingAddress=r})}else if(console.log("Attempts",r),r<8){r++;var d=a;setTimeout(function(){d.getAddressAndPostal(e,n,r)},1e3)}})["catch"](function(e){console.log("Error getting location",e)})},M=function(o,n){var r=e.defer(),a={lat:parseFloat(o),lng:parseFloat(n)};return t.geocoder.geocode({location:a},function(e,t){"OK"===t?e[0]?r.resolve(e):r.resolve([]):window.alert("Geocoder failed due to: "+t)}),r.promise},P=function(e,n){o.shared(e).then(function(e){if(0==e.total)t.isActive=!1,alert("User has no active locations");else{var o=e.data;if(_(o),e.page<e.last_page){var r=e.page+1,a="?page="+r+"&hash_id="+n;P(a,n)}else t.mapSemaphore=!0,setTimeout(function(){console.log("Timeout Triggered"),f(n,e.page)},t.sharedTimeout)}},function(e){console.log(e)})};return{updateLocations:f,createMap:i,postMapLocation:S,createStop:l,createRoute:u,createLocationMarker:c,getColor:p,getAddressAndPostal:A,createPolygon:g,createReport:d}}])},function(e,t){angular.module("besafe").factory("MapDashService",["$q","$rootScope","LocationService",function(e,t,o){var n,r;t.map,t.iconpath="http://hoovert.com/images/icons",t.meicon="wasp.svg",t.markers=[],t.polylines=[];var a,s=function(e){var o=(t.markers.length,12),n=new google.maps.LatLng(4.704296,(-74.073775));r={center:n,zoom:o,mapTypeId:google.maps.MapTypeId.ROADMAP};var i=new google.maps.Map(document.getElementById(e),r);return a=new google.maps.InfoWindow,"map"==e&&(t.mapActive=!0,t.mapLoaded=!0,t.mapSemaphore=!0),i},c=function(e,o){console.log("Setting map center"),n=new google.maps.LatLng(e,o),t.map&&(t.map.setZoom(15),t.map.setCenter(n))},d=function(){return t.markers},l=function(e){for(marker in t.markers){var o=t.markers[marker];if(o.user_id==parseInt(e))return o}return null},u=function(e){for(polyline in t.polylines)if(t.polylines[polyline].user_id==e)return t.polylines[polyline];return null},p=function(e){for(polyline in t.polylines)if(t.polylines[polyline].user_id==e)return t.polylines[polyline];return null},g=function(e){if(console.log("add user to polyline"),P(e.user_id),"1"==e.islast)w(e.user_id);else{var o=new google.maps.LatLng(e.lat,e["long"]),n=u(e.user_id);if(n){O(e.user_id),console.log("pos added to existing poly");var r=n.getPath();r.push(o),"emergency"==e.status&&(n.status="emergency")}else{n=new google.maps.Polyline({strokeColor:"#000000",strokeOpacity:1,strokeWeight:3,user_id:e.user_id,name:e.name,status:e.status,visible:t.rootMapMarkers,isActive:!1});var r=n.getPath();r.push(o),t.rootMapMarkers?n.setMap(t.map):n.setMap(null),console.log("new poly created and pos added: "+n.user_id),t.polylines.push(n)}e.owner_type="user",v(e);var a=T(e,t.rootMapMarkers);t.markers.push(a)}},f=function(e){for(polyline in t.polylines)t.polylines[polyline].setMap(t.map)},m=function(){for(marker in t.merchants)t.merchants[marker].setMap(t.map)},h=function(){for(marker in t.reports)t.reports[marker].setMap(t.map);console.log("Done showing reports")},v=function(e){console.log("Check active: "+e.owner_type),console.log(JSON.stringify(e)),console.log("Active type: "+t.mapActiveType+" id: "+t.mapId),t.mapActiveType||(t.mapActiveType=e.owner_type),t.mapId||(t.mapId=e.user_id),t.mapActiveType==e.owner_type&&(console.log("type the same mapid: "+t.mapId+" user: "+e.user_id),"me"==t.mapActiveType&&S("me",-1,null),t.mapId==e.user_id&&(console.log("Set center map, id the same"),c(e.lat,e["long"])))},y=function(e,n){var r={lat:e,"long":n,radius:t.radius};o.merchants(r).then(function(e){var t=e.merchants;console.log(JSON.stringify(e)),console.log("merchants received from server: "+t.length),0==t.length?alert("No tenemos informacion de puntos de seguridad en ese punto"):C(e)},function(e){console.log(e)})},_=function(e,o){t.rootMapMarkers=!1,J(e,o).then(function(e){console.log("locations in trip: "+o+" count: "+e.length),console.log(JSON.stringify(e)),e.length>0?q(e):alert("No encuentro ese viaje")},function(e){})},b=function(){t.map.addListener("dblclick",function(e){var t=e.latLng;c(t.lat(),t.lng()),y(t.lat(),t.lng())}),t.memarkerpending&&(console.log("me marker was created before map so loading now"),t.memarkerpending=!1,t.memarker.setMap(t.map)),t.merchantspending&&(console.log("merchants were created before map so loading now"),m(),h(),t.merchantspending=!1),S(t.mapActiveType,t.mapId,null),alert("doble click para encontrar puntos de seguridad")},S=function(e,o,n){if(console.log("Setting as active: "+o+" type: "+e),t.mapActiveType=e,t.mapId=o,window.localStorage.setItem("MAP_ACTIVE_TYPE",e),window.localStorage.setItem("MAP_ACTIVE_ID",o),n)c(n.lat(),n.lng());else{var r=!1;if("emergency"==e||"user"==e||"medical_emergency"==e||"me"==e)t.tracking=!0,t.rootMapMarkers=!0,k(t.mapId)&&(r=!0);else if("trip"==e){var a=t.contactTrip,i=t.contactIdTrip;_(i,a),r=!0}if(!r){var s=t.markers.length;if(s>0){var d=t.markers[s-1];if(d){var l=d.getPosition(),u=l.latLng;if(u)return S("user",d.user_id),!0}}}if(!r&&t.trackingActive)return"me"!=e&&S("me",-1),!0}},C=function(e){var o=e.merchants;for(merchant in o){var n=!1;for(marker in t.merchants)if(o[merchant].id==t.merchants[marker].id){n=!0;break}0==n&&t.merchants.push(F(o[merchant]))}var r=e.reports;for(report in r){var n=!1;for(marker in t.reports)if(r[report].id==t.reports[marker].id){n=!0;break}0==n&&(r[report].type="Report",t.reports.push(F(r[report])))}return null},w=function(e){for(polyline in t.polylines)t.polylines[polyline]&&(t.polylines[polyline].user_id=e)&&(O(t.polylines[polyline].user_id),t.polylines[polyline].setMap(null),t.polylines.splice(polyline,1))},k=function(e){if(e>0){for(marker in t.markers)if(t.markers[marker].user_id=e){var o=t.markers[marker].getPosition();return c(o.lat(),o.lng()),t.markers[marker].setMap(t.map),!0}}else if(t.memarker){var o=t.memarker.getPosition();return c(o.lat(),o.lng()),!0}return!1},A=function(e){for(polyline in t.polylines)t.polylines[polyline]&&t.polylines[polyline].setMap(null)},M=function(e){var o=!1;for(unknown in t.followingUnknown)t.followingUnknown[unknown]==e&&(o=!0);0==o&&t.followingUnknown.push(e)},P=function(e){for(unknown in t.followingUnknown)if(t.followingUnknown[unknown]==e)return console.log("Removing user: "+e+" from unknowns"),t.followingUnknown.splice(unknown,1),!0;return!1},$=function(){t.followingUnknown.length>0?(t.tracking=!0,t.mapSemaphore=!0,console.log("Unknown markers"),console.log(JSON.stringify(t.followingUnknown)),setTimeout(function(){console.log("Timeout Triggered unknowns"),B()},t.sharedTimeout)):(window.localStorage.setItem("USER_TRACKING",!1),console.log("No one is sharing location with user"),t.$broadcast("NoSharers"))},T=function(e,o){o&&t.map?damap=t.map:damap=null,console.log("info received in marker"),console.log(JSON.stringify(e));var n="";"still"==e.activity?(n="masculine-avatar.svg",console.log("entro still")):"on_foot"==e.activity?(console.log("entro on foot"),n="pedestrian-walking.svg"):"in_vehicle"==e.activity?n="car-front.svg":"on_bicycle"==e.activity?n="cycling.svg":"running"==e.activity?n="running.svg":""==e.activity&&(console.log("entro blank"),n="map-pin.svg"),console.log("Icon path marker"),console.log(t.iconpath+"/"+n);var r=new google.maps.Marker({id:e.id,user_id:e.user_id,position:new google.maps.LatLng(e.lat,e["long"]),map:damap,animation:google.maps.Animation.DROP,report_time:e.report_time,speed:e.speed,activity:e.activity,battery:e.battery,name:e.name,status:e.status,islast:e.islast,icon:{fillColor:"#ffffff",url:t.iconpath+"/"+n,fillOpacity:1,strokeColor:"#ffffff",strokeWeight:0,scaledSize:new google.maps.Size(35,35)}});if(r.content='<div class="infoWindowContent">'+e.id+" "+e.name+"<br/><a onClick=\"window.open('http://waze.to/?ll="+e.lat+","+e["long"]+"&navigate=yes','_system','location=yes');return false;\">Waze</a><br/><a href=\"tel:"+e.phone+'">'+e.phone+"</a></div>",google.maps.event.addListener(r,"click",function(){a.setContent("<h2>"+r.report_time+"</h2>"+r.content),a.open(t.map,r);var e=r.getPosition();S("user",r.user_id,e)}),"emergency"==e.status){var i=r.getPosition();S("emergency",e.user_id,i)}return r},F=function(e){t.map?damap=t.map:(damap=null,t.merchantspending=!0,console.log("Merchant pending from adding to map"));var o="";"police"==e.type?o="police-shield.svg":"medical"==e.type?o="medic-suitcase.svg":"Report"==e.type&&(o="pin.svg"),console.log("icon: "+t.iconpath+"/"+o+" for type: "+e.type);var n=new google.maps.Marker({id:e.id,position:new google.maps.LatLng(e.lat,e["long"]),map:damap,animation:google.maps.Animation.DROP,icon:{fillColor:"#ffffff",url:t.iconpath+"/"+o,fillOpacity:1,strokeColor:"#ffffff",strokeWeight:0,scaledSize:new google.maps.Size(25,25)}});n.content='<div class="infoWindowContent">'+e.type+'<br/><a class="button icon-left ion-ios7-telephone button-calm button-outline" href="tel:+ '+e.telephone+'">'+e.telephone+"</a><br/>"+e.address+"<br/><a onClick=\"window.open('http://waze.to/?ll="+e.lat+","+e["long"]+"&navigate=yes','_system','location=yes');return false;\">Waze</a></div>";var o="";"police"==e.type?o="map-icon-police":"medical"==e.type?o="map-icon-health":"Report"==e.type&&(o="map-icon-report",n.content='<div class="infoWindowContent">'+e.type+"<br/>"+e.address+"<br/><a onClick=\"window.open('http://waze.to/?ll="+e.lat+","+e["long"]+"&navigate=yes','_system','location=yes');return false;\">Waze</a></div>"),console.log("creating merchant");var r=new google.maps.InfoWindow;return google.maps.event.addListener(n,"click",function(){r.setContent("<h2>"+e.name+"</h2>"+n.content),r.open(t.map,n)}),n},I=function(o){var n=e.defer(),r=0;for(target in o)o[target].id&&(r++,t.lastLocation<o[target].id&&(t.lastLocation=o[target].id),V(o[target]).then(function(e){r--,0==r&&n.resolve("done")},function(e){console.log("Error in checking locations"),console.error(JSON.stringify(e)),r--,0==r&&n.resolve("done")}));return n.promise},O=function(e){for(marker in t.markers)t.markers[marker]?t.markers[marker].user_id==e&&(t.markers[marker].setMap(null),t.markers.splice(marker,1)):t.markers.splice(marker,1)},D=function(){L(t.markers),A()},L=function(e){for(marker in e)e[marker]&&e[marker].setMap(null)},j=function(){if(t.tempMarkers){for(marker in t.tempMarkers)t.tempMarkers[marker]&&t.tempMarkers[marker].setMap(null);t.tempMarkers=[]}t.tempPolyline&&(t.tempPolyline.setMap(null),t.tempPolyline=null)},R=function(){E(t.markers),f()},E=function(e){for(marker in e)e[marker]&&e[marker].setMap(t.map)},x=function(e){for(marker in e)e[marker]?(console.log("id: "+e[marker].id),console.log("speed: "+e[marker].speed),console.log("activity: "+e[marker].activity),console.log("battery: "+e[marker].battery),console.log("lat: "+e[marker].lat),console.log("long: "+e[marker]["long"]),console.log("name: "+e[marker].name),console.log("trip: "+e[marker].trip),console.log("type: "+e[marker].type),console.log("user_id: "+e[marker].user_id),console.log("report_time: "+e[marker].report_time)):(console.log("Marker is null: "+marker),console.log(e[marker]))},N=function(e){console.log(t.markers.length);for(marker in t.markers)if(console.log("Comparing markers"),t.markers[marker]){if(console.log(t.markers[marker].id),console.log(e),t.markers[marker].id==e)return console.log("Marker found, returning now"),t.markers[marker]}else t.markers.splice(marker,1);return null},V=function(o){var n=e.defer();console.log("Checking database for location: "+o.id);var r=!1;for(item in t.markers)t.markers[item].id==o.id&&(r=!0);if(r){o.status=!0,console.log("Location exists: ");var a=l(o.user_id);a?(console.log("User Marker Found"),a.id>=o.id?console.log("User Marker older"):(console.log("User Marker newer"),g(o))):(console.log("Marker does not exist"),g(o)),n.resolve(o)}else o.status=!0,console.log("Location does not exists"),g(o);return n.promise},G=function(e,t,o){console.log("Trying sql contactTrips not implemented yet")},U=function(e){console.log("Trying sql user trips not implemented yet")},q=function(e){var o,n=[];t.tempMarkers&&L(t.tempMarkers),t.tempMarkers=[],console.log("Showing markers: "+e.length),console.log(JSON.stringify(e));var r,a,s;for(i=0;i<e.length;i++)e[i]&&(r=new google.maps.LatLng(e[i].lat,e[i]["long"]),console.log("Showing marker: "),a=e[i].trip,s=e[i].user_id,marker=T(e[i],!0),t.tempMarkers.push(marker),n.push(r),o=e[i]);t.contactIdTrip=s,t.contactTrip=a,c(r.lat(),r.lng());var d=new google.maps.Polyline({path:n,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2,user_id:o.user_id,name:o.name,status:"closed"});t.tempPolyline&&(t.tempPolyline.setMap(null),t.tempPolyline=null),d.setMap(t.map),t.tempPolyline=d},J=function(e,t){console.log("contact trip locations not implemented at present: "+e+" trip: "+t)},B=function(){if(console.log("Updating locations"),t.tracking)if(console.log("rootscope tracking true"),t.mapSemaphore){console.log("rootscope mapsemaphore true"),t.mapSemaphore=!1;var e=t.lastLocation,o=1,n="?page="+o+"&id_after="+e;H(n,e)}else $();else $()},z=function(e){console.log("saveTrip: "),console.log(JSON.stringify(e)),o.getLocationsTrip(e).then(function(o){var n=o.data;if(console.log("Locations received from server: "+n.length),console.log(JSON.stringify(n)),I(n),o.page<o.last_page){if(4==o.page)return void t.$broadcast("receivedTripDetail",{
trigger_id:e.user_id});e.page=o.page+1,z(e)}else t.$broadcast("receivedTripDetail",{trigger_id:e.user_id})},function(e){console.log(e)})},H=function(e,n){o.shared(e).then(function(e){if(0==e.total)$();else{var o=e.data;if(o.reverse(),I(o).then(function(e){t.mapSharedLoaded=!0},function(e){console.log(e)}),e.page<e.last_page){var r=e.page+1,a="?page="+r+"&id_after="+n;H(a,n)}else t.mapSemaphore=!0,setTimeout(function(){console.log("Timeout Triggered"),B()},t.sharedTimeout)}},function(e){console.log(e)})};return{createMarker:T,clearTemps:j,createMap:s,getNearbyMerchants:y,contactTripsCount:U,deleteUserObjects:w,deleteUserMarkers:O,getUserPolyline:p,saveTrip:z,checkMarkers:I,contactTripLocations:J,contactTrips:G,consoleLogMarkers:x,getMarker:N,hideAllActiveMarkers:D,hideMarkers:L,showAllActiveMarkers:R,showMarkers:E,updateLocations:B,getMarkers:d,getUserMarker:l,displayTrip:q,addToUnknowns:M,removeFromUnknowns:P,setActive:S,checkActive:v,postMap:b}}])},function(e,t){angular.module("besafe").service("Merchants",["$q","$http",function(e,t){var o=function(o){var n="/api/merchants";o&&(n=n+"?"+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get merchants")}),r.promise},n=function(o){var n="/api/user/merchants";o&&(n=n+"?"+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get merchants")}),r.promise},r=function(o){var n="/api/reports";o&&(n=n+"?"+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get merchants")}),r.promise},a=function(o){var n="/api/private/merchants/coverage",r=e.defer();return t({method:"get",url:n,params:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get merchants")}),r.promise},i=function(o){var n="/api/private/merchants/nearby",r=e.defer();return t({method:"get",url:n,params:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get merchants")}),r.promise},s=function(o){var n="/api/private/reports/nearby",r=e.defer();return t({method:"get",url:n,params:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get merchants")}),r.promise},c=function(o){var n="/api/merchants";o&&(n=n+"?"+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get merchants")}),r.promise},d=function(o){var n="/api/admin/merchant/orders",r=e.defer();return t({method:"POST",url:n,data:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getStoreExport")}),r.promise},l=function(o){var n="/api/admin/merchant/content",r=e.defer();return t({method:"POST",url:n,data:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getStoreExport")}),r.promise},u=function(o){var n="/api/merchants/search";o&&(n=n+"?search="+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get merchants")}),r.promise},p=function(o){var n=e.defer(),r="/api/merchants",a="POST";if(o.id)var r="/api/merchants/"+o.id,a="PATCH";return t({method:a,url:r,data:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to save/create merchant")}),n.promise},g=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/merchants/"+o}).success(function(e){console.log(e),n.resolve(e)}).error(function(){n.reject("Failed to Delete Merchant")}),n.promise};return{getMerchants:o,getMerchantsNearby:i,getReportsNearby:s,getMerchantsUser:n,getReports:r,getMerchantsCoverage:a,getMerchantsPrivate:c,saveMerchant:p,getStoreContent:l,getStoreExport:d,searchMerchants:u,deleteMerchant:g}}])},function(e,t){angular.module("besafe").service("Modals",["$mdToast","$mdDialog",function(e,t){function o(){var e=u;e.bottom&&l.top&&(e.top=!1),e.top&&l.bottom&&(e.bottom=!1),e.right&&l.left&&(e.left=!1),e.left&&l.right&&(e.right=!1),l=angular.extend({},e)}var n=function(){return{controller:["$scope","$mdDialog","Addresses","$rootScope",function(e,t,o,n){e.addresses=[],e.getAddresses=function(){n.addresses&&n.addresses.length>0?e.addresses=n.addresses:o.getAddresses().then(function(t){e.addresses=t.addresses},function(e){})},e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.selectAddress=function(e){t.hide(e)},e.getAddresses()}],templateUrl:"/templates/addressList.html",parent:angular.element(document.body),clickOutsideToClose:!0}},r=function(){return{controller:["$scope","$mdDialog","Addresses","$rootScope",function(e,t,o,n){e.addresses=[],e.selectPlatform=function(e){t.hide(e)},e.hide=function(){t.hide()},e.cancel=function(){t.cancel()}}],templateUrl:"/templates/mobileApp.html",parent:angular.element(document.body),clickOutsideToClose:!0}},a=function(e){return{controller:["$scope","$mdDialog","Merchants","$rootScope",function(t,o,n,r){t.merchants=[],t.getMerchants=function(){var o=null;o=e?{lat:r.shippingAddress.lat,"long":r.shippingAddress["long"],category:e}:{lat:r.shippingAddress.lat,"long":r.shippingAddress["long"]},n.getMerchantsCoverage(o).then(function(e){t.merchants=e.data},function(e){})},t.hide=function(){o.hide()},t.cancel=function(){o.cancel()},t.selectMerchant=function(e){o.hide(e)},t.getMerchants()}],templateUrl:"/templates/merchantsList.html",parent:angular.element(document.body),clickOutsideToClose:!0}},i=function(e){return{controller:["$scope","$mdDialog","Merchants","$rootScope",function(t,o){t.questions=e,t.hide=function(){o.hide()},t.cancel=function(){o.cancel()},t.checkValue=function(e){console.log("Checking: ",e)},t.save=function(){o.hide(t.questions)}}],templateUrl:"/templates/questionaire.html",parent:angular.element(document.body),clickOutsideToClose:!0}},s=function(){return{controller:["$scope","$mdDialog",function(e,t){e.answer=function(e){t.hide(e)},e.cancel=function(){t.cancel()},e.hide=function(){t.hide()}}],templateUrl:"/templates/locationPrompt.html",parent:angular.element(document.body),clickOutsideToClose:!0}},c=function(){return{controller:["$scope","$mdDialog",function(e,t){e.answer=function(e){t.hide(e)},e.cancel=function(){t.cancel()},e.hide=function(){t.hide()}}],templateUrl:"/templates/locationExtPrompt.html",parent:angular.element(document.body),clickOutsideToClose:!0}},d=function(t,o){"CLEAR_CART"==t&&(t="Debes vaciar tu carro para esa compra");var n=p(),r=e.simple().textContent(t).position(n).hideDelay(3e3);o&&(r=e.simple().textContent(t).position(n).parent(o).hideDelay(3e3)),e.show(r)},l={bottom:!1,top:!0,left:!1,right:!0},u=angular.extend({},l),p=function(){return o(),Object.keys(u).filter(function(e){return u[e]}).join(" ")},g=function(){t.show({controller:function(){},template:'<md-dialog style="background-color:transparent;box-shadow:none"><div layout="row" layout-sm="column" layout-align="center center" aria-label="wait" style="overflow:hidden"><md-progress-circular md-mode="indeterminate" ></md-progress-circular></div></md-dialog>',parent:angular.element(document.body),clickOutsideToClose:!0,fullscreen:!1}).then(function(e){})},f=function(){t.hide().then(function(e){})},m=function(e,t){t.includes("?")&&(t=t.split("?")[0]);var o=!0;for(var n in e)e.hasOwnProperty(n)&&(o?(t+="?"+n+"="+e[n],o=!1):t+="&"+n+"="+e[n]);return t};return getAllUrlParams=function(e){var t=e?e.split("?")[1]:window.location.search.slice(1),o={};if(t){t=t.split("#")[0];for(var n=t.split("&"),r=0;r<n.length;r++){var a=n[r].split("="),i=a[0],s="undefined"==typeof a[1]||a[1];if(i=i.toLowerCase(),"string"==typeof s&&(s=s.toLowerCase()),i.match(/\[(\d+)?\]$/)){var c=i.replace(/\[(\d+)?\]/,"");if(o[c]||(o[c]=[]),i.match(/\[\d+\]$/)){var d=/\[(\d+)\]/.exec(i)[1];o[c][d]=s}else o[c].push(s)}else o[i]?o[i]&&"string"==typeof o[i]?(o[i]=[o[i]],o[i].push(s)):o[i].push(s):o[i]=s}}return o},{getAddressesPopup:n,getLocationPrompt:s,getLocationExtPrompt:c,getMerchantsPopup:a,getQuestionairePopup:i,showToast:d,getAppPopup:r,showLoader:g,turnObjectToUrl:m,hideLoader:f,getAllUrlParams:getAllUrlParams}}])},function(e,t){angular.module("besafe").service("Orders",["$q","$http",function(e,t){var o=function(o){var n="/api/orders";o&&(n=n+"?"+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get orders")}),r.promise},n=function(o,n){var r="/api/store/reports",a=e.defer();return console.log("getStoreExport",o,n),t({method:"POST",url:r,data:{from:o,to:n}}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to getStoreExport")}),a.promise},r=function(o){var n=e.defer();return t({method:"POST",url:"/api/orders/"+o+"/approve",data:{}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to approveOrder")}),n.promise},a=function(o,n){var r=e.defer();return t({method:"POST",url:"/api/orders/"+n+"/build",data:{status:o}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to updateOrderStatus")}),r.promise},i=function(o){console.log("Setting order address: ",o);var n=e.defer();return t({method:"POST",url:"/api/orders/shipping",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to setShippingAddress")}),n.promise},s=function(o,n){var r=e.defer();return t({method:"POST",url:"/api/orders/platform/shipping/"+o+"/"+n,data:{}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to setPlatformShippingCondition")}),r.promise},c=function(o,n){var r=e.defer();return t({method:"GET",url:"/api/orders/platform/shipping/"+o+"/"+n,data:{}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to updateOrderStatus")}),r.promise},d=function(o,n){var r=e.defer();return t({method:"POST",url:"/api/orders/prepare/"+n,data:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to prepareOrder")}),r.promise},l=function(o,n){var r=e.defer();return t({method:"POST",url:"/api/orders/discounts/"+n+"/"+o,data:{}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to setDiscounts")}),r.promise},u=function(o){var n=e.defer();return t({method:"POST",url:"/api/orders/coupon",data:{coupon:o}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to setCoupon")}),n.promise},p=function(o,n){var r=e.defer();return t({method:"POST",url:"/api/orders/check/"+o,data:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to checkOrder")}),r.promise},g=function(){var o=e.defer();return t({method:"GET",url:"/api/orders/active"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to getOrder")}),o.promise};return{getOrders:o,getOrder:g,checkOrder:p,approveOrder:r,setShippingAddress:i,prepareOrder:d,setPlatformShippingCondition:s,getPlatformShippingPrice:c,setDiscounts:l,setCoupon:u,getStoreExport:n,updateOrderStatus:a}}])},function(e,t){angular.module("besafe").service("Passport",["$q","$http",function(e,t){var o=function(){var o=e.defer();return t({method:"GET",url:"/oauth/clients"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get clients")}),o.promise},n=function(o){var n=e.defer();return t({method:"POST",url:"/oauth/clients",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to create client")}),n.promise},r=function(o,n){var r=e.defer();return t({method:"PUT",url:"/oauth/clients/"+n,data:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to update client")}),r.promise},a=function(o){var n=e.defer();return t({method:"DELETE",url:"/oauth/clients/"+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to delete client")}),n.promise},i=function(){var o=e.defer();return t({method:"get",url:"/oauth/scopes"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},s=function(){var o=e.defer();return t({method:"get",url:"/oauth/personal-access-tokens"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},c=function(o){var n=e.defer();return t({method:"POST",url:"/oauth/personal-access-tokens",data:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to create client")}),n.promise},d=function(o){var n=e.defer();return t({method:"DELETE",url:"/oauth/personal-access-tokens/"+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to delete client")}),n.promise},l=function(){var o=e.defer();return t({method:"get",url:"/api/user/authtokens"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},u=function(o){var n=e.defer();return t({method:"DELETE",url:"/oauth/tokens/"+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to delete client")}),n.promise};return{getOauthClients:o,createOauthClient:n,updateOauthClient:r,deleteOauthClient:a,getScopes:i,getPersonalAccessTokens:s,deletePersonalAccessTokens:d,getTokens:l,deleteTokens:u,createPersonalAccessToken:c}}])},function(e,t){angular.module("besafe").service("Payments",["$q","$http",function(e,t){var o=function(o){var n="/api/payments";o&&(n=n+"?"+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get payments")}),r.promise},n=function(o){var n="/api/billing/payments";o&&(n=n+"?"+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get payments")}),r.promise},r=function(o){var n=e.defer();return t({method:"POST",url:"/api/payments/"+o+"/approve",data:{}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to approvePayment")}),n.promise},a=function(o){var n=e.defer();return t({method:"POST",url:"/api/billing/retry/"+o,data:{}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to retryPayment")}),n.promise},i=function(o){var n=e.defer();return t({method:"POST",url:"/api/billing/add_transaction_costs/"+o,data:{}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to addTransactionCosts")}),n.promise};return{getPayments:o,getPaymentsUser:n,retryPayment:a,addTransactionCosts:i,approvePayment:r}}])},function(e,t){angular.module("besafe").service("ProductImport",["$q","$http",function(e,t){var o=function(o){var n="/api/admin/store/products";o&&(n=n+"?"+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getProducts")}),r.promise},n=function(o){var n="/api/admin/store/variants";o&&(n=n+"?"+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getVariants")}),r.promise},r=function(o){var n="/api/admin/store/merchants";o&&(n=n+"?"+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getMerchants")}),r.promise},a=function(o){var n="/api/admin/store/categories";o&&(n=n+"?"+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getCategories")}),r.promise},i=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/admin/store/products/"+o.id}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to deleteProductItem")}),n.promise},s=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/admin/store/merchants/"+o.id}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to deleteMerchantItem")}),n.promise},c=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/admin/store/variants/"+o.id}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to deleteVariantItem")}),n.promise},d=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/admin/store/categories/"+o.id}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to deleteCategoryItem")}),n.promise};return{getProducts:o,getVariants:n,getMerchants:r,getCategories:a,deleteProductItem:i,deleteMerchantItem:s,deleteVariantItem:c,deleteCategoryItem:d}}])},function(e,t){angular.module("besafe").service("Products",["$q","$http",function(e,t){var o=function(o,n,r,a){var i=e.defer();return t({method:"post",url:"/api/cart/add",data:{product_variant_id:o,merchant_id:n,quantity:r,extras:a}}).success(function(e){i.resolve(e)}).error(function(){i.reject("Failed to get nearby")}),i.promise},n=function(o,n){var r=e.defer();return t({method:"post",url:"/api/cart/update",data:{item_id:o,quantity:n}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get nearby")}),r.promise},r=function(o){var n=e.defer();return t({method:"post",url:"/api/ratings",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to addRating")}),n.promise},a=function(o){var n=e.defer();return t({method:"post",url:"/api/favorites",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to addRating")}),n.promise},i=function(o){var n=e.defer();return t({method:"post",url:"/api/favorites/delete",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to addRating")}),n.promise},s=function(o){var n=e.defer();return t({method:"post",url:"/api/products/favorites",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to addRating")}),n.promise},c=function(){var o=e.defer();return t({method:"GET",url:"/api/cart/get"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},d=function(){var o=e.defer();return t({method:"GET",url:"/api/cart/checkout"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},l=function(o){var n=e.defer();return t({method:"GET",url:"/api/merchants/products",params:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to getProductsMerchant")}),n.promise},u=function(e,t){var o={};return o.id=e.product_id,o.name=e.prod_name,o.description=e.prod_desc,o.isActive=e.isActive,o.description_more=!1,o.more=!1,o.type=e.type,o.merchant_description_more=!1,t&&(o.merchant_name=t.merchant_name,o.merchant_id=t.merchant_id,o.merchant_description=t.merchant_description,o.merchant_attributes=t.merchant_attributes,o.src=t.merchant_icon,o.merchant_type=t.merchant_type),o.inCart=!1,e.is_on_sale?(o.onsale=!0,o.subtotal=o.price,o.exsubtotal=o.exprice):(o.subtotal=o.price,o.onsale=!1),o=v(e,o),o.item_id=null,o.amount=e.min_quantity,o.imgs=[],o.variants=[],o},p=function(e){var t={};return t.id=e.id,t.description=e.description,e.attributes.length>0?(t.attributes=JSON.parse(e.attributes),t.attributes.buyers?t.unitPrice=t.price/t.attributes.buyers:t.unitPrice=t.price):t.attributes="",e.is_on_sale?(t.exprice=e.price,t.price=e.sale):t.price=e.price,t.is_on_sale=e.is_on_sale,t.min_quantity=e.min_quantity,t},g=function(e,t){for(var o in t)if(t[o].id==e.category_id)return t[o];var n={name:e.category_name,id:e.category_id,description:e.category_description,products:[],more:!1};return t.push(n),n},f=function(e,t,o){for(var n in t)for(var r in t[n].products)if(t[n].products[r].id==e.product_id)return t[n].products[r];var a=u(e,o);return a},m=function(e){if(e.products_variants.length>0){for(var t=[],o=[],n=0;n<e.products_variants.length;n++)if(!o.includes(e.products_variants[n].id)){o.push(e.products_variants[n].id);var r=g(e.products_variants[n],t);console.log("Category found",r);var a=f(e.products_variants[n],t,e.merchant_products[0]);console.log("product found",a),h(a,r.products)||r.products.push(a);var i=p(e.products_variants[n]);i.price<a.price&&(a=v(i,a)),h(i,a.variants)||a.variants.push(i)}for(var s in e.products_files)for(var c=0;c<t.length;c++)for(var d in t[c].products){var l={};if(e.products_files[s].trigger_id==t[c].products[d].id){l.file=e.products_files[s].file,0==t[c].products[d].imgs.length&&(t[c].products[d].src=l.file),t[c].products[d].imgs.push(l);break}}return console.log("resultbuildCat",t),t}return null},h=function(e,t){var o;for(o in t)if(t[o].id==e.id)return!0;return!1},v=function(e,t){if(e.is_on_sale?(t.price=e.price,t.onsale=!0,t.exprice=e.exprice):(t.price=e.price,t.onsale=!1),t.variant_id=e.id,e.attributes){var o=e.attributes;o.buyers?(t.unitPrice=t.price/o.buyers,t.unitLunches=o.buyers):(t.unitPrice=t.price,t.unitLunches=1)}else t.unitPrice=t.price,t.unitLunches=1;return t},y=function(){var o=e.defer();return t({method:"post",url:"/api/cart/clear"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise};return{getCheckoutCart:d,getCart:c,addRating:r,deleteFavorite:i,checkFavorite:s,addFavorite:a,addCartItem:o,updateCartItem:n,getProductsMerchant:l,clearCart:y,buildProductInformation:m}}])},function(e,t){angular.module("besafe").service("Routes",["$q","$http",function(e,t){var o=function(o){var n="/api/routes";o&&(n=n+"?"+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get routes")}),r.promise},n=function(o){var n="/api/routes/"+o,r=e.defer();return t({method:"delete",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to deleteRoute")}),r.promise},r=function(o){var n="/api/stops/"+o,r=e.defer();return t({method:"delete",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to deleteStop")}),r.promise},a=function(o){var n=e.defer();return t({method:"POST",url:"/api/routes/"+o+"/build",data:{}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to buildRoute")}),n.promise},i=function(o,n){var r=e.defer();return t({method:"POST",url:"/api/routes/"+o+"/stop/"+n,data:{}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to updateRouteStops")}),r.promise},s=function(o,n,r){var a=e.defer();return t({method:"POST",url:"/api/routes/add_delivery",data:{route_id:o,delivery_id:n,stop_id:r}}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to updateRouteDelivery")}),a.promise},c=function(o){var n=e.defer();return t({method:"POST",url:"/api/routes/stop/"+o,data:{}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to sendStopToNewRoute")}),n.promise},d=function(o,n){var r=e.defer();return t({method:"POST",url:"/api/routes/"+o+"/return",data:{address_id:n}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to sendStopToNewRoute")}),r.promise};return{getRoutes:o,deleteStop:r,deleteRoute:n,sendStopToNewRoute:c,buildRoute:a,addReturnStop:d,updateRouteStop:i,updateRouteDelivery:s}}])},function(e,t){angular.module("besafe").service("Users",["$q","$http",function(e,t){var o=function(o){var n=e.defer();return t({method:"POST",url:"/user/billingAddress/"+o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},n=function(){var o=e.defer();return t({method:"get",url:"/api/addresses"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},r=function(o){var n=e.defer();return t({method:"POST",url:"/api/addresses",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},a=function(o){var n=e.defer();return t({method:"POST",url:"/api/user",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to create user")}),n.promise},i=function(o){var n=e.defer();return t({method:"POST",url:"/api/user/change_password",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to updatePassword")}),n.promise},s=function(){var o=e.defer();return t({method:"GET",url:"/api/user"}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get user")}),o.promise},c=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/addresses/"+o}).success(function(e){console.log(e),n.resolve(e)}).error(function(){n.reject("Failed to Delete Address")}),n.promise},d=function(o){var n="";o.length>0&&(n="?name=*"+o+"*");var r=e.defer();return t({method:"get",url:"/api/contacts"+n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get nearby")}),r.promise};return{setAsBillingAddress:o,getAddresses:n,saveAddress:r,deleteAddress:c,updatePassword:i,saveUser:a,getContacts:d,getUser:s}}])},function(e,t){angular.module("besafe").service("Zones",["$q","$http",function(e,t){var o=function(o){var n="/api/admin/zones";o&&(n=n+"?"+o);var r=e.defer();return t({method:"get",url:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get getArticles")}),r.promise},n=function(o){console.log("Updating zone item",o);var n=e.defer();return t({method:"PATCH",url:"/api/admin/zones/"+o.id,data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to updateZoneItem")}),n.promise},r=function(o){var n=e.defer();return t({method:"POST",url:"/api/admin/zones",data:o}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to createZoneItem")}),n.promise},a=function(o){var n=e.defer();return t({method:"DELETE",url:"/api/admin/zones/"+o.id}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to deleteZoneItem")}),n.promise};return{getZones:o,updateZoneItem:n,createZoneItem:r,deleteZoneItem:a}}])},function(e,t,o){o(0),o(1),o(26),o(16),o(21),o(8),o(9),o(2),o(25),o(24),o(3),o(23),o(19),o(11),o(20),o(14),o(17),o(18),o(22),o(15),o(10),o(6),o(7),o(5),o(4),o(12),o(13),o(27),o(28),o(37),o(39),o(32),o(31),o(40),o(38),o(47),o(36),o(45),o(30),o(42),o(34),o(29),o(46),o(43),o(41),o(44),o(33),o(48),e.exports=o(35)}]);