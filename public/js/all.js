!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,t,n){Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=45)}([function(e,t){"use strict";var n=angular.module("besafe",["besafe.constants","ngCookies"]);n.config(function(){}).run(["$http",function(e){e.defaults.headers.common.Accept="application/json"}])},function(e,t){angular.module("besafe.constants",[]).constant("API",{address:"http://lonchis.com.co/api",website:"http://lonchis.com.co",avatar:"http://lonchis.com.co/avatars/avatar.jpg"})},function(e,t){angular.module("besafe").controller("PersonalTokensCtrl",["$scope","Passport","$rootScope",function(e,t,n){e.data={},e.data.scopes=[],e.personalAccessTokens,e.showForm=!1,e.showToken=!1,angular.element(document).ready(function(){e.getPersonalAccessTokens()}),e.save=function(o){e.submitted=!0,o&&(e.data.scopes=[""],t.createPersonalAccessToken($.param(e.data)).then(function(t){e.token=t.accessToken,e.personalAccessTokens.push(t.token),n.$broadcast("getTokens"),e.data={},e.data.scopes=[],e.submitted=!1,e.showToken=!0,e.showForm=!1},function(e){}))},e.getPersonalAccessTokens=function(){t.getPersonalAccessTokens().then(function(t){e.personalAccessTokens=t},function(e){}),t.getScopes().then(function(t){e.scopes=t},function(e){})},e.deletePersonalToken=function(n){t.deletePersonalAccessTokens(n).then(function(){for(item in e.personalAccessTokens)e.personalAccessTokens[item].id==n&&e.personalAccessTokens.splice(item,1)},function(e){})},e.clean=function(){e.data={}},e.newPersonalAccessToken=function(){e.showForm=!0,e.showToken=!1}}]).controller("OauthClientsCtrl",["$scope","Passport","Users",function(e,t,n){e.data={},e.oauthClients,e.showForm=!1,angular.element(document).ready(function(){e.getOauthClients()}),e.save=function(n){e.submitted=!0,n&&(e.data.id?t.updateOauthClient($.param(e.data),e.data.id).then(function(t){e.updateOauthClient(t),e.showForm=!1,e.data={},e.submitted=!1},function(e){}):t.createOauthClient($.param(e.data)).then(function(t){e.oauthClients.push(t),e.showForm=!1,e.data={},e.submitted=!1},function(e){}))},e.updateOauthClient=function(t){for(item in e.oauthClients)e.oauthClients[item].id==t.id&&(e.oauthClients.splice(item,1),e.oauthClients.push(t))},e.getOauthClients=function(){t.getOauthClients().then(function(t){e.oauthClients=t},function(e){})},e.newOauthClient=function(){e.showForm=!0},e.editOauthClient=function(t){e.showForm=!0,e.data.id=angular.element(document.querySelector("tr#oauthClient-"+t+" span.id")).html(),e.data.name=angular.element(document.querySelector("tr#oauthClient-"+t+" span.name")).html(),e.data.redirect=angular.element(document.querySelector("tr#oauthClient-"+t+" span.redirect")).html()},e.deleteOauthClient=function(n){t.deleteOauthClient(n).then(function(t){for(item in e.oauthClients)e.oauthClients[item].id==n&&(console.log("deleting oauthClient",e.oauthClients[item]),e.oauthClients.splice(item,1))},function(e){})},e.clean=function(){e.data={}}}]).controller("TokensCtrl",["$scope","Passport","$rootScope",function(e,t,n){e.tokens,angular.element(document).ready(function(){e.getTokens()}),n.$on("getTokens",function(t,n){e.getTokens()}),e.getTokens=function(){t.getTokens().then(function(t){e.tokens=t},function(e){})},e.deleteToken=function(n){t.deleteTokens(n).then(function(){for(item in e.tokens)e.tokens[item].id==n&&e.tokens.splice(item,1)},function(e){})}}])},function(e,t){angular.module("besafe").controller("AddressesCtrl",["$scope","LocationService","Addresses",function(e,t,n){e.data={},e.addresses,e.regionVisible=!1,e.editAddress=!1,angular.element(document).ready(function(){e.getAddresses();var n="";t.getCountries(n).then(function(t){e.countries=t.data},function(e){})}),e.save=function(t){if(e.submitted=!0,t){var o=!1;e.data.address_id&&(o=!0),n.saveAddress($.param(e.data)).then(function(t){o?e.updateAddress(t.address):e.addresses.push(t.address),e.data={},e.submitted=!1,e.editAddress=!1},function(e){})}},e.getAddresses=function(){n.getAddresses().then(function(t){e.addresses=t.addresses},function(e){})},e.deleteAddress=function(t){n.deleteAddress(t).then(function(n){t=""+t;for(item in e.addresses)e.addresses[item].address_id==t&&(console.log("deleting address",e.addresses[item]),e.addresses.splice(item,1))},function(e){})},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.updateAddress=function(t){for(item in e.addresses)e.addresses[item].address_id==t.address_id&&(e.addresses.splice(item,1),e.addresses.push(t))},e.selectCountry=function(){for(item in e.countries)e.countries[item].id==e.data.country_id&&(e.data.country=e.countries[item].country_iso);t.getRegionsCountry(e.data.country_id).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1},function(e){})},e.selectRegion=function(){for(item in e.regions)e.countries[item].id==e.data.region_id&&(e.data.region=e.countries[item].name)},e.selectPlace=function(n,o){e.data.country_id=n;for(item in e.countries)e.countries[item].id==e.data.country_id&&(e.data.country=e.countries[item].country_iso);t.getRegionsCountry(n).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1,e.data.region_id=o,e.selectRegion()},function(e){})},e.editAddress=function(t){e.editAddress=!0;for(item in e.addresses)e.addresses[item].id==t&&(e.data=e.addresses[item],e.data.address_id=t,e.selectPlace(e.data.country_id,e.data.region_id))}}])},function(e,t){angular.module("besafe").controller("AdminCategoriesCtrl",["$scope","ProductImport",function(e,t){e.data={},e.items=[],e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems()}),e.buildItemData=function(e){return e},e.getItems=function(){e.page++;var n="order_by=id,desc&page="+e.page;t.getCategories(n).then(function(t){t.page==t.last_page&&(e.loadMore=!1),console.log("Items",t.data);var n=t.data;for(item in n)n[item]=e.buildItemData(n[item]);e.items=e.items.concat(n)},function(e){})},e.updateItem=function(e){t.updateCategoryItem(e).then(function(e){},function(e){})},e.deleteItem=function(e){t.deleteCategoryItem(e).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("AdminMerchantsCtrl",["$scope","ProductImport",function(e,t){e.data={},e.items=[],e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems()}),e.buildItemData=function(e){return e},e.getItems=function(){e.page++;var n="order_by=id,desc&page="+e.page;t.getMerchants(n).then(function(t){t.page==t.last_page&&(e.loadMore=!1),console.log("Items",t.data);var n=t.data;for(item in n)n[item]=e.buildItemData(n[item]);e.items=e.items.concat(n)},function(e){})},e.updateItem=function(e){t.updateMerchantItem(e).then(function(e){},function(e){})},e.deleteItem=function(e){t.deleteMerchantItem(e).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("AdminProductsCtrl",["$scope","ProductImport",function(e,t){e.data={},e.items=[],e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems()}),e.buildItemData=function(e){return e},e.getItems=function(){e.page++;var n="order_by=id,desc&includes=productVariants,categories&page="+e.page;t.getProducts(n).then(function(t){t.page==t.last_page&&(e.loadMore=!1),console.log("Items",t.data);var n=t.data;for(item in n)n[item]=e.buildItemData(n[item]);e.items=e.items.concat(n)},function(e){})},e.updateItem=function(e){t.updateProductItem(e).then(function(e){},function(e){})},e.deleteItem=function(e){t.deleteProductItem(e).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("AdminVariantsCtrl",["$scope","ProductImport",function(e,t){e.data={},e.items=[],e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems()}),e.buildItemData=function(e){return e},e.getItems=function(){e.page++;var n="order_by=id,desc&includes=product.merchants&page="+e.page;t.getVariants(n).then(function(t){t.page==t.last_page&&(e.loadMore=!1),console.log("Items",t.data);var n=t.data;for(item in n)n[item]=e.buildItemData(n[item]);e.items=e.items.concat(n)},function(e){})},e.updateItem=function(e){t.updateVariantItem(e).then(function(e){},function(e){})},e.deleteItem=function(e){t.deleteVariantItem(e).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("CartCtrl",["$scope","Cart","$rootScope",function(e,t,n){angular.element(document).ready(function(){"https://lonchis.com.co/auth/login"==window.location.href||"http://www.lonchis.com.co/auth/login"==window.location.href||e.getCart()}),e.clean=function(){angular.forEach(angular.element(".item-attributes"),function(e,t){var n=angular.element(e),o=JSON.parse(n.html()),r="";for(x in o)r+=x+": "+o[x]+" <br/>";n.html(r),n.css("display","block")})},n.$on("updateHeadCart",function(){e.getCart()}),e.getCart=function(){t.getCart().then(function(t){"error"==t.status?alert(t.message):(e.items=t.items,e.totalItems=t.totalItems)},function(e){})},e.updateCartItem=function(n){var o=angular.element(document.querySelector("input[name=quantity-"+n+"]")).val();console.log("da qty: "+o),t.updateCartItem(n,o).then(function(t){"error"==t.status&&alert(t.message),e.getCart()},function(e){})},e.clearCart=function(){t.clearCart().then(function(t){e.getCart()},function(e){})},e.deleteCartItem=function(n){t.updateCartItem(n,0).then(function(t){"error"==t.status&&alert(t.message),e.getCart()},function(e){})}}])},function(e,t){angular.module("besafe").controller("CheckoutCartCtrl",["$scope","$rootScope","Users","Checkout","Products","$window",function(e,t,n,o,r,a){e.data={},angular.element(document).ready(function(){e.getCart()}),e.cleanJson=function(){angular.forEach(angular.element(".item-attributes"),function(e,t){var n=angular.element(e),o=JSON.parse(n.html()),r="";for(x in o)r+=x+": "+o[x]+" <br/>";n.html(r),n.css("display","block")})},e.getCart=function(){r.getCheckoutCart().then(function(n){"error"==n.status?alert(n.message):n.items.length>0?(e.items=n.items,e.totalItems=n.totalItems,e.subtotal=n.subtotal,e.shipping=n.shipping,e.tax=n.tax,e.sale=n.sale,e.coupon=n.coupon,e.discount=n.sale+n.coupon,e.total=n.total,n.is_shippable?t.$broadcast("Shippable"):t.$broadcast("NotShippable")):a.location.href="/products"},function(e){})},e.updateCartItem=function(t){var n=angular.element(document.querySelector("input[name=check-quantity-"+t+"]")).val();r.updateCartItem(t,n).then(function(t){"error"==t.status&&alert(t.message),e.getCart()},function(e){})},e.clearCart=function(){r.clearCart().then(function(t){e.getCart()},function(e){})},e.deleteCartItem=function(t){r.updateCartItem(t,0).then(function(t){"error"==t.status&&alert(t.message),e.getCart()},function(e){})},e.save=function(t){e.submitted=!0,t&&n.saveAddress($.param(e.data)).then(function(t){e.getAddresses(),e.data={},e.submitted=!1},function(e){})},e.setCoupon=function(e){o.setCoupon(e).then(function(e){angular.element(document.querySelector(".replace-address")).html(e)},function(e){})},t.$on("updateCheckoutCart",function(t,n){e.getCart()})}]).controller("CheckoutShippingCtrl",["$scope","$rootScope","LocationService","Users","Checkout","Products","$window",function(e,t,n,o,r,a,i){e.data={},e.regionVisible=!1,e.cityVisible=!1,e.addAddress=!1,e.visible=!1,t.shippingAddressSet=!0,t.shippingCondition=!0,t.billingAddressSet=!1,t.paymentMethodSet=!1,t.$on("Shippable",function(n,o){t.shippingAddressSet=!1,t.shippingCondition=!1,t.billingAddressSet=!1,t.paymentMethodSet=!1,e.visible=!0}),angular.element(document).ready(function(){e.getAddresses(),n.getCountries("").then(function(e){t.countries=e.data},function(e){})}),t.$on("NotShippable",function(t,n){e.visible=!1}),e.cleanJson=function(){angular.forEach(angular.element(".item-attributes"),function(e,t){var n=angular.element(e),o=JSON.parse(n.html()),r="";for(x in o)r+=x+": "+o[x]+" <br/>";n.html(r),n.css("display","block")})},e.save=function(t){e.submitted=!0,t&&o.saveAddress($.param(e.data)).then(function(t){e.getAddresses(),e.selectAddress(t.address.id),e.data={},e.submitted=!1,e.hideAddressForm()},function(e){})},e.getAddresses=function(){o.getAddresses().then(function(e){t.addresses=e.addresses},function(e){})},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.selectCountry=function(t){n.getRegionsCountry(t).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1},function(e){})},e.selectRegion=function(t){n.getCitiesRegion(t).then(function(t){e.cities=t.data,e.cityVisible=!0},function(e){})},e.selectPlace=function(t,o,r){e.data.country_id=t,n.getRegionsCountry(t).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1,e.data.region_id=o,n.getCitiesRegion(o).then(function(t){e.cities=t.data,e.cityVisible=!0,e.data.city_id=r},function(e){})},function(e){})},e.selectAddress=function(n){r.setShippingAddress(n).then(function(o){t.shippingAddressSet=!0,e.getShippingConditions(n);for(x in t.addresses)console.log(t.addresses[x].id),console.log(n),console.log(""),t.addresses[x].id==n?t.addresses[x].selectedB=!0:t.addresses[x].selectedB=!1},function(e){})},e.getShippingConditions=function(t){r.getShippingConditions(t).then(function(t){for(item in t)t[item].value=t[item].value.replace("+","");e.shippingMethods=t},function(e){})},e.showAddressForm=function(){e.addAddress=!0,e.data.type="shipping"},e.hideAddressForm=function(){e.addAddress=!1},e.setShippingCondition=function(n){r.setShippingCondition(n).then(function(o){t.shippingCondition=!0,t.$broadcast("updateCheckoutCart");for(x in e.shippingMethods)e.shippingMethods[x].id==n?e.shippingMethods[x].selected=!0:e.shippingMethods[x].selected=!1},function(e){})}}]).controller("CheckoutBillingCtrl",["$scope","$rootScope","LocationService","Users","Checkout","Payu","$window",function(e,t,n,o,r,a,s){e.data={},e.data2={},e.data3={},e.data4={},e.banks=[],e.regionVisible=!1,e.cityVisible=!1,e.addAddress=!1,e.credito=!1,e.cash=!1,e.isDigital=!1,e.debito=!1,angular.element(document).ready(function(){var t=new Date;e.years=[],e.months=[];var n=t.getFullYear();for(i=0;i<12;i++)i<9?e.months.push("0"+(i+1)):e.months.push(i+1);for(i=0;i<13;i++)e.years.push(n+i)}),t.$on("Shippable",function(t,n){e.isDigital=!1}),t.$on("NotShippable",function(t,n){e.isDigital=!0}),e.save=function(t){e.submitted=!0,t&&o.saveAddress($.param(e.data)).then(function(t){e.getAddresses(),e.selectAddress(t.address.id),e.data={},e.submitted=!1,e.hideAddressForm()},function(e){})},e.payCreditCard=function(t){e.submitted2=!0,t&&a.payCreditCard($.param(e.data2)).then(function(e){},function(e){})},e.payDebitCard=function(t){e.submitted3=!0,t&&a.payDebitCard($.param(e.data3)).then(function(e){window.location.href=e.transactionResponse.extraParameters.BANK_URL},function(e){})},e.payCash=function(t){e.submitted4=!0,t&&a.payCash($.param(e.data4)).then(function(e){window.location.href=e.transactionResponse.extraParameters.URL_PAYMENT_RECEIPT_HTML},function(e){})},e.selectAddress=function(e){r.setBillingAddress(e).then(function(n){t.billingAddressSet=!0;for(x in t.addresses)(t.addresses[x].id=e)?t.addresses[x].selected=!0:t.addresses[x].selected=!1},function(e){})},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.clean2=function(){e.data2={}},e.fill=function(){e.data2.cc_branch="VISA",e.data2.cc_name="APPROVED",e.data2.cc_number="4111111111111111",e.data2.cc_security_code="123",e.data2.cc_expiration_month="09",e.data2.cc_expiration_year="2017",e.data2.payer_email="harredon01@gmail.com",e.data2.payer_id="321321321"},e.fill2=function(){e.data3.user_type="N",e.data3.pse_reference2="CC",e.data3.pse_reference3="1020716535",e.data3.payer_email="harredon01@gmail.com"},e.fill3=function(){e.data4.payer_email="harredon01@gmail.com"},e.selectCountry=function(t){n.getRegionsCountry(t).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1},function(e){})},e.selectRegion=function(t){n.getCitiesRegion(t).then(function(t){e.cities=t.data,e.cityVisible=!0},function(e){})},e.selectPlace=function(t,o,r){e.data.country_id=t,n.getRegionsCountry(t).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1,e.data.region_id=o,n.getCitiesRegion(o).then(function(t){e.cities=t.data,e.cityVisible=!0,e.data.city_id=r},function(e){})},function(e){})},e.showAddressForm=function(){e.addAddress=!0,e.data.type="billing"},e.hideAddressForm=function(){e.addAddress=!1},e.showMethod=function(t){e.credito=!1,e.cash=!1,e.debito=!1,"PSE"==t&&(e.debito=!0,a.getBanks().then(function(t){e.banks=t.banks},function(e){})),"CC"==t&&(e.credito=!0),"BALOTO"==t&&(e.cash=!0)}}]).controller("CheckoutGatewaysCtrl",function(){})},function(e,t){angular.module("besafe").controller("DeliveriesCtrl",["$scope","$rootScope","Food","MapService",function(e,t,n,o){e.data={},e.listArticles={},e.deliveries=[],e.page=0,e.loadMore=!0,e.status="enqueue",e.activeDate="",e.regionVisible=!1,e.editAddress=!1,e.mapActive=!1,angular.element(document).ready(function(){var t=new Date,n=t.getDay();n<6?t.setDate(t.getDate()+1):6==n&&t.setDate(t.getDate()+2),e.activeDate=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(),e.getArticles(),e.buildDatePicker()}),e.buildDatePicker=function(){var t="yy-mm-dd";$("#from").datepicker({defaultDate:"+1d",changeMonth:!0,numberOfMonths:2,dateFormat:t}).on("change",function(){console.log("date1",e.activeDate);var t=e.getDate(this);e.activeDate=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate(),console.log("date",e.activeDate)})},e.getDate=function(e){console.log("Get date",e.value);var t;try{t=$.datepicker.parseDate("yy-mm-dd",e.value)}catch(n){t=null}return t},e.updateDels=function(){e.page=0,e.deliveries=[],e.getArticles()},e.activateMap=function(){e.mapActive=!0,console.log("Creating map data"),o.createMap(4.685419,-74.064161),e.createMapData()},e.changeScenario=function(){e.getDeliveries()},e.createMapData=function(){console.log("Creating map data");var t=e.deliveries[0],n=0,r=0;for(var a in e.deliveries)r++,e.deliveries[a].address_id==t.address_id?n++:(t.icon="http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+n+"|FE6256|000000",o.createStop(t),t=e.deliveries[a],n=1),r==e.deliveries.length&&(t.icon="http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+n+"|FE6256|000000",o.createStop(t))},e.getDeliveries=function(){console.log("Status",e.status),e.page++;var t="includes=user,address&limit=50&order_by=address_id,asc&page="+e.page+"&status="+e.status+"&delivery="+e.activeDate+" 12:00:00";n.getDeliveries(t).then(function(t){var n=t.data;if(t.page==t.last_page&&(e.loadMore=!1),n.length>0)for(item in n){var o=n[item];o.details=JSON.parse(o.details),o.name=o.address.address,o.lat=o.address.lat,o.delivery=new Date(o.delivery),o["long"]=o.address["long"],e.deliveries.push(o)}console.log("Deliveries",e.deliveries),e.replaceFood()},function(e){})},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.sendReminder=function(){n.sendReminder().then(function(e){},function(e){})},e.sendNewsletter=function(){n.sendNewsletter()},e.showAll=function(){console.log("Creating map data");for(item in e.deliveries)e.deliveries[item].marker.setMap(t.map)},e.hideAll=function(){for(item in e.deliveries)e.deliveries[item].marker.setMap(null)},e.showDelivery=function(n){e.hideAll(),n.marker.setMap(t.map)},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.updateDeliveryAddress=function(e,t){n.updateDeliveryAddress(e,t).then(function(e){window.location.reload()},function(e){})},e.getPurchaseOrder=function(){n.getPurchaseOrder().then(function(e){},function(e){})},e.getArticle=function(t){console.log("getArticle",t);for(var n in e.listArticles)if(e.listArticles[n].id==t)return console.log("getArticleres",e.listArticles[n]),e.listArticles[n]},e.replaceFood=function(){console.log("articles",e.listArticles);for(var t in e.deliveries){console.log("delivery",e.deliveries[t].id);var n=e.deliveries[t].details;if(n.dish){e.deliveries[t].build=!1,e.deliveries[t].type_id=n.dish.type_id;var o=e.getArticle(n.dish.type_id);if(o){n.tipoAlmuerzo=o.name;for(item2 in o.attributes.entradas)o.attributes.entradas[item2].codigo==n.dish.starter_id&&(n.entrada=o.attributes.entradas[item2].valor,e.deliveries[t].starter_id=n.dish.starter_id);for(item3 in o.attributes.plato)o.attributes.plato[item3].codigo==n.dish.main_id&&(n.plato=o.attributes.plato[item3].valor,e.deliveries[t].main_id=n.dish.main_id);delete n.dish,delete n.products,delete n.merchant_id,e.deliveries[t].details=n}console.log("deliveryDone",e.deliveries[t].id)}else e.deliveries[t].type_id=null,e.deliveries[t].starter_id=null,e.deliveries[t].main_id=null,e.deliveries[t].build=!0}},e.selectMissingType=function(t){var n=e.getArticle(t.type_id);t.starters=n.attributes.entradas,t.mains=n.attributes.plato},e.selectDish=function(t){var o=t.details,r=e.getArticle(t.type_id);o.tipoAlmuerzo=r.name;for(item2 in r.attributes.entradas)r.attributes.entradas[item2].codigo==t.starter_id&&(o.entrada=r.attributes.entradas[item2].valor);for(item3 in r.attributes.plato)r.attributes.plato[item3].codigo==t.main_id&&(o.plato=r.attributes.plato[item3].valor);t.details=o;var a={delivery_id:t.id,type_id:t.type_id,main_id:t.main_id};t.starter_id&&(a.starter_id=t.starter_id),t.build=!1,console.log("Updating dish: ",a),n.updateMissingDish(a)},e.getArticles=function(){n.getArticlesByDate(e.activeDate).then(function(t){e.listArticles=t.data;for(var n in e.listArticles)e.listArticles[n].attributes=JSON.parse(e.listArticles[n].attributes);e.getDeliveries()},function(e){})},e.regenerateDeliveries=function(){n.regenerateDeliveries().then(function(e){},function(e){})},e.getInputs=function(){var t;return t="enqueue"==e.status?{status:"enqueue"}:{status:e.status,provider:e.provider,type:e.scenario}}}])},function(e,t){angular.module("besafe").controller("ExportsCtrl",["$scope","Users","Merchants",function(e,t,n){e.data={},e.orders,e.from,e.to,e.user,e.activeMerchant,e.activeMerchantObject,e.changeMerchant=!0,e.showSearch=!1,e.datPickerBuilt=!1,e.loadMore=!0,e.page=0,angular.element(document).ready(function(){t.getUser().then(function(t){console.log("Result",t),e.user=t.user,e.user.id<4&&(e.showSearch=!0),e.getMerchantsPrivate()},function(e){})}),e.getMerchants=function(){e.page++,n.searchMerchants(e.searchTerms).then(function(t){console.log("Items",t.data),e.merchants=t.data},function(e){})},e.getMerchantsPrivate=function(){e.page++;var t="owner_id="+e.user.id+"&page="+e.page;n.getMerchantsPrivate(t).then(function(t){console.log("Items",t.data),e.merchants=t.data},function(e){})},e.changeActiveMerchant=function(){e.changeMerchant=!0},e.cancelChangeMerchant=function(){e.changeMerchant=!1},e.selectMerchant=function(t){e.page=0,e.items=[],e.activeMerchantObject=t,e.activeMerchant=t.id+"",e.changeMerchant=!1,e.datPickerBuilt||setTimeout(function(){e.buildDatePicker()},800)},e.buildDatePicker=function(){e.datPickerBuilt=!0;var t="yy-mm-dd",n=$("#from").datepicker({defaultDate:"-1m",changeMonth:!0,numberOfMonths:2,dateFormat:t}).on("change",function(){o.datepicker("option","minDate",e.getDate(this)),e.from=e.getDate(this)}),o=$("#to").datepicker({defaultDate:"+1w",changeMonth:!0,numberOfMonths:2,dateFormat:t}).on("change",function(){n.datepicker("option","maxDate",e.getDate(this)),e.to=e.getDate(this)})},e.getDate=function(e){console.log("Get date",e.value);var t;try{t=$.datepicker.parseDate("yy-mm-dd",e.value)}catch(n){t=null}return t},e.startExport=function(t){"orders"==t?e.getStoreExport():e.getContentExport(t)},e.getStoreExport=function(){console.log("Date",e.from,e.to);var t={from:e.from,to:e.to,merchant_id:e.activeMerchant,type:"products"};n.getStoreExport(t).then(function(e){},function(e){})},e.getContentExport=function(t){var o={merchant_id:e.activeMerchant,type:t};n.getStoreContent(o).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("FoodAddressesCtrl",["$scope","Food",function(e,t){e.data={},e.addresses,e.regionVisible=!1,e.editAddress=!1,e.mapActive=!1,angular.element(document).ready(function(){e.getAddresses()}),e.delegateAddress=function(e,n){var o="";o="Rapigo"==e.provider?"Basilikum":"Rapigo";var r=(new Date(e.delivery),{address:e.address,provider:o,complete:n,merchant_id:e.merchant_id});t.delegateDeliveriesAddress(r).then(function(e){},function(e){})},e.buildAddressData=function(e){return e},e.getAddresses=function(){t.getLargestAddresses().then(function(t){var n=t.data;for(item in n)n[item]=e.buildAddressData(n[item]);e.addresses=n},function(e){})}}])},function(e,t){angular.module("besafe").controller("FoodMessagesCtrl",["$scope","Food",function(e,t){e.data={},e.items=[],e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems()}),e.buildItemData=function(e){return e},e.getItems=function(){e.page++;var n="order_by=id,desc&page="+e.page;t.getMessages(n).then(function(t){t.page==t.last_page&&(e.loadMore=!1);var n=t.data;for(item in n)n[item]=e.buildItemData(n[item]);e.items=e.items.concat(n),console.log("Load more",e.loadMore)},function(e){})},e.updateItem=function(e){t.updateMessageItem(e).then(function(e){},function(e){})},e.deleteItem=function(e){t.deleteMessageItem(e).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("GroupsSelectionCtrl",["$scope","Groups","$rootScope","Users",function(e,t,n,o){e.data={},e.invites=[],e.groups=[],e.contacts=[],e.chosen=[],e.searchText="",e.objectSelected=!1,e.editGroup=!1,e.isActive=!1,e.save=function(t){e.submitted=!0,console.log("Saving: "+t),t&&e.saveGroup()},e.groupToggle=function(){e.editGroup?e.editGroup=!1:(e.editGroup=!0,0==e.contacts.length&&e.getContacts())},e.activation=function(){e.isActive?e.isActive=!1:e.isActive=!0},e.saveGroup=function(){console.log("Data sent"),console.log(JSON.stringify(e.data)),console.log(JSON.stringify($.param(e.data)));var n={name:e.data.name,is_public:!0,contacts:e.invites,completeData:e.chosen};t.saveGroup($.param(n)).then(function(t){console.log("Return group"),console.log(JSON.stringify(t)),"success"==t.status&&(e.selectGroup(t.group),e.groups.push(t.group)),e.data={},e.submitted=!1},function(e){})},e.getGroups=function(){t.getGroups().then(function(t){var n=t.data;for(item in n){var o=n[item];o.is_selected=!1,e.groups.push(o)}0==n.length&&(e.editGroup=!0)},function(e){})},e.getContacts=function(){o.getContacts(e.searchText).then(function(t){e.contacts=[],e.contacts=t.data},function(e){})},e.selectContact=function(t){e.invites.push(t.contact_id),e.chosen.push(t);for(item in e.contacts)e.contacts[item].contact_id==t.contact_id&&e.contacts.splice(item,1)},e.deleteContact=function(t){for(item in e.chosen)e.chosen[item].contact_id==t.contact_id&&e.chosen.splice(item,1);for(item in e.invites)e.invites[item]==t.contact_id&&e.chosen.splice(item,1)},e.selectGroup=function(t){t.is_selected=!0,e.isActive=!1,n.$broadcast("ObjectSelected",{object_id:t.id})},n.$on("PlanSelected",function(t,n){e.isActive=!0,0==e.groups.length&&e.getGroups()}),e.clean=function(){e.data={},e.invites=[]}}])},function(e,t){angular.module("besafe").controller("MapLocationCtrl",["$scope","$rootScope","MapService","$cookies",function(e,t,n,o){e.map={center:{latitude:4.65345,longitude:-74.049605},zoom:8},t.activeMarker=null,t.markers=[],t.mapLoaded=!1;var r=window.location.href,a=r.split("/map/");console.log("url"),console.log(JSON.stringify(a)),n.createMap(4.65345,-74.049605),n.postMapLocation(),console.log(navigator.geolocation),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){e.$apply(function(){console.log("Position",t),e.position=t,n.createLocationMarker(t.coords.latitude,t.coords.longitude,!0)})},function(t){e.$apply(function(){console.log("Position",t),e.initMap()})}):e["default"](),e["default"]=function(){n.createLocationMarker(4.65345,-74.049605,!1)},e.cancel=function(){window.history.back()},e.saveLocation=function(){if(o.put("shippingAddress",JSON.stringify(t.shippingAddress)),console.log("shippingAddress",JSON.stringify(t.shippingAddress)),o.locationRefferrer){var e="";e=o.locationRefferrer.includes("?")?o.locationRefferrer+"&lat="+t.shippingAddress.lat+"&long="+t.shippingAddress["long"]:o.locationRefferrer+"?lat="+t.shippingAddress.lat+"&long="+t.shippingAddress["long"]}else r="/?lat="+t.shippingAddress.lat+"&long="+t.shippingAddress["long"];window.location.href=r}}])},function(e,t){angular.module("besafe").controller("MenuCtrl",["$scope","Food",function(e,t){e.data={},e.items=[],e.loadMore=!0,e.page=0,e.contentType="",e.config={},angular.element(document).ready(function(){e.getItems(),e.contentType=e.config.content}),e.buildItemData=function(e){return e.attributes=JSON.parse(e.attributes),e},e.getItems=function(){e.page++;var n="type=lunch&order_by=id,desc&page="+e.page;t.getMenu(n).then(function(t){t.page==t.last_page&&(e.loadMore=!1);var n=t.data;for(item in n)n[item]=e.buildItemData(n[item]);e.items=e.items.concat(n)},function(e){})},e.updateItem=function(e){t.updateMenuItem(e).then(function(e){},function(e){})},e.deleteItem=function(e){t.deleteMenuItem(e).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("MerchantsCtrl",["$scope","LocationService","Merchants","Users","Categories",function(e,t,n,o,r){e.data={},e.user={},e.page=0,e.merchants=[],e.categories=[],e.regionVisible=!1,e.editMerchant=!1,e.submitted=!1,angular.element(document).ready(function(){var n="";t.getCountries(n).then(function(t){e.countries=t.data},function(e){}),r.getCategories("merchants").then(function(t){e.categories=t.categories},function(e){}),o.getUser().then(function(t){console.log("Get User",t),e.user=t.user,e.getMerchants()},function(e){})}),e.save=function(t){if(e.submitted=!0,t){var o=!1;e.data.id&&(o=!0),n.saveMerchant($.param(e.data)).then(function(t){o?e.updateMerchant(t.merchant):e.merchantes.push(t.merchant),e.data={},e.submitted=!1,e.editMerchant=!1},function(e){})}},e.getMerchants=function(){e.page++;var t="owner_id="+e.user.id+"&page="+e.page;n.getMerchants(t).then(function(t){e.merchants=t.merchants},function(e){})},e.deleteMerchant=function(t){n.deleteMerchant(t).then(function(n){t=""+t;for(item in e.merchants)e.merchants[item].merchant_id==t&&(console.log("deleting merchant",e.merchants[item]),e.merchants.splice(item,1))},function(e){})},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.updateMerchant=function(t){for(item in e.merchants)e.merchants[item].id==t.id&&(e.merchants.splice(item,1),e.merchants.push(t))},e.selectCountry=function(){for(item in e.countries)e.countries[item].id==e.data.country_id&&(e.data.country=e.countries[item].country_iso);t.getRegionsCountry(e.data.country_id).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1},function(e){})},e.selectRegion=function(){for(item in e.regions)e.countries[item].id==e.data.region_id&&(e.data.region=e.countries[item].name)},e.selectPlace=function(n,o){e.data.country_id=n;for(item in e.countries)e.countries[item].id==e.data.country_id&&(e.data.country=e.countries[item].country_iso);t.getRegionsCountry(n).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1,e.data.region_id=o,e.selectRegion()},function(e){})},e.editMerchant=function(t){e.editMerchant=!0;for(item in e.merchants)e.merchants[item].id==t&&(e.data=e.merchants[item],e.selectPlace(e.data.country_id,e.data.region_id))}}])},function(e,t){angular.module("besafe").controller("OrdersCtrl",["$scope","Orders",function(e,t){e.data={},e.orders,e.from,e.to,e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.buildDatePicker(),e.getOrders()}),e.buildDatePicker=function(){var t="yy-mm-dd",n=$("#from").datepicker({defaultDate:"-1m",changeMonth:!0,numberOfMonths:2,dateFormat:t}).on("change",function(){o.datepicker("option","minDate",e.getDate(this)),
e.from=e.getDate(this)}),o=$("#to").datepicker({defaultDate:"+1w",changeMonth:!0,numberOfMonths:2,dateFormat:t}).on("change",function(){n.datepicker("option","maxDate",e.getDate(this)),e.to=e.getDate(this)})},e.getDate=function(e){console.log("Get date",e.value);var t;try{t=$.datepicker.parseDate("yy-mm-dd",e.value)}catch(n){t=null}return t},e.buildOrderData=function(e){var t=e.items;for(item in t)t[item].attributes=JSON.parse(t[item].attributes);return e.items=t,e},e.getOrders=function(){e.page++;var n="includes=orderConditions,items,payments,user&order_by=id,desc&page="+e.page;t.getOrders(n).then(function(t){t.page==t.last_page&&(e.loadMore=!1);var n=t.data;for(item in n)n[item]=e.buildOrderData(n[item]);e.orders=n},function(e){})},e.updateOrderStatus=function(e,n){t.updateOrderStatus(e,n).then(function(e){},function(e){})},e.getStoreExport=function(){console.log("Date",e.from,e.to),t.getStoreExport(e.from,e.to).then(function(e){},function(e){})},e.approveOrder=function(e){t.approveOrder(e.id).then(function(t){e.status="scheduled"},function(e){})}}])},function(e,t){angular.module("besafe").controller("PaymentsCtrl",["$scope","Payments",function(e,t){e.data={},e.payments,e.loadMore=!0,e.page=0,e.regionVisible=!1,e.editPayment=!1,angular.element(document).ready(function(){e.getPayments()}),e.getPayments=function(){e.page++;var n="includes=order,user&order_by=id,desc&page="+e.page;t.getPayments(n).then(function(t){t.page==t.last_page&&(e.loadMore=!1),e.payments=t.data},function(e){})},e.approvePayment=function(e){t.approvePayment(e.id).then(function(t){e.status="approved"},function(e){})}}])},function(e,t){angular.module("besafe").controller("ProductsCtrl",["$scope","Cart","$rootScope","$sce",function(e,t,n,o){e.categories=[],angular.element(document).ready(function(){e.clean(),e.categories=JSON.parse(viewData);for(var t in e.categories)for(var n in e.categories[t].products)e.categories[t].products[n].description=o.trustAsHtml(e.categories[t].products[n].description);document.getElementById("dissapear").remove()}),e.clean=function(){angular.forEach(angular.element(".product-attributes"),function(e,t){var n=angular.element(e),o=JSON.parse(n.html()),r="";for(x in o)r+=x+": "+o[x]+" <br/>";n.html(r),n.css("display","block")})},e.tryClean=function(){console.log("data",viewData)},e.addCartItem=function(e,o,r){t.addCartItem(e,o,r).then(function(e){"error"==e.status?alert(e.message):n.$broadcast("updateHeadCart")},function(e){})}}])},function(e,t){angular.module("besafe").controller("RoutesCtrl",["$scope","$rootScope","Routes","Food","MapService",function(e,t,n,o,r){e.data={},e.routes,e.page=0,e.returns=[{name:"casa",address_id:17663},{name:"basilikum",address_id:17660}],e.loadMore=!0,e.scenario="preorganize",e.status="pending",e.provider="Basilikum",e.regionVisible=!1,e.editAddress=!1,e.mapActive=!1,angular.element(document).ready(function(){e.getRoutes()}),e.save=function(t){if(e.submitted=!0,t){var o=!1;e.data.address_id&&(o=!0),n.saveAddress($.param(e.data)).then(function(t){o?e.updateAddress(t.address):e.routes.push(t.address),e.data={},e.submitted=!1,e.editAddress=!1},function(e){})}},e.changeScenario=function(){console.log("provider",e.provider),e.page=0,e.hideAll(),"Basilikum"==e.provider&&(e.scenario="preorganize"),e.routes=[],e.getRoutes()},e.activateMap=function(){e.mapActive=!0,console.log("Creating map data"),r.createMap(4.685419,-74.064161),e.createMapData()},e.createMapData=function(){console.log("Creating map data");for(route in e.routes){var t=e.routes[route].stops;for(item in t)console.log("Creating map data stop"),t[item].icon="http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+t[item].amount+"|FE6256|000000",t[item].marker=r.createStop(t[item]);e.routes[route].stops=t,console.log("Creating map data route");var n=r.getColor();e.routes[route].polyline=r.createRoute(e.routes[route],n)}},e.buildRouteData=function(t){var n=t.stops,o=[];for(item in n){n[item].details=JSON.parse(n[item].details);var a={lat:n[item].address.lat,lng:n[item].address["long"]};o.push(a),n[item].name=n[item].address.address,n[item].lat=n[item].address.lat,n[item]["long"]=n[item].address["long"],n[item].moving_delivery=null,e.mapActive&&(n[item].marker=r.createStop(n[item]))}if(t.stops=n,t.stopsLat=o,e.mapActive){var i=e.getRouteColor();t.polyline=r.createRoute(t,i)}return setTimeout(function(){var n=document.getElementById("route-"+t.id+"-table");new Sortable(n,{group:"routes",handle:".handle",dataIdAttr:t.id,onAdd:function(t){console.log("On add",t);var n=t.item.attributes,o=t.target.id;o=o.replace("route-",""),o=o.replace("-table","");var r=parseInt(o),a=null;for(item in n)"data-stop"==n[item].name&&(a=n[item].value);e.updateRouteLocation(r,a,t.newIndex,1e3)},onUpdate:function(t){var n=t.item.attributes,o=null,r=null;for(item in n)"data-route"==n[item].name&&(o=n[item].value),"data-stop"==n[item].name&&(r=n[item].value);o&&r&&e.updateRouteLocation(o,r,t.newIndex,t.oldIndex)}});console.log("Setting sortable")},1e3),t.address_id=17663,t},e.updateRouteLocation=function(t,n,o,r){console.log("Route",t),console.log("stop",n),console.log("index",o);var a=null,i=[];for(item in e.routes)if(e.routes[item].id==t){var s=e.routes[item],c=1;for(stopI in s.stops)s.stops[stopI].id==n?a=s.stops[stopI]:r>o?c>=o&&i.push(s.stops[stopI]):c>o&&i.push(s.stops[stopI]),c++}console.log("displacedStops",i),a||(a={},a.route_id=t,a.id=n),console.log("Moving stop",a),$(".preloader").fadeIn("slow"),e.updateRouteStop(a),setTimeout(function(){var t=1;if(i.length>0){for(item in i)e.updateSpeed(i[item],t),t++,console.log("displacing stop",i[item]);setTimeout(function(){window.location.reload()},300*(t+1))}else setTimeout(function(){window.location.reload()},300*(t+1))},1e3)},e.updateSpeed=function(t,n){setTimeout(function(){e.updateRouteStop(t)},300*(n+1))},e.getRoutes=function(){console.log("Status",e.status),console.log("provider",e.provider),e.page++;var t="includes=stops.address&order_by=id,asc&page="+e.page+"&type="+e.scenario+"&status="+e.status+"&provider="+e.provider;"pending"!=e.status&&(t="includes=stops.address&order_by=id,asc&page="+e.page+"&status="+e.status),n.getRoutes(t).then(function(t){var n=t.data;t.page==t.last_page&&(e.loadMore=!1);for(item in n)n[item]=e.buildRouteData(n[item]);e.routes=n},function(e){})},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.sendReminder=function(){o.sendReminder().then(function(e){},function(e){})},e.showAll=function(){console.log("Creating map data");for(route in e.routes){var n=e.routes[route].stops;for(item in n)console.log("Creating map data stop"),n[item].marker.setMap(t.map);e.routes[route].stops=n,e.routes[route].polyline.setMap(t.map)}},e.hideAll=function(){console.log("Creating map data");for(route in e.routes){var t=e.routes[route].stops;for(item in t)console.log("Creating map data stop"),t[item].marker&&t[item].marker.setMap(null);e.routes[route].stops=t,e.routes[route].polyline&&e.routes[route].polyline.setMap(null)}},e.showRoute=function(n){e.hideAll(),console.log("Creating map data");var o=n.stops;for(item in o)console.log("Creating map data stop"),o[item].marker.setMap(t.map);n.polyline.setMap(t.map)},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.updateRouteStop=function(e){n.updateRouteStop(e.id,e.route_id).then(function(e){},function(e){})},e.updateRouteDelivery=function(e){n.updateRouteStop(e.route_id,e.moving_delivery,e.id).then(function(e){},function(e){})},e.deleteRoute=function(e){n.deleteRoute(e).then(function(e){},function(e){})},e.deleteStop=function(e){n.deleteStop(e).then(function(e){window.location.reload()},function(e){})},e.sendStopToNewRoute=function(e){n.sendStopToNewRoute(e).then(function(e){window.location.reload()},function(e){})},e.addReturnStop=function(e,t){n.addReturnStop(e,t).then(function(e){window.location.reload()},function(e){})},e.buildRoute=function(e){o.buildScenarioRouteId(e.id).then(function(t){e.status="scheduled"},function(e){})},e.getPurchaseOrder=function(){o.getPurchaseOrder().then(function(e){},function(e){})},e.regenerateScenarios=function(){o.regenerateScenarios().then(function(e){window.location.reload()},function(e){})},e.regenerateDeliveries=function(){o.regenerateDeliveries().then(function(e){},function(e){})},e.getTotalShippingCosts=function(){o.getSummaryShipping(e.status).then(function(e){},function(e){})},e.getScenarioOrganization=function(){var t=e.getInputs();o.getScenarioOrganizationStructure(t).then(function(e){},function(e){})},e.buildScenarioLogistics=function(){var t=e.getInputs();o.buildScenarioLogistics(t).then(function(e){window.location.reload()},function(e){})},e.getInputs=function(){var t;return t="enqueue"==e.status?{status:"enqueue"}:{status:e.status,provider:e.provider,type:e.scenario}},e.getScenarioEmails=function(){var t=e.getInputs();o.getScenarioStructure(t).then(function(e){},function(e){})}}])},function(e,t){angular.module("besafe").controller("SourcesCtrl",["$scope","Billing","$rootScope",function(e,t,n){function o(t){e.data.source=t,e.saveSource()}e.data={},e.months=[],e.years=[],e.branches=[{name:"Visa",value:"VISA"},{name:"Mastercard",value:"MASTERCARD"},{name:"Visa Debito",value:"VISA_DEBIT"},{name:"Diners",value:"DINERS"},{name:"American Express",value:"AMEX"}],e.sources=[],e.buying=!1,e.editSource=!1,e.showStripe=!1,e.hideDefault=!1,e.config={},angular.element(document).ready(function(){e.localGateway=e.config.gateway}),e.save=function(t){e.submitted=!0,console.log("Saving: "+t),t&&(e.showStripe=!0)},e.edit=function(){e.editSource?e.editSource=!1:e.editSource=!0};var r=stripe.elements({locale:$translate.use()}),a={base:{color:"#32325d",lineHeight:"24px",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}},s=r.create("card",{style:a});s.mount("#card-element"),s.addEventListener("change",function(e){var t=document.getElementById("card-errors");e.error?t.textContent=e.error.message:t.textContent=""});var c=document.getElementById("payment-form"),u={owner:{name:e.data.name,address:{line1:e.data.address,city:e.data.city,postal_code:e.data.postal,country:e.data.country},email:e.data.email}};c.addEventListener("submit",function(e){e.preventDefault(),stripe.createSource(s,u).then(function(e){if(e.error){var t=document.getElementById("card-errors");t.textContent=e.error.message}else o(e.source)})}),e.stripeCreateToken=function(){},e.loadMonths=function(){console.log("Loading months");var t=new Date;for(i=0;i<15;i++)e.years.push(t.getFullYear()+i);for(i=0;i<12;i++)e.months.push(1+i)},e.saveSource=function(){delete e.data.cvc,delete e.data.expMonth,delete e.data.expYear,delete e.data.number,delete e.data.postal,console.log("Data sent"),console.log(JSON.stringify(e.data)),console.log(JSON.stringify($.param(e.data))),t.createSource($.param(e.data),n.gateway).then(function(t){if(console.log("Return source"),console.log(JSON.stringify(t)),"card"==t.type){var n=t.card;n.type="card",e.sources.push(n),e.editSource=!1}e.data={},e.submitted=!1},function(e){})},e.getSources=function(n){t.getSources(n).then(function(t){var n=t.sources;for(item in n)if("card"==n[item].type){var o=n[item].card;o.type="card",o.id=n[item].id,o.is_default=n[item].is_default,e.sources.push(o)}0==n.length?(e.editSource=!0,e.hidedefault=!0,e.data["default"]=!0):e.hidedefault=!1},function(e){})},e.deleteSource=function(o){t.deleteSource(o.id,n.gateway).then(function(t){for(item in e.sources)e.sources[item].id==o.id&&(console.log("deleting source",e.sources[item]),e.sources.splice(item,1))},function(e){})},e.loadTestData=function(t){e.data.cvc="123",e.data.postal="33132",e.data.expYear="2020",e.data.expMonth="12"},e.selectSource=function(e){n.$broadcast("SourceSelected",{source:e.id})},n.$on("GetSources",function(t,n){e.getSources(n.gateway),e.buying=!0}),n.$on("GatewaySelected",function(t,o){n.gateway==e.localGateway&&(e.getSources(e.localGateway),e.loadMonths(),e.loadTestData())}),e.clean=function(){e.data={}},e.setAsDefault=function(o){var r={};r.source=o.id,t.setAsDefault(r,n.gateway).then(function(t){for(item in e.sources)e.sources[item].is_default=!1,e.sources[item].id==o.id&&(e.sources[item].is_default=!0)},function(e){window.location.reload()})}}]).controller("SourcesPayuCtrl",["$scope","Billing","$rootScope",function(e,t,n){e.data={},e.months=[],e.years=[],e.branches=[{name:"Visa",value:"VISA"},{name:"Mastercard",value:"MASTERCARD"},{name:"Visa Debito",value:"VISA_DEBIT"},{name:"Diners",value:"DINERS"},{name:"American Express",value:"AMEX"}],e.sources=[],e.buying=!1,e.showErrors=!1,e.editSource=!1,e.errors=[],e.config={},angular.element(document).ready(function(){e.localGateway="PayU"}),e.save=function(t){e.submitted=!0,e.showErrors=!1,console.log("Saving: "+t),t&&e.saveSource()},e.edit=function(){e.editSource?e.editSource=!1:e.editSource=!0},e.loadMonths=function(){console.log("Loading months");var t=new Date;for(i=0;i<15;i++)e.years.push(t.getFullYear()+i);for(i=0;i<12;i++)e.months.push(1+i)},e.saveSource=function(){console.log("Data sent"),console.log(JSON.stringify(e.data)),console.log(JSON.stringify($.param(e.data))),t.createSource($.param(e.data),e.localGateway).then(function(t){console.log("Reply to create"),console.log(JSON.stringify(t)),"success"==t.status?(e.getSources(),e.data={},e.data.country="CO",e.submitted=!1,e.editSource=!1):(e.editSource=!0,e.errors=t,e.showErrors=!0)},function(e){})},e.getSources=function(){t.getSources(e.localGateway).then(function(t){console.log("Sources"),e.sources=[];var n=t.sources;console.log(JSON.stringify(n));for(item in n){var o=n[item];o.type="card",e.sources.push(o)}0==n.length&&(e.editSource=!0)},function(e){})},e.deleteSource=function(n){t.deleteSource(n.token,e.localGateway).then(function(t){for(item in e.sources)e.sources[item].token==n.token&&(console.log("deleting source",e.sources[item]),e.sources.splice(item,1),0==e.sources.length&&(e.editSource=!0))},function(e){})},e.loadTestData=function(){e.data.name="Hoovert Arredondo",e.data.line1="Calle 73 # 0-24",e.data.line2="Apto 202",e.data.line3="",e.data.postalCode="",e.data.city="Bogota",e.data.state="Cundinamarca",e.data.country="CO",e.data.phone="3105507245",e.data.document="1020716535",e.data.number="4111111111111111",e.data.expMonth="10",e.data.expYear="2020",e.data.branch="VISA"},e.selectSource=function(e){n.$broadcast("SourceSelected",{source:e.id})},n.$on("GetSources",function(t,n){e.getSources(),e.buying=!0}),n.$on("GatewaySelected",function(t,o){n.gateway==e.localGateway&&(e.getSources(),e.loadTestData())}),e.clean=function(){e.data={}},e.setAsDefault=function(n){var o={};o.source=n.token,t.setAsDefault(o,e.localGateway).then(function(t){for(item in e.sources)e.sources[item].is_default=!1,e.sources[item].token==n.token&&(e.sources[item].is_default=!0)},function(e){window.location.reload()})}}]).controller("SubscriptionsCtrl",["$scope","Billing",function(e,t){e.data={},e.subscriptions=[],e.plans=[],e.showEdit=!1,e.localGateway="",angular.element(document).ready(function(){e.getSubscriptions()}),e.save=function(n){if(e.submitted=!0,n){var o={plan_id:e.data.plan_id};t.editSubscription(o,e.data.subscription_id,e.localGateway).then(function(t){e.data.subscription_id=""+e.data.subscription_id;for(item in e.subscriptions)e.subscriptions[item].source_id==e.data.subscription_id&&(console.log("deleting subscription",e.subscriptions[item]),e.subscriptions.splice(item,1));e.subscriptions.push(t.subscription)},function(e){})}},e.getSubscriptions=function(){t.getSubscriptions().then(function(t){e.subscriptions=t.subscriptions;for(x in e.subscriptions){var n=e.subscriptions[x].object;e.subscriptions[x].object_name=n.name,e.subscriptions[x].object_code=n.code,e.subscriptions[x].object_status=n.status,e.subscriptions[x].object_ends=n.ends_at}},function(e){})},e.getPlans=function(){t.getPlans().then(function(t){e.plans=t.plans},function(e){})},e.deleteSubscription=function(n){t.deleteSubscription(n.source_id,n.gateway).then(function(t){var o=""+n.source_id;for(item in e.subscriptions)e.subscriptions[item].source_id==o&&e.subscriptions.splice(item,1)},function(e){})},e.clean=function(){e.data={}},e.editSubscription=function(t){e.data.subscription_id=t.id,e.getPlans(),e.showEdit=!0}}]).controller("PlansCtrl",["$scope","$rootScope",function(e,t){e.selectPlan=function(e){t.$broadcast("PlanSelected",{plan:e})}}]).controller("GatewaysCtrl",function(e,t){e.data={},e.objectSelected=!1,e.selectGateway=function(e){t.gateway=e,t.$broadcast("GatewaySelected")},t.$on("ObjectSelected",function(t,n){e.objectSelected=!0})}).controller("SubscriptionPlansStripeCtrl",function(e,t,n){function o(t,n){n.error||(e.data.source=n.id,e.createSubscription())}e.data={},e.months=[],e.years=[],e.sources=[],e.localGateway="",e.sourceSelected=!1,e.showSources=!1,e.buying=!0,e.data.object_id=1,angular.element(document).ready(function(){e.localGateway="Stripe"}),e.saveSimple=function(t){e.submitted=!0,t&&e.createSubscription()},e.save=function(t){e.submitted=!0,t&&e.stripeCreateToken()},e.loadMonths=function(){var t=new Date;for(i=0;i<15;i++)e.years.push(t.getFullYear()+i);for(i=0;i<12;i++)e.months.push(1+i)},e.editSources=function(){window.location.href="/sources"},e.loadTestData=function(){e.data.number="4242424242424242",e.data.cvc="123",e.data.postal="33132",e.data.expYear="2020",e.data.expMonth="12"},e.createSubscription=function(){e.data["default"]=!0,delete e.data.cvc,delete e.data.expMonth,delete e.data.expYear,delete e.data.number,delete e.data.postal,console.log("Data sent"),console.log(JSON.stringify(e.data)),console.log(JSON.stringify($.param(e.data))),t.createSubscription($.param(e.data),e.localGateway).then(function(t){"status"in t&&"success"==t.status&&(console.log("Subscription created"),e.data={},e.submitted=!1,window.location.href="/subscriptions"),e.errors=t,e.showErrors=!0},function(e){})},e.stripeCreateToken=function(){Stripe.source.create({type:"card",card:{number:e.data.number,cvc:e.data.cvc,exp_month:e.data.expMonth,exp_year:e.data.expYear},owner:{address:{postal_code:e.data.postal}}},o)},n.$on("PlanSelected",function(t,n){e.data.plan_id=n.plan}),n.$on("ObjectSelected",function(t,n){e.data.object_id=n.object_id}),n.$on("GatewaySelected",function(t,o){if(n.gateway==e.localGateway){console.log(JSON.stringify(e.config));var r=e.config.sources;console.log(e.localGateway);for(item in r)console.log(JSON.stringify(r[item])),r[item].gateway==e.localGateway&&r[item].has_default&&(e.sourceSelected=!0,console.log("Has default"));e.loadMonths(),e.loadTestData()}})}).controller("SubscriptionPlansPayuCtrl",["$scope","Billing","$rootScope",function(e,t,n){e.data={},e.months=[],e.years=[],e.branches=[{name:"Visa",value:"VISA"},{name:"Mastercard",value:"MASTERCARD"},{name:"Visa Debito",value:"VISA_DEBIT"},{name:"Diners",value:"DINERS"},{name:"American Express",value:"AMEX"}],e.sources=[],e.localGateway="",e.sourceSelected=!1,e.showSources=!1,e.buying=!0,e.hasDefault=!1,e.newCard=!1,e.data.object_id=1,angular.element(document).ready(function(){e.localGateway="PayU"}),e.saveSimple=function(t){e.submitted=!0,t&&e.createSubscription()},e.selectSource=function(t){e.data.source=t.token,e.submitted=!0,e.data.plan_id&&e.data.object_id&&(e.sourceSelected=!0,e.createSubscription())},e.newCardTrigger=function(){e.newCard=!0,e.sourceSelected=!1},e.getSources=function(){e.sourceSelected=!1,e.newCard=!1,t.getSources(e.localGateway).then(function(t){console.log("Sources"),e.sources=[];var n=t.sources;console.log(JSON.stringify(n));for(item in n){var o=n[item];o.type="card",e.sources.push(o)}0==n.length&&(e.newCard=!0)},function(e){})},e.save=function(t){e.submitted=!0,t&&(e.data["new"]=!0,e.createSubscription())},e.loadMonths=function(){var t=new Date;for(i=0;i<15;i++)e.years.push(t.getFullYear()+i);for(i=0;i<12;i++)e.months.push(1+i);console.log(JSON.stringify(e.months))},e.loadTestData=function(){console.log("Loading test data"),e.data.name="Hoovert Arredondo",e.data.line1="Calle 73 # 0-24",e.data.line2="Apto 202",e.data.line3="",e.data.postalCode="",e.data.city="Bogota",e.data.state="Cundinamarca",e.data.country="CO",e.data.phone="3105507245",e.data.document="1020716535",e.data.number="4111111111111111",e.data.expMonth="10",e.data.expYear="2020",e.data.branch="VISA"},e.createSubscription=function(){console.log("Data sent"),console.log(JSON.stringify(e.data)),console.log(JSON.stringify($.param(e.data))),t.createSubscription($.param(e.data),e.localGateway).then(function(t){return"status"in t&&"success"==t.status?(console.log("Subscription created"),e.data={},window.location.href="/subscriptions",e.submitted=!1,!0):(e.errors=t,void(e.showErrors=!0))},function(e){})},n.$on("PlanSelected",function(t,n){e.data.plan_id=n.plan}),n.$on("ObjectSelected",function(t,n){e.data.object_id=n.object_id}),n.$on("GatewaySelected",function(t,o){if(console.log(n.gateway),console.log(e.localGateway),console.log(n.gateway==e.localGateway),n.gateway==e.localGateway){console.log(JSON.stringify(e.config));var r=e.config.sources;console.log(e.localGateway);for(item in r)console.log(JSON.stringify(r[item])),r[item].gateway==e.localGateway&&r[item].has_default?(e.sourceSelected=!0,e.hasDefault=!0,console.log("Has default")):(e.sourceSelected=!1,e.hasDefault=!1,e.getSources());e.loadMonths(),e.loadTestData()}})}])},function(e,t){angular.module("besafe").controller("UserAddressesCtrl",["$scope","LocationService","Users",function(e,t,n){e.data={},e.addresses,e.regionVisible=!1,e.cityVisible=!1,angular.element(document).ready(function(){e.getAddresses();var n="";t.getCountries(n).then(function(t){e.countries=t.data},function(e){})}),e.save=function(t){if(e.submitted=!0,t){var o=!1;e.data.address_id&&(o=!0),n.saveAddress($.param(e.data)).then(function(t){o?e.updateAddress(t.address):e.addresses.push(t.address),e.data={},e.submitted=!1},function(e){})}},e.getAddresses=function(){n.getAddresses().then(function(t){e.addresses=t.addresses},function(e){})},e.deleteAddress=function(t){n.deleteAddress(t).then(function(n){t=""+t;for(item in e.addresses)e.addresses[item].address_id==t&&(console.log("deleting address",e.addresses[item]),e.addresses.splice(item,1))},function(e){})},e.billingAddress=function(t){n.setAsBillingAddress(t).then(function(t){e.getAddresses()},function(e){})},e.clean=function(){e.data={},e.regionVisible=!1,e.cityVisible=!1},e.updateAddress=function(t){for(item in e.addresses)e.addresses[item].address_id==t.address_id&&(e.addresses.splice(item,1),e.addresses.push(t))},e.selectCountry=function(n){t.getRegionsCountry(n).then(function(t){e.regions=t.data,e.regionVisible=!0,e.cityVisible=!1},function(e){})},e.selectRegion=function(n){t.getCitiesRegion(n).then(function(t){e.cities=t.data,e.cityVisible=!0},function(e){})},e.selectPlace=function(n,o,r){e.data.country_id=n,t.getRegionsCountry(n).then(function(n){e.regions=n.data,e.regionVisible=!0,e.cityVisible=!1,e.data.region_id=o,t.getCitiesRegion(o).then(function(t){e.cities=t.data,e.cityVisible=!0,e.data.city_id=r},function(e){})},function(e){})},e.editAddress=function(t){e.data.address_id=angular.element(document.querySelector("li#address-"+t+" span.address_id")).html(),e.data.type=angular.element(document.querySelector("li#address-"+t+" span.type")).html(),e.data.firstName=angular.element(document.querySelector("li#address-"+t+" span.firstName")).html(),e.data.lastName=angular.element(document.querySelector("li#address-"+t+" span.lastName")).html(),e.data.address=angular.element(document.querySelector("li#address-"+t+" span.address")).html(),e.data.phone=angular.element(document.querySelector("li#address-"+t+" span.phone")).html(),e.data.postal=angular.element(document.querySelector("li#address-"+t+" span.postal")).html(),e.selectPlace(angular.element(document.querySelector("li#address-"+t+" span.country_id")).html(),angular.element(document.querySelector("li#address-"+t+" span.region_id")).html(),angular.element(document.querySelector("li#address-"+t+" span.city_id")).html())}}]).controller("NotificationsCtrl",["$scope","$rootScope","Alerts",function(e,t,n){e.notifications=[],t.$broadcast("updateNotifList"),e.noavatar=API.avatar,e["delete"]=function(e){n.deleteNotification(e)},e.followNotification=function(e){n.get(e).then(function(e){console.log("After Get:"),console.log(JSON.stringify(e)),n.followNotification(e),console.log("After follow:"),console.log(JSON.stringify(e))},function(e){})},t.$on("updateNotifList",function(){e.notifications=[],n.loadNotificationsGlobal("50").then(function(n){for(notif in n){n[notif].created_at=new Date(n[notif].created_at),"location_first"==n[notif].type?n[notif]["class"]="ion-android-pin":"location_last"==n[notif].type?n[notif]["class"]="ion-android-pin":"notification_location"==n[notif].type?n[notif]["class"]="ion-android-compass":"emergency"==n[notif].type?n[notif]["class"]="ion-android-warning":"medical_emergency"==n[notif].type?n[notif]["class"]="ion-ios-medkit":"emergency_end"==n[notif].type?n[notif]["class"]="ion-flag":"user_message"==n[notif].type?n[notif]["class"]="ion-email":"group_message"==n[notif].type?n[notif]["class"]="ion-email":"new_contact"==n[notif].type?n[notif]["class"]="ion-person-stalker":"new_group"==n[notif].type?n[notif]["class"]="ion-person-stalker":"system"==n[notif].type&&(n[notif]["class"]="ion-alert");try{e.notifications.push(n[notif])}catch(o){console.log("Repetido"),console.log(JSON.stringify(n[notif]))}}t.notificationsChanged=!1},function(e){})}),t.$on("receivedNotification",function(e,n){t.$broadcast("updateNotifList")}),e.$on("$stateChangeSuccess",function(e,n,o,r,a){"tab.notifications"==n.name&&(console.log("Entering notifications"),1==t.notificationsChanged&&t.$broadcast("updateNotifList"))})}]).controller("UserRegisterCtrl",["$scope","LocationService","Users",function(e,t,n){e.data={},e.addresses,e.regionVisible=!1,e.cityVisible=!1,t.getCountries("").then(function(t){e.countries=t.data},function(e){})}]).controller("UserProfileCtrl",["$scope","LocationService","Users",function(e,t,n){e.data={},e.addresses,e.regionVisible=!1,e.cityVisible=!1,t.getCountries("").then(function(t){e.countries=t.data},function(e){}),e.save=function(t){if(e.submitted=!0,t){var o=!1;e.data.address_id&&(o=!0),n.saveUser($.param(e.data)).then(function(t){e.submitted=!1},function(e){})}}}])},function(e,t){angular.module("besafe").controller("ZonesCtrl",["$scope","$rootScope","Zones","MapService","Merchants",function(e,t,n,o,r){e.data={},e.items=[],e.merchants=[{name:"Plan de almuerzos",value:1299,id:1299},{name:"Para preparar en casa",value:1300,id:1300},{name:"Catering",value:1301,id:1301}],e.providers=[{name:"Basilikum",value:"Basilikum"},{name:"Rapigo",value:"Rapigo"}],e.activeMerchant="1299",e.activeMerchantObject={name:"Plan de almuerzos",value:1299,id:1299},e.activeProvider="Basilikum",e.searchTerms="",e.changeMerchant=!1,e.createNewMerchant=!1,e.loadMore=!0,e.page=0,angular.element(document).ready(function(){e.getItems(),o.createMap(4.685419,-74.064161)}),t.$on("zone-updated",function(t,n){for(item in e.items)e.items[item].id==n.id&&(e.items[item].isActive=!0,e.$digest())}),e.buildItemData=function(e){return e.isActive=!1,e},e.changeActiveMerchant=function(){e.changeMerchant=!0},e.createItemStart=function(){e.createNewMerchant=!0},e.cancelChangeMerchant=function(){e.changeMerchant=!1},e.activateMap=function(){e.mapActive=!0,console.log("Creating map data"),e.createMapData()},e.createMapData=function(){console.log("Creating map data");for(item in e.items){console.log("Creating map data item");var t=o.getColor();e.items[item].polygon=o.createPolygon(e.items[item],t)}},e.clearMap=function(){for(item in e.items)console.log("Creating map data item"),e.items[item].polygon.setMap(null),e.items[item].isActive=!1},e.changeScenario=function(){e.clearMap(),e.items=[],e.page=0,e.getItems()},e.getColor=function(){var e=["#FF0000","#800000","#FFFF00","#808000","#00FF00","#008000","#00FFFF","#008080","#0000FF","#000080","#FF00FF","#800080"],t=Math.round(Math.random()*(e.length-1));return e[t]},e.selectItem=function(n){e.clearMap(),n.isActive=!0,n.polygon.setMap(t.map)},e.createItem=function(){e.clearMap();var r=t.map.getCenter(),a={lat:r.lat(),lng:r.lng()};console.log("Center Map",a.lat);var i=[{lat:a.lat+.006,lng:a.lng},{lat:a.lat-.006,lng:a.lng-.006},{lat:a.lat-.006,lng:a.lng+.006},{lat:a.lat+.006,lng:a.lng}],s={city_id:524,region_id:11,address_id:14,country_id:1,merchant_id:e.activeMerchant,provider:e.activeProvider,coverage:JSON.stringify(i),lat:4.649824,"long":-74.058881};n.createZoneItem(s).then(function(t){var n=o.getColor(),r=t.item;r.isActive=!1,r.polygon=o.createPolygon(r,n),e.items.push(r)},function(e){})},e.getItems=function(){e.page++;var t="order_by=id,desc&page="+e.page+"&merchant_id="+e.activeMerchant+"&provider="+e.activeProvider;n.getZones(t).then(function(t){t.page==t.last_page&&(e.loadMore=!1),console.log("Items",t.data);var n=t.data;for(item in n)n[item]=e.buildItemData(n[item]);e.items=e.items.concat(n),e.activateMap()},function(e){})},e.getMerchants=function(){e.page++,r.searchMerchants(e.searchTerms).then(function(t){console.log("Items",t.data),e.merchants=t.data},function(e){})},e.selectMerchant=function(t){e.activeMerchantObject=t,e.clearMap(),e.page=0,e.items=[],e.activeMerchant=t.id+"",e.changeMerchant=!1,e.getItems()},e.updateItem=function(e){var t=e,o=[],r=null;t.polygon.getPaths().forEach(function(e,t){console.log("path",t);for(var n=e,a=0;a<n.getLength();a++){var i=n.getAt(a),s={lat:i.lat(),lng:i.lng()};o.push(s),0==a&&(r=s)}}),o.push(r);var a=t.polygon;delete t.polygon,delete t.isActive,t.coverage=JSON.stringify(o),console.log("Zone",t),console.log("Points",o),n.updateZoneItem(t).then(function(e){t.polygon=a,t.isActive=!1,console.log("updateZoneItem",e)},function(e){})},e.deleteItem=function(t){console.log("Zone",t),n.deleteZoneItem(t).then(function(n){for(t in e.items)console.log("Creating map data item"),e.items[t].polygon.setMap(null),e.items[t].isActive=!1,e.items.splice(t,1)},function(e){})}}])},function(e,t){angular.module("besafe").service("Addresses",["$q","$http",function(e,t){var n=function(){var n=e.defer();return t({method:"get",url:"/api/addresses"}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},o=function(n){var o=e.defer();return t({method:"POST",url:"/api/addresses",data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},r=function(n){var o=e.defer();return t({method:"DELETE",url:"/api/addresses/"+n}).success(function(e){console.log(e),o.resolve(e)}).error(function(){o.reject("Failed to Delete Address")}),o.promise};return{getAddresses:n,saveAddress:o,deleteAddress:r}}])},function(e,t){angular.module("besafe").service("Billing",["$q","$http",function(e,t){var n=function(n,o){var r=e.defer();return t({method:"POST",url:"api/subscriptions/"+o,data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get nearby")}),r.promise},o=function(n,o){var r=e.defer();return t({method:"POST",url:"api/subscriptions/"+o,data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get nearby")}),r.promise},r=function(n,o,r){var a=e.defer();return t({method:"POST",url:"api/subscriptions/"+r+"/"+o,data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to get nearby")}),a.promise},a=function(){var n=e.defer();return t({method:"GET",url:"api/subscriptions"}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get sources")}),n.promise},i=function(n,o){var r=e.defer();return t({method:"GET",url:"api/subscriptions/object/"+n+"/"+o}).success(function(e){r.resolve(e)}).error(function(){
r.reject("Failed to getSubscriptionsTypeObject")}),r.promise},s=function(n){var o="";o=n?"api/plans?"+n:"api/plans";var r=e.defer();return t({method:"GET",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get plans")}),r.promise},c=function(n,o){var r=e.defer();return t({method:"Delete",url:"api/subscriptions/"+o+"/"+n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get nearby")}),r.promise},u=function(n,o){var r=e.defer();return t({method:"POST",url:"api/sources/"+o,data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get nearby")}),r.promise},l=function(n){var o=e.defer();return t({method:"GET",url:"api/sources/"+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get sources")}),o.promise},d=function(n,o){var r=e.defer();return t({method:"Delete",url:"api/sources/"+o+"/"+n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get nearby")}),r.promise},f=function(n,o){var r=e.defer();return t({method:"POST",url:"api/sources/"+o+"/default",data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get nearby")}),r.promise},p=function(n){var o=e.defer();return t({method:"POST",url:"/pay/pay_cash",data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise};return{deleteSource:d,getSources:l,createSource:u,setAsDefault:f,getPlans:s,makeCharge:p,deleteSubscription:c,getSubscriptions:a,editSubscription:r,createSubscription:o,createSubscriptionExisting:n,getSubscriptionsTypeObject:i}}])},function(e,t){angular.module("besafe").service("Cart",["$q","$http",function(e,t){var n=function(n,o,r,a){var i=e.defer();return t({method:"post",url:"/api/cart/add",data:{product_variant_id:n,merchant_id:o,quantity:r,extras:a}}).success(function(e){i.resolve(e)}).error(function(){i.reject("Failed to get nearby")}),i.promise},o=function(n,o){var r=e.defer();return t({method:"post",url:"/api/cart/update",data:{item_id:n,quantity:o}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get nearby")}),r.promise},r=function(){var n=e.defer();return t({method:"GET",url:"/api/cart/get"}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},a=function(){var n=e.defer();return t({method:"GET",url:"/api/cart/checkout"}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},i=function(){var n=e.defer();return t({method:"post",url:"/api/cart/clear"}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise};return{getCheckoutCart:a,getCart:r,addCartItem:n,updateCartItem:o,clearCart:i}}])},function(e,t){angular.module("besafe").service("Categories",["$q","$http",function(e,t){var n=function(n){var o="/api/categories/"+n,r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get nearby")}),r.promise};return{getCategories:n}}])},function(e,t){angular.module("besafe").service("Checkout",["$q","$http",function(e,t){var n=function(n){var o=e.defer();return t({method:"POST",url:"/checkout/shippingAddress/"+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},o=function(n){var o=e.defer();return t({method:"POST",url:"/checkout/shippingCondition/"+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},r=function(n){var o=e.defer();return t({method:"POST",url:"/checkout/billingAddress/"+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},a=function(n){var o=e.defer();return t({method:"POST",url:"/checkout/coupon/"+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},i=function(n){var o=e.defer();return t({method:"GET",url:"/checkout/shippingConditions/"+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},s=function(n){var o=e.defer();return t.post("/payu/pay_cash",n).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},c=function(n){var o=e.defer();return t.post("/payu/pay_cash",n).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},u=function(n){var o=e.defer();return t.post("/payu/pay_cash",n).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},l=function(n){var o=e.defer();return t.post("/payu/pay_cash",n).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise};return{setShippingAddress:n,payCreditCard:s,setBillingAddress:r,setCoupon:a,payDebitCard:c,payCash:u,getBanks:l,setShippingCondition:o,getShippingConditions:i}}])},function(e,t){angular.module("besafe").service("Food",["$q","$http",function(e,t){var n=function(){var n="/api/food/newsletter",o=e.defer();return t({method:"get",url:n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to sendNewsletter")}),o.promise},o=function(n){var o="/api/food/deliveries";n&&(o=o+"?"+n);var r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get getDeliveries")}),r.promise},r=function(n){var o="/api/food/menu";n&&(o=o+"?"+n);var r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get getArticles")}),r.promise},a=function(n){var o="/api/admin/zones";n&&(o=o+"?"+n);var r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get getArticles")}),r.promise},i=function(n){var o="/api/food/messages";n&&(o=o+"?"+n);var r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get getArticles")}),r.promise},s=function(){var n="/api/food/largest_addresses",o=e.defer();return t({method:"get",url:n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get getLargestAddresses")}),o.promise},c=function(n){var o="/api/food/delegate_deliveries",r=e.defer();return t({method:"post",url:o,data:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get getLargestAddresses")}),r.promise},u=function(n,o){var r="/api/food/user/"+n+"/address/"+o,a=e.defer();return t({method:"post",url:r,data:{}}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to updateDeliveryAddress")}),a.promise},l=function(n){var o="/api/food/update_dish",r=e.defer();return t({method:"post",url:o,data:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to updateDeliveryAddress")}),r.promise},d=function(n){var o="/api/food/build_route_id/"+n,r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to buildScenarioRouteId")}),r.promise},f=function(n){var o="/api/food/build_scenario_positive/"+n,r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to buildScenarioPositive")}),r.promise},p=function(n){var o="/api/food/build_complete_scenario/"+n,r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to buildCompleteScenario")}),r.promise},m=function(n){var o="/api/food/get_scenario_structure",r=e.defer();return t({method:"get",url:o,params:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getScenarioStructure")}),r.promise},g=function(n){var o="/api/food/summary/"+n,r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getSummaryShipping")}),r.promise},h=function(n){var o="/api/food/route_organize",r=e.defer();return t({method:"get",url:o,params:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getScenarioOrganizationStructure")}),r.promise},v=function(n){var o="/api/food/build_scenario_logistics",r=e.defer();return t({method:"post",url:o,data:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to buildScenarioLogistics")}),r.promise},y=function(){var n="/api/food/purchase_order",o=e.defer();return t({method:"get",url:n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to getPurchaseOrder")}),o.promise},b=function(){var n="/api/food/regenerate_scenarios",o=e.defer();return t({method:"get",url:n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to regenerateScenarios")}),o.promise},S=function(){var n="/api/food/regenerate_deliveries",o=e.defer();return t({method:"get",url:n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to regenerateDeliveries")}),o.promise},k=function(n){var o=e.defer();return t({method:"POST",url:"/api/food/menu/"+n.id,data:n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to updateMenuItem")}),o.promise},_=function(n){console.log("Updating zone item",n);var o=e.defer();return t({method:"PATCH",url:"/api/admin/zones/"+n.id,data:n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to updateZoneItem")}),o.promise},C=function(n){var o=e.defer();return t({method:"POST",url:"/api/admin/zones",data:n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to createZoneItem")}),o.promise},w=function(n){var o=e.defer();return t({method:"POST",url:"/api/food/messages/"+n.id,data:n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to updateMessageItem")}),o.promise},M=function(){var n=e.defer();return t({method:"POST",url:"/api/food/reminder",data:{}}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to sendReminder")}),n.promise},A=function(n){var o=e.defer();return t({method:"DELETE",url:"/api/food/messages/"+n.id}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to deleteMessageItem")}),o.promise},F=function(n){var o=e.defer();return t({method:"DELETE",url:"/api/admin/zones/"+n.id}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to deleteZoneItem")}),o.promise},T=function(n){var o=e.defer();return t({method:"DELETE",url:"/api/food/content/"+n.id}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to deleteMenuItem")}),o.promise},P=function(n){var o=e.defer();return t({method:"GET",url:"/api/articles?start_date="+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to getArticlesByDate")}),o.promise};return{getMenu:r,getZones:a,getPurchaseOrder:y,delegateDeliveriesAddress:c,getMessages:i,getArticlesByDate:P,updateDeliveryAddress:u,buildScenarioLogistics:v,regenerateDeliveries:S,getScenarioStructure:m,getSummaryShipping:g,buildScenarioRouteId:d,getDeliveries:o,sendReminder:M,buildCompleteScenario:p,regenerateScenarios:b,buildScenarioPositive:f,updateZoneItem:_,createZoneItem:C,updateMenuItem:k,getScenarioOrganizationStructure:h,updateMessageItem:w,sendNewsletter:n,deleteZoneItem:F,updateMissingDish:l,deleteMenuItem:T,deleteMessageItem:A,getLargestAddresses:s}}])},function(e,t){angular.module("besafe").service("Groups",["$q","$http",function(e,t){var n=function(){var n=e.defer();return t({method:"get",url:"/api/groups"}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},o=function(n){var o=e.defer();return t({method:"POST",url:"/api/groups",data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise};return{saveGroup:o,getGroups:n}}])},function(e,t){angular.module("besafe").service("LocationService",["$q","$http","$rootScope",function(e,t,n){var o=function(n){var o=e.defer();return t({method:"get",url:"/api/locations"+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},r=function(n,o){var r=e.defer();return t({method:"get",headers:{"Content-Type":"application/json","X-Auth-Token":void 0,Authorization:void 0},url:"http://maps.googleapis.com/maps/api/geocode/json?latlng="+n+","+o+"&sensor=true"}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get nearby")}),r.promise},a=function(n){var o=e.defer();return console.log("Getting merchants"),console.log(JSON.stringify(n)),t({method:"get",url:"/api/merchants/nearby",params:n}).success(function(e){o.resolve(e)}).error(function(e){console.log(JSON.stringify(e)),o.reject("Failed to get nearby merchants")}),o.promise},i=function(n){console.log("Get locations trip: /historic_locations?target_id="+n.user_id+"&trip_id="+n.trip);var o=e.defer(),r="/historic_locations?target_id="+n.user_id+"&trip_id="+n.trip;return n.page&&(r=r+"&page="+n.page),n.perpage&&(r=r+"&per_page="+n.perpage),t.get(r).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},s=function(){var n=e.defer();return t({method:"get",url:"/api/locations/hash"}).success(function(e){n.resolve(e)}).error(function(e){console.log(JSON.stringify(e)),n.reject("Failed to get nearby")}),n.promise},c=function(n){var o=e.defer();return t({method:"get",url:"/api/cities?limit=50&region_id="+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},u=function(n){var o=e.defer();return t.post("/api/cities/from",n).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},l=function(n){var o=e.defer();return t({method:"get",url:"/api/regions?limit=40&country_id="+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},d=function(n){var o=e.defer();return t({method:"get",url:"/api/countries?id="+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},f=function(){var n=e.defer();return t({method:"get",url:"/api/countries?limit=50&order_by=name,asc"}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise};return{shared:o,merchants:a,getCountries:f,getUserHash:s,getCityFromLat:r,getRegionFromCity:u,getLocationsTrip:i,getCitiesRegion:c,getRegionsCountry:l,getCountry:d,getRegionName:function(e){for(region in n.regions){var t=n.regions[region];if(t.id==parseInt(e))return t.name}return null},isRegionsLoaded:function(){return!!n.regions},isCountriesLoaded:function(){return!!n.countries},getRegions:function(){return n.regions}}}])},function(e,t){angular.module("besafe").factory("MapService",["$q","$rootScope","LocationService",function(e,t,n){var o,r;t.map,t.iconpath="http://hoovert.com/images/icons",t.markers=[],t.polylines=[];var a,i=function(e,n){var o=new google.maps.LatLng(e,n);r={center:o,zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP},document.getElementById("map")&&(t.map=new google.maps.Map(document.getElementById("map"),r),a=new google.maps.InfoWindow,t.geocoder=new google.maps.Geocoder,t.mapActive=!0,t.mapLoaded=!0,t.tracking=!0,t.mapSemaphore=!0)},s=function(e){damap=t.map,console.log("info received in marker"),console.log(JSON.stringify(e));var n="";"still"==e.activity?(n="masculine-avatar.svg",console.log("entro still")):"on_foot"==e.activity?(console.log("entro on foot"),n="pedestrian-walking.svg"):"in_vehicle"==e.activity?n="car-front.svg":"on_bicycle"==e.activity?n="cycling.svg":"running"==e.activity?n="running.svg":""==e.activity&&(console.log("entro blank"),n="map-pin.svg");var o=new google.maps.Marker({id:e.id,user_id:e.user_id,position:new google.maps.LatLng(e.lat,e["long"]),map:damap,animation:google.maps.Animation.DROP,report_time:e.report_time,speed:e.speed,activity:e.activity,battery:e.battery,name:e.name,status:e.status,islast:e.islast,icon:{fillColor:"#ffffff",url:t.iconpath+"/"+n,fillOpacity:1,strokeColor:"#ffffff",strokeWeight:0,scaledSize:new google.maps.Size(35,35)}});return o.content='<div class="infoWindowContent">'+e.id+" "+e.name+"</div>",google.maps.event.addListener(o,"click",function(){a.setContent("<h2>"+o.report_time+"</h2>"+o.content),a.open(t.map,o)}),o},c=function(e,n,o){damap=t.map,console.log("info received in marker");var r=new google.maps.Marker({position:new google.maps.LatLng(e,n),map:damap,animation:google.maps.Animation.DROP,draggable:!0});return google.maps.event.addListener(r,"dragend",function(){var e=r.getPosition();y(e.lat(),e.lng()),w(e.lat(),e.lng(),1)}),o&&google.maps.event.trigger(r,"dragend"),t.locationMarker=r,r},u=function(e){damap=t.map;var n=new google.maps.Marker({id:e.id,position:new google.maps.LatLng(e.lat,e["long"]),map:damap,animation:google.maps.Animation.DROP,created_at:e.created_at,name:e.name});return n.content='<div class="infoWindowContent">'+e.id+" "+e.name+"</div>",google.maps.event.addListener(n,"click",function(){a.setContent("<h2>"+n.created_at+"</h2>"+n.content),a.open(t.map,n)}),n},l=function(e){damap=t.map,console.log("creating stop",e);var n=new google.maps.Marker({id:e.id,icon:e.icon,position:new google.maps.LatLng(e.lat,e["long"]),map:damap,animation:google.maps.Animation.DROP,name:e.name});return n.content='<div class="infoWindowContent">'+e.id+" "+e.name+"</div>",google.maps.event.addListener(n,"click",function(){a.setContent("<h2>"+n.created_at+"</h2>"+n.content),a.open(t.map,n)}),n},d=function(e,n){damap=t.map,console.log("createRoute",e);var o=e.stopsLat,r=new google.maps.Polyline({path:o,geodesic:!0,strokeColor:n,strokeOpacity:1,strokeWeight:2});return r.setMap(damap),r},f=function(){var e=["#FF0000","#800000","#FFFF00","#808000","#00FF00","#008000","#00FFFF","#008080","#0000FF","#000080","#FF00FF","#800080"],t=Math.round(Math.random()*(e.length-1));return e[t]},p=function(e,n){damap=t.map,console.log("createRoute",e);var o=JSON.parse(e.coverage),r=new google.maps.Polygon({id:e.id,paths:o,strokeColor:n,strokeOpacity:.8,editable:!0,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,draggable:!0,geodesic:!0});return r.setMap(damap),r.getPaths().forEach(function(n,o){google.maps.event.addListener(n,"insert_at",function(){console.log("zzinsert_at",e.id),t.$broadcast("zone-updated",e),e.isActive=!0}),google.maps.event.addListener(n,"remove_at",function(){console.log("zzinsert_at",e.id),t.$broadcast("zone-updated",e),e.isActive=!0}),google.maps.event.addListener(n,"set_at",function(){console.log("zzinsert_at",e.id),t.$broadcast("zone-updated",e)})}),google.maps.event.addListener(r,"dragend",function(){console.log("set_at.",r.id)}),r},m=function(e,n){if(console.log("Updating locations"),t.mapActive&&(console.log("Map Active"),t.mapSemaphore)){console.log("rootscope mapsemaphore true"),t.mapSemaphore=!1;var o="?page="+n+"&hash_id="+e;A(o,e)}},g=function(e){for(marker in t.markers)t.markers[marker]?t.markers[marker].user_id==e&&(t.markers[marker].setMap(null),t.markers.splice(marker,1)):t.markers.splice(marker,1)},h=function(e){for(polyline in t.polylines)if(t.polylines[polyline].user_id==e)return t.polylines[polyline];return null},v=function(e){console.log("add user to polyline"),t.mapLoaded||(t.mapLoaded=!0,i(e.lat,e["long"]));var n=new google.maps.LatLng(e.lat,e["long"]),o=h(e.user_id);if(o){g(e.user_id),console.log("pos added to existing poly");var r=o.getPath();r.push(n),"emergency"==e.status&&(o.status="emergency")}else{o=new google.maps.Polyline({strokeColor:"#000000",strokeOpacity:1,strokeWeight:3,user_id:e.user_id,name:e.name,status:e.status,visible:!0,isActive:!1});var r=o.getPath();r.push(n),o.setMap(t.map),console.log("new poly created and pos added: "+o.user_id),t.polylines.push(o)}e.owner_type="user",y(e.lat,e["long"]);var a=s(e);t.activeMarker=a,t.markers.push(a)},y=function(e,n){console.log("Setting map center"),o=new google.maps.LatLng(e,n),t.map&&(t.map.setZoom(15),t.map.setCenter(o))},b=function(e){for(target in e)e[target].id&&S(e[target])},S=function(e){console.log("Checking database for location: "+e.id),t.activeMarker?e.id>t.activeMarker.id&&(e.status=!0,console.log("Location exists: "),v(e)):v(e)},k=function(){t.map.addListener("dblclick",function(e){var n=e.latLng;t.locationMarker.setPosition(n),google.maps.event.trigger(t.locationMarker,"dragend"),y(n.lat(),n.lng()),w(n.lat(),n.lng(),1)}),t.map.addListener("click",function(e){var n=e.latLng;t.locationMarker.setPosition(n),google.maps.event.trigger(t.locationMarker,"dragend"),y(n.lat(),n.lng()),w(n.lat(),n.lng(),1)})},_=function(e){var t="";try{t=e[0].formatted_address}catch(n){}return t},C=function(e){if(e.length>0){var t,n=e[0],o=!1,r=0,a=n.address_components,i="";do{t=a[r];for(var s in t.types)"postal_code"==t.types[s]&&(i=t.long_name,o=!0);r++,r>=e.length&&(o=!0)}while(0==o);return console.log("decodePostalFromLatResult",i),i}},w=function(e,n,o){var r=this;M(e,n).then(function(a){if(console.log("Address from lat",a),a){var i={address:_(a),postal:C(a),lat:e,"long":n};t.shippingAddress=i,console.log("Result",i)}else if(console.log("Attempts",o),o<8){o++;var s=r;setTimeout(function(){s.getAddressAndPostal(e,n,o)},1e3)}})["catch"](function(e){console.log("Error getting location",e)})},M=function(n,o){var r=e.defer(),a={lat:parseFloat(n),lng:parseFloat(o)};return t.geocoder.geocode({location:a},function(e,t){"OK"===t?e[0]?r.resolve(e):r.resolve([]):window.alert("Geocoder failed due to: "+t)}),r.promise},A=function(e,o){n.shared(e).then(function(e){if(0==e.total)t.isActive=!1,alert("User has no active locations");else{var n=e.data;if(b(n),e.page<e.last_page){var r=e.page+1,a="?page="+r+"&hash_id="+o;A(a,o)}else t.mapSemaphore=!0,setTimeout(function(){console.log("Timeout Triggered"),m(o,e.page)},t.sharedTimeout)}},function(e){console.log(e)})};return{updateLocations:m,createMap:i,postMapLocation:k,createStop:l,createRoute:d,createLocationMarker:c,getColor:f,getAddressAndPostal:w,createPolygon:p,createReport:u}}])},function(e,t){angular.module("besafe").factory("MapDashService",["$q","$rootScope","LocationService",function(e,t,n){var o,r;t.map,t.iconpath="http://hoovert.com/images/icons",t.meicon="wasp.svg",t.markers=[],t.polylines=[];var a,s=function(e){var n=(t.markers.length,12),o=new google.maps.LatLng(4.704296,(-74.073775));r={center:o,zoom:n,mapTypeId:google.maps.MapTypeId.ROADMAP};var i=new google.maps.Map(document.getElementById(e),r);return a=new google.maps.InfoWindow,"map"==e&&(t.mapActive=!0,t.mapLoaded=!0,t.mapSemaphore=!0),i},c=function(e,n){console.log("Setting map center"),o=new google.maps.LatLng(e,n),t.map&&(t.map.setZoom(15),t.map.setCenter(o))},u=function(){return t.markers},l=function(e){for(marker in t.markers){var n=t.markers[marker];if(n.user_id==parseInt(e))return n}return null},d=function(e){for(polyline in t.polylines)if(t.polylines[polyline].user_id==e)return t.polylines[polyline];return null},f=function(e){for(polyline in t.polylines)if(t.polylines[polyline].user_id==e)return t.polylines[polyline];return null},p=function(e){if(console.log("add user to polyline"),F(e.user_id),"1"==e.islast)C(e.user_id);else{var n=new google.maps.LatLng(e.lat,e["long"]),o=d(e.user_id);if(o){O(e.user_id),console.log("pos added to existing poly");var r=o.getPath();r.push(n),"emergency"==e.status&&(o.status="emergency")}else{o=new google.maps.Polyline({strokeColor:"#000000",strokeOpacity:1,strokeWeight:3,user_id:e.user_id,name:e.name,status:e.status,visible:t.rootMapMarkers,isActive:!1});var r=o.getPath();r.push(n),t.rootMapMarkers?o.setMap(t.map):o.setMap(null),console.log("new poly created and pos added: "+o.user_id),t.polylines.push(o)}e.owner_type="user",v(e);var a=P(e,t.rootMapMarkers);t.markers.push(a)}},m=function(e){for(polyline in t.polylines)t.polylines[polyline].setMap(t.map)},g=function(){for(marker in t.merchants)t.merchants[marker].setMap(t.map)},h=function(){for(marker in t.reports)t.reports[marker].setMap(t.map);console.log("Done showing reports")},v=function(e){console.log("Check active: "+e.owner_type),console.log(JSON.stringify(e)),console.log("Active type: "+t.mapActiveType+" id: "+t.mapId),t.mapActiveType||(t.mapActiveType=e.owner_type),t.mapId||(t.mapId=e.user_id),t.mapActiveType==e.owner_type&&(console.log("type the same mapid: "+t.mapId+" user: "+e.user_id),"me"==t.mapActiveType&&k("me",-1,null),t.mapId==e.user_id&&(console.log("Set center map, id the same"),c(e.lat,e["long"])))},y=function(e,o){var r={lat:e,"long":o,radius:t.radius};n.merchants(r).then(function(e){var t=e.merchants;console.log(JSON.stringify(e)),console.log("merchants received from server: "+t.length),0==t.length?alert("No tenemos informacion de puntos de seguridad en ese punto"):_(e)},function(e){console.log(e)})},b=function(e,n){t.rootMapMarkers=!1,q(e,n).then(function(e){console.log("locations in trip: "+n+" count: "+e.length),console.log(JSON.stringify(e)),e.length>0?U(e):alert("No encuentro ese viaje")},function(e){})},S=function(){t.map.addListener("dblclick",function(e){var t=e.latLng;c(t.lat(),t.lng()),y(t.lat(),t.lng())}),t.memarkerpending&&(console.log("me marker was created before map so loading now"),t.memarkerpending=!1,t.memarker.setMap(t.map)),t.merchantspending&&(console.log("merchants were created before map so loading now"),g(),h(),t.merchantspending=!1),k(t.mapActiveType,t.mapId,null),alert("doble click para encontrar puntos de seguridad")},k=function(e,n,o){if(console.log("Setting as active: "+n+" type: "+e),t.mapActiveType=e,t.mapId=n,window.localStorage.setItem("MAP_ACTIVE_TYPE",e),window.localStorage.setItem("MAP_ACTIVE_ID",n),o)c(o.lat(),o.lng());else{var r=!1;if("emergency"==e||"user"==e||"medical_emergency"==e||"me"==e)t.tracking=!0,t.rootMapMarkers=!0,w(t.mapId)&&(r=!0);else if("trip"==e){var a=t.contactTrip,i=t.contactIdTrip;b(i,a),r=!0}if(!r){var s=t.markers.length;if(s>0){var u=t.markers[s-1];if(u){var l=u.getPosition(),d=l.latLng;if(d)return k("user",u.user_id),!0}}}if(!r&&t.trackingActive)return"me"!=e&&k("me",-1),!0}},_=function(e){var n=e.merchants;for(merchant in n){var o=!1;for(marker in t.merchants)if(n[merchant].id==t.merchants[marker].id){o=!0;break}0==o&&t.merchants.push(D(n[merchant]))}var r=e.reports;for(report in r){var o=!1;for(marker in t.reports)if(r[report].id==t.reports[marker].id){o=!0;break}0==o&&(r[report].type="Report",t.reports.push(D(r[report])))}return null},C=function(e){for(polyline in t.polylines)t.polylines[polyline]&&(t.polylines[polyline].user_id=e)&&(O(t.polylines[polyline].user_id),t.polylines[polyline].setMap(null),t.polylines.splice(polyline,1))},w=function(e){if(e>0){for(marker in t.markers)if(t.markers[marker].user_id=e){var n=t.markers[marker].getPosition();return c(n.lat(),n.lng()),t.markers[marker].setMap(t.map),!0}}else if(t.memarker){var n=t.memarker.getPosition();return c(n.lat(),n.lng()),!0}return!1},M=function(e){for(polyline in t.polylines)t.polylines[polyline]&&t.polylines[polyline].setMap(null)},A=function(e){var n=!1;for(unknown in t.followingUnknown)t.followingUnknown[unknown]==e&&(n=!0);0==n&&t.followingUnknown.push(e)},F=function(e){for(unknown in t.followingUnknown)if(t.followingUnknown[unknown]==e)return console.log("Removing user: "+e+" from unknowns"),t.followingUnknown.splice(unknown,1),!0;return!1},T=function(){t.followingUnknown.length>0?(t.tracking=!0,t.mapSemaphore=!0,console.log("Unknown markers"),console.log(JSON.stringify(t.followingUnknown)),setTimeout(function(){console.log("Timeout Triggered unknowns"),z()},t.sharedTimeout)):(window.localStorage.setItem("USER_TRACKING",!1),console.log("No one is sharing location with user"),t.$broadcast("NoSharers"))},P=function(e,n){n&&t.map?damap=t.map:damap=null,console.log("info received in marker"),console.log(JSON.stringify(e));var o="";"still"==e.activity?(o="masculine-avatar.svg",console.log("entro still")):"on_foot"==e.activity?(console.log("entro on foot"),o="pedestrian-walking.svg"):"in_vehicle"==e.activity?o="car-front.svg":"on_bicycle"==e.activity?o="cycling.svg":"running"==e.activity?o="running.svg":""==e.activity&&(console.log("entro blank"),o="map-pin.svg"),console.log("Icon path marker"),console.log(t.iconpath+"/"+o);var r=new google.maps.Marker({id:e.id,user_id:e.user_id,position:new google.maps.LatLng(e.lat,e["long"]),map:damap,animation:google.maps.Animation.DROP,report_time:e.report_time,speed:e.speed,activity:e.activity,battery:e.battery,name:e.name,status:e.status,islast:e.islast,icon:{fillColor:"#ffffff",url:t.iconpath+"/"+o,fillOpacity:1,strokeColor:"#ffffff",strokeWeight:0,scaledSize:new google.maps.Size(35,35)}});if(r.content='<div class="infoWindowContent">'+e.id+" "+e.name+"<br/><a onClick=\"window.open('http://waze.to/?ll="+e.lat+","+e["long"]+"&navigate=yes','_system','location=yes');return false;\">Waze</a><br/><a href=\"tel:"+e.phone+'">'+e.phone+"</a></div>",google.maps.event.addListener(r,"click",function(){a.setContent("<h2>"+r.report_time+"</h2>"+r.content),a.open(t.map,r);var e=r.getPosition();k("user",r.user_id,e)}),"emergency"==e.status){var i=r.getPosition();k("emergency",e.user_id,i)}return r},D=function(e){t.map?damap=t.map:(damap=null,t.merchantspending=!0,console.log("Merchant pending from adding to map"));var n="";"police"==e.type?n="police-shield.svg":"medical"==e.type?n="medic-suitcase.svg":"Report"==e.type&&(n="pin.svg"),console.log("icon: "+t.iconpath+"/"+n+" for type: "+e.type);var o=new google.maps.Marker({id:e.id,position:new google.maps.LatLng(e.lat,e["long"]),map:damap,animation:google.maps.Animation.DROP,icon:{fillColor:"#ffffff",url:t.iconpath+"/"+n,fillOpacity:1,strokeColor:"#ffffff",strokeWeight:0,scaledSize:new google.maps.Size(25,25)}});o.content='<div class="infoWindowContent">'+e.type+'<br/><a class="button icon-left ion-ios7-telephone button-calm button-outline" href="tel:+ '+e.telephone+'">'+e.telephone+"</a><br/>"+e.address+"<br/><a onClick=\"window.open('http://waze.to/?ll="+e.lat+","+e["long"]+"&navigate=yes','_system','location=yes');return false;\">Waze</a></div>";var n="";"police"==e.type?n="map-icon-police":"medical"==e.type?n="map-icon-health":"Report"==e.type&&(n="map-icon-report",o.content='<div class="infoWindowContent">'+e.type+"<br/>"+e.address+"<br/><a onClick=\"window.open('http://waze.to/?ll="+e.lat+","+e["long"]+"&navigate=yes','_system','location=yes');return false;\">Waze</a></div>"),console.log("creating merchant");var r=new google.maps.InfoWindow;return google.maps.event.addListener(o,"click",function(){r.setContent("<h2>"+e.name+"</h2>"+o.content),r.open(t.map,o)}),o},I=function(n){var o=e.defer(),r=0;for(target in n)n[target].id&&(r++,t.lastLocation<n[target].id&&(t.lastLocation=n[target].id),V(n[target]).then(function(e){r--,0==r&&o.resolve("done")},function(e){console.log("Error in checking locations"),console.error(JSON.stringify(e)),r--,0==r&&o.resolve("done")}));return o.promise},O=function(e){for(marker in t.markers)t.markers[marker]?t.markers[marker].user_id==e&&(t.markers[marker].setMap(null),t.markers.splice(marker,1)):t.markers.splice(marker,1)},$=function(){j(t.markers),M()},j=function(e){for(marker in e)e[marker]&&e[marker].setMap(null)},R=function(){if(t.tempMarkers){for(marker in t.tempMarkers)t.tempMarkers[marker]&&t.tempMarkers[marker].setMap(null);t.tempMarkers=[]}t.tempPolyline&&(t.tempPolyline.setMap(null),t.tempPolyline=null)},E=function(){L(t.markers),m()},L=function(e){for(marker in e)e[marker]&&e[marker].setMap(t.map)},x=function(e){for(marker in e)e[marker]?(console.log("id: "+e[marker].id),console.log("speed: "+e[marker].speed),console.log("activity: "+e[marker].activity),console.log("battery: "+e[marker].battery),console.log("lat: "+e[marker].lat),console.log("long: "+e[marker]["long"]),console.log("name: "+e[marker].name),console.log("trip: "+e[marker].trip),console.log("type: "+e[marker].type),console.log("user_id: "+e[marker].user_id),console.log("report_time: "+e[marker].report_time)):(console.log("Marker is null: "+marker),
console.log(e[marker]))},N=function(e){console.log(t.markers.length);for(marker in t.markers)if(console.log("Comparing markers"),t.markers[marker]){if(console.log(t.markers[marker].id),console.log(e),t.markers[marker].id==e)return console.log("Marker found, returning now"),t.markers[marker]}else t.markers.splice(marker,1);return null},V=function(n){var o=e.defer();console.log("Checking database for location: "+n.id);var r=!1;for(item in t.markers)t.markers[item].id==n.id&&(r=!0);if(r){n.status=!0,console.log("Location exists: ");var a=l(n.user_id);a?(console.log("User Marker Found"),a.id>=n.id?console.log("User Marker older"):(console.log("User Marker newer"),p(n))):(console.log("Marker does not exist"),p(n)),o.resolve(n)}else n.status=!0,console.log("Location does not exists"),p(n);return o.promise},G=function(e,t,n){console.log("Trying sql contactTrips not implemented yet")},J=function(e){console.log("Trying sql user trips not implemented yet")},U=function(e){var n,o=[];t.tempMarkers&&j(t.tempMarkers),t.tempMarkers=[],console.log("Showing markers: "+e.length),console.log(JSON.stringify(e));var r,a,s;for(i=0;i<e.length;i++)e[i]&&(r=new google.maps.LatLng(e[i].lat,e[i]["long"]),console.log("Showing marker: "),a=e[i].trip,s=e[i].user_id,marker=P(e[i],!0),t.tempMarkers.push(marker),o.push(r),n=e[i]);t.contactIdTrip=s,t.contactTrip=a,c(r.lat(),r.lng());var u=new google.maps.Polyline({path:o,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2,user_id:n.user_id,name:n.name,status:"closed"});t.tempPolyline&&(t.tempPolyline.setMap(null),t.tempPolyline=null),u.setMap(t.map),t.tempPolyline=u},q=function(e,t){console.log("contact trip locations not implemented at present: "+e+" trip: "+t)},z=function(){if(console.log("Updating locations"),t.tracking)if(console.log("rootscope tracking true"),t.mapSemaphore){console.log("rootscope mapsemaphore true"),t.mapSemaphore=!1;var e=t.lastLocation,n=1,o="?page="+n+"&id_after="+e;Z(o,e)}else T();else T()},B=function(e){console.log("saveTrip: "),console.log(JSON.stringify(e)),n.getLocationsTrip(e).then(function(n){var o=n.data;if(console.log("Locations received from server: "+o.length),console.log(JSON.stringify(o)),I(o),n.page<n.last_page){if(4==n.page)return void t.$broadcast("receivedTripDetail",{trigger_id:e.user_id});e.page=n.page+1,B(e)}else t.$broadcast("receivedTripDetail",{trigger_id:e.user_id})},function(e){console.log(e)})},Z=function(e,o){n.shared(e).then(function(e){if(0==e.total)T();else{var n=e.data;if(n.reverse(),I(n).then(function(e){t.mapSharedLoaded=!0},function(e){console.log(e)}),e.page<e.last_page){var r=e.page+1,a="?page="+r+"&id_after="+o;Z(a,o)}else t.mapSemaphore=!0,setTimeout(function(){console.log("Timeout Triggered"),z()},t.sharedTimeout)}},function(e){console.log(e)})};return{createMarker:P,clearTemps:R,createMap:s,getNearbyMerchants:y,contactTripsCount:J,deleteUserObjects:C,deleteUserMarkers:O,getUserPolyline:f,saveTrip:B,checkMarkers:I,contactTripLocations:q,contactTrips:G,consoleLogMarkers:x,getMarker:N,hideAllActiveMarkers:$,hideMarkers:j,showAllActiveMarkers:E,showMarkers:L,updateLocations:z,getMarkers:u,getUserMarker:l,displayTrip:U,addToUnknowns:A,removeFromUnknowns:F,setActive:k,checkActive:v,postMap:S}}])},function(e,t){angular.module("besafe").service("Merchants",["$q","$http",function(e,t){var n=function(n){var o="/api/merchants";n&&(o=o+"?"+n);var r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get merchants")}),r.promise},o=function(n){var o="/api/merchants";n&&(o=o+"?"+n);var r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get merchants")}),r.promise},r=function(n){var o="/api/admin/merchant/orders",r=e.defer();return t({method:"POST",url:o,data:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getStoreExport")}),r.promise},a=function(n){var o="/api/admin/merchant/content",r=e.defer();return t({method:"POST",url:o,data:n}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getStoreExport")}),r.promise},i=function(n){var o="/api/merchants/search";n&&(o=o+"?search="+n);var r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get merchants")}),r.promise},s=function(n){var o=e.defer(),r="/api/merchants",a="POST";if(n.id)var r="/api/merchants/"+n.id,a="PATCH";return t({method:a,url:r,data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to save/create merchant")}),o.promise},c=function(n){var o=e.defer();return t({method:"DELETE",url:"/api/merchants/"+n}).success(function(e){console.log(e),o.resolve(e)}).error(function(){o.reject("Failed to Delete Merchant")}),o.promise};return{getMerchants:n,getMerchantsPrivate:o,saveMerchant:s,getStoreContent:a,getStoreExport:r,searchMerchants:i,deleteMerchant:c}}])},function(e,t){angular.module("besafe").service("Orders",["$q","$http",function(e,t){var n=function(n){var o="/api/orders";n&&(o=o+"?"+n);var r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get orders")}),r.promise},o=function(n,o){var r="/api/store/reports",a=e.defer();return console.log("getStoreExport",n,o),t({method:"POST",url:r,data:{from:n,to:o}}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to getStoreExport")}),a.promise},r=function(n){var o=e.defer();return t({method:"POST",url:"/api/orders/"+n+"/approve",data:{}}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to approveOrder")}),o.promise},a=function(n,o){var r=e.defer();return t({method:"POST",url:"/api/orders/"+o+"/build",data:{status:n}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to updateOrderStatus")}),r.promise};return{getOrders:n,approveOrder:r,getStoreExport:o,updateOrderStatus:a}}])},function(e,t){angular.module("besafe").service("Passport",["$q","$http",function(e,t){var n=function(){var n=e.defer();return t({method:"GET",url:"/oauth/clients"}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get clients")}),n.promise},o=function(n){var o=e.defer();return t({method:"POST",url:"/oauth/clients",data:n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to create client")}),o.promise},r=function(n,o){var r=e.defer();return t({method:"PUT",url:"/oauth/clients/"+o,data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to update client")}),r.promise},a=function(n){var o=e.defer();return t({method:"DELETE",url:"/oauth/clients/"+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to delete client")}),o.promise},i=function(){var n=e.defer();return t({method:"get",url:"/oauth/scopes"}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},s=function(){var n=e.defer();return t({method:"get",url:"/oauth/personal-access-tokens"}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},c=function(n){var o=e.defer();return t({method:"POST",url:"/oauth/personal-access-tokens",data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to create client")}),o.promise},u=function(n){var o=e.defer();return t({method:"DELETE",url:"/oauth/personal-access-tokens/"+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to delete client")}),o.promise},l=function(){var n=e.defer();return t({method:"get",url:"/api/user/authtokens"}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},d=function(n){var o=e.defer();return t({method:"DELETE",url:"/oauth/tokens/"+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to delete client")}),o.promise};return{getOauthClients:n,createOauthClient:o,updateOauthClient:r,deleteOauthClient:a,getScopes:i,getPersonalAccessTokens:s,deletePersonalAccessTokens:u,getTokens:l,deleteTokens:d,createPersonalAccessToken:c}}])},function(e,t){angular.module("besafe").service("Payments",["$q","$http",function(e,t){var n=function(n){var o="/api/payments";n&&(o=o+"?"+n);var r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get payments")}),r.promise},o=function(n){var o=e.defer();return t({method:"POST",url:"/api/payments/"+n+"/approve",data:{}}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to approvePayment")}),o.promise};return{getPayments:n,approvePayment:o}}])},function(e,t){angular.module("besafe").service("Payu",["$q","$http",function(e,t){var n=function(n){var o=e.defer();return t({method:"POST",url:"/checkout/shippingAddress/"+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},o=function(n){var o=e.defer();return t({method:"POST",url:"/pay/pay_cc",data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},r=function(){var n=e.defer();return t({method:"GET",url:"/pay/banks"}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},a=function(n){var o=e.defer();return t({method:"POST",url:"/pay/pay_debit",data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},i=function(n){var o=e.defer();return t({method:"POST",url:"/pay/pay_cash",data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},s=function(n){var o=e.defer();return t({method:"POST",url:"/checkout/shippingCondition/"+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},c=function(n){var o=e.defer();return t({method:"POST",url:"/checkout/billingAddress/"+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},u=function(n){var o=e.defer();return t({method:"POST",url:"/checkout/coupon/"+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},l=function(n){var o=e.defer();return t({method:"GET",url:"/checkout/shippingConditions/"+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise};return{setShippingAddress:n,payCreditCard:o,setBillingAddress:c,setCoupon:u,payDebitCard:a,payCash:i,getBanks:r,setShippingCondition:s,getShippingConditions:l}}])},function(e,t){angular.module("besafe").service("ProductImport",["$q","$http",function(e,t){var n=function(n){var o="/api/admin/store/products";n&&(o=o+"?"+n);var r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getProducts")}),r.promise},o=function(n){var o="/api/admin/store/variants";n&&(o=o+"?"+n);var r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getVariants")}),r.promise},r=function(n){var o="/api/admin/store/merchants";n&&(o=o+"?"+n);var r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getMerchants")}),r.promise},a=function(n){var o="/api/admin/store/categories";n&&(o=o+"?"+n);var r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to getCategories")}),r.promise},i=function(n){var o=e.defer();return t({method:"DELETE",url:"/api/admin/store/products/"+n.id}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to deleteProductItem")}),o.promise},s=function(n){var o=e.defer();return t({method:"DELETE",url:"/api/admin/store/merchants/"+n.id}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to deleteMerchantItem")}),o.promise},c=function(n){var o=e.defer();return t({method:"DELETE",url:"/api/admin/store/variants/"+n.id}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to deleteVariantItem")}),o.promise},u=function(n){var o=e.defer();return t({method:"DELETE",url:"/api/admin/store/categories/"+n.id}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to deleteCategoryItem")}),o.promise};return{getProducts:n,getVariants:o,getMerchants:r,getCategories:a,deleteProductItem:i,deleteMerchantItem:s,deleteVariantItem:c,deleteCategoryItem:u}}])},function(e,t){angular.module("besafe").service("Products",["$q","$http",function(e,t){var n=function(n,o,r,a){var i=e.defer();return t({method:"post",url:"/api/cart/add",data:{product_variant_id:n,merchant_id:o,quantity:r,extras:a}}).success(function(e){i.resolve(e)}).error(function(){i.reject("Failed to get nearby")}),i.promise},o=function(n,o){var r=e.defer();return t({method:"post",url:"/api/cart/update",data:{item_id:n,quantity:o}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get nearby")}),r.promise},r=function(){var n=e.defer();return t({method:"GET",url:"/api/cart/get"}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},a=function(){var n=e.defer();return t({method:"GET",url:"/api/cart/checkout"}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},i=function(){var n=e.defer();return t({method:"post",url:"/api/cart/clear"}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise};return{getCheckoutCart:a,getCart:r,addCartItem:n,updateCartItem:o,clearCart:i}}])},function(e,t){angular.module("besafe").service("Routes",["$q","$http",function(e,t){var n=function(n){var o="/api/routes";n&&(o=o+"?"+n);var r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get routes")}),r.promise},o=function(n){var o="/api/routes/"+n,r=e.defer();return t({method:"delete",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to deleteRoute")}),r.promise},r=function(n){var o="/api/stops/"+n,r=e.defer();return t({method:"delete",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to deleteStop")}),r.promise},a=function(n){var o=e.defer();return t({method:"POST",url:"/api/routes/"+n+"/build",data:{}}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to buildRoute")}),o.promise},i=function(n,o){var r=e.defer();return t({method:"POST",url:"/api/routes/"+n+"/stop/"+o,data:{}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to updateRouteStops")}),r.promise},s=function(n,o,r){var a=e.defer();return t({method:"POST",url:"/api/routes/add_delivery",data:{route_id:n,delivery_id:o,stop_id:r}}).success(function(e){a.resolve(e)}).error(function(){a.reject("Failed to updateRouteDelivery")}),a.promise},c=function(n){var o=e.defer();return t({method:"POST",url:"/api/routes/stop/"+n,data:{}}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to sendStopToNewRoute")}),o.promise},u=function(n,o){var r=e.defer();return t({method:"POST",url:"/api/routes/"+n+"/return",data:{address_id:o}}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to sendStopToNewRoute")}),r.promise};return{getRoutes:n,deleteStop:r,deleteRoute:o,sendStopToNewRoute:c,buildRoute:a,addReturnStop:u,updateRouteStop:i,updateRouteDelivery:s}}])},function(e,t){angular.module("besafe").service("Users",["$q","$http",function(e,t){var n=function(n){var o=e.defer();return t({method:"POST",url:"/user/billingAddress/"+n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},o=function(){var n=e.defer();return t({method:"get",url:"/api/addresses"}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get nearby")}),n.promise},r=function(n){var o=e.defer();return t({method:"POST",url:"/api/addresses",data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to get nearby")}),o.promise},a=function(n){var o=e.defer();return t({method:"POST",url:"/api/user",data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to create user")}),o.promise},i=function(){var n=e.defer();return t({method:"GET",url:"/api/user"}).success(function(e){n.resolve(e)}).error(function(){n.reject("Failed to get user")}),n.promise},s=function(n){var o=e.defer();return t({method:"DELETE",url:"/api/addresses/"+n}).success(function(e){console.log(e),o.resolve(e)}).error(function(){o.reject("Failed to Delete Address")}),o.promise},c=function(n){var o="";n.length>0&&(o="?name=*"+n+"*");var r=e.defer();return t({method:"get",url:"/api/contacts"+o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get nearby")}),r.promise};return{setAsBillingAddress:n,getAddresses:o,saveAddress:r,deleteAddress:s,saveUser:a,getContacts:c,getUser:i}}])},function(e,t){angular.module("besafe").service("Zones",["$q","$http",function(e,t){var n=function(n){var o="/api/admin/zones";n&&(o=o+"?"+n);var r=e.defer();return t({method:"get",url:o}).success(function(e){r.resolve(e)}).error(function(){r.reject("Failed to get getArticles")}),r.promise},o=function(n){console.log("Updating zone item",n);var o=e.defer();return t({method:"PATCH",url:"/api/admin/zones/"+n.id,data:n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to updateZoneItem")}),o.promise},r=function(n){var o=e.defer();return t({method:"POST",url:"/api/admin/zones",data:n}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to createZoneItem")}),o.promise},a=function(n){var o=e.defer();return t({method:"DELETE",url:"/api/admin/zones/"+n.id}).success(function(e){o.resolve(e)}).error(function(){o.reject("Failed to deleteZoneItem")}),o.promise};return{getZones:n,updateZoneItem:o,createZoneItem:r,deleteZoneItem:a}}])},function(e,t,n){n(0),n(1),n(23),n(15),n(20),n(8),n(9),n(2),n(22),n(3),n(21),n(18),n(11),n(19),n(14),n(16),n(17),n(10),n(6),n(7),n(5),n(4),n(12),n(13),n(24),n(33),n(35),n(28),n(27),n(34),n(43),n(32),n(41),n(29),n(39),n(26),n(37),n(31),n(25),n(42),n(38),n(36),n(40),n(30),e.exports=n(44)}]);